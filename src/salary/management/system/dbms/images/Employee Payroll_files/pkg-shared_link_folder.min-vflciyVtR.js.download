define("modules/clean/loggers/device_type",["require","exports","tslib","modules/core/browser_detection"],(function(e,t,r,n){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),(function(e){e.desktop="desktop",e.mobile="mobile",e.tablet="tablet"})(a=t.DeviceType||(t.DeviceType={})),t.getDeviceType=function(){return n.is_supported_mobile_browser()?a.mobile:n.is_tablet()?a.tablet:a.desktop}})),define("modules/clean/loggers/folder_preview_logger",["require","exports","tslib","modules/clean/ajax","modules/core/browser","modules/constants/request","modules/clean/react/previews/constants","modules/clean/web_timing_logger","modules/clean/uuid","modules/clean/loggers/device_type"],(function(e,t,r,n,a,i,o,s,l,d){"use strict";var u;function c(e){return+!!e}function f(e){return JSON.stringify(r.__assign(r.__assign({},e),{has_cached_data:c(e.has_cached_data),folder_preview_timeline:JSON.stringify(e.folder_preview_timeline),subfolder_nav_tracking:c(e.subfolder_nav_tracking),web_timing_data:JSON.stringify(e.web_timing_data)}))}function p(e){var t=r.__assign({},e.extra),n=a.performance();if(null!=n){var i=n.timing;i&&i.fetchStart&&(t.time_to_first_byte=i.responseStart-i.fetchStart,t.web_timing_data=i)}return{device_type:e.deviceType,folder_preview_session_id:e.id,folder_ns_id:e.ns_id||0,web_request_id:e.web_request_id,extra:f(t)}}Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),a=r.__importStar(a),i=r.__importStar(i),(function(e){e.attempted="preview_attempted",e.renderSucceeded="render_succeeded",e.renderFailed="render_failed",e.ended="preview_session_ended",e.appDownloadInterstitialClose="app_download_interstitial_close",e.appDownloadInterstitialContinue="app_download_interstitial_continue",e.appDownloadInterstitialInstall="app_download_interstitial_install",e.appDownloadInterstitialView="app_download_interstitial_view",e.breadcrumbClicked="breadcrumb_clicked"})(u=t.EventType||(t.EventType={})),t.createSession=function(e){var t=void 0===e?{}:e,r=t.id,n=void 0===r?l.UUID.v4({allowInsecure:!0}):r,u=t.ns_id,c=void 0===u?0:u,f=t.deviceType,p=void 0===f?d.getDeviceType():f,_=t.web_request_id,m=void 0===_?i.REQUEST_ID:_,h=t.source_action,g=void 0===h?o.PreviewSourceAction.Visit:h,v=t.subfolder_nav_tracking,y=t.has_cached_data,b=t.use_odyssey,w=void 0!==b&&b,k=t.folder_id;return{id:n,ns_id:c,web_request_id:m,deviceType:p,extra:{start_time:g===o.PreviewSourceAction.Visit?s.start_time():a.now(),subfolder_nav_tracking:v,has_cached_data:y,source_action:g,folder_preview_timeline:{},use_odyssey:w,folder_id:k}}},t.markPrimaryEvent=function(e){var t=e.extra;if(!t.primary_mark_ts){var r=a.now();t.primary_mark_ts=r;var n=t.start_time;n&&t.primary_mark_ts&&(t.time_to_primary_mark=t.primary_mark_ts-n)}},t.logEvent=function(e,t){var i=t.extra.folder_preview_timeline,o=a.now();if(!i.preview_session_ended_ts){switch(e){case u.attempted:if(i.preview_attempted_ts)return;i.preview_attempted_ts=o;break;case u.ended:if(i.preview_session_ended_ts)return;i.preview_session_ended_ts=o;break;case u.renderSucceeded:if(i.render_succeeded_ts)return;i.render_succeeded_ts=o;break;case u.renderFailed:if(i.render_failed_ts)return;i.render_failed_ts=o}return(function(e,t){return n.SilentBackgroundBeaconRequest({url:"/log/folder_preview",data:r.__assign(r.__assign({},p(t)),{event_name:e})})})(e,t)}}})),define("modules/clean/photos/batching_thumb_store",["require","exports","tslib","modules/clean/photos/thumb_loading/batching_thumb_loader","modules/clean/photos/thumb_loading/generic_thumb_store","modules/constants/request"],(function(e,t,r,n,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=r.__importStar(i);t.default=function(e){var t=!(!e||!e.allow_http2)&&e.allow_http2,r=i.IS_HTTP2&&t,o=r?void 0:new n.BatchingThumbLoader;return new a.GenericThumbStore(o,!r)}})),define("modules/clean/photos/thumb_loading/batching_thumb_loader",["require","exports","modules/clean/photos/batch_thumb_loader","modules/clean/photos/thumb_loading/utils"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(){function e(){this.batch_thumb_loader=new r.BatchThumbLoader({})}return e.prototype.get_request_id=function(){return this.batch_thumb_loader.vend_request_id()},e.prototype.load_image=function(e,t,r,n,a,i){this.batch_thumb_loader.queue_thumb(e,this._thumb_loaded.bind(this,{url:e,request_id:t,success:n,error:a,should_retry:i}),{onrequest:r,request_id:t}),window.setTimeout(this.batch_thumb_loader.flush.bind(this.batch_thumb_loader,10))},e.prototype._thumb_loaded=function(e,t){var r=e.url,a=(e.request_id,e.success),i=e.error,o=e.should_retry;t&&0===t.indexOf("data:")?a(t):n.load_individual_image(r,0,a,i,o)},e.prototype.cancel_thumb=function(e){this.batch_thumb_loader.cancel_thumb(e)},e})();t.BatchingThumbLoader=a})),define("modules/clean/prefetch/prefetch",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPrefetchData=function(e){var t=window[e];if(t)return(function(e){return new Promise((function(t,r){var n=e.getDataIfAvailable();n?n.payload?t(JSON.parse(n.payload)):r(n.error):e((function(e){return t(JSON.parse(e))}),r)}))})(t)}})),define("modules/clean/react/shared_link_folder/api",["require","exports","modules/clean/prefetch/prefetch","modules/clean/ajax"],(function(e,t,r,n){"use strict";function a(e){return{_mount_access_perms:e._mount_access_perms,filename:e.filename,href:e.href,is_dir:e.is_dir,ns_id:e.ns_id,open_in_app_data:e.open_in_app_data,shared_folder_id:e.shared_folder_id,sort_key:e.sort_key,folder_id:e.folder_id}}function i(e){return{canCopyToDropboxRoles:e.canCopyToDropboxRoles,canDownloadRoles:e.canDownloadRoles,canPrintRoles:e.canPrintRoles,canRemoveLinkUids:e.canRemoveLinkUids,canSyncToDropboxRoles:e.canSyncToDropboxRoles,canViewContextMenuRoles:e.canViewContextMenuRoles,canViewMetadataRoles:e.canViewMetadataRoles}}function o(e){return{itemId:e.itemId,linkKey:e.linkKey,linkType:e.linkType,secureHash:e.secureHash,subPath:e.subPath}}function s(e){for(var t,r=[],n=0,s=e.entries;n<s.length;n++){var l=s[n];l.is_dir?r.push(a(l)):r.push({is_dir:(t=l).is_dir,filename:t.filename,sort_key:t.sort_key,href:t.href,bytes:t.bytes,preview:t.preview,ns_id:t.ns_id,preview_type:t.preview_type?t.preview_type:null,sjid:t.sjid,ts:t.ts,thumbnail_url_tmpl:t.thumbnail_url_tmpl,file_id:t.file_id,revision_id:t.revision_id,is_symlink:!1})}var d=e.share_permissions.map(i),u=e.share_tokens.map(o);return{entries:r,folder:a(e.folder),folderSharedLinkInfo:e.folder_shared_link_info,folderSharePermission:i(e.folder_share_permission),folderShareToken:o(e.folder_share_token),hasMoreEntries:e.has_more_entries,nextRequestVoucher:e.next_request_voucher,sharedLinkInfos:e.shared_link_infos,sharePermissions:d,shareTokens:u,takedownRequestType:e.takedown_request_type}}function l(e,t,r){var a={link_key:e.linkKey,link_type:e.linkType,secure_hash:e.secureHash,sub_path:e.subPath||""};return t&&(a.voucher=t),new Promise((function(e,t){return n.WebRequest({type:"POST",url:"/list_shared_link_folder_entries",data:a,dataType:"json",success:function(t,n,a){if(r){var i=a.getResponseHeader("x-dropbox-request-id");r.end(i||void 0)}e(s(t))},error:function(e,r,n){t(new Error(n))}})}))}Object.defineProperty(t,"__esModule",{value:!0}),t.deserializePage=s,t.fetchPage=l,t.fetchPreviewAndSharingData=function(e){return l(e)},t.prefetchFirstPage=function(e){return(function(){var e=r.getPrefetchData("__REGISTER_SHARED_LINK_FOLDER_PRELOAD_HANDLER");if(e)return e.then(s)})()||l(e)},t.fetchNextPage=function(e,t){return l(e,t)}})),define("modules/clean/react/shared_link_folder/api_odyssey",["require","exports","tslib","modules/clean/prefetch/prefetch","modules/clean/react/shared_link_folder/api","modules/clean/filepath"],(function(e,t,r,n,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=r.__importStar(i);function o(e){for(var t=[],r=0,n=e.paginated?e.first_page.items:e.file_info;r<n.length;r++){var a=n[r];a.is_dir?t.push(s(a)):t.push(l(a))}return{entries:t,hasMoreEntries:e.paginated&&e.first_page.has_more_items,nextRequestVoucher:e.paginated?e.first_page.next_request_voucher:void 0}}function s(e){return{_mount_access_perms:e.mount_access_perms,filename:i.filename(e.fq_path),href:"",is_dir:!0,ns_id:e.ns_id,open_in_app_data:void 0,shared_folder_id:void 0,sort_key:[e.sort_key]}}function l(e){return{bytes:e.bytes,file_id:e.file_id,filename:i.filename(e.fq_path),href:"",is_dir:!1,is_symlink:e.is_symlink,ns_id:e.ns_id,revision_id:e.revision_id,sjid:e.sjid,sort_key:[e.sort_key],ts:e.ts}}t.deserializeOdysseyResponse=o,t.deserializeFolder=s,t.deserializeFile=l,t.prefetchFirstPage=function(e){return(function(){var e=n.getPrefetchData("__REGISTER_ODYSSEY_SHARED_LINK_FOLDER_PRELOAD_HANDLER");if(e)return e.then(o)})()||a.fetchPage(e)}})),define("modules/clean/react/shared_link_folder/app",["require","exports","tslib","external/lodash","react","redux","react-redux","modules/clean/cloud_docs/open_with_utils","modules/clean/loggers/folder_preview_logger","modules/clean/open_in_app/actions","modules/clean/previews/constants","modules/clean/react/async/loadable","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer/location_utils","modules/clean/react/location/with_location","modules/clean/react/file_viewer/url_utils","modules/clean/react/previews/constants","modules/clean/react/shared_link_folder/data/actions","modules/clean/react/shared_link_folder/data/store","modules/clean/react/shared_link_folder/page","modules/clean/viewer","modules/clean/web_timing_logger","modules/constants/python","modules/clean/web_timing_logger","modules/clean/storage","modules/clean/react/shared_link_folder/utils","modules/clean/react/shared_link_folder/data/selectors","modules/clean/csrf","modules/core/browser","modules/clean/react/file_viewer/utils"],(function(e,t,r,n,a,i,o,s,l,d,u,c,f,p,_,m,h,g,v,y,b,w,k,S,E,P,T,F,M,D,I){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),a=r.__importDefault(a),E=r.__importStar(E);var C=n.memoize((function(){return new Promise((function(t,r){e(["modules/clean/react/file_viewer/collection_viewer"],t,r)})).then(r.__importStar)}));t.AsyncFileCollectionViewer=c.Loadable({loader:function(){return C().then((function(e){return e.FileCollectionViewer}))}});var A=function(e){return{label:e.filename,href:e.href}};function O(){var e=E.get_timer();return e.timeToInteractive()&&(e=E.get_timer("shared_link_folder_ajax")).initialize({requireTTI:!0,requireTTV:!0,url:"shared_link_folder_ajax"}),e}var L=(function(i){function o(e){var t,r,n=i.call(this,e)||this;n.handleOpenFile=function(e){e.preview_type&&e.preview_type===u.PreviewType.CloudDoc&&!s.isShortcut(e)?D.open_tab(e.href):n.previewDataPromise?n.previewDataPromise.then((function(){return h.openFile(e)})):h.openFile(e)},n.handleOpenFolder=function(e){n.previewDataPromise?n.previewDataPromise.then((function(){return T.openFolder(e)})):T.openFolder(e)};var a=w.Viewer.get_viewer(),o=a.work_user||a.personal_user,d=e.folderShareToken.secureHash,c=e.folderData,f=e.shouldFetchPreviewData;return n.state={folderHierarchyMap:(t={},t[d]=c?[c]:[],t),pageYOffset:0,previewSourceAction:g.PreviewSourceAction.Visit,user:o},n.folderPreviewSession=l.createSession({subfolder_nav_tracking:e.subfolderNavTracking,use_odyssey:f,folder_id:null===(r=e.folder)||void 0===r?void 0:r.folder.folder_id}),n.webTimer=O(),n}return r.__extends(o,i),o.prototype.componentWillMount=function(){if(this.webTimer.applicationStart(),this.props.openImmediatelyInApp)return this.openImmediatelyInApp()},o.prototype.componentWillUnmount=function(){this.unsubscribe()},o.prototype.componentWillReceiveProps=function(e){var t,r;!this.props.viewingFilename&&e.viewingFilename&&this.setState({pageYOffset:window.pageYOffset}),this.props.viewingFilename!==e.viewingFilename&&this.setState({previewSourceAction:g.PreviewSourceAction.Click});var n=e.folder?e.folder.folder.ns_id:void 0;e.folderShareToken.secureHash!==this.props.folderShareToken.secureHash?(this.webTimer=O(),this.webTimer.restart(),this.folderPreviewSession=l.createSession({source_action:g.PreviewSourceAction.Click,subfolder_nav_tracking:e.subfolderNavTracking,has_cached_data:e.folder&&!!e.folder.entries.length,ns_id:n,folder_id:null===(t=e.folder)||void 0===t?void 0:t.folder.folder_id}),this.props.onFolderLoad(e.folderShareToken,this.webTimer)):this.props.viewingFilename&&!e.viewingFilename&&(this.folderPreviewSession=l.createSession({source_action:g.PreviewSourceAction.FileViewerExit,subfolder_nav_tracking:e.subfolderNavTracking,has_cached_data:!0,ns_id:n,folder_id:null===(r=e.folder)||void 0===r?void 0:r.folder.folder_id})),e.folder&&e.folder.folder&&T.setPageTitle(e.folder.folder.filename)},o.prototype.componentDidMount=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,a,i,o;return r.__generator(this,(function(r){switch(r.label){case 0:return e=this.props,t=e.file,a=e.folderShareToken,i=e.onFolderPrefetch,e.viewingFilename&&window.setTimeout(I.cleanupPrerenderPreview),a&&(this.previewDataPromise=i(a,t)),[4,k.waitForTTI()];case 1:return r.sent(),C(),[4,this.readFolderHierarchy()];case 2:return o=r.sent(),this.setState((function(e,t){var r=t.folderShareToken.secureHash;return{folderHierarchyMap:n.get(o,r)?o:e.folderHierarchyMap}})),[2]}}))}))},o.prototype.componentDidUpdate=function(e){var t=this.props.viewingFilename,n=this.state.pageYOffset;t!==e.viewingFilename&&(t||window.scrollTo(0,n));var a=e.folderShareToken.secureHash,i=this.props.folderShareToken.secureHash;a!==i&&this.setState((function(t,n){var o;if(!n.folder||!T.shouldUpdateFolderHierarchy(t.folderHierarchyMap,e.folderShareToken,n.folderShareToken))return{folderHierarchyMap:t.folderHierarchyMap};var s=n.folder.folder;return{folderHierarchyMap:r.__assign(r.__assign({},t.folderHierarchyMap),(o={},o[i]=r.__spreadArrays(t.folderHierarchyMap[a],[s]),o))}}),this.writeFolderHierarchy)},o.prototype.getUserStorageKey=function(){return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(a){switch(a.label){case 0:return[4,new Promise((function(t,r){e(["sjcl"],t,r)})).then(r.__importStar)];case 1:return t=a.sent(),n=t.hash.sha256.hash(M.readCsrfToken()||""),[2,t.codec.base64.fromBits(n)]}}))}))},o.prototype.writeFolderHierarchy=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,a;return r.__generator(this,(function(r){switch(r.label){case 0:return t=(e=P.SessionStorage).set,n=["shared_folder_hierarchy"],a={},[4,this.getUserStorageKey()];case 1:return t.apply(e,n.concat([(a[r.sent()]=this.state.folderHierarchyMap,a)])),[2]}}))}))},o.prototype.readFolderHierarchy=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,a;return r.__generator(this,(function(r){switch(r.label){case 0:return t=(e=n).get,a=[P.SessionStorage.get("shared_folder_hierarchy")],[4,this.getUserStorageKey()];case 1:return[2,t.apply(e,a.concat([r.sent()]))]}}))}))},o.prototype.openImmediatelyInApp=function(){var e=this.props.folder;if(e)try{e.folder.open_in_app_data&&d.openImmediately(e.folder.open_in_app_data)}catch(e){}},o.prototype.render=function(){var e=this.props,r=e.accountMenuOptions,i=e.appDownloadInterstitialDismissed,o=e.brandingInfo,s=e.file,l=e.files,d=e.fileViewOrigin,u=e.fileViewTarget,c=e.folder,f=e.onAppDownloadInterstitialDismissed,p=e.outOfQuota,_=e.shouldForceListMode,m=e.showSyncCoachmark,v=e.subfolders,y=e.viewingFilename,w=e.encryptionOptions,k=e.requestEditAccessVariant,E=this.state,P=E.folderHierarchyMap,F=E.user,M=E.previewSourceAction,D=n.get(P,this.props.folderShareToken.secureHash,[]).map(A);if(y&&s){var I=[],C=[],O=[],L=[];return Array.isArray(l)&&l.length?l.forEach((function(e,t){C.push(e.shareToken),O.push(e.sharedLinkInfo),I.push(e.sharePermission),L.push(e.file)})):(L=[s.file],I=[s.sharePermission],C=[s.shareToken],O=[s.sharedLinkInfo]),a.default.createElement(t.AsyncFileCollectionViewer,{brandingInfo:o,canClose:!0,className:"no-background",file:s.file,files:L,fileViewOrigin:d,fileViewTarget:u,fileViewAction:S.FileViewActionType.CLICK,initialPreviewSourceContext:g.PreviewSourceContext.SharedLinkFolder,initialPreviewSourceAction:M,skipOuterRouting:!0,sharedLinkInfos:O,sharePermissions:I,shareTokens:C,titleBarCloseUrl:h.getCurrentFolderHref(),onCloseViewer:h.closeFile,user:F,encryptionOptions:w})}if(!c)return null;var R=c.shareToken,x=c.sharedLinkInfo,N=c.folder,H=c.sharePermission,q=c.hasMore,V=c.takedownRequestType,B={files:Array.isArray(l)?l.map((function(e){return e.file})):[],folders:Array.isArray(v)?v.map((function(e){return e.folder})):[]};return N.folder_id&&(this.folderPreviewSession.extra.folder_id=N.folder_id),a.default.createElement(b.SharedLinkFolderPage,{accountMenuOptions:r,appDownloadInterstitialDismissed:i,brandingInfo:o,breadcrumbs:D,contents:B,folder:N,folderPreviewSession:this.folderPreviewSession,folderSharePermission:H,folderShareToken:R,folderSharedLinkInfo:x,hasMore:q,onAppDownloadInterstitialDismissed:f,onFileOpen:this.handleOpenFile,onFolderOpen:this.handleOpenFolder,onListModeDisable:T.disableListMode,onListModeEnable:T.enableListMode,outOfQuota:p,shouldForceListMode:_,showSyncCoachmark:m,takedownRequestType:V,user:F,webTimer:this.webTimer,encryptionOptions:w,requestEditAccessVariant:k})},o.defaultProps={subfolderNavTracking:!1},o})(a.default.PureComponent);t._SharedLinkFolderApp=L;var R=o.connect((function(e,t){var r=p.getAppDownloadInterstitial(e);void 0===r&&(r=t.appDownloadInterstitialDismissed);var n=t.folderShareToken.secureHash,a=t.viewingFilename;return{appDownloadInterstitialDismissed:r,file:F.getSharedFilePackageByFilenameForFolderPath(e,n,a||""),folder:F.getFolderByPath(e,n),files:F.getSharedFilePackagesForFolderPath(e,n),subfolders:F.getSubfoldersForFolderPath(e,n)}}),(function(e,t){var r=t.shouldFetchPreviewData;return i.bindActionCreators({onAppDownloadInterstitialDismissed:f.dismissAppDownloadInterstitial,onFolderLoad:v.fetchFolder,onFolderPrefetch:r?v.prefetchFolderFromOdyssey:v.prefetchFolder},e)}))(L),x=m.withLocation(R,(function(e){return{folderShareToken:T.getFolderShareTokenFromLocation(e),viewingFilename:_.getFilenameFromLocation(e),shouldForceListMode:"lst"in e.query,subfolderNavTracking:"subfolder_nav_tracking"in e.query}})),N=(function(e){function t(t){var r=e.call(this,t)||this;return r.store=y.getStoreForSharedLinkFolder(),y.hydrateStore(r.store,{initialFolder:r.props.folderData,initialPreview:r.props.preview,folderSharedLinkInfo:r.props.folderSharedLinkInfo,folderSharePermission:r.props.folderSharePermission,folderShareToken:r.props.folderShareToken}),r}return r.__extends(t,e),t.prototype.render=function(){return a.default.createElement(o.Provider,{store:this.store},a.default.createElement(x,r.__assign({},this.props)))},t})(a.default.Component);t.SharedLinkFolderApp=N})),define("modules/clean/react/shared_link_folder/data/actions",["require","exports","tslib","modules/clean/file_store/actions","modules/clean/react/shared_link_folder/api","modules/clean/react/shared_link_folder/api_odyssey","modules/clean/react/shared_link_folder/data/types","modules/clean/file_store/utils","modules/clean/previews/data/actions","modules/clean/redux/types"],(function(e,t,r,n,a,i,o,s,l,d){"use strict";function u(e,t){var n=(function(e){return e?{file:e.file,fileMetadata:r.__rest(e,["file"])}:{file:void 0,fileMetadata:void 0}})(t),a=n.file,i=n.fileMetadata,l=a&&s.getFileStoreId(a);return{type:o.Actions.HydrateSharedFolder,payload:{fileId:l,fileMetadata:i,folderPackage:r.__assign(r.__assign({},e),{entries:e.entries.length?e.entries:l?[{type:"file",id:l}]:[]})}}}function c(e,t){for(var r=[],n={},a=0,i=t;a<i.length;a++){var l=i[a];if(l.is_dir){var d=l.filename;r.push({type:"folder",id:d}),n[d]={folder:l,entries:[],hasMore:!0}}else r.push({type:"file",id:s.getFileRevisionId(l)})}return{type:o.Actions.HydrateEntries,payload:{secureHash:e,entries:r,folderPackageMap:n}}}function f(e){return{type:o.Actions.FetchPageRequest,payload:e}}function p(e,t){return{type:o.Actions.FetchPageSuccess,payload:{fileMetadata:e,folderPackage:t}}}function _(e,t){return function r(i,l){void 0===l&&(l=0);var d=(function(e,t,r){var n;void 0===r&&(r=0);var a=e.entries,i=e.hasMoreEntries,l=e.sharedLinkInfos,d=e.sharePermissions,u=e.shareTokens,c=e.takedownRequestType,f={},p=((n={})[t]={entries:[],fromIndex:r,hasMore:i,takedownRequestType:c,folder:e.folder,sharedLinkInfo:e.folderSharedLinkInfo,sharePermission:e.folderSharePermission,shareToken:e.folderShareToken},n),_=[];return a.forEach((function(e,r){if(o.isFile(e)){var n=s.getFileStoreId(e);_.push(e),f[n]={sharedLinkInfo:l[r],sharePermission:d[r],shareToken:u[r]},p[t].entries.push({type:"file",id:n})}else{var a=u[r].secureHash;p[t].entries.push({type:"folder",id:a}),p[a]={folder:e,fromIndex:0,hasMore:!0,sharedLinkInfo:l[r],sharePermission:d[r],shareToken:u[r]}}})),{files:_,fileMetadata:f,folderPackage:p}})(i,t.secureHash,l),u=d.files,c=d.fileMetadata,f=d.folderPackage;e(n.putFiles(u)),e(p(c,f)),i.hasMoreEntries&&i.nextRequestVoucher&&a.fetchNextPage(t,i.nextRequestVoucher).then((function(e){return r(e,l+i.entries.length)}))}}function m(e,t){return function(r){var a=t.entries,i=t.sharedLinkInfos,u=t.sharePermissions,c=t.shareTokens;if(a){var f=[],p={},_={},m=[];a.forEach((function(e,t){if(o.isFile(e)){var r=s.getFileStoreId(e);p[r]={sharedLinkInfo:i[t],sharePermission:u[t],shareToken:c[t]},f.push(e),m.push({type:"file",id:s.getFileRevisionId(e)})}else{var n=c[t].secureHash;_[n]={entries:[],folder:e,fromIndex:0,hasMore:!0,sharedLinkInfo:i[t],sharePermission:u[t],shareToken:c[t]},m.push({type:"folder",id:n})}})),r(n.putFiles(f)),r(l.updatePreviewData(l.buildPreviewData(f,d.ApiClientStatus.Success))),r({type:o.Actions.HydratePreviewAndSharingData,payload:{parentSecureHash:e,parentFolderEntries:m,fileMetadataMap:p,folderPackageMap:_}})}}}Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importStar(a),i=r.__importStar(i),t.hydrateSharedFolderAndFile=function(e,t){return function(r){t&&r(n.putFile(t.file)),r(u(e,t))}},t.hydrateEntries=c,t.fetchPageSuccess=p,t.prefetchFolder=function(e,t){return function(t){t(f(e.secureHash));var r=a.prefetchFirstPage(e);return r.then(_(t,e)),r}},t.prefetchFolderFromOdyssey=function(e,t){return function(r){var u=a.fetchPreviewAndSharingData(e);return r(f(e.secureHash)),i.prefetchFirstPage(e).then((function(a){var i=(function(e,t){var r=e.entries,n=t?t.file:void 0;return{files:r.filter(o.isFile).map((function(e){return n&&s.areFilesEqual(n,e)?n:e})),entries:r}})(a,t),f=i.files,p=i.entries;r(n.putFiles(f)),r(l.updatePreviewData(l.buildPreviewData(f,d.ApiClientStatus.Request))),r(c(e.secureHash,p)),u.then((function(t){r(m(e.secureHash,t)),_(r,e)(t)}))})),u}},t.fetchFolder=function(e,t){return function(r){return r(f(e.secureHash)),a.fetchPage(e,void 0,t).then(_(r,e))}},t.hydratePreviewAndSharingData=m})),define("modules/clean/react/shared_link_folder/data/reducer",["require","exports","tslib","external/lodash","modules/clean/react/shared_link_folder/data/types","modules/clean/react/shared_link_folder/utils"],(function(e,t,r,n,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n);var o={fileMetadata:{},folderPackage:{}};t.sharedLinkFolderReducer=function(e,t){var s,l,d,u,c;switch(void 0===e&&(e=o),t.type){case a.Actions.FetchPageRequest:var f=t.payload,p=e.folderPackage[f];return p?r.__assign(r.__assign({},e),{folderPackage:r.__assign(r.__assign({},e.folderPackage),(s={},s[f]=r.__assign(r.__assign({},p),{hasMore:!0}),s))}):e;case a.Actions.HydrateSharedFolder:var _=t.payload,m=_.fileId,h=_.fileMetadata,g=(f=(w=_.folderPackage).shareToken.secureHash,null!=m?((l={})[m]=h,l):{});return r.__assign(r.__assign({},e),{fileMetadata:r.__assign(r.__assign({},e.fileMetadata),g),folderPackage:r.__assign(r.__assign({},e.folderPackage),(d={},d[f]=r.__assign(r.__assign({},w),{hasMore:!0}),d))});case a.Actions.HydrateEntries:var v=t.payload,y=(f=v.secureHash,v.entries),b=v.folderPackageMap,w=e.folderPackage[f];return r.__assign(r.__assign({},e),{folderPackage:r.__assign(r.__assign(r.__assign({},e.folderPackage),b),(u={},u[f]=r.__assign(r.__assign({},w),{entries:y}),u))});case a.Actions.FetchPageSuccess:var k=t.payload,S=(h=k.fileMetadata,k.folderPackage),E={};return Object.keys(S).forEach((function(t){var n=e.folderPackage[t]||{},a=S[t],o=a.fromIndex,s=r.__rest(a,["fromIndex"]);E[t]=r.__assign(r.__assign(r.__assign({},n),s),{entries:i.mergeFolderEntries(n.entries,s.entries,o,!s.hasMore)})})),r.__assign(r.__assign({},e),{fileMetadata:r.__assign(r.__assign({},e.fileMetadata),h),folderPackage:r.__assign(r.__assign({},e.folderPackage),E)});case a.Actions.HydratePreviewAndSharingData:var P=t.payload,T=P.fileMetadataMap,F=(b=P.folderPackageMap,P.parentSecureHash),M=P.parentFolderEntries,D=n.values(b).map((function(e){return e.folder.filename})),I=Object.keys(e.folderPackage).filter((function(e){return-1===D.indexOf(e)})).reduce((function(t,r){return t[r]=e.folderPackage[r],t}),{});return r.__assign(r.__assign({},e),{fileMetadata:r.__assign(r.__assign({},e.fileMetadata),T),folderPackage:r.__assign(r.__assign(r.__assign({},I),b),(c={},c[F]=r.__assign(r.__assign({},e.folderPackage[F]),{entries:M}),c))})}return e}})),define("modules/clean/react/shared_link_folder/data/selectors",["require","exports","tslib","external/lodash","modules/clean/redux/namespaces","modules/clean/file_store/selectors"],(function(e,t,r,n,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n);var o=function(e){return e[a.SHARED_LINK_FOLDER_NAMESPACE_KEY]};t.getFolderByPath=function(e,t){return o(e).folderPackage[t]};var s=function(e,r){var n=t.getFolderByPath(e,r);return n?n.entries.filter((function(e){return"file"===e.type})).map((function(e){return e.id})):[]};function l(e,t){var n=i.getFile(e,t);if(n){var a=(function(e,t){return o(e).fileMetadata[t]})(e,t);return r.__assign(r.__assign({},a),{file:n})}}t.getSubfoldersForFolderPath=function(e,r){var n=t.getFolderByPath(e,r);if(n)return n.entries.filter((function(e){return"folder"===e.type})).map((function(t){return(function(e,t){return o(e).folderPackage[t]})(e,t.id)}))},t.getSharedFilePackagesForFolderPath=function(e,t){return s(e,t).map((function(t){return l(e,t)})).filter(Boolean)},t.getSharedFilePackageByFilenameForFolderPath=function(e,t,r){var a=(function(e,t,r){if(r){var a=s(e,t);return n.find(a,(function(t){var n=i.getFile(e,t);return void 0!==n&&n.filename===r}))}})(e,t,r);if(a)return l(e,a)}})),define("modules/clean/react/shared_link_folder/data/store",["require","exports","tslib","external/lodash","modules/clean/file_store/reducer","modules/clean/react/file_viewer/data/reducer","modules/clean/react/shared_link_folder/data/actions","modules/clean/react/shared_link_folder/data/reducer","modules/clean/redux/store","modules/clean/redux/namespaces"],(function(e,t,r,n,a,i,o,s,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),t.getStoreForSharedLinkFolder=n.once((function(){var e,t=((e={})[d.FILE_NAMESPACE_KEY]=a.fileNamespaceReducer,e[d.FILE_VIEWER_NAMESPACE_KEY]=i.fileViewerReducer,e[d.SHARED_LINK_FOLDER_NAMESPACE_KEY]=s.sharedLinkFolderReducer,e);return l.getStoreAndRegisterReducers(t)})),t.hydrateStore=function(e,t){var r=t.initialPreview,n={folder:t.initialFolder,sharedLinkInfo:t.folderSharedLinkInfo,sharePermission:t.folderSharePermission,shareToken:t.folderShareToken,hasMore:!0,entries:[]};e.dispatch(o.hydrateSharedFolderAndFile(n,r))}})),define("modules/clean/react/shared_link_folder/data/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isFile=function(e){return!e.is_dir},(function(e){e.HydrateSharedFolder="SHARED_FOLDER/HYDRATE",e.HydrateEntries="SHARED_FOLDER/HYDRATE_ENTRIES",e.HydratePreviewAndSharingData="SHARED_FOLDER/HYDRATE_PREVIEW_AND_SHARING_DATA",e.FetchPageSuccess="SHARED_FOLDER/FETCH_SUCCESS",e.FetchPageRequest="SHARED_FOLDER/FETCH_REQUEST"})(t.Actions||(t.Actions={})),(function(e){e[e.DMCA=1]="DMCA",e[e.MALWARE=2]="MALWARE",e[e.ILLEGAL=3]="ILLEGAL",e[e.OTHER=4]="OTHER",e[e.SPAM=5]="SPAM",e[e.TERROR=6]="TERROR"})(t.TakedownType||(t.TakedownType={}))})),define("modules/clean/react/shared_link_folder/folder_icon",["require","exports","tslib","react","modules/clean/react/shared_link_folder/utils","spectrum/icon_content","modules/clean/react/icon/icon_helper"],(function(e,t,r,n,a,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),t.SharedLinkFolderFolderIcon=function(e){var t=e.className,r=e.folder,s=e.size;return n.default.createElement(i.IconContent,{className:t,name:o.spectrumFolderIcon({size:s,isConfidential:a.isNoAccessFolder(r)})})}})),define("modules/clean/react/shared_link_folder/folder_title",["require","exports","tslib","react","modules/constants/trademark","modules/core/uri","modules/core/i18n","modules/clean/react/shared_link_folder/utils","modules/clean/react/async/loadable"],(function(e,t,r,n,a,i,o,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n);var d=l.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/breadcrumb/trail"],t,r)})).then(r.__importStar).then((function(e){return e.BreadcrumbTrail}))}}),u=(function(e){function a(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleCrumbClick=function(e,r,n){var a=t.props.onCrumbClick;e.preventDefault(),s.navigateToFolderHref(r.href),a&&a(n)},t}return r.__extends(a,e),a.prototype.render=function(){var e=this.props,a=e.breadcrumbs,i=e.ownerName,o=e.ownerTeamLogo,s=e.ownerTeamName,l=e.title;return n.default.createElement("div",{className:"sl-folder-title"},a&&a.length>0?n.default.createElement(d,r.__assign({},(function(e){var t,r;return e.length<=2?t=e:(t=e.slice(e.length-1),r=e.slice(0,e.length-1)),{inlineCrumbs:t,overflowCrumbs:r}})(a),{onChange:this.handleCrumbClick})):l,s?n.default.createElement(t.ContentOwner,{ownerName:i,ownerTeamName:s,ownerTeamLogo:o}):null)},a})(n.default.PureComponent);t.FolderTitle=u;var c=new i.URI({path:"/business",query:{src:"schmodel"}}).toString();t.ContentOwner=function(e){var t=e.ownerName,r=e.ownerTeamName,i=e.ownerTeamLogo;return n.default.createElement("div",{className:"sl-subtitle"},null!=t?o.intl.formatMessage({id:"V1gDEG",defaultMessage:"from {owner} ({team})"},{owner:t,team:r}):o.intl.formatMessage({id:"mL9XU3",defaultMessage:"from {team}"},{team:r}),null!=i?n.default.createElement("span",null," ","via ",n.default.createElement("a",{href:c},a.TRADEMARK_BUSINESS)):null)}})),define("modules/clean/react/shared_link_folder/grid",["require","exports","tslib","react","classnames","modules/clean/em_string","modules/clean/previews/constants","modules/clean/react/icon/icon_helper","modules/clean/react/shared_link_folder/folder_icon","modules/clean/react/file_viewer/url_utils","modules/clean/react/thumbnail","spectrum/tooltip","modules/core/i18n"],(function(e,t,r,n,a,i,o,s,l,d,u,c,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),a=r.__importDefault(a);function p(e){var t=e.label,r=e.filename,a=n.default.createElement("span",{className:"sl-grid-filename"},t);return r===t?a:n.default.createElement(c.Tooltip,{positioning:"below",tooltipContent:r,wrapperClassName:"sl-grid-tooltip-wrapper"},a)}function _(e){var t=e.entry,r=e.onFolderOpen,a=e.onFileOpen,o=i.Emstring.em_snippet(t.filename,16);return t.is_dir?n.default.createElement(h,{folder:t,label:o,onOpen:r}):n.default.createElement(m,{file:t,label:o,onOpen:a})}t.FileTitle=p,t.SharedLinkFolderGrid=function(e){var t=e.entries,r=e.onFileOpen,a=e.onFolderOpen;return n.default.createElement("div",{className:"sl-grid"},n.default.createElement("div",{className:"sl-grid-header clearfix"},n.default.createElement("div",{className:"sl-grid-header-column sl-grid-header-column--sort"},f.intl.formatMessage({id:"gTD7Ga",defaultMessage:"Sorted by name"}))),n.default.createElement("ol",{className:"sl-grid-body"},t.map((function(e){return n.default.createElement("li",{className:"sl-grid-cell",key:e.filename},n.default.createElement(_,{entry:e,onFolderOpen:a,onFileOpen:r}))}))))};var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClick=d.linkClickHandler((function(e){e.preventDefault();var r=t.props,n=r.file;(0,r.onOpen)(n)})),t}return r.__extends(t,e),t.prototype.isVideo=function(){return this.props.file.preview_type===o.PreviewType.Video},t.prototype.render=function(){var e=this.props,t=e.file,r=e.label,i=a.default("sl-link sl-link--file",{"sl-link--disabled":""===t.href});return n.default.createElement("a",{href:t.href,onClick:this.handleClick,className:i},n.default.createElement("div",{className:"sl-grid-thumbnail-container"},n.default.createElement(u.ThumbnailIcon,{alt:t.filename,className:"sl-grid-thumbnail",file:t,iconSize:s.SpectrumIconSize.Large}),this.isVideo()?n.default.createElement("div",{className:"sl-video-watermark"}):null),n.default.createElement(p,{label:r,filename:t.filename}))},t})(n.default.PureComponent);t.FileCell=m;var h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClick=d.linkClickHandler((function(e){e.preventDefault();var r=t.props,n=r.folder;(0,r.onOpen)(n)})),t}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.folder,r=e.label,i=a.default("sl-link sl-link--folder",{"sl-link--disabled":""===t.href});return n.default.createElement("a",{href:t.href,onClick:this.handleClick,className:i},n.default.createElement("div",{className:"sl-grid-thumbnail-container"},n.default.createElement(l.SharedLinkFolderFolderIcon,{className:"sl-grid-thumbnail",folder:t,size:s.SpectrumIconSize.Large})),n.default.createElement(p,{label:r,filename:t.filename}))},t})(n.default.PureComponent);t.FolderCell=h})),define("modules/clean/react/shared_link_folder/list",["require","exports","tslib","react","classnames","spectrum/table","spectrum/media_table","modules/clean/datetime","modules/clean/em_string","modules/clean/react/shared_link_folder/folder_icon","modules/clean/react/thumbnail","modules/core/i18n","modules/core/uri","modules/clean/react/size_class/constants","modules/clean/react/file_viewer/url_utils"],(function(e,t,r,n,a,i,o,s,l,d,u,c,f,p,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),a=r.__importDefault(a);function m(e){var t=e.entry,r=e.sizeClass,a=e.onFolderOpen,i=e.onFileOpen;return t.is_dir?n.default.createElement(g,{folder:t,sizeClass:r,onOpen:a}):n.default.createElement(v,{file:t,sizeClass:r,onOpen:i})}function h(e){var t=e.icon,r=e.lastModified,i=e.name,d=e.sizeClass,u=e.onClick,c=e.href,f=_.linkClickHandler((function(e){e.preventDefault(),"function"==typeof u&&u()})),m=a.default("sl-list-row",{"sl-list-row--disabled":""===c});return n.default.createElement(o.MediaRow,{className:m},n.default.createElement(o.MediaCell,{className:"sl-list-column--filename",icon:t,title:l.Emstring.em_snippet(i,40)},n.default.createElement("a",{href:c,"aria-label":i,onClick:f})),d!==p.SizeClass.Small?n.default.createElement(o.MediaCell,{className:"sl-list-column--modified",title:r?s.format_date(r,s.localized_datetime_format):"--"}):null)}function g(e){var t=e.folder,r=e.sizeClass,a=e.onOpen,i="";""!==t.href&&(i=f.URI.parse(t.href).updateQuery({lst:""}).toString());return n.default.createElement(h,{icon:n.default.createElement(d.SharedLinkFolderFolderIcon,{className:"sl-list-icon",folder:t}),href:i,name:t.filename,onClick:function(){return a(t)},sizeClass:r})}function v(e){var t=e.file,r=e.sizeClass,a=e.onOpen;return n.default.createElement(h,{icon:n.default.createElement(u.ThumbnailIcon,{alt:t.filename,className:"sl-list-icon",file:t}),lastModified:new Date(1e3*t.ts),name:t.filename,href:t.href,onClick:function(){return a(t)},sizeClass:r})}t.SharedLinkFolderList=function(e){var t=e.entries,r=e.sizeClass,a=e.onFileOpen,o=e.onFolderOpen;return n.default.createElement(i.Table,{className:"sl-list-container"},n.default.createElement(i.TableHead,null,n.default.createElement(i.TableHeadCell,null,c.intl.formatMessage({id:"cJojIg",defaultMessage:"Name"})),r!==p.SizeClass.Small?n.default.createElement(i.TableHeadCell,null,c.intl.formatMessage({id:"wqMlXT",defaultMessage:"Modified"})):null),n.default.createElement(i.TableBody,null,t.map((function(e){return n.default.createElement(m,{key:e.filename,entry:e,sizeClass:r,onFileOpen:a,onFolderOpen:o})}))))}})),define("modules/clean/react/shared_link_folder/page",["require","exports","tslib","classnames","react","modules/clean/analytics","modules/clean/components/loading_indicator","modules/clean/react/browse/sort_helpers","modules/clean/react/css","modules/clean/react/async/loadable","modules/clean/em_string","modules/clean/react/open_in_app/banner","modules/clean/react/shared_link_folder/folder_icon","modules/clean/react/shared_link_folder/grid","modules/clean/react/shared_link_folder/list","modules/clean/react/shared_link_folder/view_toggle","modules/clean/react/takedown_warning","spectrum-sharing/utils/sharing_constants","modules/clean/web_timing_logger","modules/core/i18n","modules/clean/react/icon/icon_helper","modules/clean/react/size_class/size_class","modules/clean/react/size_class/constants","modules/clean/loggers/folder_preview_logger","modules/clean/react/file_viewer/app_download_interstitial/app_download_interstitial","modules/clean/react/shared_link_folder/folder_title","modules/core/i18n","modules/clean/bug_reporting/routing","modules/clean/react/branding/optional_branding_block","modules/clean/react/branding/branding_modal_controller"],(function(e,t,r,n,a,i,o,s,l,d,u,c,f,p,_,m,h,g,v,y,b,w,k,S,E,P,T,F,M,D){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),a=r.__importDefault(a),v=r.__importStar(v);var I=d.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/shared_link_folder/title_bar"],t,r)})).then(r.__importStar).then((function(e){return e.SharedLinkFolderTitleBar}))}}),C=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={openInAppBannerClosed:!1},t.shouldShowOpenInAppBanner=function(){var e=t.props.folder,r=t.state.openInAppBannerClosed;return e&&e.open_in_app_data&&!r},t.onOpenInAppClosed=function(){t.setState({openInAppBannerClosed:!0})},t.onInterstitialClose=function(){S.logEvent(S.EventType.appDownloadInterstitialClose,t.props.folderPreviewSession),t.props.onAppDownloadInterstitialDismissed()},t.onInterstitialContinue=function(){S.logEvent(S.EventType.appDownloadInterstitialContinue,t.props.folderPreviewSession),t.props.onAppDownloadInterstitialDismissed()},t.onAppDownload=function(){S.logEvent(S.EventType.appDownloadInterstitialInstall,t.props.folderPreviewSession)},t.handleBreadcrumbClick=function(e){var n=t.props,a=n.breadcrumbs,i=n.folderPreviewSession;i.extra=r.__assign(r.__assign({},i.extra),{origin_breadcrumb:a.length-1,destination_breadcrumb:e}),S.logEvent(S.EventType.breadcrumbClicked,i)},t}return r.__extends(t,e),t.prototype.componentWillMount=function(){S.logEvent(S.EventType.attempted,this.props.folderPreviewSession)},t.prototype.componentWillUnmount=function(){S.logEvent(S.EventType.ended,this.props.folderPreviewSession)},t.prototype.componentDidMount=function(){this.ensureWebTimingMarked(),this.logSclTiming(),this.shouldShowAppDownloadInterstitial()&&S.logEvent(S.EventType.appDownloadInterstitialView,this.props.folderPreviewSession)},t.prototype.componentDidUpdate=function(){this.ensureWebTimingMarked()},t.prototype.componentDidCatch=function(){S.logEvent(S.EventType.renderFailed,this.props.folderPreviewSession)},t.prototype.shouldShowAppDownloadInterstitial=function(){var e=this.props,t=e.folder;return!e.appDownloadInterstitialDismissed&&t&&t.open_in_app_data},t.prototype.ensureWebTimingMarked=function(){var e=this.props,t=e.contents,r=t.files,n=t.folders,a=e.hasMore,i=e.webTimer;(r.length>0||n.length>0||!a)&&(i&&(i.timeToView()||i.markTimeToView(),i.timeToInteractive()||i.markTimeToInteractive()),S.markPrimaryEvent(this.props.folderPreviewSession),S.logEvent(S.EventType.renderSucceeded,this.props.folderPreviewSession))},t.prototype.logSclTiming=function(){if(this.props.user&&this.props.folderShareToken.linkType===g.SharedLinkType.Content){var e=(new Date).getTime(),t={ns_id:this.props.folder.shared_folder_id,timing:e-v.start_time()};i.ShareTibEventLogger.log(this.props.user.id,"PREVIEW_RENDER",g.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE,t)}},t.prototype.render=function(){var e=this.props,t=e.accountMenuOptions,r=e.brandingInfo,i=e.breadcrumbs,s=e.contents,l=e.folder,d=e.folderSharePermission,f=e.folderShareToken,p=e.folderSharedLinkInfo,_=e.folderPreviewSession,m=e.hasMore,g=e.onFileOpen,v=e.onFolderOpen,b=e.onListModeDisable,w=e.onListModeEnable,S=e.outOfQuota,T=e.shouldForceListMode,C=e.showSyncCoachmark,A=e.sizeClass,O=e.takedownRequestType,L=e.user,R=e.encryptionOptions,N=e.requestEditAccessVariant;_.extra.size_class=A;var H,q=a.default.createElement(P.FolderTitle,{title:u.Emstring.em_snippet(l.filename,A!==k.SizeClass.Small?35:20),ownerName:p.ownerName,ownerTeamName:p.ownerTeamName,ownerTeamLogo:p.ownerTeamLogo,breadcrumbs:i,onCrumbClick:this.handleBreadcrumbClick}),V=n.default("sl-page-body",{"view-in-app-bar-present":this.shouldShowOpenInAppBanner()});if(this.shouldShowAppDownloadInterstitial()){var B=p.displayName;H=a.default.createElement("div",{"aria-label":B},a.default.createElement(E.AppDownloadInterstitial,{isFolder:!0,fileOrFolderName:B,open_in_app_data:l.open_in_app_data,ownerName:p.ownerName,ownerTeamName:p.ownerTeamName,onClose:this.onInterstitialClose,onContinue:this.onInterstitialContinue,onAppDownload:this.onAppDownload}))}return a.default.createElement(F.RegisterComponentWithBugReporter,{componentId:"web.folder_viewer",componentName:"Shared Folder Viewer"},a.default.createElement("div",null,a.default.createElement("div",{className:"sl-page-container"},a.default.createElement("div",{className:"sl-page-header"},a.default.createElement(I,{accountMenuOptions:t,folder:l,outOfQuota:S,sharedLinkInfo:p,shareToken:f,sharePermission:d,showSyncCoachmark:C,sizeClass:A,title:A===k.SizeClass.Small?q:void 0,user:L,encryptionOptions:R,folderPreviewSession:_,requestEditAccessVariant:N}),this.shouldShowOpenInAppBanner()?a.default.createElement(c.OpenInAppBanner,{urls:l.open_in_app_data,onClose:this.onOpenInAppClosed}):null),a.default.createElement("div",{className:V},a.default.createElement(M.OptionalBrandingBlock,{brandingInfo:r,className:"sl-branding-header",sharedLinkInfo:p}),a.default.createElement("div",{className:"sl-header clearfix"},a.default.createElement("h3",{className:"sl-title"},null!=O?a.default.createElement("div",{className:"sl-takedown-warning"},a.default.createElement(h.TakedownWarning,{takedownType:O})):null,A!==k.SizeClass.Small?q:null)),a.default.createElement(x,{files:s.files,folder:l,hasMore:m,shouldForceListMode:T,sizeClass:A,subfolders:s.folders,onListModeDisable:b,onListModeEnable:w,onFolderOpen:v,onFileOpen:g}),m?a.default.createElement("div",{className:"sl-loading-indicator"},a.default.createElement(o.LoadingIndicator,{style:o.LoadingIndicator.LoadingIndicatorStyle.BLUE_SPINNER})):null)),H||a.default.createElement(D.BrandingModalController,{brandingInfo:r,closeButtonText:y.intl.formatMessage({id:"eC3oZ9",defaultMessage:"View folder"}),sharedLinkInfo:p})))},t.defaultProps={shouldForceListMode:!1,webTimer:v.get_timer()},t})(a.default.PureComponent);t._SharedLinkFolderPage=C;var A=l.requireCssWithComponent(C,["/static/css/react_title_bar-vflTsHzg0.css","/static/css/react_file_viewer-vflh04f32.css"]),O=w.withSizeClass(A);t.SharedLinkFolderPage=O;function L(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]);var n,a=(n=T.case_insensitive_comparator(!0),function(e,t){return s.compare(e.filename,t.filename,1,n)});return r.__spreadArrays(t,e).sort(a)}function R(e){return a.default.createElement("div",{className:"sl-body sl-body--empty-folder"},a.default.createElement(f.SharedLinkFolderFolderIcon,{className:"sl-empty-folder-icon",folder:e.folder,size:b.SpectrumIconSize.Large}),a.default.createElement("h3",{className:"sl-empty-folder-message"},y.intl.formatMessage({id:"YLBqRL",defaultMessage:"This folder is empty"})))}function x(e){var t=e.files,r=e.folder,n=e.hasMore,i=e.shouldForceListMode,o=e.sizeClass,s=e.subfolders,l=e.onFileOpen,d=e.onFolderOpen,u=L(t,s);return u.length||n?a.default.createElement("div",{className:"sl-body"},i?[a.default.createElement(_.SharedLinkFolderList,{key:"list",entries:u,sizeClass:o,onFolderOpen:d,onFileOpen:l}),a.default.createElement(m.FolderViewToggleOption,{key:"toggler",icon:"grid_light",label:y.intl.formatMessage({id:"vEc1Xz",defaultMessage:"View as grid"}),onClick:e.onListModeDisable})]:[a.default.createElement(p.SharedLinkFolderGrid,{key:"grid",entries:u,onFolderOpen:d,onFileOpen:l}),a.default.createElement(m.FolderViewToggleOption,{key:"toggler",icon:"list_light",label:y.intl.formatMessage({id:"XLVIFy",defaultMessage:"View as list"}),onClick:e.onListModeEnable})]):a.default.createElement(R,{folder:r})}})),define("modules/clean/react/shared_link_folder/utils",["require","exports","tslib","modules/core/uri","modules/clean/history","modules/core/notify","modules/core/i18n","spectrum-sharing/utils/sharing_constants","modules/clean/viewer"],(function(e,t,r,n,a,i,o,s,l){"use strict";function d(e){var t=e._mount_access_perms;return null!=t&&!t.includes("can_view")}function u(e){var t=e.getPath();try{t=decodeURIComponent(t)}catch(e){}a.default.push_state(n.URI.encode_parts(t),e.getQuery())}function c(e,t){void 0===t&&(t=!1);var r=n.URI.parse(e);"lst"in a.default.get_uri().getQuery()&&r.updateQuery({lst:""}),t&&r.updateQuery({subfolder_nav_tracking:"1"}),u(r)}function f(e){return l.Viewer.get_viewer().is_signed_in?o.intl.formatMessage({id:"dbYCaa",defaultMessage:"{folder_name} - Dropbox"},{folder_name:e}):o.intl.formatMessage({id:"3J1lxt",defaultMessage:"Dropbox - {folder_name} - Simplify your life"},{folder_name:e})}function p(e,t,n,a){if(void 0===n&&(n=0),void 0===a&&(a=!1),!Array.isArray(t))return e||[];if(!t.length)return[];if(!Array.isArray(e))return t;var i=r.__spreadArrays(e);return i.splice.apply(i,r.__spreadArrays([n,t.length],t)),a?i.slice(0,n+t.length):i}Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),t.isNoAccessFolder=d,t.navigateToFolderHref=c,t.openFolder=function(e){d(e)?i.Notify.error(o.intl.formatMessage({id:"IzGklK",defaultMessage:"Can’t open {folder_name}. Ask your admin for access."},{folder_name:e.filename})):c(e.href,!0)},t.enableListMode=function(){(function(e,t){var r={};r[e]=t;var n=a.default.get_uri();n.updateQuery(r),u(n)})("lst","")},t.disableListMode=function(){var e,t;e="lst",(t=a.default.get_uri()).removeQuery(e),u(t)},t.getFolderShareTokenFromLocation=function(e){var t=e.path,r=s.SharedLinkType.Shmodel;"/sh"===t.substr(0,3)?(r=s.SharedLinkType.Shmodel,t=t.substring(4,t.length)):"/scl/fo"===t.substr(0,7)&&(r=s.SharedLinkType.Content,t=t.substring(8,t.length));var n=t.split("/");return{linkKey:n[0],linkType:r,secureHash:n[1],subPath:n.slice(2).join("/")}},t.shouldUpdateFolderHierarchy=function(e,t,r){var n=r.secureHash,a=r.subPath,i=t.secureHash,o=t.subPath;return!e[n]||a.startsWith(o)&&e[i].length>=e[n].length},t.generatePageTitle=f,t.setPageTitle=function(e){document.title=f(e)},t.mergeListChunk=p,t.mergeFolderEntries=p})),define("modules/clean/react/shared_link_folder/view_toggle",["require","exports","tslib","classnames","react","modules/clean/react/sprite"],(function(e,t,r,n,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),a=r.__importDefault(a),t.FolderViewToggleOption=function(e){var t=e.icon,r=e.label,o=e.onClick;return a.default.createElement("button",{"aria-label":r,className:n.default({"sl-view-toggle-option":!0}),name:r,onClick:o,value:r},a.default.createElement(i.Sprite,{group:"web",name:t,alt:r}))}})),define("modules/clean/react/share_sync/actions",["require","exports","tslib","modules/clean/multiaccount_login","modules/clean/viewer","modules/clean/sharing/shared_content_link_mount_folder"],(function(e,t,r,n,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),i=r.__importStar(i),t.syncToDropbox=function(e,t,r){new Promise((function(e,r){a.Viewer.get_viewer().is_role_signed_in(t)?e():n.default.show_modal({role:t,on_success:function(){e()}})})).then((function(){i.mountSharedFolder(e,t,r,!0)}))}})),define("modules/clean/react/share_sync/button",["require","exports","tslib","react","modules/clean/filepath","modules/clean/react/bubble_menu","modules/clean/react/share_sync/models","spectrum-sharing/utils/sharing_constants","modules/clean/sharing/views/sync_coachmark","modules/clean/react/sprite_div","modules/clean/viewer","modules/core/i18n","modules/constants/payments","modules/clean/analytics","modules/clean/react/sticky_position"],(function(e,t,r,n,a,i,o,s,l,d,u,c,f,p,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),a=r.__importStar(a),s=r.__importStar(s),d=r.__importDefault(d),f=r.__importStar(f);var m=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this.props.options.map((function(e){return n.default.createElement(i.BubbleMenuItem,{onClick:function(){return e.handler()},disabled:e.isDisabled},n.default.createElement(d.default,{group:"web",name:e.spriteName,text:e.text}))}));return n.default.createElement(i.BubbleMenu,{targetButton:this.props.targetButton,position:_.StickyPosition.BOTTOM,verticalDisplacement:4,items:e})},t})(n.default.Component),h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.logShareFolderPreviewUpgradeBtn=function(e){p.GrowthEventsLogger.log("wb_nq_pre_fo_up_b",{action:e,button_text:"Upgrade to Add Folder",destination_url:"http://www.dropbox.com/low-space",location:"top",quota_status:"near",upsell_type:"button"})},t.handleUpgradeButtonClick=function(){t.logShareFolderPreviewUpgradeBtn("click")},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.props.outOfQuota&&this.logShareFolderPreviewUpgradeBtn("view")},t.prototype.onClickedOption=function(e,t){e.preventDefault(),t.handler()},t.prototype.getSyncOptions=function(){var e=this,t=this.props.sharePermission.canSyncToDropboxRoles,r=u.Viewer.get_viewer();return t.map((function(t){return o.ShareSyncActionOption.buildOption(e.props.folder,r,t,s.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE,e.props.folderPreviewSession,e.props.shareToken.linkType)}))},t.prototype.renderSyncCoachmark=function(){var e=this.props.sharePermission.canSyncToDropboxRoles.length>0;return this.props.showSyncCoachmark&&e?n.default.createElement("div",{className:"sync-button__coachmark-container"},n.default.createElement(l.SharingSyncCoachmark,null)):null},t.prototype.renderSyncButton=function(){var e=this;if(""!==this.props.shareToken.subPath)return null;if(0===this.props.sharePermission.canSyncToDropboxRoles.length)return null;var t="button-primary control__button sync-button";if(this.props.outOfQuota){var r=f.OUT_OF_SPACE_URL+"?oqa=wb_oq_pre_fo_up_b";return n.default.createElement("a",{className:t,href:r,onClick:this.handleUpgradeButtonClick},c.intl.formatMessage({id:"JhDJcU",defaultMessage:"Upgrade to Add Folder"}))}var i=void 0;if(this.props.user&&this.props.user.is_cdm_member){var o=a.filename(this.props.user.cdm_tmf_path);i=o.length>25?c.intl.formatMessage({id:"6m85k6",defaultMessage:"Add to my member folder"}):c.intl.formatMessage({id:"ck1w+U",defaultMessage:"Add to <strong>{cdm_tmf_name}</strong> folder"},{cdm_tmf_name:o,strong:function(e){return n.default.createElement("strong",{style:{fontWeight:800}},e)}})}else i=c.intl.formatMessage({id:"N8ovVA",defaultMessage:"Add to Dropbox"});var s=this.getSyncOptions();if(1===s.length)return n.default.createElement("button",{className:t,style:{display:"-webkit-box"},onClick:function(t){return e.onClickedOption(t,s[0])}},i);var l=n.default.createElement("button",{className:t},i);return n.default.createElement(m,{targetButton:l,folder:this.props.folder,shareToken:this.props.shareToken,options:s})},t.prototype.render=function(){return n.default.createElement("div",null,this.renderSyncCoachmark(),this.renderSyncButton())},t})(n.default.Component);t.ShareSyncButton=h})),define("modules/clean/react/share_sync/models",["require","exports","tslib","immutable","react","modules/clean/filepath","modules/clean/react/share_sync/actions","modules/core/i18n","modules/clean/loggers/folder_preview_logger","modules/clean/react/file_viewer/constants","spectrum-sharing/utils/sharing_constants"],(function(e,t,r,n,a,i,o,s,l,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),a=r.__importDefault(a),i=r.__importStar(i),o=r.__importStar(o);var c={text:void 0,handler:void 0,isDisabled:!1,spriteName:void 0},f=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.buildOption=function(e,r,n,c,f,p){var _=s.intl.formatMessage({id:"l/lvUk",defaultMessage:"Save to my Dropbox"}),m="dropbox",h=r.get_user_by_role(n);if(h&&h.is_cdm_member){var g=i.filename(h.cdm_tmf_path);_=g.length>12?s.intl.formatMessage({id:"QPvsZL",defaultMessage:"Save to my member folder"}):s.intl.formatMessage({id:"VIDWC/",defaultMessage:"Save to <strong>{cdm_tmf_name}</strong> folder"},{cdm_tmf_name:g,strong:function(e){return a.default.createElement("strong",null,e)}}),r.is_paired&&(m="s_briefcase")}else if(r.is_paired)switch(n){case"personal":_=s.intl.formatMessage({id:"S5UJEB",defaultMessage:"Save to personal Dropbox"}),m="s_house";break;case"work":_=s.intl.formatMessage({id:"76AF1h",defaultMessage:"Save to {team_name} Dropbox"},{team_name:r.team_name}),m="s_briefcase"}return new t({text:_,handler:function(){p===u.SharedLinkType.Shmodel&&l.logEvent(d.UserAction.AddToDropbox,f),o.syncToDropbox(e.shared_folder_id,n,c)},spriteName:m})},t})(n.Record(c));t.ShareSyncActionOption=f})),define("modules/clean/react/takedown_warning",["require","exports","tslib","react","classnames","modules/constants/python","modules/core/i18n"],(function(e,t,r,n,a,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),a=r.__importDefault(a);t.TakedownWarning=function(e){var t=e.takedownType;return n.default.createElement("div",{className:a.default("notify","server-success")},(function(e){return e===i.TakedownRequestTypes.DMCA?o.intl.formatMessage({id:"z8QPs2",defaultMessage:"Certain files in this folder can’t be shared due to a takedown request in accordance with the DMCA. <a>Learn more</a>"},{a:function(e){return n.default.createElement("a",{target:"_top",href:"/help/210"},e)}}):o.intl.formatMessage({id:"KUyXWm",defaultMessage:"Certain files in this folder are unavailable. For more information <a>contact Dropbox support</a>."},{a:function(e){return n.default.createElement("a",{target:"_top",href:"/ticket"},e)}})})(t))},t.TakedownWarning.displayName="TakedownWarning"})),define("modules/clean/react/thumbnail",["require","exports","tslib","classnames","react","modules/clean/photos/batching_thumb_store","spectrum/file_icon","modules/constants/python","modules/core/uri","modules/clean/file_store/utils"],(function(e,t,r,n,a,i,o,s,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),a=r.__importDefault(a),i=r.__importDefault(i);var u=i.default(),c=(function(e){function t(t){var r=e.call(this,t)||this;return r.bindingId=null,r.handleImageError=function(){r.setState({src:null})},r.state=r.getStateForTemplateUrl(r.props.file.thumbnail_url_tmpl),r}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.bindThumbStore()},t.prototype.componentWillReceiveProps=function(e){var t=e.file.thumbnail_url_tmpl;t!==this.props.file.thumbnail_url_tmpl&&this.setState(this.getStateForTemplateUrl(t))},t.prototype.componentWillUpdate=function(){this.unbindThumbStore()},t.prototype.componentDidUpdate=function(){this.bindThumbStore()},t.prototype.componentWillUnmount=function(){this.unbindThumbStore()},t.prototype.bindThumbStore=function(){var e=this;if(this.state.isLoading&&!this.bindingId){var t=this.state.url;t&&(this.bindingId=u.bind_url(t,{onSuccess:function(){e.setState({isLoading:!1,src:u.get_thumb(t)})},onError:function(){e.setState({isLoading:!1})}}))}},t.prototype.unbindThumbStore=function(){this.bindingId&&(u.unbind_url(this.bindingId),this.bindingId=null)},t.prototype.getStateForTemplateUrl=function(e){var r=null;if(!e)return{isLoading:!1,src:null};var n=t.getThumbnailUrl(e);return n&&(r=u.get_thumb(n)),{isLoading:!!n&&!r,src:r,url:n}},t.getThumbnailUrl=function(e){if(e){var t=l.URI.parse(e);return t.updateQuery("size","178x178"),t.updateQuery("size_mode",s.THUMBNAIL_SIZE_MODE.EXACT.toString()),t.toString()}},t.prototype.render=function(){var e,t=this.props,r=t.alt,i=t.file,s=t.iconSize,l=t.className,u=this.state.src;return u?(e=["icon","thumbnail-image--loaded",l],a.default.createElement("img",{alt:r,className:n.default(e),src:u,onError:this.handleImageError})):(e=["icon","thumbnail-image--failed",l],a.default.createElement(o.FileIcon,{className:n.default(e),path:d.getFilename(i),variant:s}))},t.displayName="ThumbnailIcon",t})(a.default.Component);t.ThumbnailIcon=c}));
//# sourceMappingURL=pkg-shared_link_folder.min.js-vfl8CcONk.map