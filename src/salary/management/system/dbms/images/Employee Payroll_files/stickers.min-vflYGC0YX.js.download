define(["require","exports","tslib","tslib","comments2/components/comment_editor/core/class_decorators","comments2/components/comment_editor/layers/scaffold","comments2/components/comment_editor/core/types","draft-js"],(function(t,e,r,n,o,a,s,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.prototype.initStyle=function(t){var e=t.innerProps.evt,r=this.splitStickers(e.metadata).stickers;if(r.length){var n=r[0],o=i.ContentState.createFromText("").createEntity("sticker","IMMUTABLE",n),a=o.getLastCreatedEntityKey(),s=i.AtomicBlockUtils.insertAtomicBlock(i.EditorState.createWithContent(o),a,"*").getCurrentContent().getBlockMap().skip(1).first(),c=i.ContentState.createFromBlockArray([s]);return i.EditorState.createWithContent(c)}},e.prototype.postStyles=function(t){var e=t.innerProps,n=e.evt,o=e.value,a=this.getStickerMetadata(i.convertToRaw(n.getCurrentContent())),s=this.splitStickers(o.metadata).other;return r.__assign(r.__assign({},o),{metadata:r.__spreadArrays(s,a)})},e.prototype.getStickerMetadata=function(t){return t.blocks.reduce((function(e,n){var o=e.metadata,a=e.pos,s=n.entityRanges;return{metadata:r.__spreadArrays(o,s.filter((function(e){return"sticker"===t.entityMap[e.key].type})).map((function(e){var n=t.entityMap[e.key].data;return r.__assign({type:"sticker"},n.metadata[0])}))),pos:a+n.text.length}}),{metadata:[],pos:0}).metadata},e.prototype.splitStickers=function(t){return t.reduce((function(t,e){return"sticker"===e.type?{stickers:r.__spreadArrays(t.stickers,[e]),other:t.other}:{stickers:t.stickers,other:r.__spreadArrays(t.other,[e])}}),{stickers:[],other:[]})},e})(s.BaseLayer);e.StickerLayer=c,n.__decorate([o.plug(a.into.draft.on.populateWithComment.update.editorState)],c.prototype,"initStyle",null),n.__decorate([o.plug(a.into.comment.on.post.update.content)],c.prototype,"postStyles",null)}));
//# sourceMappingURL=stickers.min.js-vfl-z5e6H.map