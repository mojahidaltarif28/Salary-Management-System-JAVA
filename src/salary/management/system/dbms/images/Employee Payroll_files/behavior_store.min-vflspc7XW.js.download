define(["require","exports","tslib","external/lodash","reselect","rondo/v1/behavior","rondo/v1/performance","rondo/v1/store"],(function(e,t,i,r,o,s,h,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=i.__importStar(r);var c=(function(){function e(e){var t=e.behavior,i=e.displayName,o=e.initialState,s=e.id,h=e.slice,c=e.selector,n=e.options,d=e.store;this.displayName=i,this.slice=h,this.behavior=t,this.options=n,this.initialState=o,this.widgetSliceSelector=c?function(e){return c(e)}:r.identity,this.store=d&&a.isExtendedStore(d)?d:void 0,this.id=s||this.generateUniqueId()}return e.prototype.generateUniqueId=function(){return"STORE-"+(this.displayName?this.displayName+"-":"")+(this.slice?this.slice+"-":"")+Math.random().toString(36).substr(2,9)},e.prototype.createBehavior=function(){s.isBehaviorClass(this.behavior)?this.behaviorWidget=new this.behavior({slicePath:this.slice}):r.isFunction(this.behavior)?this.behaviorWidget=new(s.behavior(this.behavior))({slicePath:this.slice}):(this.behaviorWidget=this.behavior,this.behaviorWidget.slice=this.slice||this.behaviorWidget.slice,this.slice=this.behaviorWidget.slice)},e.prototype.createBehaviorContext=function(){var e=this,t=(this.options?this.options.behaviorSelectors:{})||{};return{state:this.store.getState(),selectors:Object.keys(t).reduce((function(i,r){return i[r]=o.createSelector(e.widgetSliceSelector,t[r]),i}),{})}},e.prototype.createStore=function(){return a.createStore(this.behaviorWidget,this.store||this.behaviorWidget.store,this.initialState,{replaceExistingReducer:!1})},e.prototype.createActions=function(){var e=this.behaviorWidget.createActions(),t=this.behaviorWidget.path;e=t&&t.length>0?r.get(e,t,{}):e;var i=this.slice?e[this.slice]:{};return r.assignIn({},e,i)},e.prototype.create=function(){var e=this;this.createBehavior(),this.store=this.createStore(),this.actions=this.createActions(),this.widgetSelect=this.behaviorWidget.createSelectors(),this.behaviorWidget.context=this.createBehaviorContext(),this.subscribe((function(){return e.behaviorWidget.context.state=e.store.getState()})),this.store.middlewareRegistry.get(s.ACTION_LISTENERS_MIDDLEWARE).subscribe(s.ACTION_BEHAVIOR_REFRESH,h.markAround(this.id,"behaviorRefresh",(function(e){return e.payload.behavior.id}))((function(t){var i=t.error,r=t.payload;if(i)return!1;var o=r,h=o.behavior,c=o.replaceExistingReducer,n=o.refresh;return e.actions=e.createActions(),e.widgetSelect=e.behaviorWidget.createSelectors(),e.store=a.createStore(e.behaviorWidget,e.store,void 0,{initBehavior:!1,replaceExistingReducer:c,refresh:n}),e.store.dispatch(s.createActionInitBehavior(h.id)),!0})))},e.prototype.getStateWithSelectors=function(e){void 0===e&&(e=this.store.getState());var t=this.widgetSliceSelector(e);return r.merge({},this.behaviorWidget.path.length>0?r.get(t,this.behaviorWidget.path):t,this.widgetSelect(t))},e.prototype.getSelectors=function(e){void 0===e&&(e=this.store.getState());var t=this.widgetSliceSelector(e);return this.widgetSelect(t)},e.prototype.getState=function(){return this.store?this.store.getState():void 0},e.prototype.subscribe=function(e){this.store&&this.store.subscribe(e)},e})();t.BehaviorStore=c}));
//# sourceMappingURL=behavior_store.min.js-vfl18zmVC.map