define(["require","exports","tslib","external/lodash","rondo/v1/invariant","rondo/v1/metadata","rondo/v1/behavior/delayed_op"],(function(e,r,t,n,i,s,u){"use strict";var b;Object.defineProperty(r,"__esModule",{value:!0}),n=t.__importStar(n),r.STATE_SUBSCRIBER_FIELD_TYPE="StateSubscriber";var o=(function(e){function s(t,s,u){var o=e.call(this,(function(){return o.subscribe()}),["_behavior","_store"],(function(){return!!o.behavior&&!!o.store}))||this;return o[b]=r.STATE_SUBSCRIBER_FIELD_TYPE,o.unsubscribe=function(){i.invariant(!!o._unsubscribe,"Cannot call unsubscribe before subscribing to the store"),o._unsubscribe()},o.subscribe=function(){i.invariant(!!o.behavior&&!!o.store,"Subscribe for state subscriber called before behavior and/or store are set");var e=o.store.getState(),r=o.behavior.pathState(e),t=o.store.subscribe((function(){var t=o.store.getState(),i=o.behavior.pathState(t);if(!n.isEqual(r,i)){var s=r;r=i,o.subscriberFns.forEach((function(r){return r({state:s,fullState:e},{state:i,fullState:t})}))}e=t}));o._unsubscribe=function(){var e=o.behavior.unsubscribers.indexOf(o.unsubscribe);e>-1&&o.behavior.unsubscribers.splice(e,1),t()}},o.listen=function(e,r){o.subscriberFns.push(r),e.addUnsubscribers((function(){var e=o.subscriberFns.indexOf(r);e>-1&&o.subscriberFns.splice(e,1)}))},o.behavior=s,o.store=u,o.subscriberFns=[t],o}return t.__extends(s,e),Object.defineProperty(s.prototype,"behavior",{get:function(){return this._behavior},set:function(e){e!==this._behavior&&this.reset(),this._behavior=e},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"store",{get:function(){return this._store},set:function(e){e!==this._store&&this.reset(),this._store=e},enumerable:!0,configurable:!0}),s})(u.DelayedOperation);r.StateSubscriberInBehavior=o,b=s.ENTRY_FIELD_TYPE,r.subscribeState=function(e){return new o(e)},r.subscribeStateWhen=function(e,t){return r.subscribeState((function(r,n){e(n.state,r.state)&&t(r,n)}))},r.whenFieldDefined=function(e,t){return r.subscribeStateWhen((function(r,t){var i=n.get(r,n.isString(e)?[e]:e),s=n.get(t,n.isString(e)?[e]:e);return!n.isEqual(i,s)&&void 0!==i}),t)},r.whenFieldChanged=function(e,t){return r.subscribeStateWhen((function(r,t){var i=n.get(t,n.isString(e)?[e]:e),s=n.get(r,n.isString(e)?[e]:e);return!n.isEqual(i,s)}),t)},r.once=function(e){var r=e.subscriberFns[0];return e.subscriberFns[0]=function(t,n){r(t,n),e.unsubscribe()},e}}));
//# sourceMappingURL=subscriber.min.js-vflsBeJ7e.map