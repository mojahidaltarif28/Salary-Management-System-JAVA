define("modules/clean/sortable",["require","exports","tslib","jquery"],(function(e,t,r,i){"use strict";function o(e,t,r){var o=i.default(e).find("[data-sort-name="+r+"]"),s=o.data("sort-value")||o.text();return"int"===t?parseInt(s,10):"float"===t?parseFloat(s):s}Object.defineProperty(t,"__esModule",{value:!0}),i=r.__importDefault(i);var s=(function(){function e(e,t,r,o){null==t&&(t=".sort-header"),null==r&&(r=".sort-row"),this.header_selector=t,this.row_selector=r,this.sort_callback=o,this.$root=i.default(e),this._build_indicators(),this._listen()}return e.prototype.sort=function(e,t){var r;this._clear(),e=i.default(e),t?(e.attr("data-sort-ascending",1),e.find(".sort-indicator").removeClass("s_web_arrow-down-gray").addClass("s_web_arrow-up-gray")):(e.attr("data-sort-descending",1),e.find(".sort-indicator").removeClass("s_web_arrow-up-gray").addClass("s_web_arrow-down-gray"));var s=e.attr("data-sort-type"),n=e.attr("data-sort-name"),a=this.$root.find(this.row_selector);if(a.length){for(var u=[],_=0,l=Array.from(a);_<l.length;_++){r=o(p=l[_],s,n),u.push([r,p])}u.sort((function(e,t){var r=e[0],i=t[0];return r<i?-1:r>i?1:0})),t||u.reverse();for(var d=i.default(a[0]).parent(),m=0,h=Array.from(u);m<h.length;m++){var p=h[m][1];d.append(p)}return"function"==typeof this.sort_callback?this.sort_callback(this.$root):void 0}},e.prototype._listen=function(){var e=this;return this.$root.on("click",this.header_selector,(function(t){var r=i.default(t.target).closest(e.header_selector);return e.sort(r,!r.attr("data-sort-ascending"))}))},e.prototype._clear=function(){for(var e=this.header_selector+"[data-sort-ascending]",t=this.header_selector+"[data-sort-descending]",r=this.$root.find(e),i=0,o=Array.from(r);i<o.length;i++){o[i].removeAttribute("data-sort-ascending")}var s=this.$root.find(t);return(function(){for(var e=[],t=0,r=Array.from(s);t<r.length;t++){var i=r[t];e.push(i.removeAttribute("data-sort-descending"))}return e})()},e.prototype._build_indicators=function(){return this.$root.find(this.header_selector).each((function(){var e=i.default(this),t=e.find(".sort-indicator");if(t.length)return t.addClass("sprite sprite_web");var r=i.default("<span/>",{class:"sort-indicator sprite sprite_web"});return r.append("&nbsp;"),e.append(r)}))},e})();t.default=s})),define("modules/clean/teams/device_management_remove_device",["require","exports","tslib","purify","jquery","modules/clean/ajax","modules/clean/react/modal","modules/clean/viewer","modules/core/i18n","modules/core/notify"],(function(e,t,r,i,o,s,n,a,u,_){"use strict";var l;Object.defineProperty(t,"__esModule",{value:!0}),i=r.__importStar(i),o=r.__importDefault(o),s=r.__importStar(s),(l=(function(){function e(t,r,i,o,s){e.user_id=t,e.user_name=r,e.team_id=i,e.team_name=o,e.init_listener(s)}return e.initClass=function(){this.user_id=null,this.user_name=null,this.team_id=null,this.team_name=null},e.init_listener=function(t){return(function(){for(var r=[],i=function(t){var i=t.id,s=t.model;o.default("#dm_remove_device-"+i).data("device_id",i),o.default("#dm_remove_device-"+i).data("device_model",s),o.default("#dm_remove_device-"+i).data("device_is_delete_on_unlink_supported",t.is_delete_on_unlink_supported),r.push(o.default("#dm_remove_device-"+i).on("click",(function(){var t=o.default("#"+this.id);i=t.data("device_id"),s=t.data("device_model");var r=t.data("device_is_delete_on_unlink_supported");return e.remove_device(i,s,r,t)})))},s=0,n=Array.from(t.devices);s<n.length;s++)i(n[s]);return r})()},e.remove_device=function(t,r,o,s){var a=u.intl.formatMessage({id:"6stS1v",defaultMessage:"Remove {device_model}"},{device_model:r}),_=u.intl.formatMessage({id:"J4nSFt",defaultMessage:"You’re about to unlink {member_name}’s {device_model}. It will immediately stop syncing all sessions with their {team_name} Dropbox on this device."},{member_name:'<span class="member-name">'+e.user_name+"</span>",device_model:r,team_name:'<span class="team-name">'+e.team_name+"</span>"});return o&&(_+='<br/><br/><input type="checkbox" id="remove_device_delete_data"/>'+u.intl.formatMessage({id:"H1ycIc",defaultMessage:"Delete {team_name} files from this computer the next time it comes online."},{team_name:e.team_name})),n.SimpleModal.show({title_text:a,body_html:i.sanitize(_),cancel_text:u.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}),confirm_text:u.intl.formatMessage({id:"6WOQfa",defaultMessage:"Remove"}),confirm_callback:function(){return e.remove_device_submit(t,r,s)},cancel_callback:function(){}})},e.remove_device_submit=function(t,r,i){var n=!1;return o.default("#remove_device_delete_data").length>0&&o.default("#remove_device_delete_data")[0].checked&&(n=!0),s.WebRequest({url:"/account/remove_user_device",data:{team_id:e.team_id,user_id:e.user_id,device_id:JSON.stringify(t),delete_data:n,app_id:"0"},subject_user:a.Viewer.get_viewer().work_user,success:function(t){return"OK"===t?(e.remove_closest_row(i),_.Notify.success(u.intl.formatMessage({id:"vjZ5av",defaultMessage:"{device_model} removed."},{device_model:r}))):_.Notify.error(u.intl.formatMessage({id:"mRtsI4",defaultMessage:"remove device failed"}))}})},e.remove_closest_row=function(e){var t=o.default(e).closest(".team_admin_table_row"),r=o.default(t).closest(".team_admin_table");if(1===r.find(".team_admin_table_row").length){var i=r.prev(".team_admin_table_title");return i.length||(i=o.default(".team_apps_table_panel")),i.remove(),r.remove()}return t.remove()},e})()).initClass(),l=l,t.default=l})),define("modules/clean/teams/member_unlock_action",["require","exports","tslib","modules/clean/teams/admin/api/admin_console_api_client","modules/core/browser","modules/core/notify","modules/core/i18n"],(function(e,t,r,i,o,s,n){"use strict";function a(e,t){(new i.AdminConsoleApiClient).unlockUser(e).then((function(){o.redirect(t)})).catch((function(){s.Notify.error(n.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."}))}))}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.memberUnlockAction=a,t.bindBannerUnlockUser=function(e,t,r){var i=document.getElementById(e);i&&i.addEventListener("click",(function(e){return a(t,r)}))}})),define("modules/dirty/groups/group_list",["require","exports","tslib","jquery","legacy_js/dropbox","modules/clean/contacts/types","modules/clean/groups/api","modules/clean/groups/util","modules/clean/sortable","modules/clean/table_filter","modules/clean/viewer","modules/core/html","modules/core/i18n","modules/dirty/groups/groups_list","scriptaculous"],(function(e,t,r,i,o,s,n,a,u,_,l,d,m,h,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=r.__importDefault(i),s=r.__importDefault(s),n=r.__importStar(n),a=r.__importStar(a),u=r.__importDefault(u),_=r.__importDefault(_),h=r.__importDefault(h);var c=(function(){function e(t){var r=this,n=t.base,a=t.group,_=t.viewer_is_admin,d=t.ui,h=t.context;this.handle_token_change=this.handle_token_change.bind(this),this.show_add_to_group_modal=this.show_add_to_group_modal.bind(this),this.add_users_to_group=this.add_users_to_group.bind(this),this.show_edit_group_modal=this.show_edit_group_modal.bind(this),this.change_group_name=this.change_group_name.bind(this),this.handle_rename_errors=this.handle_rename_errors.bind(this),this.finalize_group_name=this.finalize_group_name.bind(this),this.show_delete_group_modal=this.show_delete_group_modal.bind(this),this.remove_group=this.remove_group.bind(this),this.finalize_delete_group=this.finalize_delete_group.bind(this),this.show_leave_group_modal=this.show_leave_group_modal.bind(this),this.leave_group=this.leave_group.bind(this),this.finalize_leave_group=this.finalize_leave_group.bind(this),this.switch_to=this.switch_to.bind(this),this.show_created_group=this.show_created_group.bind(this),this.refresh=this.refresh.bind(this),this.show_group=this.show_group.bind(this),this.hide_new_member_field=this.hide_new_member_field.bind(this),this.show_group_actions=this.show_group_actions.bind(this),this.show_user_actions=this.show_user_actions.bind(this),this.add_to_group_handler=this.add_to_group_handler.bind(this),this.click_new_member_field=this.click_new_member_field.bind(this),this.toggle_new_member_field=this.toggle_new_member_field.bind(this),this.doc_click=this.doc_click.bind(this),this.remove_user=this.remove_user.bind(this),this.show_remove_user_modal=this.show_remove_user_modal.bind(this),this.finalize_remove_user=this.finalize_remove_user.bind(this),this.show_make_owner_modal=this.show_make_owner_modal.bind(this),this.make_owner=this.make_owner.bind(this),this.show_make_member_modal=this.show_make_member_modal.bind(this),this.make_member=this.make_member.bind(this),this.set_viewer_admin_or_owner=this.set_viewer_admin_or_owner.bind(this),this.render_users_for_group=this.render_users_for_group.bind(this),this.set_up_search_filter=this.set_up_search_filter.bind(this),this.refresh_search_filter=this.refresh_search_filter.bind(this),this.ui=d,this.$base=i.default(n),this.group=a||{},this.viewer_is_admin=_||!1,this.viewer_is_admin_or_owner=_,this.context=h||e.CURRENT_GROUP,this.$base.find(".add-new-member-link").click(this.toggle_new_member_field),this.$base.find(".add-new-member-field .text-input-input, .add-new-member-field .add_member_icon").click(this.click_new_member_field),this.$base_group_user_list=this.$base.find(".group-user-list"),this.$base_group_user_list_container=this.$base.find(".group-user-list-container"),this.$base_group_user_list.on("click",".user-actions-link",this.show_user_actions),this.$base_group_user_list.on("click",".remove-user-action",this.remove_user),this.$base_group_user_list.on("click",".make-owner-action",this.show_make_owner_modal),this.$base_group_user_list.on("click",".make-member-action",this.show_make_member_modal),i.default(document).click(this.doc_click),this.$base.find("#group-actions-dropdown").click(this.show_group_actions),this.$base.find("#add-to-group-button").click(this.show_add_to_group_modal),this.$base.find("#add-users-to-group-button").click(this.add_users_to_group),this.$base.find("#group-change-link").click(this.show_edit_group_modal),this.$base.find("#delete-group-button, #delete-group-link").click(this.show_delete_group_modal),this.$base.find("#leave-group-button, #leave-group-link").click({leave_group:!0},this.remove_user),i.default(".cancel-modal-button").click((function(){return o.Modal.hide()})),this.context===e.CURRENT_GROUP&&(this.auto_completer=new p.Autocompleter.TeamTokenizer(l.Viewer.get_viewer().work_user,"add-user-new-collab-input","add-user-new-whobulk","add-user-hidden-input",{hide_import_contacts:!0,suggestions_disabled:!0,wrap_name:!0,tokens:[",",";"],team_only:!0,contact_filter:function(e){return e.excludeNonTeam().excludeNewStyleGroups().excludeByEmail(r.email)}}),this.auto_completer.element.observe("token:remove",this.handle_token_change),this.auto_completer.element.observe("token:add",this.handle_token_change),this.auto_completer.createTokenInfo=function(e,t,r){var i=!0,n=!1,a=t;return r!==s.default.EMAIL||o.Util.validate_email(t)?Array.from(this.members).includes(t)?(i=!1,a=m.intl.formatMessage({id:"chQq36",defaultMessage:"Already in the group"})):t===this.user.email||t===this.user.id?a=m.intl.formatMessage({id:"kFyzJs",defaultMessage:"You"}):r===s.default.EMAIL&&this.suspended_contacts[t]?(a=m.intl.formatMessage({id:"WL0qyn",defaultMessage:"This member is suspended"}),n=!0):r===s.default.EMAIL&&this.pending_contacts[t]?a=m.intl.formatMessage({id:"6+01wL",defaultMessage:"This is an invited member"}):r!==s.default.EMAIL||this.team_contacts[t]||(i=!1,n=!0,a=m.intl.formatMessage({id:"1tiqch",defaultMessage:"Not a team member"})):(i=!1,a=m.intl.formatMessage({id:"iZo4vO",defaultMessage:"Invalid email"})),!e&&t&&(e=t.toString()),{display:e,value:t,type:r,valid:i,external:n,bubble_title:a}}),this.$base.on("db:destroy",this.destroy),null!=this.group.id&&this.refresh(),new u.default(this.$base_group_user_list_container),this.$base.find(".sort-header").on("click",(function(){return this.stopPropagation})),this.set_up_search_filter()}return e.initClass=function(){this.CURRENT_GROUP="currentgroup",this.NEW_GROUP="newgroup"},e.prototype.handle_token_change=function(e){var t=this.auto_completer.token_manager.tokens.filter((function(e){return e.info.valid}));return t.length!==this.auto_completer.token_manager.tokens.length?i.default("#add-to-group-error").text(m.intl.formatMessage({id:"85p8vn",defaultMessage:"One or more names or email addresses you entered are invalid."})):(t.length,i.default("#add-to-group-error").text(""))},e.prototype.show_add_to_group_modal=function(e){var t=m.intl.formatMessage({id:"7ZfcJ/",defaultMessage:"Add members to '{group_name}'"},{group_name:this.group.name});return o.Modal.show(t,i.default("#add-to-group-modal")[0]),this.auto_completer.clearTokens(),this.auto_completer.update.hide(),i.default("#add-to-group-error").text(""),i.default("#add-user-new-collab-input").focus()},e.prototype.add_users_to_group=function(e){if(i.default("#add-user-new-collab-input").val().length>0&&this.auto_completer.tokenize_emails_input(!0),0===this.auto_completer.token_manager.tokens.length)return i.default("#add-to-group-error").text(m.intl.formatMessage({id:"JYmsWD",defaultMessage:"Please enter at least one valid name or email address"})),i.default("#add-user-new-collab-input").focus();var t=this.auto_completer.token_manager.tokens.filter((function(e){return e.info.valid}));if(t.length!==this.auto_completer.token_manager.tokens.length)return i.default("#add-to-group-error").text(m.intl.formatMessage({id:"zynStQ",defaultMessage:"One or more names or email addresses you entered are invalid. Please correct the highlighted inputs below."}));i.default("#add-to-group-error").text("");var r=t.map((function(e){return{email:e.info.value,is_owner:!1}}));return this.add_to_group_handler(r)},e.prototype.show_edit_group_modal=function(e){e.preventDefault();var t=m.intl.formatMessage({id:"9lplRT",defaultMessage:"Edit '{group_name}'"},{group_name:this.group.name});return i.default("#edit-group-modal .edit-group-name-input .text-input-input").prop("disabled",!1),i.default("#edit-group-modal .edit-group-name-input").val(this.group.name),o.Modal.show(t,i.default("#edit-group-modal")[0]),i.default("#modal-content .edit-group-name-input").focus(),i.default("#modal-content .save-group-name-button").off("click").on("click",this.change_group_name)},e.prototype.change_group_name=function(e){var t=i.default(".edit-group-name-input").val(),r=!0;if(this.ui&&(this.ui.clear_error_message("edit-group-name-field"),t.trim().length<=0?(this.ui.set_error_message("edit-group-name-field",m.intl.formatMessage({id:"kJ19st",defaultMessage:"Your group must have a name."})),i.default("#modal-content .edit-group-name-input").focus(),r=!1):t.trim().length>140&&(this.ui.set_error_message("edit-group-name-field",m.intl.formatMessage({id:"ma216W",defaultMessage:"The group name should be under 140 characters"})),i.default("#modal-content .edit-group-name-input").focus(),r=!1)),r)return n.rename_group({group_id:this.group.id,new_name:t},this.finalize_group_name,this.handle_rename_errors)},e.prototype.handle_rename_errors=function(e){return this.ui&&this.ui.set_error_message("edit-group-name-field",e),i.default("#modal-content .edit-group-name-input").focus()},e.prototype.finalize_group_name=function(){return this.group.name=i.default("#modal-content .edit-group-name-input").val(),this.ui&&(this.ui.update_group_header("single-group-header",this.group.name,this.group.localized_created_ts),this.ui.groups_list.refresh()),o.Modal.hide()},e.prototype.show_delete_group_modal=function(e){var t=m.intl.formatMessage({id:"VeAz6Q",defaultMessage:"Delete '{group_name}'"},{group_name:this.group.name});return i.default("#delete-group-modal .group_name").text(this.group.name),i.default("#delete-group-confirm-button").prop("disabled",!1),o.Modal.show(t,i.default("#delete-group-modal")[0]),i.default("#modal-content .delete-group-confirm-button").click(this.remove_group)},e.prototype.remove_group=function(e){return i.default(".delete-group-confirm-button").prop("disabled",!0),n.remove_group({group_id:this.group.id},this.finalize_delete_group)},e.prototype.finalize_delete_group=function(){if(i.default(".delete-group-confirm-button").prop("disabled",!1),o.Modal.hide(),this.ui)return this.ui.groups_list.refresh(),this.ui.main_groups_view()},e.prototype.show_leave_group_modal=function(e){var t=m.intl.formatMessage({id:"sjM3E3",defaultMessage:"Leave '{group_name}'"},{group_name:this.group.name});return i.default("#leave-group-modal .group_name").text(this.group.name),i.default(".leave-group-confirm-button").prop("disabled",!1),o.Modal.show(t,i.default("#leave-group-modal")[0]),i.default("#modal-content .leave-group-confirm-button").click(this.leave_group)},e.prototype.leave_group=function(e){return i.default(".leave-group-confirm-button").prop("disabled",!0),n.remove_user_from_group({group_id:this.group.id,user_id:this.viewer_id},this.finalize_leave_group)},e.prototype.finalize_leave_group=function(){return o.Modal.hide(),this.ui?(this.ui.groups_list.refresh(),this.ui.main_groups_view()):this.refresh()},e.prototype.switch_to=function(e){return this.group=e,this.refresh()},e.prototype.show_created_group=function(e){return this.group={},this.group.name=e.name,this.group.id=e.id,this.group.created_ts=(new Date).getTime(),this.render_users_for_group(e.users)},e.prototype.refresh=function(){return i.default("#group-user-search").val(""),n.get_users_for_group({group_id:this.group.id},this.render_users_for_group)},e.prototype.show_group=function(e){return this.group=e,this.render_users_for_group(e.users)},e.prototype.hide_new_member_field=function(){return this.$base.find(".add-new-member").show(),this.$base.find(".add-new-member-field").hide()},e.prototype.show_group_actions=function(e){this.doc_click(),i.default(".group_actions_bubble").show(),e.stopPropagation()},e.prototype.show_user_actions=function(e){this.doc_click(),this.hide_new_member_field();var t=i.default(e.currentTarget),r=t.data("user-name"),o=t.data("user-email"),s=t.data("user-id"),n=t.data("group-id"),a=0!==t.closest(".group-user-item").find(".group-owner-reminder").length,u=d.HTML.tmpl("group_user_actions_tmpl"),_=i.default(e.currentTarget).parent(),l=_.find(".group_user_actions_bubble");if(l.length>0)l.remove();else{i.default(".group_users").find(".group_user_actions_bubble").length>0&&i.default(".group_users").find(".group_user_actions_bubble").remove();var m=u({user_id:s,group_id:n,group_name:this.group.name,user_name:r||o,user_email:o,is_owner:a,can_be_owner:this.group.can_be_owner[o]});_.append(m.toHTML())}e.stopPropagation()},e.prototype.add_to_group_handler=function(e){var t=this;return n.add_users_to_group({members:JSON.stringify(e),group_id:this.group.id},(function(){if(t.ui)return t.ui.groups_list.refresh(),t.ui.single_group_ctl.refresh(),o.Modal.hide()}))},e.prototype.click_new_member_field=function(e){return e.stopPropagation()},e.prototype.toggle_new_member_field=function(e){return this.doc_click(),this.$base.find(".add-new-member").hide(),this.$base.find(".add-new-member-field").show().find("input").focus().val(""),e.stopPropagation()},e.prototype.doc_click=function(e){return this.hide_new_member_field(),this.$base.find(".group_user_actions_bubble").remove(),this.$base.find(".group_actions_bubble").hide()},e.prototype.remove_user=function(e){var t;return i.default(e.currentTarget).data("user-id")===l.Viewer.get_viewer().work_user.id||(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.leave_group)?this.show_leave_group_modal(e):this.show_remove_user_modal(e)},e.prototype.show_remove_user_modal=function(e){var t=i.default(e.currentTarget),r=t.data("user-name"),s=t.data("user-id"),n=t.data("group-id"),a=t.data("group-name"),u=m.intl.formatMessage({id:"rg/kpn",defaultMessage:"Remove {user_name} from '{group_name}'"},{user_name:r,group_name:a});return i.default("#remove-from-group-modal .group_name").text(a),i.default("#remove-from-group-modal .user_name").text(r),o.Modal.show(u,i.default("#remove-from-group-modal")[0]),i.default("#modal-content .remove-from-group-confirm-button").off("click").click({user_id:s,group_id:n},this.finalize_remove_user)},e.prototype.finalize_remove_user=function(e){var t=this;return n.remove_user_from_group({group_id:e.data.group_id,user_id:e.data.user_id},(function(){if(t.ui)return t.ui.groups_list.refresh(),t.ui.single_group_ctl.refresh()})),o.Modal.hide()},e.prototype.show_make_owner_modal=function(e){var t=i.default(e.currentTarget),r=t.data("user-id"),s=t.data("user-name"),n=t.data("user-email"),a=m.intl.formatMessage({id:"m0z9z6",defaultMessage:"Are you sure you want to make {user_name} an owner?"},{user_name:s});return i.default("#make-owner-modal .user_name").text(s),o.Modal.show(a,i.default("#make-owner-modal")[0],{user_id:r,user_email:n,user_name:s||n}),i.default("#modal-content .make-owner-button").one("click",this.make_owner)},e.prototype.make_owner=function(e){var t=this,r=o.Modal.vars.user_id;return n.change_group_member_type({group_id:this.group.id,user_id:r,is_owner:!0},(function(){if(t.ui)return t.ui.groups_list.refresh(),t.ui.single_group_ctl.refresh()})),o.Modal.hide()},e.prototype.show_make_member_modal=function(e){var t=i.default(e.currentTarget),r=t.data("user-id"),s=t.data("user-name"),n=t.data("user-email"),a=m.intl.formatMessage({id:"6O9OEr",defaultMessage:"Are you sure you want to remove owner permissions from {user_name}?"},{user_name:s});return i.default("#make-member-modal .user_name").text(s),o.Modal.show(a,i.default("#make-member-modal")[0],{user_id:r,user_email:n,user_name:s}),i.default("#modal-content .make-member-button").one("click",this.make_member)},e.prototype.make_member=function(e){var t=this,r=o.Modal.vars.user_id;return n.change_group_member_type({group_id:this.group.id,user_id:r,is_owner:!1},(function(){if(t.ui)return t.ui.groups_list.refresh(),t.ui.single_group_ctl.refresh()})),o.Modal.hide()},e.prototype.set_viewer_admin_or_owner=function(e){var t=this;return(function(){for(var r=[],i=0,o=Array.from(e);i<o.length;i++){var s=o[i];if(s.email===l.Viewer.get_viewer().work_email){t.viewer_is_admin_or_owner=t.viewer_is_admin||s.is_owner,t.viewer_id=s.user_id;break}r.push(void 0)}return r})()},e.prototype.render_users_for_group=function(e){var t=e.length,r=this.$base.find(".user_num");r.length>0&&(r.empty(),r.append(m.intl.formatMessage({id:"ECZFz/",defaultMessage:"{count, plural, one{{count} member} other{{count} members}}"},{count:t}))),0===t?(i.default(".no-group-members").show(),i.default("#user-search-empty").hide()):i.default(".no-group-members").hide(),this.set_viewer_admin_or_owner(e),this.viewer_is_admin_or_owner?(i.default("#group-admin-controls").show(),i.default("#leave-group-link").data("user-id",this.viewer_id),i.default("#leave-group-button").hide(),i.default("#group-change-link").show()):(i.default("#group-admin-controls").hide(),i.default("#leave-group-button").data("user-id",this.viewer_id),i.default("#leave-group-button").show(),i.default("#group-change-link").hide()),this._tmpl=d.HTML.tmpl("group_user_list_item_tmpl");var o=this.$base.find(".group-user-list");o.empty(),this.group.owners=[],this.group.can_be_owner={},e=a.sortBy(e,(function(e){return e.name.toLowerCase()})),this.auto_completer.members=[];for(var s=0,n=Array.from(e);s<n.length;s++){var u=n[s];this.auto_completer.members.push(u.email);var _=this._tmpl({user:u,get_initials:h.default.get_initials,get_display_name:h.default.get_display_name,get_color:h.default.string_to_color,brand_new:!1,admin_or_owner:this.viewer_is_admin_or_owner});u.is_owner?(this.group.owners.push(u),o.children(".owner-row").length>0?o.children(".owner-row").last().after(_.toHTML()):o.prepend(_.toHTML())):(u.can_be_owner&&(this.group.can_be_owner[u.email]=!0),o.append(_.toHTML()))}return this.ui&&this.ui.update_group_header("single-group-header",this.group.name,this.group.localized_created_ts),0!==t&&this.refresh_search_filter(),this.$base.trigger("db:groups_ready")},e.prototype.set_up_search_filter=function(){this.filter=new _.default("group-user-search","group-user-list","group-user-item",!1,"user-search-empty")},e.prototype.refresh_search_filter=function(){return this.filter.refresh()},e})();t.GroupUserListController=c,c.initClass();var g=(function(){function e(e){this.to_html=this.to_html.bind(this),this.upload_data=this.upload_data.bind(this),this.name=e.name,this.email=e.email,this.is_owner=e.is_owner}return e.prototype.to_html=function(){var e={user:{name:this.name,email:this.email,is_owner:this.is_owner,user_id:null,group_id:null},brand_new:!0,admin_or_owner:!0};return d.HTML.tmpl("group_user_list_item_tmpl")(e).toHTML()},e.prototype.upload_data=function(){return{email:this.email,is_owner:this.is_owner}},e})(),f=(function(e){function t(t){var r=t.base,i=t.viewer_is_admin,s=t.ui,n=e.call(this,{base:r,viewer_is_admin:i,ui:s,context:c.NEW_GROUP})||this;return n.submit=n.submit.bind(n),n.users_to_add=[],n.viewer_is_admin_or_owner=!0,n.$base.on("click","#finish-creating-group-button",n.submit),n.$base.on("click","#cancel-creating-group-button",(function(){return n.ui.set_group_id_hash(),o.Modal.onHide=null,o.Modal.hide()})),n}return r.__extends(t,e),t.prototype.refresh=function(){var e=this;this.users_to_add=[],this.$base.find("input").val("");var t=new g({name:l.Viewer.get_viewer().display_name,email:l.Viewer.get_viewer().work_email,is_owner:!0});this.users_to_add.push(t),this.ui.clear_error_message("group-name-input");var r=m.intl.formatMessage({id:"Jlk66P",defaultMessage:"Create a new group"});return o.Modal.onHide=function(){return e.ui.set_group_id_hash(),o.Modal.onHide=null,o.Modal.hide()},o.Modal.show(r,this.$base[0])},t.prototype.submit=function(){var e=this,t=this.$base.find("#group-name-input").val();if(this.ui&&t.trim().length<=0)return this.ui.set_error_message("group-name-input",m.intl.formatMessage({id:"kJ19st",defaultMessage:"Your group must have a name."}));if(this.ui&&t.trim().length>140)return this.ui.set_error_message("group-name-input",m.intl.formatMessage({id:"ma216W",defaultMessage:"The group name should be under 140 characters"}));var r=this.$base.find("#finish-creating-group-button"),i=this.$base.find(".progress-spinner");r.prop("disabled",!0),i.show();var s=JSON.stringify(Array.from(this.users_to_add).map((function(e){return e.upload_data()})));return n.create_group_with_users({name:t,members:s,is_admin_managed:!1},(function(t){return o.Modal.onHide=null,o.Modal.hide(),e.$base.trigger("db:group_created",t)})).always((function(){return r.prop("disabled",!1),i.hide()}))},t.prototype.set_up_search_filter=function(){},t.prototype.refresh_search_filter=function(){},t})(c);t.NewGroupUserListController=f})),define("modules/dirty/groups/groups_list",["require","exports","tslib","jquery","legacy_js/dropbox","modules/clean/avatar/style","modules/clean/groups/api","modules/clean/groups/util","modules/clean/sortable","modules/clean/viewer","modules/core/html","modules/core/i18n","modules/core/notify","modules/clean/teams/modals/remove_user_from_group_modal","prototype"],(function(e,t,r,i,o,s,n,a,u,_,l,d,m,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=r.__importDefault(i),n=r.__importStar(n),a=r.__importStar(a),u=r.__importDefault(u);var p=(function(){function e(e){var t=e.base,r=e.user_id,s=e.user_name,n=e.populate_groups_list,a=e.group_name_links,u=e.team_name;this.refresh=this.refresh.bind(this),this.show_remove_user_modal=this.show_remove_user_modal.bind(this),this.finalize_remove_user=this.finalize_remove_user.bind(this),this.$base=i.default(t),this.user_id=r,this.user_name=s,this.populate_groups_list=n,this.groups={},this.group_name_links=null==a||a,this.team_name=u,this.$base_groups_list=this.$base.find(".groups-list"),this.$base_groups_list.on("click",".join-request-link",this.group_join_request_handler),void 0===this.user_id&&(this.user_id=_.Viewer.get_viewer().work_user.id),this.editable=this.$base.find(".settings-column").length,this.show_membership=this.$base.find(".membership-column").length,this.show_join_requests=this.$base.find(".join-requests-column").length,this.$base.on("click",".group-settings-col",this.show_remove_user_modal),i.default(".cancel-modal-button").click((function(){return o.Modal.hide()}))}return e.initClass=function(){this.join_owners=function(e){return Array.from(e).map((function(e){return e.name})).join("")}},e.prototype.refresh=function(){var t=this;return this.populate_groups_list({user_id:this.user_id},(function(r){if(0===r.length&&i.default("#empty-groups-view").show().length)t.$base.hide();else{var o=l.HTML.tmpl("group_list_item_tmpl"),s=t.$base.find(".groups-list"),n=s[0].className.indexOf("only_company_managed_groups")>-1;s.empty(),r=a.sortBy(r,(function(e){return e.name.toLowerCase()}));for(var _=0,d=Array.from(r);_<d.length;_++){var m=d[_];if(!n||m.is_admin_managed){t.groups[m.id]=m;var h=o({get_inits:e.get_initials,get_color:e.string_to_color,snip_owners:e.snip_owners,join_owners:e.join_owners,editable:t.editable,show_membership:t.show_membership,show_join_requests:t.show_join_requests,group:m,group_name_links:t.group_name_links,team_name:t.team_name});s.append(h.toHTML())}}new u.default(i.default("#groups_main"))}return t.$base.trigger("db:all_groups_loaded")}))},e.prototype.show_remove_user_modal=function(e){var t=i.default(e.target),r=this.user_name,o=this.user_id,s=t.data("group-id"),n=t.data("group-name");return h.showRemoveUserFromGroupModal({groupId:s,groupName:n,userId:o,userDisplayName:r,removeSelf:!0,onPrimaryAction:function(){t.parents(".group-item").remove()}})},e.prototype.finalize_remove_user=function(e){var t=e.data.row;return n.remove_user_from_group({group_id:e.data.group_id,user_id:e.data.user_id},(function(){return t.parents(".group-item").remove()})),o.Modal.hide()},e.prototype.group_join_request_handler=function(e){return n.make_group_join_request({group_id:i.default(e.currentTarget).data("group-id"),success:function(){return m.Notify.success(d.intl.formatMessage({id:"q5XxwP",defaultMessage:"Request sent."}))}})},e.get_display_name=function(e){return""===e?"-":e},e.get_initials=function(e,t){if(""===e&&null!=t)return t.charAt(0).toLowerCase();var r=e.split(" ").map((function(e){return e.charAt(0).toUpperCase()}));return r.length>2&&(r=r.splice(0,2)),r.join("")},e.string_to_color=function(e){return s.colorValueForAvatarName(e)},e.snip_owners=function(e,t,r){var i=Array.from(e).map((function(e){return e.name}));return 0===i.length?t?r:"-":1===i.length?i[0]:d.intl.formatMessage({id:"M0ZojO",defaultMessage:"{count, plural, one{{name} + 1 other} other{{name} + {count} others}}"},{count:i.length-1,name:i[0]})},e})();p.initClass(),__CIRCULAR_DEPENDENCY__.GroupsListController=p,t.default=p})),define("modules/dirty/groups/ui",["require","exports","tslib","jquery","modules/clean/groups/api","modules/clean/multiaccount_login","modules/clean/viewer","modules/core/browser","modules/core/controller_helpers","modules/core/i18n","modules/core/notify","modules/dirty/groups/group_list","modules/dirty/groups/groups_list"],(function(e,t,r,i,o,s,n,a,u,_,l,d,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=r.__importDefault(i),o=r.__importStar(o),s=r.__importDefault(s),a=r.__importStar(a),u=r.__importStar(u),d=r.__importStar(d),m=r.__importDefault(m);var h=d.GroupUserListController,p=d.NewGroupUserListController,c={};c.ready=function(e){return c._config=e,c._groups_loaded=!1,c._pending_view=void 0,i.default(".create-group-button").click(c.switch_to_new_group_view),i.default(".groups-views").on("click",".main-groups-view-link",c.main_groups_view),i.default(".groups-list").on("click",".group-link",c.single_group_view),i.default(document).click(c.doc_click),i.default(document).on("db:group_created",(function(e,t){return c.set_group_id_hash(t.id),c.update_group_header("single-group-breadcrumb",t.name,t.localized_created_ts),c.single_group_ctl.show_created_group(t)})),i.default(document).on("tabs:tab_shown",(function(t,r){var i=c.group_id_from_hash();c.groups_shown()&&c.maybe_login_then_init(e,i)})),u.get_controller(i.default("#sharing-tabs"))?c.maybe_login_then_init(e):(i.default(window).bind("hashchange",(function(){var t=c.group_id_from_hash();return c.maybe_login_then_init(e,t)})),void i.default(window).trigger("hashchange"))},c.maybe_login_then_init=function(e,t){return n.Viewer.get_viewer().is_role_signed_in("work")?c.groups_shown()&&null!=c.groups_list?c.show_group_or_list(t):c.init_groups_list(e,c.groups_shown()):c.groups_shown()?s.default.show_modal({role:"work",on_success:function(){return c.init_groups_list(e,!0)}}):void 0},c.init_groups_list=function(e,t){if(c.single_group_ctl=new h({base:"#single-group-view",viewer_is_admin:e.user_is_team_admin,ui:c}),c.new_group_ctl=new p({base:"#new-group-modal",viewer_is_admin:e.user_is_team_admin,ui:c}),c.groups_list=new m.default({base:"#main-groups-view",populate_groups_list:o.get_groups_for_user,team_name:e.team_name}),i.default(document).on("db:groups_ready",(function(e){return c.switch_view(e.target.id)})),c._groups_loaded||i.default(document).one("db:all_groups_loaded",(function(e){if(c._groups_loaded=!0,null!=c._pending_view)return c._pending_view(),c._pending_view=void 0})),i.default(".groups-views").show(),t){var r=c.group_id_from_hash();return c.show_group_or_list(r),void i.default(".c-tabs__tab.c-tabs__tab--selected")}return c.groups_list.refresh()},c.show_group_or_list=function(e){return null!=e?"newgroup"===e?c.new_group_modal():c.show_single_group(e):(c.groups_list.refresh(),c.main_groups_view())},c.is_viewer_in_group=function(e){if(void 0===e.users)return!1;var t=Array.from(e.users).map((function(e){return e.user_id}));return 0!==Array.from(n.Viewer.get_viewer().get_user_ids(!1)).filter((function(e){return Array.from(t).includes(e)})).length},c._show_single_group=function(e){return null==e?(l.Notify.warning(_.intl.formatMessage({id:"7/JG7q",defaultMessage:"You’re not a member of this group, or it doesn’t exist."})),void c.main_groups_view()):(c.set_group_id_hash(e.id),!1===c.is_viewer_in_group(e)&&i.default("#leave-group-link").length>0?i.default("#leave-group-link").hide():i.default("#leave-group-link").show(),c._config.group_links_redirect_to_team_group_page?void 0:(c.update_group_header("single-group-header",e.name,e.localized_created_ts),c.display_spinner(),null==e.users?c.single_group_ctl.switch_to(e):c.single_group_ctl.show_group(e)))},c.show_single_group=function(e){var t=c.groups_list.groups[e];return null==t?o.get_group_info({group_id:e},c._show_single_group):c._show_single_group(t)},c.single_group_view=function(e){var t=i.default(e.currentTarget).data("group-id");return c.show_single_group(t)},c.set_error_message=function(e,t){c.clear_error_message(e);var r=i.default("<span/>",{class:"error-message"});return i.default("#"+e+" .text-input-error-wrapper").prepend(r.text(t))},c.clear_error_message=function(e){return i.default("#"+e+" .error-message").remove()},c.update_group_header=function(e,t,r){var o=i.default("#"+e),s=o.find(".group-name"),n=o.find(".group-creation-date"),a=o.find(".group-icon"),u=m.default.string_to_color(t);r||(r=_.intl.formatMessage({id:"pp9ILf",defaultMessage:"Just now"})),s.text(t),n.text(_.intl.formatMessage({id:"DHjasW",defaultMessage:"Created:"})+" "+r),a.text(m.default.get_initials(t)),a.css({"border-color":u,color:u})},c.switch_to_new_group_view=function(){return c.set_group_id_hash("newgroup")},c.new_group_modal=function(){return c.new_group_ctl.refresh()},c.main_groups_view=function(e){return c.set_group_id_hash(),c._groups_loaded?0===Object.keys(c.groups_list.groups).length?(c.hide_spinner(),i.default(".groups-view").hide(),i.default("#empty-groups-view").show().length):c.switch_view("main-groups-view"):(c.display_spinner(),c._pending_view=c.main_groups_view)},c.display_spinner=function(){return i.default(".groups-view").hide(),i.default(".groups-spinner").show()},c.hide_spinner=function(){return i.default(".groups-spinner").hide()},c.switch_view=function(e){return c.hide_spinner(),i.default(".groups-view").hide(),i.default("#"+e).show()},c.groups_shown=function(){var e,t;return!(i.default("#sharing-tabs").length>0)||"groups"===(null===(t=null===(e=window.location.hash)||void 0===e?void 0:e.split("#")[1])||void 0===t?void 0:t.split("/")[0])},c.group_id_from_hash=function(){var e,t=null!=window.location.hash?window.location.hash.split("#").pop():void 0;if(i.default("#sharing-tabs").length>0||0===t.search("groups/")){var r=null!=t?t.split("/"):void 0;e=null!=r?r[1]:void 0}else e=t;return null!=e&&""!==e&&"groups"!==e?e:void 0},c.set_group_id_hash=function(e){return c._config.group_links_redirect_to_admin_console_group_page&&e?a.redirect("/team/admin/groups#/"+e):c._config.group_links_redirect_to_team_group_page&&e?window.location="/groups/"+encodeURIComponent(e):c._config.group_links_redirect_to_team_group_page?void 0:window.location.hash="groups"+(e?"/"+e:"")},t.default=c})),define("modules/clean/groups/util",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sortBy=function(e,t){return e.sort((function(e,r){return(e=t(e))>(r=t(r))?1:e<r?-1:0}))}})),define("modules/clean/table_filter",["require","exports","tslib","jquery","modules/clean/deprecated/sick_input"],(function(e,t,r,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=r.__importDefault(i);var s=(function(){function e(e,t,r,s,n){this.refresh=this.refresh.bind(this),this.expand=this.expand.bind(this),this._keylisten=this._keylisten.bind(this),this._searching=this._searching.bind(this),this._exit=this._exit.bind(this),this._filter_rows=this._filter_rows.bind(this),this.row_class=r,this.show_partial_results=s,this.NUM_SHOWN_DEFAULT=200,this.NUM_EXPAND=100,this.no_results_container=i.default("#"+n),this.prev_needle=null,this.matched=i.default([]),this.num_shown=0,this.$search_container=i.default("#"+e+"-container"),i.default("#"+e+"-container .search-close").click(this._exit),this.$search=i.default("#"+e),this.$search_table=i.default("#"+t),o.SickInput.add_interval_handler(i.default(e+"-field"),this._filter_rows),this.$search.keyup(this._keylisten)}return e.prototype.refresh=function(){return this.prev_needle=null,this._filter_rows()},e.prototype.expand=function(){var e=this.num_shown;return this.num_shown=this.num_shown+this.NUM_EXPAND,this.matched.slice(e,this.num_shown).show()},e.prototype._keylisten=function(e){if(this.num_shown=this.NUM_EXPAND,27===e.keyCode)return this._searching()?this._exit():this.$search.blur()},e.prototype._searching=function(){return this.$search_container.hasClass("searching")},e.prototype._exit=function(){return this.$search.val("")},e.prototype._filter_rows=function(){var e=this.$search.val().toLowerCase();if(e!==this.prev_needle){if(this.prev_needle=e,e?(this.$search_container.addClass("searching"),this.matched=this.$search_table.find("."+this.row_class+'[data-search*="'+e+'"]')):(this.$search_container.removeClass("searching"),this.matched=this.$search_table.find("."+this.row_class)),this.$search_table.find("."+this.row_class).hide(),this.show_partial_results?(this.num_shown=this.NUM_SHOWN_DEFAULT,this.matched.slice(0,this.num_shown).show()):this.matched.show(),this.no_results_container&&0===this.matched.length)return this.no_results_container.show();if(this.no_results_container)return this.no_results_container.hide()}},e})();t.default=s})),define("modules/dirty/teams/admin_member_groups",["require","exports","tslib","jquery","modules/clean/groups/api","modules/dirty/groups/groups_list","modules/dirty/groups/ui"],(function(e,t,r,i,o,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=r.__importDefault(i),o=r.__importStar(o),s=r.__importDefault(s),n=r.__importDefault(n);var a=function(e,t,r,a){this.base=e,this.user_id=t,this.user_name=r,this.team_name=a,this.base=i.default(this.base),this.groups_list=new s.default({base:this.base,user_id:this.user_id,user_name:this.user_name,populate_groups_list:o.get_groups_for_user,group_name_links:!0,team_name:this.team_name}),this.groups_list.refresh(),n.default.groups_list=this.groups_list,n.default._config={group_links_redirect_to_admin_console_group_page:!0},i.default(".groups-list").on("click",".group-link",n.default.single_group_view)};t.default=a})),define("modules/dirty/teams/change_team_member_email_modal",["require","exports","tslib","jquery","legacy_js/dropbox","modules/clean/dbmodal","modules/core/i18n","modules/core/notify"],(function(e,t,r,i,o,s,n,a){"use strict";var u;Object.defineProperty(t,"__esModule",{value:!0}),i=r.__importDefault(i),u=(function(e){function t(t,r,i){var o=e.call(this,{element_id:"change-team-member-email"})||this;return o.on_show=o.on_show.bind(o),o.on_confirm_button_click=o.on_confirm_button_click.bind(o),o._listen=o._listen.bind(o),o._clear_fields=o._clear_fields.bind(o),o.member_name=t,o.link_selector=r,o.email_selector=i,o._listen(),o}return r.__extends(t,e),t.prototype.on_show=function(){return this._clear_fields()},t.prototype.on_confirm_button_click=function(e){var t=this;e.preventDefault();var r=this.$form.find(".confirm-button")[0],s=this.$form.find("input[name=email]").val();return o.Forms.ajax_submit(this.$form[0],!1,(function(e,r,o){var u=n.intl.formatMessage({id:"2krq2q",defaultMessage:"Changed {name}'s email address to {email}"},{email:s,name:t.member_name});return a.Notify.success(u),t.email_selector&&i.default(t.email_selector).text(s),t.hide()}),null,r)},t.prototype._listen=function(){var e=this;return i.default(this.link_selector).on("click",(function(t){return t.preventDefault(),e.show()}))},t.prototype._clear_fields=function(){return this.$form=this.$modal_window.find(".change-team-member-email-form"),this.$form.find("input[type=email], input[type=text]").val(""),this.$form.find(".error-removable").remove()},t})(s.DBModal),t.default=u}));
//# sourceMappingURL=pkg-legacy-aw.min.js-vfls6LjQu.map