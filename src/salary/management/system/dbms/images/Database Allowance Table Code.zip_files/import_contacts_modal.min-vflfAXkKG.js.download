define(["require","exports","tslib","react","modules/core/i18n","spectrum/button","spectrum/modal","spectrum/input","modules/clean/teams/admin/widgets/import_contacts_modal/contact_row","dig-components/typography","modules/clean/react/css","modules/clean/api_v2/user_client","modules/clean/viewer","dig-components/progress_indicators","modules/clean/profile_services/profile_services_constants","modules/clean/contacts/contact","modules/clean/analytics","react-intl","modules/clean/react/modal","react-window"],(function(e,t,a,n,l,o,s,c,r,i,m,u,d,f,_,g,p,h,v,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importStar(n),_=a.__importDefault(_);var E=l.intl.formatMessage({id:"LmN8eC",defaultMessage:"Search Google contacts"}),M=l.intl.formatMessage({id:"qx0cgi",defaultMessage:"Back"});t.selectAllText=l.intl.formatMessage({id:"I+vIeJ",defaultMessage:"Select all"}),t.deselectAllText=l.intl.formatMessage({id:"+t/Zhg",defaultMessage:"Deselect all"});var w=l.intl.formatMessage({id:"WElJu0",defaultMessage:"Search"}),b=h.defineMessage({id:"/c7TiD",defaultMessage:"{count, plural, one{# contact} other{# contacts}}"}),S=l.intl.formatMessage({id:"uB0ll+",defaultMessage:"Continue"}),N=l.intl.formatMessage({id:"yofFQe",defaultMessage:"Loading imported contacts…"}),C=l.intl.formatMessage({id:"uJxOXX",defaultMessage:"We couldn't find that person"}),x=l.intl.formatMessage({id:"1l7IZN",defaultMessage:"We couldn't find any organization contacts in your Google Directory"}),T=l.intl.formatMessage({id:"b+266D",defaultMessage:"Something went wrong, but we think it’s a fluke."}),A=l.intl.formatMessage({id:"7YQq8z",defaultMessage:"Try reloading the page."});t.ImportContactsModal=m.requireCssWithComponent((function(e){var m=n.useState(!0),h=m[0],L=m[1],k=n.useState(!1),I=k[0],W=k[1],D=n.useState(""),q=D[0],z=D[1],F=n.useState([]),O=F[0],B=F[1],G=n.useState([]),U=G[0],J=G[1],R=n.useState([]),j=R[0],P=R[1],Q=n.useState(new Map),V=Q[0],X=Q[1],Z=(function(e,t){var a=n.useState(e),l=a[0],o=a[1];return n.useEffect((function(){var a=setTimeout((function(){o(e)}),t);return function(){clearTimeout(a)}}),[e,t]),l})(q,300);n.useEffect((function(){de(),p.TeamsWebActionsLogger.log("google_directory_import_modal_shown")}),[]),n.useEffect((function(){I||me(Z)}),[Z,h,I]);var Y=a.__spreadArrays(O,U),H=Y.map((function(e){return e.email})),K=j.sort((function(e,t){return e.displayName.localeCompare(t.displayName)})),$=K.filter((function(e){return r.isInvitable(e)})),ee=$.filter((function(e){return e.isSelected})),te=e.preselectedContacts.map((function(e){return e.email})),ae=O.filter((function(e){return e.isSelected})),ne=ee.length===$.length,le=0===Y.length,oe=!le&&0===j.length,se=function(){var t=ae.map((function(e){return g.Contact.buildFromRawEmail(e.email)})),a=e.preselectedContacts.filter((function(e){return e.email&&!H.includes(e.email)}));e.onConfirmSelection(t,a)},ce=n.useMemo((function(){return n.default.createElement(o.Button,{className:"import-contacts-modal__confirm-select",variant:"primary",disabled:h||0===ae.length,onClick:se},n.default.createElement("span",{className:"modal-button-wrapper"},S))}),[ae,h]),re=function(t){e.onClose()},ie=n.useMemo((function(){return n.default.createElement(o.Button,{className:"import-contacts-modal__go-back",variant:"secondary",onClick:re},n.default.createElement("span",{className:"modal-button-wrapper"},M))}),[]),me=function(e){if(e){for(var t=e.toLocaleLowerCase(),a=[],n=0,l=Array.from(V.keys());n<l.length;n++){var o=l[n];o.includes(t)&&a.push(V.get(o))}P(a)}else P(Y)},ue=function(e){var t=e.isSelected?"google_directory_import_modal_deselect_contact":"google_directory_import_modal_select_contact";p.TeamsWebActionsLogger.log(t),B((function(t){var n=a.__spreadArrays(t);return n.includes(e)&&(e.isSelected=!e.isSelected),n}))},de=function(){return a.__awaiter(void 0,void 0,void 0,(function(){var e,t,n,l,o,s,c;return a.__generator(this,(function(a){switch(a.label){case 0:e=d.Viewer.get_viewer(),t=(new u.UserApiV2Client).ns("domain_contacts"),n={contacts:[]},a.label=1;case 1:return a.trys.push([1,3,,4]),[4,t.rpc("list",{service:_.default.to_api_service_type(_.default.GOOGLE)},{subjectUserId:e.work_user.id})];case 2:return n=a.sent(),[3,4];case 3:return a.sent(),W(!0),L(!1),p.TeamsWebActionsLogger.log("google_directory_import_modal_error_state"),[2];case 4:return l=n.contacts.filter((function(t){return t.email!==e.work_user.email})).map((function(e){return{email:e.email,displayName:e.display_name,teamStatus:e.team_status,isSelected:!1}})),o=l.filter((function(e){return r.isInvitable(e)})),s=l.filter((function(e){return!r.isInvitable(e)})),o.forEach((function(e){e.isSelected=-1!==te.indexOf(e.email)})),s.forEach((function(e){e.isSelected=!0})),c=new Map,l.forEach((function(e){var t=(e.displayName+" "+e.email).toLocaleLowerCase();c.set(t,e)})),B(o),J(s),X(c),p.TeamsWebActionsLogger.log("google_directory_import_modal_contacts_loaded",{num_invitable_contacts:o.length,num_uninvitable_contacts:s.length}),L(!1),[2]}}))}))},fe={tagName:"p",color:"faint",size:"small"};return n.default.createElement(s.UtilityModal,{title:E,open:!0,ariaLabel:E,primaryAction:function(){return ce},secondaryAction:function(){return ie},className:"import-contacts-modal",width:e.width+"px",onRequestClose:v.Modal.close},n.default.createElement(n.default.Fragment,null,n.default.createElement(c.Input,{className:"import-contacts-modal__search",placeholder:w,value:q,"aria-label":w,fullWidth:!0,onChange:function(e){return z(e.target.value)}}),h?n.default.createElement("div",{className:"import-contacts-modal__container"},n.default.createElement(f.Spinner,{"aria-valuetext":N})):I?n.default.createElement("div",{className:"import-contacts-modal__container"},n.default.createElement(i.Text,a.__assign({},fe,{className:"import-contacts-modal__small-text"}),T),n.default.createElement(i.Text,a.__assign({},fe,{className:"import-contacts-modal__small-text"}),A)):le?n.default.createElement("div",{className:"import-contacts-modal__container"},n.default.createElement(i.Text,a.__assign({},fe),x)):oe?n.default.createElement("div",{className:"import-contacts-modal__container"},n.default.createElement(i.Text,a.__assign({},fe,{className:"import-contacts-modal__small-text"}),C)):n.default.createElement(n.default.Fragment,null,n.default.createElement("div",{className:"import-contacts-modal__select-controls"},n.default.createElement("div",{className:"import-contacts-modal__num-selected"},l.intl.formatMessage(b,{count:ae.length})),$.length>0&&n.default.createElement(i.Link,{href:"",onClick:function(e){e.preventDefault(),e.stopPropagation();var t=ne?ee.length:$.length-ee.length,n=ne?"google_directory_import_modal_deselect_all":"google_directory_import_modal_select_all";p.TeamsWebActionsLogger.log(n,{num_contacts_toggled:t,total_invitable_contacts:O.length,search_term_present:""!==q}),P((function(e){return(function(e,t){var n=a.__spreadArrays(e);return n.forEach((function(e){r.isInvitable(e)&&(e.isSelected=!t)})),n})(e,ne)}))},hasNoUnderline:!0,className:"import-contacts-modal__"+(ne?"deselect-all":"select-all")},ne?t.deselectAllText:t.selectAllText)),n.default.createElement("hr",{className:"import-contacts-modal__divider"}),n.default.createElement("div",{className:"import-contacts-modal__contacts"},n.default.createElement(y.FixedSizeList,{height:215,width:e.width-48,itemCount:j.length,itemSize:48},(function(e){return n.default.createElement("div",{style:e.style},n.default.createElement(r.ContactRow,{key:K[e.index].email,contact:K[e.index],onCheck:ue}))}))))))}),["/static/css/teams/admin/widgets/import_contacts_modal/import_contacts_modal-vflVlYLQo.css"])}));
//# sourceMappingURL=import_contacts_modal.min.js-vfl-qxfm1.map