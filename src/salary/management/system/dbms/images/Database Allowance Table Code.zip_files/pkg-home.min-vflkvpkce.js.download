define("modules/clean/react/home/actions_post_tti",["require","exports","tslib","modules/clean/flux/dispatcher","modules/clean/react/home/constants","modules/core/notify","modules/clean/react/home/api_post_tti","modules/core/i18n"],(function(e,t,n,i,o,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setSectionVisibilityPostTTI=function(e,i,o){t.setSectionVisibilityHelper(e,i,o,(function(){return n.__awaiter(void 0,void 0,void 0,(function(){return n.__generator(this,(function(e){return[2,a.setSectionVisibility]}))}))}))},t.setSectionVisibilityHelper=function(e,t,a,c){return n.__awaiter(void 0,void 0,void 0,(function(){var l,d,u;return n.__generator(this,(function(n){switch(n.label){case 0:l=t[".tag"],i.Dispatcher.dispatch({type:o.HomeActionTypes.SET_SECTION_VISIBILITY,payload:{section:l,visible:a}}),n.label=1;case 1:return n.trys.push([1,4,,5]),[4,c()];case 2:return[4,n.sent()(e,t,a)];case 3:return n.sent(),[3,5];case 4:throw d=n.sent(),u=a?s.intl.formatMessage({id:"D9XHqB",defaultMessage:"Unable to show section."}):s.intl.formatMessage({id:"W8LAoH",defaultMessage:"Unable to hide section."}),r.Notify.error(u),i.Dispatcher.dispatch({type:o.HomeActionTypes.SET_SECTION_VISIBILITY,payload:{section:l,visible:!a}}),d;case 5:return[2]}}))}))}})),define("modules/clean/react/home/actions",["require","exports","tslib","modules/constants/env","modules/core/uri","modules/core/i18n","modules/core/notify","modules/clean/react/home/post_tti/api","modules/clean/react/home/actions_post_tti","modules/clean/viewer"],(function(e,t,n,i,o,r,a,s,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(){function e(){}return e.setSectionVisibility=function(e,t,i){return n.__awaiter(this,void 0,void 0,(function(){var o,r=this;return n.__generator(this,(function(a){return o=function(){return n.__awaiter(r,void 0,void 0,(function(){return n.__generator(this,(function(e){switch(e.label){case 0:return[4,s.waitForHomeTTI()];case 1:return[2,e.sent().setSectionVisibility]}}))}))},c.setSectionVisibilityHelper(e,t,i,o),[2]}))}))},e.createPaperDocInNewTab=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t,c,d,u,m,_,h;return n.__generator(this,(function(n){switch(n.label){case 0:t=r.intl.formatMessage({id:"PhUVTN",defaultMessage:"Could not create paper document."}),c=window.open("about:blank"),n.label=1;case 1:return n.trys.push([1,4,,5]),[4,s.waitForHomeTTI()];case 2:return[4,(0,n.sent().createPaperDoc)(e)];case 3:return d=n.sent(),u=l.Viewer.get_viewer(),m=u.get_user_by_id(e),_=u.is_paired?{role:m.role}:{},c&&!c.closed?(h=new o.URI({scheme:"https",authority:i.NOTES_WEBSERVER,path:"/doc/"+d.doc_id,query:_}).toString(),c.location.replace(h)):a.Notify.error(t),[3,5];case 4:return n.sent(),a.Notify.error(t),c&&!c.closed?[2,c.close()]:[3,5];case 5:return[2]}}))}))},e})();t.HomeActions=d})),define("modules/clean/react/home/api_post_tti",["require","exports","modules/clean/api_v2/user_client"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setSectionVisibility=function(e,t,i){return(new n.UserApiV2Client).ns("home").rpc("set_section_visibility",{section:t,visible:i},{subjectUserId:e})},t.createPaperDoc=function(e){return(new n.UserApiV2Client).ns("paper").upload("docs/create",{import_format:{".tag":"plain_text"}},"",{subjectUserId:e})}})),define("modules/clean/react/home/api",["require","exports","tslib","modules/clean/ajax","external/lodash","modules/core/exception","modules/clean/web_timing_logger"],(function(e,t,n,i,o,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);t.now=function(){return Date.now()};var s=0,c=0,l=t.now();function d(e){return n.__awaiter(this,void 0,void 0,(function(){var i,o;return n.__generator(this,(function(n){switch(n.label){case 0:return i=l,l=t.now(),e||l-i<40?(c++,o=10+~~(90*Math.random()),[4,new Promise((function(e){return setTimeout(e,o)}))]):[3,2];case 1:return n.sent(),c--,[2,o];case 2:return[2,0]}}))}))}t.makeRequest=function(e,o){var a=this,l=void 0===o?{}:o,u=l.delayRequest,m=l.isBackground;l.shouldAssertResponse;s++;var _=new Promise((function(o,l){return n.__awaiter(a,void 0,void 0,(function(){var a,_;return n.__generator(this,(function(h){switch(h.label){case 0:return[4,d(!!u)];case 1:return a=h.sent(),_=t.now(),(m?i.SilentBackgroundRequest:i.WebRequest)(n.__assign({dataType:"json",success:o,error:function(n,i,o){if("abort"!==i){var d=e&&e.url||"no url",h=o?": '"+o+"'":"",p="makeRequest to '"+d+"' failed - "+i+h;r.reportStack(p,{severity:r.SEVERITY.NONCRITICAL,exc_extra:{errorThrown:o,textStatus:i,requestParams:e,delayRequest:u,isBackground:m,requestDelay:a,openRequests:s,delayedRequests:c,requestDuration:t.now()-_,status:n.status,"exclog.exc_group":"homeapi:"+i+":"+o+":"+d}}),l(Error(o+" ("+d+")"))}}},e)),[2]}}))}))}));return _.finally((function(){return s--})),_};var u={},m=o.throttle((function(){o.size(u)>1&&r.reportStack("Multiple role activities",{severity:r.SEVERITY.NONCRITICAL,exc_extra:u}),Object.keys(u).forEach((function(e){var n=u[e];t.makeRequest({url:"/home_feed/log_activities",type:"POST",data:{role:e,activities_json:JSON.stringify(o.map(n,"json")),send_ts:t.now(),page_start_ts:window.performance&&window.performance.timing?window.performance.timing.navigationStart||window.performance.timing.fetchStart:void 0}},{isBackground:!0,delayRequest:!0,shouldAssertResponse:!0}).then((function(){return n.forEach((function(e){return e.resolve()}))}),(function(){return n.forEach((function(e){return e.reject()}))}))})),u={}}),1e3,{leading:!0,trailing:!0});t.logHomeActivity=function(e){var i=this,r=e.role,s=e.eventName,c=e.extra;return new Promise((function(e,l){return n.__awaiter(i,void 0,void 0,(function(){return n.__generator(this,(function(n){switch(n.label){case 0:return u[r]=u[r]||[],u[r].push({json:{event_name:s,event_time:t.now(),extra:o.mapValues(c||{},(function(e){return String(e)}))},resolve:e,reject:l}),[4,a.waitForTTI()];case 1:return n.sent(),m(),[2]}}))}))}))}})),define("modules/clean/react/home/constants",["require","exports"],(function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.DO_NOT_LOAD=1]="DO_NOT_LOAD",e[e.IMMEDIATE=2]="IMMEDIATE",e[e.POST_TTI=3]="POST_TTI"})(t.ConditionalSectionLoadingPreference||(t.ConditionalSectionLoadingPreference={})),(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SYNCHRONOUS=1]="SYNCHRONOUS",e[e.ASYNCHRONOUS_PRE_TTI=2]="ASYNCHRONOUS_PRE_TTI",e[e.POST_TTI=3]="POST_TTI"})(t.ConditionalSectionLoadingMode||(t.ConditionalSectionLoadingMode={})),t.HomeActionTypes={INITIALIZE_STORE:"HOME_INITIALIZE_STORE",SET_PRE_TTI_PROPS:"HOME_SET_PRE_TTI_PROPS",SET_SECTION_VISIBILITY:"HOME_SET_SECTION_VISIBILITY",LOADED_ASYNC_CONDITIONAL_SECTION:"HOME_STORE_LOADED_ASYNC_CONDITIONAL_SECTION",DECLARE_CONDITIONAL_SECTION:"HOME_STORE_DECLARE_CONDITIONAL_SECTION",HOME_PREFETCH_RECEIVED_DATA:"HOME_PREFETCH_RECEIVED_DATA",SET_TAB_ID:"HOME_SET_TAB_ID",OPEN_FILE_VIEWER:"HOME_OPEN_FILE_VIEWER",CLOSE_FILE_VIEWER:"HOME_CLOSE_FILE_VIEWER"},(function(e){e.STARRED="Starred",e.TASKS="To-do"})(t.HomeTabId||(t.HomeTabId={})),t.HomeResourceStoreActionTypes={RECEIVED_RESOURCE_ID_TO_FILE:"HOME_RESOURCE_STORE_RECEIVED_RESOURCE_ID_TO_FILE",REQUEST_PREVIEW:"HOME_RESOURCE_STORE_REQUEST_PREVIEW"},t.HomeSections={STARRED:"starred",RECENTS:"recents",SUGGEST:"suggest",TEAMS:"teams",PROMPT:"prompt",RECOMMENDED_MEMBERS:"recommended_members"},t.DEFAULT_PRE_TTI_PROPS={isPaperEnabledForUser:!1,activeVariants:{},expHomeRecentsPage:"OFF",useMaestroPortal:"ON"},t.ExpHomeStarredPageOnVariants=["ON_WITH_STARRED","ON_WITHOUT_HOME"],t.ExpHomeRecentsPageOnVariants=["ON","ON_DEFAULT_TO_BROWSE"].concat(t.ExpHomeStarredPageOnVariants),t.ConditionalSections={PAPER_RECENTS:"paper_recents"},t.LoggingTypes={CLICK_SHOW_ALL:"click_show_all",HOME_PAGE_SHOWN:"home_page_shown",STARRED_SHOWN:"starred_shown",RECENTS_SHOWN:"recents_shown",HIDE_SECTION:"hide_section",UNHIDE_SECTION:"unhide_section",RECENTS_ITEM_ACTION:"recents_item_action",OPEN_FILTERS_MENU:"open_filters_menu",CLOSE_FILTERS_MENU:"close_filters_menu",RESET_FILTERS_MENU:"reset_filters_menu",SELECT_FILTERS_MENU_ITEM:"select_filters_menu_item",DESELECT_FILTERS_MENU_ITEM:"deselect_filters_menu_item",OPEN_STARRED_ITEM:"open_starred_item",UNDO_UNSTAR_ITEM:"undo_unstar_item",CLICK_STAR_OVERFLOW_MENU:"click_star_overflow_menu",CLICK_STAR_OVERFLOW_SHARE:"click_star_overflow_share",SELECT_TASKS_TAB:"select_tasks_tab",SELECT_TASKS_FILTER:"select_tasks_filter",OPEN_DOC_FROM_TASK:"open_doc_from_tasks",CLICK_DOC_TASKS_OVERFLOW_MENU:"click_doc_tasks_overflow_menu",CLICK_DOC_TASKS_OVERFLOW_SHARE:"click_doc_tasks_overflow_share",CLICK_CREATE_NEW_FILE:"create_new_file",CLICK_UPLOAD_FILES:"upload_files",CLICK_UPLOAD_FOLDER:"upload_folder",CLICK_CREATE_PAPER_DOC:"create_paper_doc",CLICK_NEW_SHARED_FOLDER:"new_shared_folder",CLICK_NEW_FOLDER:"create_folder"},t.HomePrefetchTypes={RETRIEVE_STARRED:"retrieve_starred",RECENTS_JSON:"recents_json",RETRIEVE_PAPER_RECENTS:"retrieve_paper_recents",GET_SUGGESTED:"get_suggested"},t.LoadingStates={LOADING:"LOADING",SUCCESS:"SUCCESS",FAILURE:"FAILURE"},t.FILE_RESOURCE_TYPE="FILE",t.FOLDER_RESOURCE_TYPE="FOLDER",t.PAPER_DOCUMENT_RESOURCE_TYPE="PAPER_DOCUMENT",t.PAPER_FOLDER_RESOURCE_TYPE="PAPER_FOLDER",t.EXTERNAL_RESOURCE_TYPE="EXTERNAL",t.DisplayTypeToResourceType={DOC:t.FILE_RESOURCE_TYPE,MSDOC:t.FILE_RESOURCE_TYPE,PDF:t.FILE_RESOURCE_TYPE,SPREADSHEET:t.FILE_RESOURCE_TYPE,FILE:t.FILE_RESOURCE_TYPE,FOLDER:t.FOLDER_RESOURCE_TYPE,SHARED_FOLDER:t.FOLDER_RESOURCE_TYPE,TEAM_FOLDER:t.FOLDER_RESOURCE_TYPE,SHARED_FOLDER_READ_ONLY:t.FOLDER_RESOURCE_TYPE,CDM_TEAM_MEMBER_FOLDER:t.FOLDER_RESOURCE_TYPE,TEAM_READ_ONLY:t.FOLDER_RESOURCE_TYPE,PAPER_DOCUMENT:t.PAPER_DOCUMENT_RESOURCE_TYPE,PAPER_FOLDER:t.PAPER_FOLDER_RESOURCE_TYPE,PAPER_PUBLIC_FOLDER:t.PAPER_FOLDER_RESOURCE_TYPE,PAPER_PROJECT:t.PAPER_FOLDER_RESOURCE_TYPE,EXTERNAL:t.EXTERNAL_RESOURCE_TYPE},(function(e){e.AGGREGATION="AGGREGATION",e.DOC="DOC",e.MSDOC="DOC",e.MSDOC_DEPRECATED="MSDOC",e.PDF="PDF",e.SPREADSHEET="SPREADSHEET",e.FILE="FILE",e.FOLDER="FOLDER",e.SHARED_FOLDER="SHARED_FOLDER",e.TEAM_FOLDER="TEAM_FOLDER",e.PAPER_DOCUMENT="PAPER_DOCUMENT",e.PAPER_FOLDER="PAPER_FOLDER",e.PAPER_PUBLIC_FOLDER="PAPER_PUBLIC_FOLDER",e.PAPER_PROJECT="PAPER_PROJECT",e.EXTERNAL="EXTERNAL",e.CDM_TEAM_MEMBER_FOLDER="CDM_TEAM_MEMBER_FOLDER",e.TEAM_READ_ONLY="TEAM_READ_ONLY",e.SHARED_FOLDER_READ_ONLY="SHARED_FOLDER_READ_ONLY",e.RESTRICTED_FOLDER="RESTRICTED_FOLDER",e.CAMERA_UPLOADS="CAMERA_UPLOADS"})(n=t.DisplayTypes||(t.DisplayTypes={})),t.PreviewableDisplayTypes=[n.DOC,n.MSDOC_DEPRECATED,n.PDF,n.SPREADSHEET,n.FILE],t.DisplayTypeToIconName={AGGREGATION:"image-small",FOLDER:"folder-small",SHARED_FOLDER:"folder_shared-small",TEAM_FOLDER:"folder_team-small",CDM_TEAM_MEMBER_FOLDER:"folder_team_member-small",PAPER_DOCUMENT:"paper-small",PAPER_FOLDER:"folder-small",PAPER_PUBLIC_FOLDER:"folder_team-small",PAPER_PROJECT:"folder_project-small",TEAM_READ_ONLY:"folder_team_read_only-small",SHARED_FOLDER_READ_ONLY:"folder_shared_read_only-small",RESTRICTED_FOLDER:"folder_confidential-small",CAMERA_UPLOADS:"folder_camera_upload-small"},(function(e){e.FILE="file",e.PAPER_DOCUMENT="paper_document"})(t.SuggestItemTypes||(t.SuggestItemTypes={})),t.SUGGEST_GRID_FEATURE="home_suggest_grid",t.SUGGEST_GRID_MAX_TILE_WIDTH=200,t.SUGGEST_GRID_V2_MAX_TILE_WIDTH=180,t.SUGGEST_GRID_V2_MIN_TILE_WIDTH=134,t.SUGGEST_GRID_V2_TILE_PADDING=8})),define("modules/clean/react/home/content_suggestions/grid_layout",["require","exports","modules/clean/react/home/constants"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLayout=function(e){var t={minTileWidth:n.SUGGEST_GRID_V2_MIN_TILE_WIDTH,maxColWidth:n.SUGGEST_GRID_V2_MAX_TILE_WIDTH,tilePadding:n.SUGGEST_GRID_V2_TILE_PADDING},i=t.minTileWidth,o=t.maxColWidth,r=t.tilePadding,a=e-2*r-2;if(a<2*n.SUGGEST_GRID_MAX_TILE_WIDTH)return{itemsToShow:2,tileWidth:(a-r)/2};var s=Math.max(1,Math.floor(a/o)),c=n.SUGGEST_GRID_MAX_TILE_WIDTH;if(a%o>1){var l=a/(s+1)-r;l>=i&&(s++,c=l)}return{itemsToShow:s,tileWidth:c}}})),define("modules/clean/react/home/content_suggestions/home_suggest_frame",["require","exports","tslib","classnames","react","dig-components/icons","dig-components/icons/src","dig-components/tooltips","modules/clean/react/home/section_header","modules/core/i18n"],(function(e,t,n,i,o,r,a,s,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importDefault(o),t.SuggestHeader=function(e){var t=e.isHiddenByUser,n=e.buttonAction;return o.default.createElement(c.SectionHeader,{title:l.intl.formatMessage({id:"B7S1VF",defaultMessage:"Suggested from your activity"}),ueName:"suggest",isHidden:t,onToggleHidden:n,infoIcon:o.default.createElement(s.Tooltip,{placement:"right",title:l.intl.formatMessage({id:"Sx3SWG",defaultMessage:"Quick access to files you’ve been working on."})},o.default.createElement("div",null,o.default.createElement(r.UIIcon,{src:a.InfoLine})))})},t.SuggestFrame=function(e){var t=e.isHiddenByUser,n=e.children;return o.default.createElement("section",{className:i.default({"home-access-section":!0,"home-access-section-suggest-nonempty":!t})},n)}})),define("modules/clean/react/home/content_suggestions/loading",["require","exports","tslib","classnames","react","modules/clean/react/home/content_suggestions/grid_layout","modules/clean/react/home/content_suggestions/home_suggest_frame"],(function(e,t,n,i,o,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i);var s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.isHiddenByUser;return o.default.createElement(a.SuggestFrame,{isHiddenByUser:e},o.default.createElement(a.SuggestHeader,{isHiddenByUser:e}),o.default.createElement(c,n.__assign({},this.props)))},t})((o=n.__importDefault(o)).default.PureComponent);t.SuggestedLoading=s;var c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.renderLoadingTile=function(e,t){return o.default.createElement("div",{key:t,className:i.default(["tile","home-suggest-preview-tile"])},o.default.createElement("div",{className:"tile__loading-container",style:{width:e+"px"}},o.default.createElement("div",{className:"tile__loading-thumbnail",style:{width:e+"px"}})),o.default.createElement("div",{className:"loading-tile-label"},o.default.createElement("div",{className:"loading-tile-label__detail-text"}),o.default.createElement("div",{className:"loading-tile-label__detail-subheader"})))},t.prototype.render=function(){for(var e=this.props,t=e.containerWidth,n=e.isHiddenByUser,a=r.getLayout(t),s=a.itemsToShow,c=a.tileWidth,l=[],d=0;d<s;d++)l.push(this.renderLoadingTile(c,d));return n?null:o.default.createElement("div",{className:i.default({"home-access-section__content":!0,"home__suggest-items":!0})},o.default.createElement("div",{className:"home-tile__container"},l))},t})(o.default.PureComponent);t.SuggestedLoadingInner=c})),define("modules/clean/react/home/modals/async_home_modals",["require","exports","tslib"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.asyncShowNewFolderModal=function(t){var i=t.user,o=t.origin,r=t.initialPath,a=t.onShowModal,s=t.onErrorShowingModal,c=t.redirectOnClose;return n.__awaiter(void 0,void 0,void 0,(function(){return n.__generator(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,new Promise((function(t,n){e(["modules/clean/react/home/modals/new_folder_modal"],t,n)})).then(n.__importStar)];case 1:return(0,t.sent().showNewFolderModal)({user:i,onShowModal:a,initialPath:r,origin:o,redirectOnClose:c}),[3,3];case 2:return t.sent(),s&&s(),[3,3];case 3:return[2]}}))}))}})),define("modules/clean/react/home/post_tti/api",["require","exports","tslib","react","modules/clean/web_timing_logger","modules/clean/react/async/loadable"],(function(e,t,n,i,o,r){"use strict";function a(){return n.__awaiter(this,void 0,Promise,(function(){return n.__generator(this,(function(t){switch(t.label){case 0:return[4,o.waitForTTI()];case 1:return t.sent(),[4,new Promise((function(t,n){e(["modules/clean/react/home/post_tti/interface"],t,n)})).then(n.__importStar)];case 2:return[2,t.sent()]}}))}))}function s(){return n.__awaiter(this,void 0,void 0,(function(){var e,t;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,a()];case 1:return e=n.sent(),t={imports:e},[4,e.getPostTTIProps()];case 2:return[2,(t.props=n.sent(),t)]}}))}))}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.waitForHomeTTI=a,t.PostHomeTTIComponent=function(e){var t=this,i=e.getPostTTIRenderer,o=e.preTTIRenderer,s=e.displayName;return r.Loadable({displayName:"PostHomeTTIComponent("+s+")",loader:function(){return n.__awaiter(t,void 0,void 0,(function(){var e;return n.__generator(this,(function(t){switch(t.label){case 0:return e=i,[4,a()];case 1:return[2,e.apply(void 0,[t.sent()])]}}))}))},loading:o})},t.waitForHomeTTIWithProps=s;var c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return null},t})(i.default.PureComponent);t.PostHomeTTIComponentWithProps=function(e){var t=this,o=e.getPostTTIRenderer,a=e.preTTIRenderer,l=e.displayName;return r.Loadable({displayName:"PostHomeTTIComponentWithProps("+l+")",loader:function(){return n.__awaiter(t,void 0,void 0,(function(){var e;return n.__generator(this,(function(t){switch(t.label){case 0:return[4,s()];case 1:return e=t.sent(),[4,o(e)];case 2:return[2,t.sent()||function(){return i.default.createElement(c,null)}]}}))}))},loading:a})}})),define("modules/clean/react/home/recents/actions/error_actions",["require","exports","tslib","external/lodash","modules/clean/react/home/recents/recent_activity_constants","modules/clean/react/home/recents/recent_activity_dispatcher","modules/core/exception","modules/core/i18n","modules/core/notify"],(function(e,t,n,i,o,r,a,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),a=n.__importStar(a);var l=(function(){function e(e){var t=this;this._flushQueues=function(){t._rafId=null;var e=t._recentActivityQueue;t._recentActivityQueue=[],e.length&&t._dispatcher.dispatch({type:o.RAW_RECENT_ACTIVITY_PARSE_ERROR,errors:e});var n=t._relatedActivityQueue;t._relatedActivityQueue=[],n.length&&t._dispatcher.dispatch({type:o.RAW_RELATED_ACTIVITY_PARSE_ERROR,errors:n})},this._notify=i.throttle((function(){var e=s.intl.formatMessage({id:"QANSaH",defaultMessage:"Sorry, we were unable to show some recent items. The team has been notified"});c.Notify.error(e)}),500,{trailing:!1}),this._dispatcher=e,this._recentActivityQueue=[],this._relatedActivityQueue=[],this._rafId=null}return e.prototype.recentActivityParseError=function(e,t){a.reportException({err:t}),this._notify(),this._enqueueError(this._recentActivityQueue,e,t)},e.prototype.relatedActivityParseError=function(e,t){a.reportException({err:t}),this._notify(),this._enqueueError(this._relatedActivityQueue,e,t)},e.prototype._enqueueError=function(e,t,n){e.push({activityKey:t,error:n}),this._rafId||(this._rafId=window.requestAnimationFrame(this._flushQueues))},e})();t.ErrorActions=l,t.errorActions=new l(r.recentActivityDispatcher)})),define("modules/clean/react/home/recents/actions/federated_recent_activity_actions",["require","exports","tslib","modules/core/i18n","modules/core/browser","modules/clean/react/modal","modules/clean/react/home/recents/recent_activity_constants","modules/clean/react/home/recents/recent_activity_dispatcher","modules/clean/react/home/recents/recent_activity_federated_model","modules/clean/react/home/recents/stores/recent_activity_store","modules/core/exception","modules/core/notify","modules/clean/react/home/recents/utils/events","modules/clean/react/home/post_tti/api"],(function(e,t,n,i,o,r,a,s,c,l,d,u,m,_){"use strict";function h(e,t,n){e?o.open_tab(e):d.reportStack("Cannot open tab to preform the action "+t,{severity:d.SEVERITY.NONCRITICAL,exc_extra:{paperRecentItem:n.paperRecentItem}})}function p(e,t,n){m.logFederatedItemEvent(e,n.cellView,t)}function E(e,t){s.recentActivityDispatcher.dispatch({type:e,activityKey:t})}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),t.shareItem=function(e,t){p(a.ActionType.PAPER_SHARE,e,t),h(c.getPaperShareUrl(e),a.ActionType.PAPER_SHARE,e)},t.previewItem=function(e,t){p(a.ActionType.PAPER_OPEN,e,t),h(e.getUrl(),a.ActionType.PAPER_OPEN,e)},t.promptAndArchiveItem=function(e,t,o){var s=this,d=e.getActivityKey();if(l.getRecentActivityStore().canArchiveActivityKey(d)){var m=e.getActivityKey();r.SimpleModal.show({title_text:i.intl.formatMessage({id:"bArtK/",defaultMessage:"Archive document?"}),body_html:i.intl.formatMessage({id:"S6cb1J",defaultMessage:"Do you want to archive this document?"}),confirm_text:i.intl.formatMessage({id:"JiHG/V",defaultMessage:"Archive"}),cancel_text:i.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}),autoclose:!0,confirm_callback:function(){return n.__awaiter(s,void 0,void 0,(function(){return n.__generator(this,(function(n){switch(n.label){case 0:p(a.ActionType.PAPER_ARCHIVE,e,o),E(a.ARCHIVE_PAPER_DOCUMENT_PENDING,m),n.label=1;case 1:return n.trys.push([1,4,,5]),[4,_.waitForHomeTTI()];case 2:return[4,n.sent().archivePaperResources(t,[e.paperRecentItem])];case 3:return n.sent().some((function(t){return c.equalsPaperRecentItem(e,t)}))?(E(a.ARCHIVE_PAPER_DOCUMENT_COMMIT,m),u.Notify.success(i.intl.formatMessage({id:"r3vKLt",defaultMessage:"The document was archived."}))):E(a.ARCHIVE_PAPER_DOCUMENT_ROLLBACK,m),[3,5];case 4:return n.sent(),E(a.ARCHIVE_PAPER_DOCUMENT_ROLLBACK,m),[3,5];case 5:return[2]}}))}))}})}}})),define("modules/clean/react/home/recents/actions/recent_activity_action_permissions",["require","exports","external/lodash","modules/clean/react/home/recents/models/utils","modules/clean/pnm/utils"],(function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRecentActivityItemViewPermissions=function(e,t){if(e.federatedRecentItem)return{archive:e.federatedRecentItem.isArchiveable(),comment:!1,delete:!1,download:!1,open:!1,share:e.federatedRecentItem.isShareable(),versions:!1,viewInFolder:!1};var r=t[0],a=1===t.length;if(i.isMountedRecentItem(e)){var s=a&&!r.isDir,c=a&&!r.isCloudDoc,l=a&&r.isVersionable,d=e.paths.length?n.last(e.paths):null,u={archive:!1,comment:s&&c,delete:t.every((function(e){return!e.isReadOnly})),download:a&&c,open:!(!a||!r.canOpen),share:a,versions:s&&l,viewInFolder:!(!d||!d.url)},m=e.perNodeMetadata;return m&&(o.hasValidLinkNode(m)&&(u.archive=!1,u.comment=!1,u.delete=!1,u.download=!1,u.open=!1,u.share=!1,u.versions=!1,u.viewInFolder=!1),m.suppress_delete&&(u.delete=!1),(m.suppress_ns_partition||m.suppress_shared_link)&&(u.share=!1)),u}return{archive:!1,comment:!1,delete:!1,download:!1,open:!!e.scl,share:!1,versions:!1,viewInFolder:!1}},t.shouldRenderActionsMenu=function(e){for(var t in e)if("share"!==t&&e[t])return!0;return!1}})),define("modules/clean/react/home/recents/actions/recent_activity_actions",["require","exports","tslib","external/lodash","modules/clean/navigation","modules/clean/pnm/utils","modules/clean/react/home/post_tti/api","modules/clean/react/home/recents/actions/federated_recent_activity_actions","modules/clean/react/home/recents/recent_activity_constants","modules/clean/react/home/recents/recent_activity_dispatcher","modules/clean/react/home/recents/stores/recent_activity_store","modules/clean/react/plusplus/logging","modules/core/exception"],(function(e,t,n,i,o,r,a,s,c,l,d,u,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),t.shareRecentItem=function(e,t,i,o){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(n){switch(n.label){case 0:return e.federatedRecentItem?(s.shareItem(e.federatedRecentItem,i),[3,4]):[3,1];case 1:return[4,a.waitForHomeTTI()];case 2:return[4,n.sent().shareFile(t[0].id,i,o)];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))},t.previewRecentItem=function(e,t,i,o){var c=this;if(r.isSupportedLinkNodeClickAction(e.perNodeMetadata))a.waitForHomeTTI().then((function(t){var i=t.handleLinkNodeAction;return n.__awaiter(c,void 0,void 0,(function(){return n.__generator(this,(function(t){return i(e.perNodeMetadata,(function(t){u.logProductAnalytics(e.viewingUserId,"web","select",t,"recents")})),[2]}))}))}));else if(e.federatedRecentItem)s.previewItem(e.federatedRecentItem,i);else if(1===e.attachmentIds.length)a.waitForHomeTTI().then((function(n){return(0,n.previewFileSyncRecentItem)(e,!!o,t,i)}));else{var l=t.index,d=t.shouldUseEntityUri;m.reportStack("To preview, file sync items must have 1 attachment id",{severity:m.SEVERITY.NONCRITICAL,exc_extra:{recentItem:e,index:l,shouldUseEntityUri:d}})}},t.deleteRecentItem=function(e,t,i){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(o){return a.waitForHomeTTIWithProps().then((function(o){var s=o.imports,c=o.props;s.deleteRecentItem(e,t,i,c),(function(e){var t=this;if(!r.isPreSetupLinkNode(e.perNodeMetadata))return;a.waitForHomeTTI().then((function(i){var o=i.getLinkNodeEventObject;return n.__awaiter(t,void 0,void 0,(function(){var t;return n.__generator(this,(function(n){return(t=o(e.perNodeMetadata))?(u.logProductAnalytics(e.viewingUserId,"web","delete",t,"recents"),[2]):[2]}))}))}))})(e)})),[2]}))}))},t.archiveRecentItem=function(e,t){e.federatedRecentItem?s.promptAndArchiveItem(e.federatedRecentItem,e.viewingUserId,t):m.reportStack("Archiving is not supported",{severity:m.SEVERITY.NONCRITICAL,exc_extra:{recentItem:e}})},t.loadNextPage=function(){var e=d.getRecentActivityStore().getFileSyncCursor();return e&&a.waitForHomeTTI().then((function(t){return(0,t.loadRecentItems)(e)})),!!e},t.hasCursor=function(){return!!d.getRecentActivityStore().getFileSyncCursor()},t.openFile=function(e,t,o){return void 0===o&&(o=i.noop),n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(n){switch(n.label){case 0:return[4,a.waitForHomeTTI()];case 1:return[4,n.sent().openFile(e,t)];case 2:return n.sent(),o(),[2]}}))}))},t.downloadFiles=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(n){switch(n.label){case 0:return[4,a.waitForHomeTTI()];case 1:return n.sent().downloadFiles(e,t),[2]}}))}))},t.openVersions=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(n){switch(n.label){case 0:return[4,a.waitForHomeTTI()];case 1:return n.sent().openVersions(o.NavigationMethod.REDIRECT,e,t),[2]}}))}))},t.refreshRecentItems=function(){return n.__awaiter(this,void 0,void 0,(function(){var e,t,i;return n.__generator(this,(function(n){switch(n.label){case 0:return d.getRecentActivityStore().didReceiveItemsFromAllStreams()?(l.recentActivityDispatcher.dispatch({type:c.REFRESH_RECENT_ACTIVITIES}),[4,a.waitForHomeTTI()]):[3,3];case 1:return e=n.sent(),t=e.loadRecentItems,i=e.loadPaperRecentItems,[4,Promise.all([t(),i(!1)])];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))}})),define("modules/clean/react/home/recents/components/pending_attachment_list_view",["require","exports","tslib","react"],(function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i);var o=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.count;return i.default.createElement("ul",{className:"recents-item__attachments"},new Array(Math.min(e,4)).fill(null).map((function(e,t){return i.default.createElement("li",{className:"recents-item__attachment-item",key:t})})))},t})(i.default.Component);t.PendingAttachmentListView=o})),define("modules/clean/react/home/recents/components/recent_activity_container",["require","exports","tslib","classnames","react","react-dom","dig-components/progress_indicators","modules/clean/react/home/actions","modules/clean/react/home/constants","modules/clean/react/home/post_tti/api","modules/clean/react/home/recents/actions/recent_activity_actions","modules/clean/react/home/recents/components/recent_activity_item_container","modules/clean/react/home/recents/stores/recent_activity_store","modules/clean/react/home/section_header","modules/clean/react/home/store","modules/clean/react/home/util/empty","modules/clean/react/home/util/logging/activity_logger","modules/clean/react/home/util/logging/timing_component","modules/clean/react/home/util/logging/timing_logger","modules/clean/react/home/util/show_hide_link","modules/core/i18n"],(function(e,t,n,i,o,r,a,s,c,l,d,u,m,_,h,p,E,f,T,g,I){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importDefault(o),r=n.__importDefault(r);var R=(function(e){function t(t){var i=e.call(this,t)||this;return i.onShouldLoadMore=function(){var e=m.getRecentActivityStore();if(!i.state.isPending&&i.state.showAll&&!e.didTruncateRecentItems()&&e.didReceiveItemsFromAllStreams()){var t=e.getRecentItems().items;t.length>i.state.items.length?i.setState({items:t}):d.loadNextPage()&&i.setState({isPending:!0})}},i.onChangeRecentsVisibility=function(){var e=!i.props.isHiddenByUser;s.HomeActions.setSectionVisibility(h.getUserId(),{".tag":"recents"},!e),E.homeActivityLogger.logShowHideSection(c.HomeSections.RECENTS,e)},i.handleVisibilityChange=function(){"visible"===document.visibilityState&&d.refreshRecentItems()},i.onStoreUpdate=function(){return i.setState(i.getStateFromStore())},i.onShowAll=function(){i.setState({showAll:!0});var e=r.default.findDOMNode(i.refs.lastUnhiddenActivity);if(e){var t=e.querySelector("a");t&&t.focus()}},i.removeStoreListeners=m.getRecentActivityStore().addListener(i.onStoreUpdate),i.state=n.__assign(n.__assign({},i.getStateFromStore()),{isUnityAvailable:!1,showAll:!!t.showAll}),i}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;this.props.isHiddenByUser&&T.homeTimingLogger.logSkippedSection(c.HomeSections.RECENTS),l.waitForHomeTTI().then((function(t){return n.__awaiter(e,void 0,void 0,(function(){return n.__generator(this,(function(e){switch(e.label){case 0:return t.recentActivityContainerComponentDidMount(this.onShouldLoadMore),[4,t.getUnityFeatures()];case 1:return e.sent()&&this.setState({isUnityAvailable:!0}),[2]}}))}))})),!this.state.items.length&&m.getRecentActivityStore().didReceiveItemsFromAllStreams()&&this.setState({isPending:!1}),document.addEventListener("visibilitychange",this.handleVisibilityChange,!1)},t.prototype.componentWillUnmount=function(){document.removeEventListener("visibilitychange",this.handleVisibilityChange),this.removeStoreListeners()},t.prototype.getStateFromStore=function(){var e=m.getRecentActivityStore(),t=!e.didReceiveItemsFromAllStreams(),n=e.getRecentItems().items;if(!t&&T.homeTimingLogger.logTTData(c.HomeSections.RECENTS)){var i=n.length;i&&E.homeActivityLogger.logRecentsShown(i,!h.getHomeStore().getSectionVisibility()[c.HomeSections.RECENTS])}return{isPending:t,items:n}},t.prototype.renderLoadingView=function(){return o.default.createElement("div",{className:"recents-loading-view",key:"loading"},o.default.createElement(a.Spinner,{size:"small","aria-valuetext":I.intl.formatMessage({id:"k2bVak",defaultMessage:"Loading your recent items"})}))},t.prototype.renderItems=function(){var e=this.props.now,t=this.state,n=t.items,i=t.showAll,r={isUnityAvailable:t.isUnityAvailable,now:e,user:h.getUser()},a=i?n:n.slice(0,10);return o.default.createElement("div",null,a.map((function(e,t){return o.default.createElement(u.RecentActivityItemContainer,{key:e.id,recentItem:e,renderingInfo:r,ref:9===t?"lastUnhiddenActivity":void 0})})))},t.prototype.renderShowMoreLink=function(){var e=this.state,t=e.items,n=e.showAll,i=Math.max(t.length-10,0);return n||!d.hasCursor()&&i<=0?null:o.default.createElement(g.ShowHideLink,{key:"show_more",onClick:this.onShowAll,isExpanded:!1,hiddenItemCount:i,canLoadMore:!0})},t.prototype.renderContent=function(){var e=this.state,t=e.isPending;return e.items.length?[this.renderItems(),this.renderShowMoreLink(),t&&this.renderLoadingView()]:t?this.renderLoadingView():o.default.createElement(p.SectionEmptyText,{message:I.intl.formatMessage({id:"hFDfoh",defaultMessage:"Items you recently viewed show up here."}),learnMoreLink:"/help/desktop-web/recents-overview"})},t.prototype.render=function(){var e=this.props,t=e.canRenderItems,n=e.isHiddenByUser,r=e.showHeader;if(!t)return null;var a=this.state,s=a.isPending,c=a.items,l=i.default({"home-recents-section__container":!0,"recents-view":!0,"recents-view--is-pending":s&&0===c.length});return o.default.createElement("section",{className:"home-access-section home-recents-section"},r?o.default.createElement(_.SectionHeader,{title:I.intl.formatMessage({id:"hApMtp",defaultMessage:"Recent"}),ueName:"recents",isHidden:n,onToggleHidden:this.onChangeRecentsVisibility}):null,o.default.createElement("div",{className:"home-access-section__content"},!n&&o.default.createElement("div",{className:l},this.renderContent())))},t.displayName="RecentActivityContainer",t})(o.default.PureComponent);t.RecentActivityContainerInner=R,t.RecentActivityContainer=f.timingComponent(R,c.HomeSections.RECENTS)})),define("modules/clean/react/home/recents/components/recent_activity_item_actions_view",["require","exports","tslib","react","dig-components/buttons","dig-components/icons","dig-components/icons/src","dig-components/menu","modules/core/i18n"],(function(e,t,n,i,o,r,a,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i);var l=function(e){e.stopPropagation(),e.preventDefault()},d=function(e,t){l(t),e(t)},u=function(e){return function(t){return t.permissions[e]}},m=[{name:"handleDownload",label:c.intl.formatMessage({id:"iFX+XI",defaultMessage:"Download"}),shouldRender:u("download")},{name:"handleComment",label:c.intl.formatMessage({id:"tJzlWE",defaultMessage:"Comment"}),shouldRender:u("comment")},{name:"handleDelete",label:c.intl.formatMessage({id:"NQS3dU",defaultMessage:"Delete all…"}),shouldRender:function(e){return e.permissions.delete&&e.attachmentCount>1}},{name:"handleDelete",label:c.intl.formatMessage({id:"Ieup/u",defaultMessage:"Delete…"}),shouldRender:function(e){return e.permissions.delete&&e.attachmentCount<=1}},{name:"handleArchive",label:c.intl.formatMessage({id:"CvAVX3",defaultMessage:"Archive"}),shouldRender:u("archive")},{name:"handleVersions",label:c.intl.formatMessage({id:"jId+M1",defaultMessage:"Version history"}),shouldRender:u("versions")},{name:"handleViewInFolder",label:c.intl.formatMessage({id:"3Dgw+C",defaultMessage:"View in folder"}),shouldRender:u("viewInFolder")}];t.RecentActivityItemActionsView=function(e){if(e.disableActions)return null;var t=m.filter((function(t){return t.shouldRender(e)}));return t.length?i.default.createElement(s.Menu.Wrapper,{className:"recents-item__unportaled-menu",onSelection:d,isPortaled:!1},(function(d){var u=d.getContentProps,m=d.getTriggerProps;return i.default.createElement(i.default.Fragment,null,i.default.createElement(o.IconButton,n.__assign({variant:"transparent"},m({onClick:l})),i.default.createElement(r.UIIcon,{src:a.MoreHorizontalLine,"aria-label":c.intl.formatMessage({id:"mnOOD/",defaultMessage:"More actions"})})),i.default.createElement(s.Menu.Content,n.__assign({},u({onClick:l}),{placement:"bottom-end"}),i.default.createElement(s.Menu.Segment,null,t.map((function(t){var n=t.name,o=t.label;return i.default.createElement(s.Menu.ActionItem,{key:n,value:e.handler[n]},o)})))))})):null}})),define("modules/clean/react/home/recents/components/recent_activity_item_container",["require","exports","tslib","external/lodash","react","modules/core/exception","modules/clean/react/home/recents/recent_activity_constants","modules/clean/react/home/recents/actions/recent_activity_actions","modules/clean/react/home/recents/components/recent_activity_item_view","modules/clean/react/home/recents/utils/events","modules/clean/react/home/recents/stores/attachment_store","modules/clean/react/home/post_tti/api"],(function(e,t,n,i,o,r,a,s,c,l,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var m=(function(e){function t(t){var n=e.call(this,t)||this;return n.onAttachmentStoreChange=function(){n.setState({attachments:d.getAttachmentStore().getByIds(n.getRecentItem().attachmentIds)})},n.handleArchive=function(){return s.archiveRecentItem(n.getRecentItem(),n.getLogData())},n.handleComment=function(){var e=n.getSingleAttachment("handleComment only supports a single attachment"),t=Math.max(0,n.state.attachments.indexOf(e));n.previewOrOpenFiles({index:t,isCommentAction:!0})},n.handleDelete=function(){s.deleteRecentItem(n.getRecentItem(),n.state.attachments,n.getLogData())},n.handleDownload=function(){var e=n.getSingleAttachment("handleDownload only supports a single attachment");s.downloadFiles([e.id],n.getLogData())},n.handleHeaderClick=function(){var e=n.state,t=e.isCollapsed,i=e.attachments,o=t?a.ActionType.UNCOLLAPSE:a.ActionType.COLLAPSE;l.logEvent(o,n,n.state.attachments,i.length),n.setState({isCollapsed:!t})},n.handleOpen=function(){var e=n.getSingleAttachment("handleOpen only supports a single attachment");s.openFile(e.id,n.getLogData())},n.handlePathClick=function(e){var t=n.getAttachmentFqPaths(),i=n.props.recentItem,o=i.attachmentIds,r=i.viewingUserId;u.waitForHomeTTI().then((function(i){var s=i.logOpenPathUrl,c=i.openUrl;s(r,t,o.length,n),c(e,a.ActionType.OPEN_PATH,o,n.getLogData())}))},n.handleViewInFolder=function(){var e=n.getAttachmentFqPaths(),t=n.props.recentItem,o=t.attachmentIds,r=t.viewingUserId;u.waitForHomeTTI().then((function(s){var c=s.logViewInFolder,l=s.openUrl;c(r,e,o.length,n),l(i.last(t.paths).url,a.ActionType.VIEW_IN_FOLDER,o,n.getLogData())}))},n.handlePreview=function(e){n.previewOrOpenFiles({},e)},n.handleShare=function(){s.shareRecentItem(n.getRecentItem(),n.state.attachments,n.getLogData(),!1)},n.handleVersions=function(){var e=n.getSingleAttachment("handleVersions only supports a single attachment");s.openVersions(e.id,n.getLogData())},n.removeStoreListeners=null,n.state={attachments:[],isCollapsed:!0},n}return n.__extends(t,e),t.prototype.getRecentItem=function(){return this.props.recentItem},t.prototype.getLogData=function(){return{totalCount:this.props.recentItem.attachmentIds.length,cellView:this}},t.prototype.getAttachmentFqPaths=function(){return i.compact(i.map(this.state.attachments,"fqPath"))},t.prototype.getSingleAttachment=function(e){return e&&r.assert(1===this.state.attachments.length,e),this.state.attachments[0]},t.prototype.previewOrOpenFiles=function(e,t){var i=this.props.recentItem;s.previewRecentItem(i,n.__assign({},e),this.getLogData(),t)},t.prototype.UNSAFE_componentWillMount=function(){this.removeStoreListeners=d.getAttachmentStore().addListener(this.onAttachmentStoreChange),this.onAttachmentStoreChange()},t.prototype.componentWillUnmount=function(){this.removeStoreListeners&&this.removeStoreListeners()},t.prototype.render=function(){return o.default.createElement(c.RecentActivityItemView,{recentItem:this.getRecentItem(),attachments:this.state.attachments,handler:this,isCollapsed:this.state.isCollapsed,renderingInfo:this.props.renderingInfo})},t.displayName="RecentActivityItemContainer",t})((o=n.__importDefault(o)).default.PureComponent);t.RecentActivityItemContainer=m})),define("modules/clean/react/home/recents/components/recent_activity_item_view",["require","exports","tslib","classnames","external/lodash","react","dig-components/buttons","dig-components/icons","dig-components/icons/src","dig-components/tooltips","dig-components/typography","modules/clean/browse_uri_interface","modules/clean/datetime","modules/clean/em_string","modules/clean/filepath","modules/clean/react/home/constants","modules/clean/react/home/recents/actions/recent_activity_action_permissions","modules/clean/react/home/recents/components/pending_attachment_list_view","modules/clean/react/home/recents/components/recent_activity_item_actions_view","modules/clean/react/home/recents/models/utils","modules/clean/react/home/recents/recent_activity_constants","modules/clean/react/home/recents/recent_activity_text_helper","modules/clean/react/home/util/conditional_api","modules/clean/react/home/util/post_tti_components","modules/clean/react/home/util/resource_icon","modules/clean/react/starred/constants","modules/core/exception","modules/core/i18n"],(function(e,t,n,i,o,r,a,s,c,l,d,u,m,_,h,p,E,f,T,g,I,R,y,S,v,A,P,C){"use strict";function O(e){return 0===e.button&&!(function(e){return e.altKey||e.ctrlKey||e.metaKey||e.shiftKey})(e)}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),r=n.__importDefault(r),R=n.__importStar(R);var D=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onShare=function(e){e.preventDefault(),e.stopPropagation(),t.props.handler.handleShare()},t.handleTitleClick=function(e){e.stopPropagation(),O(e)&&(e.preventDefault(),t.props.handler.handlePreview(e.metaKey))},t.handleClick=function(e){e.stopPropagation(),e.preventDefault(),t.isAggregation()?t.props.handler.handleHeaderClick():t.props.handler.handlePreview(e.metaKey)},t.handleParentClick=function(e){e.stopPropagation(),O(e)&&(e.preventDefault(),t.props.handler.handlePathClick(t.getParentPathComponent().url))},t}return n.__extends(t,e),t.prototype.shouldDisableActions=function(){var e=this.props.recentItem.federatedRecentItem;return e?!e.hasMenuActions():!this.hasLoadedAttachments()},t.prototype.isAggregation=function(){return this.props.recentItem.attachmentIds.length>1},t.prototype.shouldShowThumbnails=function(){var e=this.props.recentItem;return g.isMountedRecentItem(e)&&g.shouldShowThumbnailsForRecentItem(e)},t.prototype.getLoadedAttachmentsCount=function(){return this.props.attachments.filter((function(e){return e.isLoaded})).length},t.prototype.canRenderAttachmentView=function(){var e=this.getLoadedAttachmentsCount();return e===this.props.recentItem.attachmentIds.length||e>=I.MAX_INITIAL_THUMBNAIL_ATTACHMENTS},t.prototype.hasLoadedAttachments=function(){return!(!this.props.attachments.length||!this.getLoadedAttachmentsCount())},t.prototype.getHeading=function(){var e=this.props,t=e.attachments,n=e.recentItem;if(t.length<2){var i=n.displayName||"";return _.Emstring.em_snippet(i,30)}for(var o=n.attachmentIds.length,r=n.uniqueFilterTypes,a=[],s=0,c=t;s<c.length;s++){var l=c[s];l.isLoaded&&l.displayName&&a.push(l.displayName)}switch(r.length){case 1:switch(r[0]){case I.RECENT_EVENT_FILTER_TYPE.PHOTOS:return C.intl.formatMessage({id:"HxTR1s",defaultMessage:"{count, plural, one{{count} image} other{{count} images}}"},{count:o});case I.RECENT_EVENT_FILTER_TYPE.VIDEOS:return C.intl.formatMessage({id:"fmi87t",defaultMessage:"{count, plural, one{{count} video} other{{count} videos}}"},{count:o});case I.RECENT_EVENT_FILTER_TYPE.VISUAL_NOTES:return C.intl.formatMessage({id:"vZtJe2",defaultMessage:"{count, plural, one{{count} visual note} other{{count} visual notes}}"},{count:o})}break;case 2:if(r.indexOf(I.RECENT_EVENT_FILTER_TYPE.PHOTOS)>=0&&r.indexOf(I.RECENT_EVENT_FILTER_TYPE.VIDEOS)>=0)return C.intl.formatMessage({id:"E1nUJ4",defaultMessage:"{count} images and videos"},{count:o})}return a.length?R.snippetList(a,30,{totalCount:o}):C.intl.formatMessage({id:"IGlwYu",defaultMessage:"{count, plural, one{{count} file} other{{count} files}}"},{count:o})},t.prototype.getParentPathComponent=function(){var e=this.props.recentItem,t=e.type,n=e.paths;if(!g.isMountedRecentItem(e))return t===I.RECENT_EVENT_TYPES.FILE_SHARED_ADD?{name:C.intl.formatMessage({id:"guiO/P",defaultMessage:"Your links"}),url:"/share/links"}:null;if(n.length){var i=o.last(n);if(i.url)return i}return null},t.prototype.renderStar=function(){var e=this.props,t=e.attachments,n=e.recentItem,i=e.renderingInfo,o=Boolean(t.length>0&&t[0].isDir);return y.waitForStarred((function(e){var t=e.Star,a=(0,e.getIdTypePairFromRecentItem)(n);return a?r.default.createElement(t,{id:a.id,idType:a.type,isDir:o,itemName:n.displayName||void 0,user:i.user,source:A.StarredSource.HOME_RECENTS}):null}),!1)},t.prototype.componentDidMount=function(){this.shouldShowThumbnails()||this.isAggregation()&&P.reportStack("Tried to render non-photo aggregation but failed",{severity:P.SEVERITY.NONCRITICAL,exc_extra:{isMounted:this.props.recentItem.isMounted,hasSCL:!!this.props.recentItem.scl,attachment_lenth:this.props.attachments.length}})},t.prototype.render=function(){var e,t=this.props,n=t.recentItem,o=t.attachments,_=t.handler,I=t.renderingInfo,R=t.isCollapsed,y=n.displayType,A=n.federatedRecentItem,P=n.fqPath,O=n.scl,D=this.getParentPathComponent(),N=new Date(n.when),L=E.getRecentActivityItemViewPermissions(n,o),w=g.isMountedRecentItem(n),M=L.share&&(A?A.isShareable():this.hasLoadedAttachments()),F=this.isAggregation()?void 0:w?P?u.preview_uri_for_fq_path(I.user,P).toString():void 0:O,b=i.default(((e={})["recents-item"]=!0,e["recents-item--loaded"]=this.hasLoadedAttachments(),e));return r.default.createElement("div",{"data-item-id":n.id,"data-item-type":n.type,"data-item-date":n.when,className:b,onClick:this.handleClick},r.default.createElement("div",{className:"recents-item-header"},r.default.createElement("div",{className:"recents-item-header__chevron"},this.isAggregation()&&r.default.createElement(a.IconButton,{onClick:this.props.handler.handleHeaderClick,variant:"transparent",className:"recents-item-header__chevron-button","aria-label":R?C.intl.formatMessage({id:"5loFC4",defaultMessage:"Expand"}):C.intl.formatMessage({id:"cwEFpr",defaultMessage:"Collapse"})},r.default.createElement(s.UIIcon,{src:R?c.ChevronRightLine:c.ChevronDownLine,size:"small"}))),r.default.createElement("div",{className:"recents-item-header__icon"},r.default.createElement(v.HomeResourceIcon,{displayType:y||p.DisplayTypes.FILE,fileName:n.displayName||"",shortcutUrlForIcon:n.fqPath&&"web"===h.file_extension(n.fqPath)&&n.scl||void 0,icon:n.icon||void 0})),r.default.createElement("div",{className:"recents-item-header__content"},r.default.createElement("div",{className:"recents-item-header__title"},F?r.default.createElement(d.Link,{variant:"monochromatic",hasNoUnderline:!0,className:"recents-item-header__title-text",href:F,onClick:this.handleTitleClick},this.getHeading()):r.default.createElement(d.Text,{className:"recents-item-header__title-text"},this.getHeading()),this.renderStar()),r.default.createElement(d.Text,{size:"small",color:"faint",className:"recents-item-header__subtitle"},g.getActionTypeLocalizedString(n)+" ",r.default.createElement(l.Tooltip,{placement:"top",title:m.format_date(N,"MMM d, yyyy "+m.localized_time_format)},r.default.createElement("span",null,m.agoFromDate(N,I.now,!1))),D?" · ":"",D&&r.default.createElement(d.Link,{href:D.url,onClick:this.handleParentClick,variant:"monochromatic",hasNoUnderline:!0},D.name))),r.default.createElement("div",{className:"recents-item__actions"},M&&r.default.createElement("div",{className:"recents-item__action recents-item__action--hover-only recents-item__action--standard-breakpoint-only"},r.default.createElement(a.Button,{onClick:this.onShare,variant:"opacity"},C.intl.formatMessage({id:"2ZK3bH",defaultMessage:"Share"}))),r.default.createElement(S.PostTTIRecentsActivityFileActions,{recentItem:this.props.recentItem,attachments:this.props.attachments}),r.default.createElement(T.RecentActivityItemActionsView,{handler:_,isMountedItem:w,permissions:L,attachmentCount:n.attachmentIds.length,disableActions:this.shouldDisableActions(),renderingInfo:I}))),this.shouldShowThumbnails()&&!this.props.isCollapsed&&(this.canRenderAttachmentView()?r.default.createElement(S.PostTTIRecentActivityImageAttachments,{attachments:o}):r.default.createElement(f.PendingAttachmentListView,{count:n.attachmentIds.length})))},t.displayName="RecentActivityItemView",t})(r.default.Component);t.RecentActivityItemView=D})),define("modules/clean/react/home/recents/models/attachment",["require","exports","modules/core/exception"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertFileActivityToAttachmentItem=function(e){var t=e.preview_jsinfo||null,i=null,o=null;if(t&&(t.thumbnail_url_tmpl&&(i=t.thumbnail_url_tmpl),t.thumbnail_dimensions)){var r=t.thumbnail_dimensions,a=r[0];o={height:r[1],width:a}}var s=e.comment||{},c=s.commenter_dict||{};return s.raw_comment_text&&n.reportStack("Received a comment attachment",{severity:n.SEVERITY.NONCRITICAL,exc_extra:{activity:e}}),{id:e.activity_key,isLoaded:!0,viewingUserId:e.viewing_user.id,displayName:e.name||null,displayType:e.activity_data&&e.activity_data.home_display_type||null,previewInfo:e.preview_jsinfo||null,fqPath:e.fq_path||null,nsPath:e.ns_path||null,nsId:e.ns_id||null,thumbnailUrl:i||null,thumbnailDimensions:o||null,canOpen:!1,inRootCollection:!1,isReadOnly:!!e.is_read_only,isDir:!!e.is_dir,isCloudDoc:!!e.is_cloud_doc,isVersionable:!!e.is_versionable,perNodeMetadata:e.per_node_metadata||null,commentRawText:s.raw_comment_text||null,commenterId:c.id||null,commenterDisplayName:c.display_name||null,commenterPhotoUrl:c.photo_circle_url||null}},t.createPartialAttachmentsFromRecentActivity=function(e){return(e.related_activity_keys||[]).map((function(t){return{id:t,viewingUserId:e.viewing_user.id,displayName:null,displayType:null,isLoaded:!1,canOpen:!1,inRootCollection:!1,isReadOnly:!1,isDir:!1,isCloudDoc:!1,isVersionable:!1,perNodeMetadata:null,previewInfo:null,fqPath:null,nsPath:null,nsId:null,thumbnailUrl:null,thumbnailDimensions:null,commentRawText:null,commenterId:null,commenterDisplayName:null,commenterPhotoUrl:null}}))}})),define("modules/clean/react/home/recents/models/federated_recent_item",["require","exports","modules/clean/react/home/recents/recent_activity_constants","modules/clean/react/home/recents/recent_activity_federated_model"],(function(e,t,n,i){"use strict";function o(e){switch(e.action||n.PaperRecentItemAction.OPENED){case n.PaperRecentItemAction.CREATED:return n.RECENT_EVENT_TYPES.PAPER_ADD;case n.PaperRecentItemAction.EDITED:return n.RECENT_EVENT_TYPES.PAPER_EDIT;default:return n.RECENT_EVENT_TYPES.PAPER_VIEW}}Object.defineProperty(t,"__esModule",{value:!0}),t.createRecentItemFromPaperRecentItem=function(e,t,r){var a=new i.FederatedRecentItem(e),s=a.getActivityKey();return{federatedRecentItem:a,id:s,idType:e.id_type,resourceId:e.resource_id,type:o(e),icon:a.getIcon(),displayType:e.display_type,when:e.time,viewingUserId:t.id,displayName:e.name,accountDisplayName:t.display_name,contextDisplayName:a.getFolderPath()||t.display_name,attachmentIds:[s],paths:e.path,order:r,uniqueFilterTypes:[n.RECENT_EVENT_FILTER_TYPE.DOCUMENTS]}}})),define("modules/clean/react/home/recents/models/recent_item",["require","exports","tslib","external/lodash","modules/clean/react/home/recents/actions/error_actions","modules/clean/react/home/recents/models/utils"],(function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var a=0,s=i.memoize((function(e){return a+=1}));t.convertRecentActivityToRecentItem=function(e){try{var t=e.skeleton_data;return{id:e.activity_key,type:e.recent_event_type||null,icon:e.icon||t&&t.icon||null,displayType:e.activity_data&&e.activity_data.home_display_type||null,when:e.when_milli||null,viewingUserId:e.viewing_user.id,displayName:t&&t.display_name||null,accountDisplayName:t&&t.account_display_name||null,contextDisplayName:t&&t.context_display_name||null,uniqueFilterTypes:t?i.uniq(i.values(t.filter_types_by_key)):[],attachmentIds:e.related_activity_keys||[],paths:r.getPathsByFqPath(t&&t.context_display_path||"",e.viewing_user.id,!0),order:s(e.activity_key),idType:e.id_type,resourceId:e.resource_id,scl:e.scl,isMounted:e.is_mounted,perNodeMetadata:e.per_node_metadata}}catch(t){return i.defer((function(){return o.errorActions.recentActivityParseError(e.activity_key,t)})),null}}})),define("modules/clean/react/home/recents/models/utils",["require","exports","tslib","external/lodash","modules/clean/browse_uri_interface","modules/clean/react/home/recents/recent_activity_constants","modules/clean/viewer"],(function(e,t,n,i,o,r,a){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var c=[r.RECENT_EVENT_FILTER_TYPE.PHOTOS,r.RECENT_EVENT_FILTER_TYPE.VIDEOS,r.RECENT_EVENT_FILTER_TYPE.VISUAL_NOTES];function l(e,t){return!!(e>1&&t.every((function(e){return c.indexOf(e)>=0})))}function d(e){switch(e.type){case r.RECENT_EVENT_TYPES.FILE_PRIVATE_VIEW:case r.RECENT_EVENT_TYPES.FILE_SHARED_VIEW:case r.RECENT_EVENT_TYPES.PAPER_VIEW:return r.RecentItemActionType.OPENED;case r.RECENT_EVENT_TYPES.FILE_EDIT:case r.RECENT_EVENT_TYPES.PAPER_EDIT:return r.RecentItemActionType.EDITED;default:return r.RecentItemActionType.ADDED}}t.shouldShowThumbnailsForSkeletonData=function(e){var t=i.values(e.filter_types_by_key);return l(t.length,i.uniq(t))},t.shouldShowThumbnailsForRecentItem=function(e){return l(e.attachmentIds.length,e.uniqueFilterTypes)},t.extractAttachmentIds=function(e){return i.map(e,"id")},t.isMountedRecentItem=function(e){return!1!==e.isMounted},t.getPathsByFqPath=function(e,t,n){void 0===n&&(n=!1);var r=a.Viewer.get_viewer().get_user_by_id(t);"/"===e&&(e="");var s=[],c=e.split("/");for(n||c.pop();c.length;){var l=i.last(c),d=c.join("/");1===c.length&&""===l&&(l=a.Viewer.get_root_name(r),d="");var u=o.browse_uri_for_fq_path(r,d).toString();s.push({name:l||"",url:u}),c.pop()}return s.reverse()},t.compareRecentItems=function(e,t){return t.when-e.when||e.order-t.order||t.type-e.type},t.getExtension=function(e){var t=e.split(".");return t.length<2?"":"."+t.slice(-1)[0].replace(/\n$/,"").toLowerCase()},t.getRecentItemActionType=d;var u=((s={})[r.RecentItemActionType.OPENED]=r.I18N.OPENED,s[r.RecentItemActionType.EDITED]=r.I18N.EDITED,s[r.RecentItemActionType.ADDED]=r.I18N.ADDED,s);t.getActionTypeLocalizedString=function(e){return u[d(e)]}})),define("modules/clean/react/home/recents/recent_activity_client_utils",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPayload=function(e){if("ok"===e.status)return e.payload;throw new Error("Payload not okay: "+JSON.stringify(e))},t.isSFJRecentItem=function(e){return void 0!==e.activity_key},t.isPaperRecentItem=function(e){return void 0!==e.time}})),define("modules/clean/react/home/recents/recent_activity_constants",["require","exports","tslib","modules/constants/python","modules/core/i18n"],(function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),t.RECENT_EVENT_TYPES=i.RECENT_EVENT_TYPES,t.RECENT_EVENT_FILTER_TYPE=i.RECENT_EVENT_FILTER_TYPE,t.ARCHIVE_PAPER_DOCUMENT_COMMIT="ARCHIVE_PAPER_DOCUMENT_COMMIT",t.ARCHIVE_PAPER_DOCUMENT_PENDING="ARCHIVE_PAPER_DOCUMENT_PENDING",t.ARCHIVE_PAPER_DOCUMENT_ROLLBACK="ARCHIVE_PAPER_DOCUMENT_ROLLBACK",t.DELETE_FILES_COMMIT="DELETE_FILES_COMMIT",t.DELETE_FILES_PENDING="DELETE_FILES_PENDING",t.DELETE_FILES_ROLLBACK="DELETE_FILES_ROLLBACK",t.RAW_RECENT_ACTIVITY_PARSE_ERROR="RAW_RECENT_ACTIVITY_PARSE_ERROR",t.RAW_RELATED_ACTIVITY_PARSE_ERROR="RAW_RELATED_ACTIVITY_PARSE_ERROR",t.RECEIVE_CAN_OPEN_INFO="RECEIVE_CAN_OPEN_INFO",t.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO="RECEIVE_FILE_IN_ROOT_COLLECTION_INFO",t.RECEIVE_PAPER_RECENT_ITEMS="RECEIVE_PAPER_RECENT_ITEMS",t.RECEIVE_RAW_RECENT_ACTIVITIES="RECEIVE_RAW_RECENT_ACTIVITIES",t.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY="RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY",t.REFRESH_RECENT_ACTIVITIES="REFRESH_RECENT_ACTIVITIES",t.ADD_PENDING_ACTIVITY_KEYS="ADD_PENDING_ACTIVITY_KEYS",t.REMOVE_PENDING_ACTIVITY_KEYS="REMOVE_PENDING_ACTIVITY_KEYS",t.MAX_INITIAL_DOC_ATTACHMENTS=3,t.SHOW_MORE_DOC_ATTACHMENT_INCREMENT=10,t.MAX_INITIAL_THUMBNAIL_ATTACHMENTS=8,t.SHOW_MORE_THUMBNAIL_ROW_INCREMENT=4,(function(e){e.CREATED="CREATE",e.OPENED="VIEW",e.EDITED="EDIT"})(t.PaperRecentItemAction||(t.PaperRecentItemAction={})),t.PaperRecentItemTypes={DOCUMENT:"DOCUMENT",FOLDER:"FOLDER",PROJECT:"PROJECT"},t.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2_PRE_TTI=10,t.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2_POST_TTI=100,t.MAX_ENSURE_ATTACHMENT_LOAD_ATTACHMENTS_ATTEMPTS=1,(function(e){e.OPENED="OPENED",e.EDITED="EDITED",e.ADDED="ADDED"})(t.RecentItemActionType||(t.RecentItemActionType={})),t.I18N={OPENED:o.intl.formatMessage({id:"xPH1sd",defaultMessage:"Opened"}),EDITED:o.intl.formatMessage({id:"l46MMy",defaultMessage:"Edited"}),ADDED:o.intl.formatMessage({id:"toc0wl",defaultMessage:"Added"})},(function(e){e.COMMENT="comment",e.DELETE="delete",e.DOWNLOAD="download",e.HIDE="hide",e.OPEN="open",e.OPEN_DIR="open_dir",e.OPEN_PATH="open_path",e.PAPER_ARCHIVE="paper_archive",e.PAPER_OPEN="paper_open",e.PAPER_SHARE="paper_share",e.REPORT_JUNK="report_junk",e.SHARE="share",e.SHARE_COLLECTION="share_collection",e.UNITY_OPEN="unity_open",e.VERSIONS="versions",e.VIEW_FILE="view",e.VIEW_SHARED_LINK="view_shared_link",e.VIEW_IN_FOLDER="view_in_folder",e.COLLAPSE="collapse",e.UNCOLLAPSE="uncollapse"})(t.ActionType||(t.ActionType={})),(function(e){e.SINGLE="single",e.SUBSET="subset",e.AGGREGATION="aggregation"})(t.ActionScope||(t.ActionScope={})),(function(e){e.RECENTS_JSON_CONTINUATION="handleAndLogRecentsJson",e.SHARE_FILE="shareFile",e.PREVIEW_RECENT_ITEM="previewRecentItem",e.OPEN_FILE="openFile",e.DOWNLOAD_FILES="downloadFiles",e.OPEN_VERSIONS="openVersions",e.PROMPT_AND_DELETE_ATTACHMENTS="promptAndDeleteAttachments",e.LOAD_REMAINING_ATTACHMENTS="loadRemainingAttachments"})(t.EnsureAttachmentsPurpose||(t.EnsureAttachmentsPurpose={}))})),define("modules/clean/react/home/recents/recent_activity_dispatcher",["require","exports","flux"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.recentActivityDispatcher=new n.Dispatcher})),define("modules/clean/react/home/recents/recent_activity_federated_model",["require","exports","modules/clean/react/home/recents/recent_activity_constants"],(function(e,t,n){"use strict";function i(e){return e.paperRecentItem.type===n.PaperRecentItemTypes.DOCUMENT}function o(e){return i(e)&&e.paperRecentItem.shareUrl||""}Object.defineProperty(t,"__esModule",{value:!0}),t.isPaperDocument=i,t.isPaperProject=function(e){return e.paperRecentItem.type===n.PaperRecentItemTypes.PROJECT},t.getPaperShareUrl=o,t.equalsPaperRecentItem=function(e,t){return e.paperRecentItem.id===t.id&&e.paperRecentItem.type===t.type};var r=(function(){function e(e){this.paperRecentItem=e}return e.prototype.isShareable=function(){return i(this)&&Boolean(o(this))},e.prototype.isArchiveable=function(){return i(this)&&Boolean(this.paperRecentItem.isEditable)},e.prototype.hasMenuActions=function(){return this.isArchiveable()},e.prototype.getIdTypePair=function(){return{id:this.paperRecentItem.resource_id,type:this.paperRecentItem.id_type}},e.prototype.getStarredStatus=function(){return{starred:this.paperRecentItem.isFavorite,idTypePair:this.getIdTypePair()}},e.prototype.getIcon=function(){switch(this.paperRecentItem.display_type){case"PAPER_DOCUMENT":return"paper_doc";case"PAPER_FOLDER":return"folder";case"PAPER_PUBLIC_FOLDER":return"folder_team";case"PAPER_PROJECT":return"paper_project";default:return"file"}},e.prototype.getDisplayType=function(){return this.paperRecentItem.display_type},e.prototype.getIsDir=function(){return!1},e.prototype.getFolderPath=function(){return[""].concat(this.paperRecentItem.path.map((function(e){return e.name}))).join("/")},e.prototype.getFqPath=function(){return this.getFolderPath()+"/"+this.paperRecentItem.name},e.prototype.getActivityKey=function(){return"paper_id_"+this.paperRecentItem.id},e.prototype.getUrl=function(){return this.paperRecentItem.url},e})();t.FederatedRecentItem=r})),define("modules/clean/react/home/recents/recent_activity_logger_utils",["require","exports","tslib","modules/clean/web_timing_logger"],(function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var o=!1,r=!1;t.getRecentsLoggingData=function(){if(!r){var e=i.start_time();if(e)return r=!0,{isFullPage:!0,startTime:e}}return{isFullPage:!1,startTime:Date.now()}},t.reset=function(){r=!1,o=!1},t.canLogFirstAction=function(){return!o},t.onLogFirstAction=function(){o=!0}})),define("modules/clean/react/home/recents/recent_activity_stream",["require","exports","tslib","external/lodash","modules/clean/react/home/recents/models/utils"],(function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var r=(function(){function e(e,t){var n=this;this.sortedRecentItems=e,this.hasMore=t,this.activityKeyToRecentItem={},e.forEach((function(e){n.activityKeyToRecentItem[e.id]=e})),this.oldestTimeForOtherStream=this.getOldestItemTimeForOtherStreams()}return e.prototype.getOldestItemTimeForOtherStreams=function(){return this.hasMore&&this.sortedRecentItems.length&&this.sortedRecentItems[this.sortedRecentItems.length-1].when||0},e.prototype.getRecentItems=function(){return this.sortedRecentItems.slice()},e.prototype.getRecentItemByActivityKey=function(e){return this.activityKeyToRecentItem[e]||null},e.prototype.getStreamWithoutActivityKey=function(t){return new e(this.sortedRecentItems.filter((function(e){return e.id!==t})),this.hasMore)},e.prototype.getItemsAfter=function(e){if(this.oldestTimeForOtherStream<e){for(var t=[],n=0,i=this.sortedRecentItems;n<i.length;n++){var o=i[n];if(o.when<e)break;t.push(o)}return t}return this.sortedRecentItems},e})();t.RecentActivityStream=r,t.getMergedRecentItems=function(e){var t,n=e.filter(Boolean),r=i.max(n.map((function(e){return e.oldestTimeForOtherStream})));return(t=[]).concat.apply(t,n.map((function(e){return e.getItemsAfter(r)}))).sort(o.compareRecentItems)}})),define("modules/clean/react/home/recents/recent_activity_text_helper",["require","exports","modules/clean/em_string","modules/core/i18n"],(function(e,t,n,i){"use strict";function o(e,t){return i.intl.formatMessage({id:"650lWu",defaultMessage:"{count, plural, one{{name} and {count} other} other{{name} and {count} others}}"},{count:t,name:e})}Object.defineProperty(t,"__esModule",{value:!0}),t.snippetList=function(e,t,r){void 0===r&&(r={});var a=Math.max(Math.floor(r.totalCount||0),e.length);if(1===a)return n.Emstring.em_snippet(e[0],t);var s=e[0],c=a-1,l=o(s,c);if(new n.Emstring(l).length>t){var d=Math.floor(t-new n.Emstring(o("",c)).length)-1;l=d<3?i.intl.formatMessage({id:"aNHFm3",defaultMessage:"{count, plural, one{{count} other} other{{count} others}}"},{count:a}):o(n.Emstring.em_snippet(s,d),c)}for(var u="",m=1;m<e.length&&(m+=1,u=e.slice(0,m).join(", "),m<a&&(u=o(u,a-m)),new n.Emstring(u).length<t);)l=u;return l}})),define("modules/clean/react/home/recents/store_utils",["require","exports","tslib","modules/clean/react/home/store","modules/clean/react/home/recents/recent_activity_dispatcher","modules/clean/react/home/recents/recent_activity_logger_utils","modules/clean/react/home/recents/recent_activity_constants","modules/clean/react/home/recents/models/utils","modules/clean/react/home/recents/recent_activity_client_utils"],(function(e,t,n,i,o,r,a,s,c){"use strict";function l(e,t){return n.__awaiter(this,void 0,Promise,(function(){var o;return n.__generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,t()];case 1:return[2,n.sent()];case 2:throw o=n.sent(),e().then((function(e){return(0,e.logRequestFailed)(i.getUserId(),o)})),o;case 3:return[2]}}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.handleAndLogRecentsJsonPromise=function(e,t,d){var u=this;void 0===d&&(d=!0);try{var m=r.getRecentsLoggingData(),_=c.getPayload(t),h=_.recent_activities,p=_.cursor,E=_.encrypted,f=_.use_assistant_service,T=i.getUserId(),g=[],I=[];return h.forEach((function(e){c.isPaperRecentItem(e)?g.push(e):c.isSFJRecentItem(e)&&I.push(e)})),f&&o.recentActivityDispatcher.dispatch({type:a.RECEIVE_PAPER_RECENT_ITEMS,items:g,hasMore:!1,userId:T}),o.recentActivityDispatcher.dispatch({type:a.RECEIVE_RAW_RECENT_ACTIVITIES,rawRecentActivities:I,cursor:p||"",encrypted:E||"",userId:T}),l(e,(function(){return n.__awaiter(u,void 0,void 0,(function(){var t,i,o;return n.__generator(this,(function(n){switch(n.label){case 0:return t=[],I.forEach((function(e){if(e.skeleton_data&&e.related_activity_keys){var n=s.shouldShowThumbnailsForSkeletonData(e.skeleton_data)?a.MAX_INITIAL_THUMBNAIL_ATTACHMENTS:a.MAX_INITIAL_DOC_ATTACHMENTS;t=t.concat.apply(t,e.related_activity_keys.slice(0,n))}})),[4,e()];case 1:return[4,n.sent().ensureAttachments(t,a.EnsureAttachmentsPurpose.RECENTS_JSON_CONTINUATION)];case 2:return n.sent(),i=!1,o=0,I.forEach((function(e){var t=e.skeleton_data;t&&(o+=t.num_related_activities||0,(t.num_related_activities||0)>1&&(i=!0))})),e().then((function(e){return(0,e.logRecentsLoaded)(T,m,{is_paginated:!d,contains_aggregation:i,item_count:o})})),[2]}}))}))}))}catch(t){throw e().then((function(e){return(0,e.logRequestFailed)(i.getUserId(),t)})),t}},t.logErrorAndRethrowAsync=l,t.handleRetrievePaperRecentsPromise=function(e,t,n){void 0===n&&(n=!0);var r=i.getUserId(),s=c.getPayload(t);if(!s.use_assistant_service){var l=n&&s.has_more;o.recentActivityDispatcher.dispatch({type:a.RECEIVE_PAPER_RECENT_ITEMS,items:s.items,hasMore:l,userId:r}),l&&e().then((function(e){return(0,e.loadPaperRecentItems)(!1)}))}}})),define("modules/clean/react/home/recents/stores/attachment_store",["require","exports","tslib","modules/clean/flux/dispatcher","modules/clean/react/home/constants","external/lodash","modules/clean/flux/flux_store","modules/clean/react/home/recents/actions/error_actions","modules/clean/react/home/recents/stores/flux_utils","modules/clean/react/home/recents/recent_activity_constants","modules/clean/react/home/recents/recent_activity_dispatcher","modules/clean/react/home/recents/models/attachment","modules/core/exception"],(function(e,t,n,i,o,r,a,s,c,l,d,u,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importStar(r);var _=(function(e){function t(t,n){void 0===n&&(n={});var i=e.call(this,t)||this;return i.onCommit=function(e){delete i.transactionHistory[e.transactionId]},i._onDeleteFilesPending=function(e){for(var t=[],n=0,o=e.attachmentIds;n<o.length;n++){var r=o[n];r in i.attachmentIdToAttachment&&(t.push(i.attachmentIdToAttachment[r]),delete i.attachmentIdToAttachment[r])}i.transactionHistory[e.transactionId]={deletedAttachments:t},c.emitChangeIfNeeded(i,!!t.length)},i._onDeleteFilesRollback=function(e){var t=i.transactionHistory[e.transactionId];m.assert(!!t,"Unable to find data for transaction with id: "+e.transactionId),t.deletedAttachments.forEach((function(e){return i.attachmentIdToAttachment[e.id]=e})),c.emitChangeIfNeeded(i,!!t.deletedAttachments.length)},i.pendingActivityKeys=[],i.attachmentIdToEncryptedToken={},i.attachmentIdToAttachment={},(n.attachments||[]).forEach((function(e){i.attachmentIdToAttachment[e.id]=e,n.encryptedToken&&(i.attachmentIdToEncryptedToken[e.id]=n.encryptedToken)})),i.transactionHistory={},i}return n.__extends(t,e),t.prototype.areSomeActivityKeysPending=function(e){return!!r.intersection(this.pendingActivityKeys,e).length},t.prototype.getById=function(e){return this.attachmentIdToAttachment[e]||null},t.prototype.getByIds=function(e){return r.values(r.pick(this.attachmentIdToAttachment,e))},t.prototype.getByFqPath=function(e){return this.getAll().find((function(t){return t.fqPath===e}))||null},t.prototype.getAll=function(){return r.values(this.attachmentIdToAttachment)},t.prototype.groupIdsByEncryptedToken=function(e){var t=this;return r.groupBy(e.filter((function(e){return e in t.attachmentIdToEncryptedToken})),(function(e){return t.attachmentIdToEncryptedToken[e]}))},t.prototype.__onDispatch=function(e){switch(e.type){case l.ADD_PENDING_ACTIVITY_KEYS:this.onAddPendingActivityKeys(e);break;case l.REMOVE_PENDING_ACTIVITY_KEYS:this.onRemovePendingActivityKeys(e);break;case l.DELETE_FILES_COMMIT:this.onCommit(e);break;case l.DELETE_FILES_PENDING:this._onDeleteFilesPending(e);break;case l.DELETE_FILES_ROLLBACK:this._onDeleteFilesRollback(e);break;case l.RECEIVE_RAW_RECENT_ACTIVITIES:this.onReceiveRawRecentActivities(e);break;case l.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:this.onReceiveRawRelatedActivitiesByKey(e);break;case l.RECEIVE_CAN_OPEN_INFO:this.onReceiveCanOpenInfo(e);break;case l.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO:this._onReceiveFileInRootCollectionInfo(e)}},t.prototype.mutateAttachmentInNsIdPath=function(e,t){if(e&&e.indexOf(":")>=0){var n=e.split(":"),i=n[0],o=n[1],r=this.getAll().find((function(e){return e.nsId===Number(i)&&e.nsPath===o}))||null;if(r){var a=c.getMutatedOrOriginal(r,t);if(a!==r)return this.attachmentIdToAttachment[r.id]=a,!0}}return!1},t.prototype.updatePendingActivityKeys=function(e,t){var i,o=this.pendingActivityKeys.length;if(t){var a=(i=this.pendingActivityKeys).concat.apply(i,e);this.pendingActivityKeys=r.uniq(a)}else this.pendingActivityKeys=r.without.apply(r,n.__spreadArrays([this.pendingActivityKeys],e));c.emitChangeIfNeeded(this,o!==this.pendingActivityKeys.length)},t.prototype.onAddPendingActivityKeys=function(e){this.updatePendingActivityKeys(e.activityKeys,!0)},t.prototype.onRemovePendingActivityKeys=function(e){this.updatePendingActivityKeys(e.activityKeys,!1)},t.prototype.onReceiveRawRecentActivities=function(e){var t,n=this,i=e.rawRecentActivities.map(u.createPartialAttachmentsFromRecentActivity),o=(t=[]).concat.apply(t,i).filter((function(e){var t=n.getById(e.id);return!t||!t.isLoaded}));o.forEach((function(t){n.attachmentIdToAttachment[t.id]=t,n.attachmentIdToEncryptedToken[t.id]=e.encrypted})),c.emitChangeIfNeeded(this,!!o.length)},t.prototype.onReceiveRawRelatedActivitiesByKey=function(e){var t=this;if(e.rawRelatedActivitiesByKey){var n=Object.keys(e.rawRelatedActivitiesByKey);this.updatePendingActivityKeys(n,!1);var a={};c.iterateAndEmitChangesIfNeeded(this,e.rawRelatedActivitiesByKey,(function(e,n){try{var i=u.convertFileActivityToAttachmentItem(e);return i.previewInfo&&!i.previewInfo.is_dir&&(a[i.id]=i.previewInfo),t.attachmentIdToAttachment[i.id]=i,!0}catch(e){return r.defer((function(){return s.errorActions.relatedActivityParseError(n,e)})),!1}})),setTimeout((function(){return i.Dispatcher.dispatch({type:o.HomeResourceStoreActionTypes.RECEIVED_RESOURCE_ID_TO_FILE,resourceIdToFile:a})}))}},t.prototype.onReceiveCanOpenInfo=function(e){var t=this;c.iterateAndEmitChangesIfNeeded(this,e.canOpenInfo,(function(e,n){return t.mutateAttachmentInNsIdPath(n,{canOpen:e.is_locally_available})}))},t.prototype._onReceiveFileInRootCollectionInfo=function(e){var t=this;c.iterateAndEmitChangesIfNeeded(this,e.fileInRootCollectionInfo,(function(e,n){return t.mutateAttachmentInNsIdPath(n,{inRootCollection:e})}))},t})(a.FluxStore);t.AttachmentStore=_;var h=null;t.getAttachmentStore=function(){return null===h&&(h=new _(d.recentActivityDispatcher)),h}})),define("modules/clean/react/home/recents/stores/flux_utils",["require","exports","tslib"],(function(e,t,n){"use strict";function i(e,t){t&&e.__emitChange()}Object.defineProperty(t,"__esModule",{value:!0}),t.iterateAndEmitChangesIfNeeded=function(e,t,n){var o=!1;Object.keys(t).forEach((function(e){n(t[e],e)&&(o=!0)})),i(e,o)},t.emitChangeIfNeeded=i,t.getMutatedOrOriginal=function(e,t){for(var i in t)if(t[i]!==e[i])return n.__assign(n.__assign({},e),t);return e}})),define("modules/clean/react/home/recents/stores/recent_activity_store",["require","exports","tslib","external/lodash","modules/clean/react/home/recents/recent_activity_constants","modules/clean/react/home/recents/models/federated_recent_item","modules/clean/react/home/recents/recent_activity_dispatcher","modules/clean/react/home/recents/models/recent_item","modules/clean/react/home/recents/models/utils","modules/clean/react/home/recents/stores/flux_utils","modules/clean/react/home/recents/stores/attachment_store","modules/clean/react/home/store","modules/core/exception","modules/clean/react/home/recents/recent_activity_stream","modules/clean/react/home/post_tti/api","modules/clean/viewer","modules/clean/react/home/constants","modules/clean/react/home/util/logging/availability_logger","modules/clean/react/home/recents/store_utils","modules/clean/flux/flux_store"],(function(e,t,n,i,o,r,a,s,c,l,d,u,m,_,h,p,E,f,T,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var I=(function(e){function t(t,n){void 0===n&&(n=[]);var i=e.call(this,t)||this;i.handlePaperRecentsPrefetch=function(){return f.getHomeAvailabilityLogger().handlePrefetch(E.HomePrefetchTypes.RETRIEVE_PAPER_RECENTS,(function(e){return T.handleRetrievePaperRecentsPromise(h.waitForHomeTTI,e)}))},i.removeFileSyncItem=function(e){i.fileSyncRecentItemIdToRecentItem.hasOwnProperty(e.id)&&(delete i.fileSyncRecentItemIdToRecentItem[e.id],i.needsToRefreshFileSyncCache=!0)},i.addFileSyncItem=function(e){e!==i.fileSyncRecentItemIdToRecentItem[e.id]&&(i.fileSyncRecentItemIdToRecentItem[e.id]=e,i.needsToRefreshFileSyncCache=!0)},i.fileSyncRecentItemIdToRecentItem={},i.fileSyncCursor=null,i.fileSyncTransactionIdToRestoreData={},i.didReceiveRawRecentActivities=!!n.length,n.forEach(i.addFileSyncItem),i.fileSyncCache={items:n},i.needsToRefreshFileSyncCache=!1;var r=u.getHomeStore().getSectionLoadingPreference(E.ConditionalSections.PAPER_RECENTS)===E.ConditionalSectionLoadingPreference.POST_TTI;return i.paperStream=r?new _.RecentActivityStream([],!1):null,i.didRecievePaperItems=r,i.paperActivityKeyToPendingArchiving={},i.cachedFederatedRecentItems=[],i.cachedFederatedTruncatedRecentItems=[],i.federatedRecentItemsCountMax=o.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2_PRE_TTI,i.cachedProcessedRecentItems=null,h.waitForHomeTTI().then((function(){i.federatedRecentItemsCountMax=o.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2_POST_TTI,i.didTruncateRecentItems()&&(i.cacheTruncatedFederatedRecentItems(),i.cachedProcessedRecentItems=null)})),d.getAttachmentStore(),f.getHomeAvailabilityLogger().handlePrefetch(E.HomePrefetchTypes.RECENTS_JSON,(function(e){return T.handleAndLogRecentsJsonPromise(h.waitForHomeTTI,e)})),r?h.waitForHomeTTI().then(i.handlePaperRecentsPrefetch):i.handlePaperRecentsPrefetch(),i}return n.__extends(t,e),t.prototype.getSortedFileSyncRecentItems=function(){return this.fileSyncCache.sortedItems||(this.fileSyncCache.sortedItems=this.fileSyncCache.items.slice().sort(c.compareRecentItems)),this.fileSyncCache.sortedItems},t.prototype.__onDispatch=function(e){this.fileSyncHandler(e)||this.paperHandler(e)},t.prototype.fileSyncHandler=function(e){switch(e.type){case o.DELETE_FILES_COMMIT:this.onDeleteCommit(e);break;case o.DELETE_FILES_PENDING:this.onDeleteFilesPending(e);break;case o.DELETE_FILES_ROLLBACK:this.onDeleteFilesRollback(e);break;case o.RECEIVE_RAW_RECENT_ACTIVITIES:this.onReceiveRawRecentActivities(e);break;case o.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:this.onReceiveRawRelatedActivitiesByKey(e);break;case o.RAW_RELATED_ACTIVITY_PARSE_ERROR:this.onRawRelatedActivityParseError(e);break;case o.REFRESH_RECENT_ACTIVITIES:this.onRefreshRecentActivities();break;default:return!1}return this.updateFileSyncCache(!0),!0},t.prototype.paperHandler=function(e){switch(e.type){case o.RECEIVE_PAPER_RECENT_ITEMS:this.onReceivePaperRecentItems(e.items,e.hasMore,e.userId);break;case o.ARCHIVE_PAPER_DOCUMENT_PENDING:this.onArchivePaperDocumentPending(e.activityKey);break;case o.ARCHIVE_PAPER_DOCUMENT_COMMIT:this.onArchivePaperDocumentCommit(e.activityKey);break;case o.ARCHIVE_PAPER_DOCUMENT_ROLLBACK:this.onArchivePaperDocumentRollback(e.activityKey);break;default:return}this.__emitChange()},t.prototype.updateFileSyncCache=function(e){this.needsToRefreshFileSyncCache?(this.fileSyncCache={items:i.values(this.fileSyncRecentItemIdToRecentItem)},this.clearFederatedCache(),this.needsToRefreshFileSyncCache=!1,l.emitChangeIfNeeded(this,e)):l.emitChangeIfNeeded(this,!this.cachedProcessedRecentItems)},t.prototype.onDeleteCommit=function(e){delete this.fileSyncTransactionIdToRestoreData[e.transactionId]},t.prototype.onReceiveRawRecentActivities=function(e){var t=this;l.emitChangeIfNeeded(this,!this.didReceiveRawRecentActivities&&!e.rawRecentActivities.length),this.didReceiveRawRecentActivities=!0;var n=!this.fileSyncCache.items.length,r=[],a={};if(e.rawRecentActivities.forEach((function(c){if(c.viewing_user&&c.viewing_user.id===e.userId){var l=s.convertRecentActivityToRecentItem(c);if(l&&(l.uniqueFilterTypes.indexOf(o.RECENT_EVENT_FILTER_TYPE.JUNK)<0||l.uniqueFilterTypes.indexOf(o.RECENT_EVENT_FILTER_TYPE.ALL)>=0))if(r.push(c),n)t.fileSyncRecentItemIdToRecentItem[l.id]=l;else if(!a[l.id]){a[l.id]=l;var d=t.fileSyncCache.items.find((function(e){return e.id!==l.id&&e.contextDisplayName===l.contextDisplayName}));if(d)i.intersection(d.attachmentIds,l.attachmentIds).length>0&&(t.removeFileSyncItem(d),t.updateFileSyncCache(!1));var u=t.fileSyncRecentItemIdToRecentItem[l.id];t.updateFileSyncItem(l,{fqPath:u&&u.fqPath||void 0,paths:u&&u.paths||l.paths})}}})),h.waitForHomeTTI().then((function(e){return e.fetchStarredStatus(r)})),this.updateFileSyncCache(!1),!n){var c={};this.getSortedFileSyncRecentItems().forEach((function(e){if(e.attachmentIds.length>0){var n=Object.keys(c).length;e.attachmentIds.forEach((function(e){return c[e]=!0})),n===Object.keys(c).length&&t.removeFileSyncItem(e)}}))}this.fileSyncCursor=e.cursor,this.needsToRefreshFileSyncCache=!0},t.prototype.onReceiveRawRelatedActivitiesByKey=function(e){var t=this;this.waitForAttachmentStoreDispatcher();var n=Object.keys(e.rawRelatedActivitiesByKey||{});n.length&&this.clearFederatedCache(),this.getFileSyncRecentItemsByAttachmentIds(n).forEach((function(e){var n=e.id,i=t.fileSyncRecentItemIdToRecentItem[n];if(i){var o=i.attachmentIds;if(o&&o.length){var r=d.getAttachmentStore().getById(o[0]);if(r&&r.isLoaded){var a=r.fqPath||"";o.slice(1).forEach((function(e){var t=d.getAttachmentStore().getById(e);if(t.isLoaded){var n=t.fqPath||"";n.split("/").length<a.split("/").length&&(a=n)}}));var s=a.split("/"),l=s[s.length-2];t.updateFileSyncItem(i,{fqPath:a,paths:c.getPathsByFqPath(a,i.viewingUserId),contextDisplayName:l||i.contextDisplayName}),r.displayType||(r.displayType=i.displayType)}}}}))},t.prototype.onRawRelatedActivityParseError=function(e){this.getFileSyncRecentItemsByAttachmentIds(i.map(e.errors,"activityKey")).forEach(this.removeFileSyncItem)},t.prototype.onDeleteFilesPending=function(e){this.waitForAttachmentStoreDispatcher();var t=this.deleteAttachments(e.attachmentIds);t&&(this.fileSyncTransactionIdToRestoreData[e.transactionId]=t)},t.prototype.onDeleteFilesRollback=function(e){this.waitForAttachmentStoreDispatcher();var t=this.fileSyncTransactionIdToRestoreData[e.transactionId];m.assert(!!t,"Unable to find data for transaction with id: "+e.transactionId),delete this.fileSyncTransactionIdToRestoreData[e.transactionId],this.rollbackDelete(t)},t.prototype.onRefreshRecentActivities=function(){this.getUnprocessedRecentItems(),this.didReceiveRawRecentActivities=!1,this.didRecievePaperItems=!1},t.prototype.deleteAttachments=function(e){var t=null;if(e.length){var n=this.getFileSyncRecentItemsByAttachmentIds([e[0]])[0];if(n){var o=i.difference(n.attachmentIds,e);this.updateFileSyncItem(n,{attachmentIds:o}),t={deletedAttachmentIds:e,item:n},0===o.length&&this.removeFileSyncItem(n)}}return t},t.prototype.rollbackDelete=function(e){var t,n=this.fileSyncRecentItemIdToRecentItem[e.item.id];n?t=n.attachmentIds:(n=e.item,t=[]),this.updateFileSyncItem(n,{attachmentIds:i.uniq(t.concat.apply(t,e.deletedAttachmentIds))})},t.prototype.getCachedAttachmentIdToIdToFileSyncItem=function(){var e=this;return this.fileSyncCache.attachmentIdToIdToItem||(this.fileSyncCache.attachmentIdToIdToItem={},this.fileSyncCache.items.forEach((function(t){return t.attachmentIds.forEach((function(n){var i;e.fileSyncCache.attachmentIdToIdToItem[n]?e.fileSyncCache.attachmentIdToIdToItem[n][t.id]=t:e.fileSyncCache.attachmentIdToIdToItem[n]=((i={})[t.id]=t,i)}))}))),this.fileSyncCache.attachmentIdToIdToItem},t.prototype.getFileSyncRecentItemsByAttachmentIds=function(e){var t=this.getCachedAttachmentIdToIdToFileSyncItem(),n={};return e.forEach((function(e){t.hasOwnProperty(e)&&i.values(t[e]).forEach((function(e){return n[e.id]=e}))})),i.values(n)},t.prototype.waitForAttachmentStoreDispatcher=function(){this.getDispatcher().waitFor([d.getAttachmentStore().getDispatchToken()])},t.prototype.updateFileSyncItem=function(e,t){this.addFileSyncItem(l.getMutatedOrOriginal(e,t))},t.prototype.onArchivePaperDocumentPending=function(e){this.paperActivityKeyToPendingArchiving[e]=!0},t.prototype.onArchivePaperDocumentCommit=function(e){this.deletePendingArchive(e),this.paperStream=this.paperStream.getStreamWithoutActivityKey(e),this.clearFederatedCache()},t.prototype.onArchivePaperDocumentRollback=function(e){this.deletePendingArchive(e)},t.prototype.deletePendingArchive=function(e){this.paperActivityKeyToPendingArchiving[e]&&delete this.paperActivityKeyToPendingArchiving[e]},t.prototype.onReceivePaperRecentItems=function(e,t,n){this.didRecievePaperItems=!0;var i=p.Viewer.get_viewer().get_user_by_id(n),o=e.map((function(e,t){return r.createRecentItemFromPaperRecentItem(e,i,t)}));this.paperStream=new _.RecentActivityStream(o,t),h.waitForHomeTTI().then((function(t){return t.setStarredStatusOfPaperRecentItems(e)})),this.clearFederatedCache()},t.prototype.clearFederatedCache=function(){this.cachedFederatedRecentItems&&this.didReceiveItemsFromAllStreams()&&(this.__emitChange(),this.cachedFederatedRecentItems=null,this.cachedFederatedTruncatedRecentItems=null,this.cachedProcessedRecentItems=null)},t.prototype.cacheTruncatedFederatedRecentItems=function(){this.cachedFederatedRecentItems?this.cachedFederatedTruncatedRecentItems=this.cachedFederatedRecentItems.slice(0,this.federatedRecentItemsCountMax):this.getUnprocessedRecentItems()},t.prototype.getUnprocessedRecentItems=function(){if(null===this.cachedFederatedRecentItems){var e=[this.paperStream,new _.RecentActivityStream(this.getSortedFileSyncRecentItems(),!!this.fileSyncCursor)];this.cachedFederatedRecentItems=_.getMergedRecentItems(e),this.cacheTruncatedFederatedRecentItems()}return this.cachedFederatedTruncatedRecentItems},t.prototype.getFileSyncCursor=function(){return this.fileSyncCursor},t.prototype.canArchiveActivityKey=function(e){if(this.paperStream&&!this.paperActivityKeyToPendingArchiving[e]){var t=this.paperStream.getRecentItemByActivityKey(e);return!(!t||!t.federatedRecentItem.isArchiveable())}return!1},t.prototype.didReceiveItemsFromAllStreams=function(){return this.didRecievePaperItems&&this.didReceiveRawRecentActivities},t.prototype.getRecentItems=function(){return null===this.cachedProcessedRecentItems&&(this.cachedProcessedRecentItems=this.getUnprocessedRecentItems()),{items:this.cachedProcessedRecentItems}},t.prototype.didTruncateRecentItems=function(){return!!(this.cachedFederatedRecentItems&&this.cachedFederatedTruncatedRecentItems&&this.cachedFederatedTruncatedRecentItems.length<this.cachedFederatedRecentItems.length)},t})(g.FluxStore);t.RecentActivityStore=I;var R=null;t.getRecentActivityStore=function(){return null===R&&(R=new I(a.recentActivityDispatcher)),R}})),define("modules/clean/react/home/recents/utils/events",["require","exports","tslib","external/lodash","react-dom","modules/clean/react/home/recents/recent_activity_constants","modules/clean/react/home/util/logging/activity_logger","modules/clean/react/home/resource_id_types"],(function(e,t,n,i,o,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),o=n.__importStar(o);var c=function(e){return e?Array.prototype.indexOf.call(e.parentNode.childNodes,e):0},l=function(e,t,n,i){return e===r.ActionScope.AGGREGATION?n.props.recentItem?0:t+1:e===r.ActionScope.SUBSET?i.classList.contains("recents-item")?0:1:0},d=function(e,t,n,a,d){var u=(function(e){return i.filter(e,(function(e){return!!e.fqPath}))})(n),m=(function(e){return i.map(e,(function(e){return e.fqPath}))})(u),_=o.findDOMNode(t),h=(function(e,t){return 1===e?r.ActionScope.SINGLE:t.length===e?r.ActionScope.AGGREGATION:r.ActionScope.SUBSET})(a,m),p=(function(e,t){var n=e[t];return n&&n.previewInfo?n.previewInfo.icon:""})(n,d||0);return{actionTaken:e,scope:h,itemNumber:c(_),fileDetails:(function(e,t,n,i){if(e===r.ActionScope.AGGREGATION||t===r.ActionType.COLLAPSE||t===r.ActionType.UNCOLLAPSE)return{};var o=n[i];if(!o)return{};for(var a=0,c=["PAPER","EXTERNAL"];a<c.length;a++){var l=c[a];if(o.displayType&&o.displayType.indexOf(l)>=0)return{idType:void 0,resourceId:void 0}}return{idType:s.HOME_RESOURCE_ID_TYPE.FQ_PATH,resourceId:o.fqPath,displayType:o.displayType,isDir:o.isDir}})(h,e,u,d||0),sprite:p,subgroupPosition:l(h,d||0,t,_)}};t.logEvent=function(e,t,n,i,o){var r=d(e,t,n,i,o);return a.homeActivityLogger.logRecentsAction(r.actionTaken,r.scope,r.itemNumber,r.sprite,r.fileDetails.displayType||"",!!r.fileDetails.isDir,r.subgroupPosition,r.fileDetails.idType,r.fileDetails.resourceId)},t.logFederatedItemEvent=function(e,t,n){var i=o.findDOMNode(t),s=n.getIdTypePair();return a.homeActivityLogger.logRecentsAction(e,r.ActionScope.SINGLE,c(i),n.getIcon(),n.getDisplayType(),n.getIsDir(),l(r.ActionScope.SINGLE,0,t,i),s.type,s.id)}})),define("modules/clean/react/home/resource_id_types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e.ENCODED_FILE_OBJ_ID="ENCODED_FILE_OBJ_ID",e.FQ_PATH="FQ_PATH",e.PAPER_DOCUMENT_ID="PAPER_DOCUMENT_ID",e.PAPER_FOLDER_ID="PAPER_FOLDER_ID",e.PAPER_DOCUMENT_ID_PATH="PAPER_DOCUMENT_ID_PATH",e.PAPER_FOLDER_ID_PATH="PAPER_FOLDER_ID_PATH",e.EXTERNAL_RESOURCE_ID="EXTERNAL_RESOURCE_ID",e.UNKNOWN="UNKNOWN"})(t.HOME_RESOURCE_ID_TYPE||(t.HOME_RESOURCE_ID_TYPE={}))})),define("modules/clean/react/home/resource/store",["require","exports","tslib","modules/clean/flux/dispatcher","modules/clean/react/home/constants","modules/clean/react/starred/constants","modules/clean/react/starred/id_type_pair","modules/clean/flux/flux_store"],(function(e,t,n,i,o,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){var t=e.call(this,i.Dispatcher)||this;return t.pendingPreviewResourceId=null,t.resourceIdToFile={},t.fileToPreview=null,t.resourceIdToEquivalentResourceId={},t}return n.__extends(t,e),t.prototype.getFileToPreview=function(){return this.fileToPreview},t.prototype.emitIfPendingFileExists=function(){if(null!==this.pendingPreviewResourceId){var e=this.resourceIdToEquivalentResourceId[this.pendingPreviewResourceId]||this.pendingPreviewResourceId;this.fileToPreview=this.resourceIdToFile[this.pendingPreviewResourceId]||this.resourceIdToFile[e]||null,null!==this.fileToPreview&&(this.pendingPreviewResourceId=null,this.__emitChange())}},t.prototype.onRequestPreview=function(e){this.pendingPreviewResourceId=e,this.emitIfPendingFileExists()},t.prototype.onReceivedResourceIdToFile=function(e){this.resourceIdToFile=n.__assign(n.__assign({},this.resourceIdToFile),e),this.emitIfPendingFileExists()},t.prototype.onStarredSetStatus=function(e){var t=this;e.forEach((function(e){if(e.canonicalIdTypePair){var n=a.idTypePairToString(e.idTypePair),i=a.idTypePairToString(e.canonicalIdTypePair);n!==i&&(t.resourceIdToEquivalentResourceId[i]=n,t.resourceIdToEquivalentResourceId[n]=i)}})),this.emitIfPendingFileExists()},t.prototype.__onDispatch=function(e){var t=e.action;switch(t.type){case o.HomeResourceStoreActionTypes.REQUEST_PREVIEW:this.onRequestPreview(t.resourceId);break;case o.HomeResourceStoreActionTypes.RECEIVED_RESOURCE_ID_TO_FILE:this.onReceivedResourceIdToFile(t.resourceIdToFile);break;case r.StarredActionTypes.SET_STATUS:this.onStarredSetStatus(t.starredStatuses)}},t})(s.FluxStore);t.HomeResourceStore=c;var l=null;t.getHomeResourceStore=function(){return null===l&&(l=new c),l}})),define("modules/clean/react/home/roots/home_access_main",["require","exports","tslib","react","classnames","modules/clean/react/home/constants","modules/clean/react/home/store","modules/clean/react/home/util/conditional_components","modules/clean/react/home/recents/components/recent_activity_container","modules/clean/react/home/util/logging/availability_logger"],(function(e,t,n,i,o,r,a,s,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importDefault(o);var d=(function(e){function t(t){var n=e.call(this,t)||this;return n.outerFrame=function(e){n.element=e},n.updateWidth=function(){n.setState({containerWidth:n.getWidth()})},n.onResize=function(){window.requestAnimationFrame?window.requestAnimationFrame(n.updateWidth):setTimeout(n.updateWidth,250)},n.onHomeStoreUpdate=function(){return n.setState(n.getStateFromStore())},n.state=n.getStateFromStore(),n.removeStoreListeners=a.getHomeStore().addListener(n.onHomeStoreUpdate),n}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.updateWidth(),window.addEventListener("resize",this.onResize)},t.prototype.componentWillUnmount=function(){this.removeStoreListeners&&this.removeStoreListeners()},t.prototype.getStateFromStore=function(){var e=a.getHomeStore(),t=e.getPreTTIProps(),n=t.expHomeRecentsPage,i=this.getHomeTeamFlags(t.expHomeSurfaceExistingTeams);return{sectionVisibility:e.getSectionVisibility(),canRenderAllHomeSections:e.canRenderAllHomeSections(),canRenderItems:e.canRenderItems(),containerWidth:this.getWidth(),pageType:e.getPageType(location.pathname),expHomeRecentsPage:n,expHomeSurfaceExistingTeamsProps:i}},t.prototype.getHomeTeamFlags=function(e){return{showTeamsOnHomepageExperiment:(null==e?void 0:e.showTeamsOnHomepageExperiment)||!1,showTeamsLoadingState:(null==e?void 0:e.showTeamsLoadingState)||!1,numberOfTeams:(null==e?void 0:e.numberOfTeams)||0}},t.prototype.getWidth=function(){var e=1;return this.element&&this.element.getBoundingClientRect&&(e=this.element.getBoundingClientRect().width||1),e},t.prototype.render=function(){var e=this.state,t=e.canRenderAllHomeSections,n=e.sectionVisibility,a=e.canRenderItems,d=e.pageType,u=e.expHomeRecentsPage,m=e.expHomeSurfaceExistingTeamsProps,_=e.containerWidth,h=this.props.now;if(t){var p=o.default({"home-access-sections":!0}),E=a,f=i.default.createElement(s.ConditionalRecommendedMembersView,{key:"recommended-members-view",isHiddenByUser:!n[r.HomeSections.RECOMMENDED_MEMBERS],canRenderItems:E,containerWidth:_}),T=i.default.createElement(s.ConditionalSuggestView,{key:"suggest-view",isHiddenByUser:!n[r.HomeSections.SUGGEST],containerWidth:_,canRenderItems:E,homeAvailabilityLogger:l.getHomeAvailabilityLogger()}),g=i.default.createElement(s.ConditionalStarredView,{key:"starred-view",isHiddenByUser:!n[r.HomeSections.STARRED],canRenderItems:E,showAll:"STARRED"===d,showHeader:"HOME"===d&&!r.ExpHomeStarredPageOnVariants.includes(u)}),I=i.default.createElement(c.RecentActivityContainer,{key:"recent-activity-view",now:h,canRenderItems:E,isHiddenByUser:!n[r.HomeSections.RECENTS],showHeader:!r.ExpHomeRecentsPageOnVariants.includes(u),showAll:"RECENTS"===d}),R=i.default.createElement(s.ConditionalTeamsView,{key:"teams-view",isHiddenByUser:!n[r.HomeSections.TEAMS],canRenderItems:E,showTeamsLoadingState:m.showTeamsLoadingState,showTeamsOnHomepageExperiment:m.showTeamsOnHomepageExperiment,numberOfTeams:Number(m.numberOfTeams)}),y=[i.default.createElement(s.ConditionalHomeInlineContentPromptView,{key:"prompt-view",canRenderItems:E}),R,f,T,I,g];return i.default.createElement("div",{className:"home",ref:this.outerFrame},i.default.createElement("main",{className:"home-access",role:"main"},i.default.createElement("div",{className:p,ref:"main"},y)))}return i.default.createElement("div",{ref:this.outerFrame})},t.displayName="HomeAccessMain",t})(i.default.PureComponent);t.HomeAccessMain=d})),define("modules/clean/react/home/roots/home_access_web",["require","exports","tslib","dropbox/proto/js_init_data/home_web/home_access_web","modules/clean/flux/dispatcher","modules/clean/react/home/constants","modules/clean/react/home/post_tti/api","modules/clean/react/home/recents/stores/recent_activity_store","modules/clean/react/home/resource/store","modules/clean/react/home/roots/home_access_main","modules/clean/react/home/roots/sidebar","modules/clean/react/home/store","modules/clean/react/home/util/conditional_api","modules/clean/react/home/util/logging/timing_logger","modules/clean/react/maestro/layout/header","modules/clean/react/maestro/layout/search","modules/clean/react/snackbar","modules/clean/react/snackbar_manager","modules/clean/web_timing_logger","modules/core/exception","modules/core/i18n","proto_utils/unpack","react"],(function(e,t,n,i,o,r,a,s,c,l,d,u,m,_,h,p,E,f,T,g,I,R,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),T=n.__importStar(T);var S=(function(e){function t(n){var i=e.call(this,n)||this;i.intervalHandle=null,i.snackbarManager=y.default.createRef(),i.renderSidebar=function(e){return u.getHomeStore().getShouldRenderSidebar(location.pathname)?y.default.createElement(d.HomeSidebar,{isPostTTI:i.state.isPostTTI,responsive:e}):null},T.log_js_modules_application_code_start();var o=n.preTtiProps,a=n.initialRole,s=n.initialSectionVisibility,c=n.sectionToConditionalData;return t.initializeHomeStores(a,s,c,o||r.DEFAULT_PRE_TTI_PROPS),i.state={now:new Date,isPostTTI:!1},i}return n.__extends(t,e),t.initializeHomeStores=function(e,t,n,i){_.homeTimingLogger.activate(),u.getHomeStore();var a={role:e,sectionVisibility:t,preTTIProps:i,sectionToConditionalData:n};o.Dispatcher.dispatch({type:r.HomeActionTypes.INITIALIZE_STORE,payload:a}),c.getHomeResourceStore(),s.getRecentActivityStore(),m.waitForStarred((function(e){return e.getStarredResourceStore()}))},t.prototype.componentDidMount=function(){var e=this;E.Snackbar.manager=this.snackbarManager.current,a.waitForHomeTTIWithProps().then((function(t){var n=t.imports,i=t.props;e.setState({isPostTTI:!0}),e.intervalHandle=setInterval((function(){return e.setState({now:new Date})}),6e4),n.homeAccessWebComponentDidMount(i.maybeRenderTeamAdminModals)}))},t.prototype.componentWillUnmount=function(){null!=this.intervalHandle&&clearInterval(this.intervalHandle)},t.prototype.getHomePageType=function(){return u.getHomeStore().getPageType(location.pathname)},t.prototype.render=function(){var e=this.state.now,t="";switch(this.getHomePageType()){case"RECENTS":t=I.intl.formatMessage({id:"a0FTw9",defaultMessage:"Recents"});break;case"STARRED":t=I.intl.formatMessage({id:"X0i16w",defaultMessage:"Starred"});break;case"HOME":t=I.intl.formatMessage({id:"taNFWh",defaultMessage:"Home"})}return y.default.createElement(y.default.Fragment,null,y.default.createElement("div",{id:"page-content"},y.default.createElement(p.SearchChrome,{user:u.getUser(),embeddedAppRegion:y.default.createElement(l.HomeAccessMain,{now:e}),titleRegion:y.default.createElement(h.MaestroHeaderTitle,null,t),actionSidebarRegion:this.renderSidebar,searchBarProps:{searchVariant:"full-page"},wideSecondarySidebar:!0,useScrollableSidebar:!0,chromeClass:"dig2--enabled",useMaestroPortal:!0})),y.default.createElement(f.SnackbarManager,{ref:this.snackbarManager,getParentElement:f.SnackbarManager.getEmbeddedAppPagelet,useDigSnackbars:!0}),y.default.createElement("div",{id:"react-file-viewer"}))},t.displayName="HomeAccessWeb",t})((y=n.__importDefault(y)).default.PureComponent);t.HomeAccessWeb=S,t.RootComponent=function(e){var t=R.unpackProto(e.encodedProto,i.home_web.HomeWebPageletProps),o=t.webTimingLoggerServerContext,r=n.__rest(t,["webTimingLoggerServerContext"]);return o?T.initialize({log_time_to_interactive:!0},o):g.reportException({err:new Error("Missing WebTimingLogger server context"),severity:"non-critical"}),y.default.createElement(S,n.__assign({},r))}})),define("modules/clean/react/home/roots/sidebar",["require","exports","tslib","classnames","external/lodash","react","dig-components/icons/src","modules/clean/css","modules/clean/react/actions_menu/view","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/file_uploader/file_uploader","modules/clean/react/growth/continuous_onboarding/continuous_onboarding_loader","modules/clean/react/home/actions","modules/clean/react/home/constants","modules/clean/react/home/modals/async_home_modals","modules/clean/react/home/post_tti/api","modules/clean/react/home/recents/actions/recent_activity_actions","modules/clean/react/home/store","modules/clean/react/home/util/logging/activity_logger","modules/clean/sharing/wizard/async_wizard_modals","modules/clean/web_user_action_events","modules/clean/web_user_action_logger","modules/core/i18n"],(function(e,t,n,i,o,r,a,s,c,l,d,u,m,_,h,p,E,f,T,g,I,R,y,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importStar(o);var v=(function(e){function t(t){var i=e.call(this,t)||this;return i.onHomeStoreUpdate=function(){i.setState({isFileViewerOpen:T.getHomeStore().getIsFileViewerOpen()})},i.handleCreateNewFile=function(){g.homeActivityLogger.logClickRightMenu(h.LoggingTypes.CLICK_CREATE_NEW_FILE)},i.handleUploadFiles=function(){u.FileUploaderController.handleUploadButtonClick(!1),g.homeActivityLogger.logClickRightMenu(h.LoggingTypes.CLICK_UPLOAD_FILES)},i.handleUploadFolder=function(){u.FileUploaderController.handleUploadButtonClick(!0),g.homeActivityLogger.logClickRightMenu(h.LoggingTypes.CLICK_UPLOAD_FOLDER)},i.handleCreateSharedFolder=function(){return n.__awaiter(i,void 0,void 0,(function(){return n.__generator(this,(function(e){return y.WebUserActionLog.log(T.getUserId(),R.WebUserActionLogEvent.NEW_SHARED_FOLDER_CLICK,{origin:l.CREATE_FOLDER_ACTION_ORIGIN_TYPE.HOME_NEW_FOLDER_MODAL}),I.asyncShowShareAFolderWizardModal(T.getUser(),(function(e){g.homeActivityLogger.logClickRightMenu(h.LoggingTypes.CLICK_NEW_SHARED_FOLDER,e)})),[2]}))}))},i.handleCreateFolder=function(){return n.__awaiter(i,void 0,void 0,(function(){return n.__generator(this,(function(e){return p.asyncShowNewFolderModal({user:T.getUser(),origin:l.CREATE_FOLDER_ACTION_ORIGIN_TYPE.HOME_NEW_FOLDER_MODAL,onShowModal:function(e){g.homeActivityLogger.logClickRightMenu(h.LoggingTypes.CLICK_NEW_FOLDER,e)}}),[2]}))}))},i.handleCreateFolderFromUploadModal=function(e){return function(t){return n.__awaiter(i,void 0,void 0,(function(){return n.__generator(this,(function(n){return p.asyncShowNewFolderModal({user:T.getUser(),initialPath:t,origin:l.CREATE_FOLDER_ACTION_ORIGIN_TYPE.HOME_UPLOAD_MODAL,redirectOnClose:e}),[2]}))}))}},i.handleCreatePaperDoc=function(){_.HomeActions.createPaperDocInNewTab(T.getUserId()),g.homeActivityLogger.logClickRightMenu(h.LoggingTypes.CLICK_CREATE_PAPER_DOC)},i.handleContinuousOnboardingChange=function(e){i.setState({isContinuousOnboardingOpen:e})},i.onFileUploadComplete=o.throttle(f.refreshRecentItems,3500,{leading:!1,trailing:!0}),i.state={newFileMenuPostTTI:void 0,showLegacyCreatePaperButton:!1,isFileViewerOpen:T.getHomeStore().getIsFileViewerOpen(),isContinuousOnboardingOpen:!1},i.removeStoreListeners=T.getHomeStore().addListener(i.onHomeStoreUpdate),i}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;u.FileUploaderController.setUser(T.getUser()),E.waitForHomeTTIWithProps().then((function(t){var i=t.props,o=t.imports;return n.__awaiter(e,void 0,void 0,(function(){var e,t,r,a;return n.__generator(this,(function(n){switch(n.label){case 0:return u.FileUploaderController.loadCoreComponent(),s.require_css("/static/css/upload-vfl68nu0h.css"),e=i.uploaderPostTTIExperiments,t=i.showLegacyCreatePaperButton,r=i.permissionsAtUploadModalProps.autoTeamGroupId,[4,o.getNewFileMenu(i)];case 1:return a=n.sent(),this.setState({uploaderPostTTIExperiments:e,newFileMenuPostTTI:a,showLegacyCreatePaperButton:t,autoTeamGroupId:r}),[2]}}))}))}))},t.prototype.componentWillUnmount=function(){this.removeStoreListeners&&this.removeStoreListeners()},t.prototype.getPath=function(){var e=T.getUser(),t=e.is_cdm_member,n=e.cdm_tmf_path;return t?n:"/"},t.prototype.getBrowseContext=function(){return new d.BrowseContext({isInsideSharedFolder:!0,isInsideTeamFolderTree:!0})},t.prototype.render=function(){var e,t={displayName:S.intl.formatMessage({id:"8/w9ir",defaultMessage:"Create new file"}),className:"action-create-file-primary-pretti",handleClick:this.handleCreateNewFile,subItems:void 0},n={displayName:S.intl.formatMessage({id:"Qayhb5",defaultMessage:"Upload files"}),popoverMenuName:S.intl.formatMessage({id:"bObFEu",defaultMessage:"Files"}),handleClick:this.handleUploadFiles,className:"action-upload-files",iconName:"upload-file",icon:a.UploadFileLine,key:"upload-files"},o={displayName:S.intl.formatMessage({id:"53oUlv",defaultMessage:"Upload folder"}),popoverMenuName:S.intl.formatMessage({id:"MLqiSW",defaultMessage:"Folder"}),handleClick:this.handleUploadFolder,className:"action-upload-folder",iconName:"upload-folder",icon:a.UploadFolderLine,key:"upload-folder"},s={displayName:S.intl.formatMessage({id:"+hJZUF",defaultMessage:"Create Paper doc"}),iconName:"new-paper-doc",icon:a.PaperDocLine,className:"action-new-paper-doc",handleClick:this.handleCreatePaperDoc},l=[];e=this.state.newFileMenuPostTTI?this.state.newFileMenuPostTTI:t,l.push(n),l.push(o);var d={displayName:S.intl.formatMessage({id:"pxGZm3",defaultMessage:"New folder"}),iconName:"new-folder",icon:a.FolderLine,className:"action-new-folder",handleClick:this.handleCreateFolder,key:"new-folder"};l.push(d);var _={displayName:S.intl.formatMessage({id:"J9ZdWw",defaultMessage:"New shared folder"}),iconName:"new-shared-folder",icon:a.AddFolderLine,className:"action-new-shared-folder",handleClick:this.handleCreateSharedFolder,key:"new-shared-folder"};l.push(_),this.state.showLegacyCreatePaperButton&&l.push(s);var h=T.getUserId();return r.default.createElement("div",{className:"home-access-sidebar"},r.default.createElement("div",{className:i.default("home-access-sidebar__content",{"home-access-sidebar__content--hidden":this.state.isContinuousOnboardingOpen}),"aria-hidden":this.state.isContinuousOnboardingOpen},!this.state.isFileViewerOpen&&r.default.createElement(u.FileUploaderController,{loadOnRender:this.props.isPostTTI,needToSetStoreValues:!0,chooseDestination:!0,dragAndDropEnabled:!0,initialPermission:!0,initialPath:this.getPath(),onFileUploadComplete:this.onFileUploadComplete,uploaderPostTTIExperiments:this.state.uploaderPostTTIExperiments,handleClickNewFolder:this.handleCreateFolderFromUploadModal,autoTeamGroupId:this.state.autoTeamGroupId,getBrowseContext:this.getBrowseContext}),r.default.createElement(c.ActionsMenu,{responsive:this.props.responsive,primaryMenuItems:[e],secondaryMenuItems:l,popoverTriggerLabel:S.intl.formatMessage({id:"w81jal",defaultMessage:"Actions"})})),r.default.createElement(m.ContinuousOnboardingLoadable,{userId:h,onExpandChange:this.handleContinuousOnboardingChange}))},t})((r=n.__importDefault(r)).default.PureComponent);t.HomeSidebar=v})),define("modules/clean/react/home/section_header",["require","exports","tslib","react","dig-components/buttons","dig-components/typography","modules/clean/user_education/react/user_education_effect","modules/core/i18n"],(function(e,t,n,i,o,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i);var c=function(e){var t=e.title,n=e.ueName,c=e.isHidden,l=e.onToggleHidden,d=e.infoIcon,u=i.default.createElement("div",{className:"home-section-header__button"},i.default.createElement(o.Button,{variant:"transparent",className:"show-hide-section-button",size:"small",onClick:l},c?s.intl.formatMessage({id:"2X0e4z",defaultMessage:"Show"}):s.intl.formatMessage({id:"NNi2D+",defaultMessage:"Hide"})));return i.default.createElement("div",{className:"home-access-section__header"},i.default.createElement("div",{className:"home-access-section__title"},i.default.createElement(a.UserEducationEffect,{containerName:"home-section-header",name:n},i.default.createElement(r.Title,{size:"small"},t)),i.default.createElement("div",{className:"home-access-section__title-icon"},d)),u)};t.SectionHeader=c,c.displayName="SectionHeader"})),define("modules/clean/react/home/starred/starred_empty_layout",["require","exports","tslib","react","modules/clean/react/home/starred/starred_empty_state","modules/clean/react/home/starred/starred_layout"],(function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.StarredEmptyLayout=function(e){var t=e.isHiddenByUser,n=e.showAll,a=e.showHeader;return i.default.createElement(r.StarredLayout,{starredComponent:o.StarredEmptyState,isHiddenByUser:t,itemModels:[],canShowSpinner:!1,hasMore:!1,hasLoadedInitial:!1,showAll:n,showHeader:a})}})),define("modules/clean/react/home/starred/starred_empty_state",["require","exports","tslib","react","modules/clean/react/home/util/empty","modules/core/i18n"],(function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.StarredEmptyState=function(){return i.default.createElement(o.SectionEmptyText,{message:r.intl.formatMessage({id:"bFX0L5",defaultMessage:"When you star items, they’ll show up here for easy access."}),learnMoreLink:"/help/desktop-web/star-doc-file-folder"})}})),define("modules/clean/react/home/starred/starred_layout",["require","exports","tslib","react","modules/clean/react/home/actions","modules/clean/react/home/constants","modules/clean/react/home/section_header","modules/clean/react/home/store","modules/clean/react/home/util/logging/activity_logger","modules/core/i18n"],(function(e,t,n,i,o,r,a,s,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.STARRED_HEADER_TITLE=l.intl.formatMessage({id:"Nd85dl",defaultMessage:"Starred"});var d=(function(e){function l(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChangeVisibility=function(){var e=t.props.isHiddenByUser;o.HomeActions.setSectionVisibility(s.getUserId(),{".tag":"starred"},e),c.homeActivityLogger.logShowHideSection(r.HomeSections.STARRED,!e)},t}return n.__extends(l,e),l.prototype.render=function(){var e=this.props,o=e.isHiddenByUser,r=e.showHeader,s=e.starredComponent,c=n.__rest(e,["isHiddenByUser","showHeader","starredComponent"]),l=s;return i.default.createElement("section",{className:"home-access-section"},r&&i.default.createElement(a.SectionHeader,{title:t.STARRED_HEADER_TITLE,ueName:"starred",isHidden:o,onToggleHidden:this.onChangeVisibility}),!o&&i.default.createElement(l,n.__assign({},c)))},l})(i.default.PureComponent);t.StarredLayout=d})),define("modules/clean/react/home/store",["require","exports","tslib","external/lodash","modules/clean/flux/dispatcher","modules/clean/flux/flux_store","modules/clean/photos/thumb_loading/generic_thumb_store","modules/clean/react/home/constants","modules/clean/react/home/util/logging/availability_logger_common","modules/clean/viewer","modules/core/exception"],(function(e,t,n,i,o,r,a,s,c,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var u=(function(e){function t(){var t=e.call(this,o.Dispatcher)||this;return t.handledPrefetches=[],t.activeTabId=s.HomeTabId.STARRED,t.canRenderItems=function(){return!!t.pendingPreTTIPrefetches&&!t.pendingPreTTIPrefetches.length},t.thumbStore=new a.GenericThumbStore,t.sectionToDidLoadSynchronously={},t.sectionToPendingCallbacks={},t.preTTIProps=s.DEFAULT_PRE_TTI_PROPS,t}return n.__extends(t,e),t.prototype.getRole=function(){return this.role},t.prototype.getUser=function(){return this.user},t.prototype.getThumbStore=function(){return this.thumbStore},t.prototype.getSectionVisibility=function(){return this.sectionVisibility},t.prototype.getPreTTIProps=function(){return this.preTTIProps},t.prototype.getActiveTabId=function(){return this.activeTabId},t.prototype.getActiveVariants=function(){return this.preTTIProps.activeVariants},t.prototype.getActiveVariant=function(e){var t=this.getActiveVariants();return t&&t[e]},t.prototype.getPageType=function(e){if(s.ExpHomeRecentsPageOnVariants.includes(this.getPreTTIProps().expHomeRecentsPage)){if("/recents"===e)return"RECENTS";if("/starred"===e)return"STARRED"}return"HOME"},t.prototype.getShouldRenderSidebar=function(e){if("HOME"===this.getPageType(e))return!0;var t=this.getPreTTIProps().expHomeRecentsPage;return!["ON","ON_DEFAULT_TO_BROWSE"].includes(t)},t.prototype.executeWhenSectionIsReady=function(e,t,n){var i=this.getSectionLoadingPreference(e);return i===s.ConditionalSectionLoadingPreference.DO_NOT_LOAD?null:i===s.ConditionalSectionLoadingPreference.IMMEDIATE||this.getSectionLoadingMode(e)!==s.ConditionalSectionLoadingMode.UNKNOWN?n(!0):(t&&(this.sectionToPendingCallbacks[e]?this.sectionToPendingCallbacks[e].push(n):this.sectionToPendingCallbacks[e]=[n]),null)},t.prototype.getSectionLoadingPreference=function(e){if(this.sectionToExtendedConditionalData){var t=this.sectionToExtendedConditionalData[e];return t?t.isPostTti?s.ConditionalSectionLoadingPreference.POST_TTI:s.ConditionalSectionLoadingPreference.IMMEDIATE:s.ConditionalSectionLoadingPreference.DO_NOT_LOAD}return s.ConditionalSectionLoadingPreference.UNKNOWN},t.prototype.getSectionLoadingMode=function(e){return this.sectionToExtendedConditionalData&&this.sectionToExtendedConditionalData[e]?this.sectionToExtendedConditionalData[e].loadingMode:s.ConditionalSectionLoadingMode.UNKNOWN},t.prototype.getIsFileViewerOpen=function(){return this.isFileViewerOpen},t.prototype.canRenderAllHomeSections=function(){return this.sectionToExtendedConditionalData?i.values(this.sectionToExtendedConditionalData).every((function(e){return!e.isBlocking||(!!e.isPostTti||e.loadingMode!==s.ConditionalSectionLoadingMode.UNKNOWN)})):(this.role||d.reportStack("Called canRenderAllHomeSections before initialization",{severity:d.SEVERITY.NONCRITICAL}),!0)},t.prototype.setSectionVisibility=function(e){var t,i=e.section,o=e.visible;this.sectionVisibility[i]!==o&&(this.sectionVisibility=n.__assign(n.__assign({},this.sectionVisibility),((t={})[i]=o,t)))},t.prototype.setSectionLoadingMode=function(e,t){var i=this.getExtendedConditionalData(e);i&&(this.sectionToExtendedConditionalData[e]=n.__assign(n.__assign({},i),{loadingMode:t}))},t.prototype.getExtendedConditionalData=function(e){return this.sectionToExtendedConditionalData&&this.sectionToExtendedConditionalData[e]},t.prototype.onPrefetchReceivedData=function(e){var t=e.homePrefetchType;this.handledPrefetches.push(t),this.pendingPreTTIPrefetches&&(this.pendingPreTTIPrefetches=i.without(this.pendingPreTTIPrefetches,t),this.pendingPreTTIPrefetches.length||this.__emitChange())},t.prototype.onInitializeStore=function(e){var t=this,o=e.role,r=e.sectionVisibility,a=e.preTTIProps,u=e.sectionToConditionalData;this.role=o,this.sectionVisibility=r,this.user=l.Viewer.get_viewer().get_user_by_role(o),d.assert(!!this.user,"Could not find user for role "+o),this.preTTIProps=a||this.preTTIProps,this.pendingPreTTIPrefetches=i.without.apply(i,n.__spreadArrays([[s.HomePrefetchTypes.RECENTS_JSON].concat(i.compact(i.map(c.HOME_PREFETCH_TYPE_TO_INFO,(function(e,t){var n=e.section;if(u){var i=u[n];if(i&&!i.isPostTti)return t}return null}))))],this.handledPrefetches)),this.sectionToExtendedConditionalData=i.mapValues(u,(function(e,t){return n.__assign(n.__assign({},e),{loadingMode:s.ConditionalSectionLoadingMode.UNKNOWN,isBlocking:f(t)})})),Object.keys(this.sectionToDidLoadSynchronously).forEach((function(e){(0,t.sectionToDidLoadSynchronously[e])(t.getSectionLoadingPreference(e))&&t.setSectionLoadingMode(e,s.ConditionalSectionLoadingMode.SYNCHRONOUS)})),this.sectionToDidLoadSynchronously={}},t.prototype.onDeclareConditionalSection=function(e){var t=e.section,n=e.didInitializeSynchronously;this.sectionToExtendedConditionalData?d.reportStack("declared conditional section too late",{severity:d.SEVERITY.CRITICAL,exc_extra:{section:t}}):this.sectionToDidLoadSynchronously[t]?d.reportStack("Re-declared a conditional section",{severity:d.SEVERITY.CRITICAL,exc_extra:{section:t}}):this.sectionToDidLoadSynchronously[t]=n},t.prototype.onLoadedAsyncConditionalSection=function(e){var t=e.section,n=this.getExtendedConditionalData(t);n&&this.setSectionLoadingMode(t,n.isPostTti?s.ConditionalSectionLoadingMode.POST_TTI:s.ConditionalSectionLoadingMode.ASYNCHRONOUS_PRE_TTI),(this.sectionToPendingCallbacks[t]||[]).forEach((function(e){return e(!1)})),this.sectionToPendingCallbacks[t]=[]},t.prototype.onSetTabId=function(e){var t=e.activeTabId;this.activeTabId=t},t.prototype.__onDispatch=function(e){var t=e.action;switch(t.type){case s.HomeActionTypes.INITIALIZE_STORE:this.onInitializeStore(t.payload),this.__emitChange();break;case s.HomeActionTypes.SET_TAB_ID:this.onSetTabId(t.payload),this.__emitChange();break;case s.HomeActionTypes.HOME_PREFETCH_RECEIVED_DATA:this.onPrefetchReceivedData(t.payload);break;case s.HomeActionTypes.SET_SECTION_VISIBILITY:this.setSectionVisibility(t.payload),this.__emitChange();break;case s.HomeActionTypes.DECLARE_CONDITIONAL_SECTION:this.onDeclareConditionalSection(t.payload),this.__emitChange();break;case s.HomeActionTypes.LOADED_ASYNC_CONDITIONAL_SECTION:this.onLoadedAsyncConditionalSection(t.payload),this.__emitChange();break;case s.HomeActionTypes.OPEN_FILE_VIEWER:this.isFileViewerOpen=!0,this.__emitChange();break;case s.HomeActionTypes.CLOSE_FILE_VIEWER:this.isFileViewerOpen=!1,this.__emitChange()}},t})(r.FluxStore);t.PrivateHomeStoreClass=u;var m=null;function _(){return null===m&&(m=new u),m}function h(){return _().getUser()}t.getHomeStore=_,t.getUser=h,t.getUserId=function(){return h().id},t.getRole=function(){return h().role};var p=(function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t})(s.HomeSections);function E(e){return!!p[e]}function f(e){return E(e)}t.isHomeSection=E,t.isBlockingSection=f}));var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};define("modules/clean/react/home/util/conditional_api",["require","exports","modules/clean/react/home/store","modules/clean/react/home/constants"],(function(e,t,n,i){"use strict";function o(e,i,o,r,a){return void 0===i&&(i=!0),t.sectionToConditionalInterface[o]?e(t.sectionToConditionalInterface[o]):n.getHomeStore().executeWhenSectionIsReady(o,i,(function(n){if(n&&!t.sectionToConditionalInterface[o])try{t.sectionToConditionalInterface[o]=r()}catch(e){}return t.sectionToConditionalInterface[o]?e(t.sectionToConditionalInterface[o]):(i&&a().then((function(n){t.sectionToConditionalInterface[o]=n,e(n)})),null)}))}Object.defineProperty(t,"__esModule",{value:!0}),t.sectionToConditionalInterface={},t.waitForSection=o,t.waitForStarred=function(t,n){return void 0===n&&(n=!0),o(t,n,i.HomeSections.STARRED,(function(){return e("modules/clean/react/home/starred/conditional_interface")}),(function(){return new Promise((function(t,n){e(["modules/clean/react/home/starred/conditional_interface"],t,n)})).then(__importStar)}))}})),define("modules/clean/react/home/util/conditional_components",["require","exports","tslib","react","modules/clean/react/home/constants","modules/clean/react/home/util/conditional","modules/clean/react/home/starred/starred_empty_layout","modules/clean/react/home/content_suggestions/loading","modules/clean/react/home/post_tti/api","modules/clean/react/css"],(function(e,t,n,i,o,r,a,s,c,l){"use strict";function d(e){return e&&{componentClass:e.StarredView,initPrefetch:e.getStarredResourceStore}}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.ConditionalStarredView=r.homeConditionalSection({section:o.HomeSections.STARRED,syncLoader:function(){return d(e("modules/clean/react/home/starred/conditional_interface"))},asyncLoader:function(){return new Promise((function(t,n){e(["modules/clean/react/home/starred/conditional_interface"],t,n)})).then(n.__importStar).then((function(e){return d(e)}))},loading:function(e){return i.default.createElement(a.StarredEmptyLayout,n.__assign({},e))}}),t.ConditionalSuggestView=r.homeConditionalSection({section:o.HomeSections.SUGGEST,syncLoader:function(){return null},asyncLoader:function(){return n.__awaiter(void 0,void 0,void 0,(function(){var e,t;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,c.waitForHomeTTI()];case 1:return e=n.sent(),t=e.initPrefetch,[2,{componentClass:e.HomeSuggest,initPrefetch:t}]}}))}))},loading:function(e){return i.default.createElement(s.SuggestedLoading,n.__assign({},e))}}),t.ConditionalTeamsView=r.homeConditionalSection({section:o.HomeSections.TEAMS,syncLoader:function(){return null},asyncLoader:function(){return n.__awaiter(void 0,void 0,void 0,(function(){var e,t,i;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,c.waitForHomeTTI()];case 1:return e=n.sent(),t=e.initPrefetchHomeTeams,i=e.HomeTeams,[2,{componentClass:l.requireCssWithComponent(i,["/static/css/home_access/teams-vflm84Tvv.css"]),initPrefetch:t}]}}))}))},loading:function(e){return null}}),t.ConditionalHomeInlineContentPromptView=r.homeConditionalSection({section:o.HomeSections.PROMPT,syncLoader:function(){return null},asyncLoader:function(){return n.__awaiter(void 0,void 0,void 0,(function(){var e,t,i;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,c.waitForHomeTTI()];case 1:return e=n.sent(),t=e.initPrefetchHomeInlineContentPrompt,i=e.HomeInlineContentPrompt,[2,{componentClass:l.requireCssWithComponent(i,["/static/css/upsell/home_inline_content-vfl8mrNRC.css"]),initPrefetch:t}]}}))}))},loading:function(e){return null}}),t.ConditionalRecommendedMembersView=r.homeConditionalSection({section:o.HomeSections.RECOMMENDED_MEMBERS,syncLoader:function(){return null},asyncLoader:function(){return n.__awaiter(void 0,void 0,void 0,(function(){var e,t,i;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,c.waitForHomeTTI()];case 1:return e=n.sent(),t=e.initPrefetchRecommendedMembers,i=e.RecommendedMembers,[2,{componentClass:l.requireCssWithComponent(i,["/static/css/team_success/home_recommended_members/recommended_members-vflqNxhO5.css"]),initPrefetch:t}]}}))}))},loading:function(e){return null}})})),define("modules/clean/react/home/util/conditional",["require","exports","tslib","react","modules/clean/react/async/loadable","modules/clean/react/home/post_tti/api","modules/clean/react/home/store","modules/clean/react/home/constants","modules/clean/react/home/util/logging/timing_logger","modules/core/exception","modules/clean/flux/dispatcher"],(function(e,t,n,i,o,r,a,s,c,l,d){"use strict";function u(e){return e?(e.initPrefetch(),e.componentClass):null}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.IS_PROD=!0,t.homeConditionalSection=function(e){var m=this,_=e.section,h=e.syncLoader,p=e.asyncLoader,E=e.loading,f=null,T=s.ConditionalSectionLoadingPreference.UNKNOWN;return a.getHomeStore(),d.Dispatcher.dispatch({type:s.HomeActionTypes.DECLARE_CONDITIONAL_SECTION,payload:{section:_,didInitializeSynchronously:function(e){if(T=e,e===s.ConditionalSectionLoadingPreference.UNKNOWN)return!1;if(e===s.ConditionalSectionLoadingPreference.DO_NOT_LOAD)return a.isHomeSection(_)&&c.homeTimingLogger.logSkippedSection(_),!1;var t=e===s.ConditionalSectionLoadingPreference.POST_TTI;if(t)a.isHomeSection(_)&&c.homeTimingLogger.logSkippedSection(_);else{try{f=u(h())}catch(e){}if(f)return!0}var l=!t&&a.isBlockingSection(_),g=function(){return n.__awaiter(m,void 0,void 0,(function(){var e,i;return n.__generator(this,(function(n){switch(n.label){case 0:return t?[4,r.waitForHomeTTI()]:[3,2];case 1:n.sent(),n.label=2;case 2:return i=u,[4,p()];case 3:return e=i.apply(void 0,[n.sent()]),l&&(f=e),d.Dispatcher.dispatch({type:s.HomeActionTypes.LOADED_ASYNC_CONDITIONAL_SECTION,payload:{section:_}}),[2,e]}}))}))};if(l)g();else{var I=E;f=o.Loadable({loader:g,loading:I?function(e){return e.canRenderItems?"function"==typeof I?i.default.createElement(I,n.__assign({},e)):I:null}:void 0})}return!1}}}),function(e){return(T===s.ConditionalSectionLoadingPreference.UNKNOWN||!f&&T===s.ConditionalSectionLoadingPreference.IMMEDIATE&&a.isBlockingSection(_)&&t.IS_PROD)&&l.reportStack("Premature render",{severity:l.SEVERITY.CRITICAL,exc_extra:{section:_,loadingPreference:T,isBlockingSection:a.isBlockingSection(_)}}),f?i.default.createElement(f,n.__assign({},e)):null}}})),define("modules/clean/react/home/util/empty",["require","exports","tslib","react","dig-components/typography","modules/core/i18n"],(function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.SectionEmptyText=function(e){var t=e.message,n=e.learnMoreLink;return i.default.createElement(o.Text,{color:"faint",className:"home-access-section__empty",tagName:"p"},t," ",i.default.createElement(o.Link,{href:n,variant:"primary",hasNoUnderline:!0,target:"_blank",rel:"noopener noreferrer"},r.intl.formatMessage({id:"gk12sS",defaultMessage:"Learn more"})))}})),define("modules/clean/react/home/util/logging/activity_logger",["require","exports","modules/clean/react/home/api","modules/clean/react/home/store","modules/clean/react/home/constants"],(function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(){}return e.prototype.logClickShowAll=function(e,t){return n.logHomeActivity({eventName:o.LoggingTypes.CLICK_SHOW_ALL,role:i.getHomeStore().getRole(),extra:{component_name:e,should_show_all:t}})},e.prototype.logHomePageShown=function(){return n.logHomeActivity({eventName:o.LoggingTypes.HOME_PAGE_SHOWN,role:i.getHomeStore().getRole(),extra:{url:a()}})},e.prototype.logStarredShown=function(e,t,r){return n.logHomeActivity({eventName:o.LoggingTypes.STARRED_SHOWN,role:i.getHomeStore().getRole(),extra:{num_items:e,is_hidden:!1,has_hidden_rows:t,has_more:r,url:a()}})},e.prototype.logRecentsShown=function(e,t){return n.logHomeActivity({eventName:o.LoggingTypes.RECENTS_SHOWN,role:i.getHomeStore().getRole(),extra:{num_items:e,is_hidden:t,url:a()}})},e.prototype.logShowHideSection=function(e,t){return n.logHomeActivity({eventName:t?o.LoggingTypes.HIDE_SECTION:o.LoggingTypes.UNHIDE_SECTION,role:i.getHomeStore().getRole(),extra:{section_name:e}})},e.prototype.logRecentsAction=function(e,t,r,a,s,c,l,d,u){var m={action_taken:e,scope:t,display_type:s,is_dir:c,item_number:r,sprite:a,subgroup_position:l};return d&&u&&(m.id_type=d,m.resource_id=u),n.logHomeActivity({eventName:o.LoggingTypes.RECENTS_ITEM_ACTION,role:i.getHomeStore().getRole(),extra:m})},e.prototype.logOpenStarredItem=function(e,t,r){return n.logHomeActivity({eventName:o.LoggingTypes.OPEN_STARRED_ITEM,role:i.getHomeStore().getRole(),extra:{resource_id:e,resource_type:t,position:r}})},e.prototype.logUndoUnstarItem=function(e,t,r){return n.logHomeActivity({eventName:o.LoggingTypes.UNDO_UNSTAR_ITEM,role:i.getHomeStore().getRole(),extra:{resource_id:e,resource_type:t,position:r}})},e.prototype.logClickStarOverflowShare=function(e,t,r){return n.logHomeActivity({eventName:o.LoggingTypes.CLICK_STAR_OVERFLOW_SHARE,role:i.getHomeStore().getRole(),extra:{resource_id:e,resource_type:t,position:r}})},e.prototype.logClickRightMenu=function(e,t){var o=t?{modalSessionId:t}:{};return n.logHomeActivity({eventName:e,role:i.getHomeStore().getRole(),extra:o})},e.prototype.logCreateNewFile=function(e){return n.logHomeActivity({eventName:e,role:i.getHomeStore().getRole()})},e})();function a(){return-1!==location.host.indexOf("dropbox.com")?location.pathname:"unknown"}t.HomeActivityLogger=r,t.homeActivityLogger=new r})),define("modules/clean/react/home/util/logging/availability_logger_common",["require","exports","modules/clean/react/home/constants"],(function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0});var o=[n.ConditionalSectionLoadingPreference.IMMEDIATE,n.ConditionalSectionLoadingPreference.POST_TTI];t.HOME_PREFETCH_TYPE_TO_INFO=((i={})[n.HomePrefetchTypes.RETRIEVE_STARRED]={fragment:"retrieve_starred",handle:"__REGISTER_RETRIEVE_STARRED_PRELOAD_HANDLER",section:n.HomeSections.STARRED,conditionalSection:n.HomeSections.STARRED},i[n.HomePrefetchTypes.RECENTS_JSON]={fragment:"recents/json",handle:"__REGISTER_RECENTS_PRELOAD_HANDLER",section:n.HomeSections.RECENTS,conditionalSection:n.HomeSections.RECENTS},i[n.HomePrefetchTypes.RETRIEVE_PAPER_RECENTS]={fragment:"retrieve_paper_recents",handle:"__REGISTER_PAPER_RECENTS_PRELOAD_HANDLER",section:n.HomeSections.RECENTS,conditionalSection:n.ConditionalSections.PAPER_RECENTS},i[n.HomePrefetchTypes.GET_SUGGESTED]={fragment:"get_suggested",handle:"__REGISTER_SUGGEST_GRID_PRELOAD_HANDLER",section:n.HomeSections.SUGGEST,conditionalSection:n.HomeSections.SUGGEST,isOptional:!0},i),t.isPendingPrefetch=function(e,t){var n=t.success,i=t.info;return void 0===n&&(!i.isOptional||o.indexOf(e.getSectionLoadingPreference(i.conditionalSection))>=0)},t.withHomePrefix=function(e){return"home_"+e}})),define("modules/clean/react/home/util/logging/availability_logger",["require","exports","tslib","external/lodash","modules/clean/flux/dispatcher","modules/clean/react/home/constants","modules/clean/web_timing_logger","modules/clean/react/home/store","modules/core/exception","modules/clean/react/home/util/prefetch_handler","modules/clean/react/home/util/logging/availability_logger_common","modules/clean/react/home/post_tti/api"],(function(e,t,n,i,o,r,a,s,c,l,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var m=(function(){function e(){this.didLog=!1,this.sectionToTTData={},this.sectionToTTI={},this.sectionToIsSkipped={},this.typeToExecutionData=i.mapValues(d.HOME_PREFETCH_TYPE_TO_INFO,(function(e){return{info:e,homeTiming:{}}}))}return e.prototype.logPrefetch=function(e,t){var n=this.typeToExecutionData[e];if(void 0===n.success){var i={type:r.HomeActionTypes.HOME_PREFETCH_RECEIVED_DATA,payload:{homePrefetchType:e}};n.homeTiming.asynchronous?o.Dispatcher.dispatch(i):s.getHomeStore().__onDispatch({action:i}),n.success=t,this.pendingPrefetchesCount&&this.pendingPrefetchesCount--,this.logIfPossible()}},e.prototype.logIfPossible=function(){var e=this;!this.didLog&&void 0!==this.pendingPrefetchesCount&&this.pendingPrefetchesCount<=0&&(u.waitForHomeTTI().then((function(t){return(0,t.logHomeAvailability)({typeToExecutionData:e.typeToExecutionData,sectionToTTData:e.sectionToTTData,sectionToTTI:e.sectionToTTI,sectionToIsSkipped:e.sectionToIsSkipped})})),this.didLog=!0)},e.prototype.logTTData=function(e){this.sectionToTTData.hasOwnProperty(e)||(this.sectionToTTData[e]=a.time_since_start(),this.logIfPossible())},e.prototype.logTTI=function(e,t,n){var o=this;if(!this.sectionToTTI.hasOwnProperty(e)&&(this.sectionToTTI[e]=a.time_since_start(),this.sectionToIsSkipped[e]=Number(t),n)){this.pendingPrefetchesCount=0;var r=s.getHomeStore();i.map(this.typeToExecutionData,(function(e){d.isPendingPrefetch(r,e)&&o.pendingPrefetchesCount++})),this.logIfPossible()}},e.prototype.handlePrefetch=function(e,t){var n=this,i=d.HOME_PREFETCH_TYPE_TO_INFO[e],o=i.handle,a=i.conditionalSection,c=function(){return n.handlePrefetchImpl(e,o,t)};s.getHomeStore().getSectionLoadingPreference(a)===r.ConditionalSectionLoadingPreference.POST_TTI?u.waitForHomeTTI().then(c):c()},e.prototype.handlePrefetchImpl=function(e,t,n){var o=this,r=l.getPrefetchHandler(t),s=this.typeToExecutionData[e],d=s.homeTiming,u=s.didInvoke,m=function(t){c.reportStack("prefetch for "+e+" failed",{severity:c.SEVERITY.CRITICAL,exc_extra:{error:t,type:e}}),o.logPrefetch(e,!1)};if(r){if(!u){s.didInvoke=!0,d.register_prefetch_callback=a.time_since_start();d.asynchronous=l.handlePrefetch(r,(function(t){try{d.json_parse_start=a.time_since_start();var r=JSON.parse(t);d.json_parse_end=a.time_since_start(),d.json_string_size=16*t.length,i.isEqual(r,{})?m("payload is {}"):(o.logPrefetch(e,!0),d.payload_processing_start=a.time_since_start(),n(r),d.payload_processing_end=a.time_since_start())}catch(e){m(e)}}),m)?0:1}}else m("no prefetch handler")},e})();t.HomeAvailabilityLogger=m;var _=null;t.getHomeAvailabilityLogger=function(){return _=_||new m}})),define("modules/clean/react/home/util/logging/timing_component",["require","exports","tslib","react","modules/clean/react/home/util/logging/timing_logger"],(function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.timingComponent=function(e,t){return(function(r){function a(){return null!==r&&r.apply(this,arguments)||this}return n.__extends(a,r),a.prototype.logTTIIfCanRenderItems=function(){return this.props.canRenderItems&&o.homeTimingLogger.logTTI(t)},a.prototype.componentDidMount=function(){var e=this;this.logTTIIfCanRenderItems();var t=this.refs.wrapped,n=t.componentDidUpdate;t.componentDidUpdate=function(){e.logTTIIfCanRenderItems(),n&&n.call(t)}},a.prototype.render=function(){return i.default.createElement(e,n.__assign({ref:"wrapped"},this.props))},a})(i.default.PureComponent)}})),define("modules/clean/react/home/util/logging/timing_logger",["require","exports","tslib","modules/clean/js_client_stopwatch","external/lodash","modules/clean/web_timing_logger","modules/clean/react/home/util/logging/timing_state","modules/clean/react/home/util/logging/activity_logger","modules/core/exception","modules/clean/react/home/util/logging/availability_logger","modules/clean/react/home/util/logging/availability_logger_common"],(function(e,t,n,i,o,r,a,s,c,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),r=n.__importStar(r);var u=o.once(s.homeActivityLogger.logHomePageShown),m=(function(){function e(){this.timingStates=new a.HomeTimingStates,this.activate=o.once((function(){return i.JSStopwatch.create_stopwatch_if_not_exist("home_access_tti")}))}return e.prototype.validateActivated=function(e,t){return!!i.JSStopwatch.stopwatch_exists("home_access_tti")||(c.reportStack("Did not activate when "+e+" before logging "+t,{severity:c.SEVERITY.NONCRITICAL}),!1)},e.prototype.logTTData=function(e){if(this.validateActivated(e,a.HomeTimingState.TTDATA)&&this.timingStates.progressState(e,a.HomeTimingState.TTDATA))return this.timingStates.haveAllSectionsReachedState(a.HomeTimingState.TTDATA)&&r.log_js_modules_fetched_data_required_for_tti(),l.getHomeAvailabilityLogger().logTTData(e),!0;return!1},e.prototype.logSkippedSection=function(e){this.activate(),this.logTTData(e),this.logTTI(e,!0)},e.prototype.logTTI=function(e,t){if((void 0===t&&(t=!1),this.validateActivated(e,a.HomeTimingState.TTI))&&this.timingStates.progressState(e,a.HomeTimingState.TTI)){u(),i.JSStopwatch.recordTrace(d.withHomePrefix(e),{stopwatchName:"home_access_tti"});var n=this.timingStates.haveAllSectionsReachedState(a.HomeTimingState.TTI);return n&&(r.mark_time_to_interactive(),i.JSStopwatch.flush_current_data()),l.getHomeAvailabilityLogger().logTTI(e,t,n),!0}return!1},e})();t._HomeTimingLogger=m,t.homeTimingLogger=new m})),define("modules/clean/react/home/util/logging/timing_state",["require","exports","tslib","external/lodash","modules/clean/react/home/constants"],(function(e,t,n,i,o){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),(function(e){e[e.INIT=0]="INIT",e[e.TTDATA=1]="TTDATA",e[e.TTI=2]="TTI"})(r=t.HomeTimingState||(t.HomeTimingState={}));var a=(function(){function e(){var e=this;this.homeSectionToState={},i.values(o.HomeSections).forEach((function(t){return e.homeSectionToState[t]=r.INIT}))}return e.prototype.progressState=function(e,t){return this.homeSectionToState[e]+1===t&&(this.homeSectionToState[e]=t,!0)},e.prototype.haveAllSectionsReachedState=function(e){return i.every(this.homeSectionToState,(function(t){return t>=e}))},e})();t.HomeTimingStates=a})),define("modules/clean/react/home/util/post_tti_components",["require","exports","tslib","react","modules/clean/react/home/post_tti/api","modules/clean/react/home/recents/components/pending_attachment_list_view"],(function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),t.PostTTIRecentActivityImageAttachments=o.PostHomeTTIComponent({displayName:"PostTTIRecentActivityImageAttachments",preTTIRenderer:function(e){var t=e.attachments;return i.createElement(r.PendingAttachmentListView,{count:t.length})},getPostTTIRenderer:function(e){var t=e.AttachmentListView,n=e.Dimensions;return function(e){var o=e.attachments;return i.createElement(n,{className:"recents-item__attachments"},(function(e){var n=e.width;return i.createElement(t,{attachments:o,width:n})}))}}}),t.PostTTIRecentsActivityFileActions=o.PostHomeTTIComponent({displayName:"PostTTIRecentsActivityFileActions",getPostTTIRenderer:function(e){var t=e.RecentActivityFileActionPost;return function(e){var n=e.recentItem,o=e.attachments;return i.createElement(t,{recentItem:n,attachments:o})}}}),t.PostTTIStarredItemFileActions=o.PostHomeTTIComponent({displayName:"PostTTIStarredItemFileActions",getPostTTIRenderer:function(e){var t=e.StarredItemFileActionPost;return function(e){var n=e.starredItem,o=e.user;return i.createElement(t,{starredItem:n,user:o})}}})})),define("modules/clean/react/home/util/prefetch_handler",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPrefetchHandler=function(e){return window[e]},t.handlePrefetch=function(e,t,n){var i=e.getDataIfAvailable();if(i){var o=i.error,r=i.payload;o?n(o):t(r)}else e(t,n);return Boolean(i)}})),define("modules/clean/react/home/util/resource_icon",["require","exports","tslib","react","spectrum/file_icon","spectrum/icon_content","modules/clean/filetypes","modules/clean/react/async/loadable","modules/clean/react/home/constants","modules/clean/react/icon/folder_icon","modules/clean/web_timing_logger"],(function(e,t,n,i,o,r,a,s,c,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i);var u=s.Loadable({loader:function(){return n.__awaiter(void 0,void 0,void 0,(function(){return n.__generator(this,(function(t){switch(t.label){case 0:return[4,d.waitForTTI()];case 1:return t.sent(),[4,new Promise((function(t,n){e(["modules/clean/react/icon/shortcuts_icon"],t,n)})).then(n.__importStar)];case 2:return[2,t.sent().ShortcutsFileIcon]}}))}))}}),m=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.renderIcon=function(){var e=this.props,t=e.displayType,n=e.shortcutUrlForIcon,s=e.icon,d=e.isLarge,m=l.getDigIcon(s);if(m)return m;if(c.DisplayTypeToResourceType[t]===c.FILE_RESOURCE_TYPE){if(n){var _={type:a.FileTypes.FILE,icon:"dlink"};return i.default.createElement(u,{file:_,shortcutUrlForIcon:n,variant:d?"large":"small"})}return i.default.createElement(o.FileIcon,{path:this.props.fileName,variant:d?"large":"small"})}var h=c.DisplayTypeToIconName[t]||c.DisplayTypeToIconName.FOLDER;return d&&(h=h.replace("small","large")),i.default.createElement(r.IconContent,{name:h})},t.prototype.render=function(){return i.default.createElement("span",{className:this.props.className},this.renderIcon())},t.displayName="HomeResourceIcon",t})(i.default.PureComponent);t.HomeResourceIcon=m})),define("modules/clean/react/home/util/show_hide_link",["require","exports","tslib","react","dig-components/buttons","dig-components/icons","dig-components/icons/src","modules/core/i18n"],(function(e,t,n,i,o,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.ShowHideLink=function(e){var t=e.onClick,n=e.isExpanded,c=e.hiddenItemCount,l=e.canLoadMore,d=s.intl.formatMessage({id:"s+pc7h",defaultMessage:"Show {number} more"},{number:c});return n?d=s.intl.formatMessage({id:"EFRGA8",defaultMessage:"Collapse section"}):c<=0?d=s.intl.formatMessage({id:"JZEdSO",defaultMessage:"Show more"}):l&&(d=s.intl.formatMessage({id:"w9jP5U",defaultMessage:"Show {number}+ more"},{number:c})),i.default.createElement("div",{className:"show-hide-link__container"},i.default.createElement(o.Button,{onClick:t,variant:"transparent",hasNoUnderline:!0,withIconLeft:i.default.createElement(r.UIIcon,{src:n?a.ChevronUpLine:a.ChevronDownLine})},d))}})),define("modules/clean/react/starred/constants",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StarredLoadingState={LOADING:"LOADING",LOAD_SUCCESS:"LOAD_SUCCESS",LOAD_FAILED:"LOAD_FAILED"},t.StarredActionTypes={LOADING:"STARRED_LOADING",SET_STATUS:"STARRED_SET_STATUS",LOAD_FAILURE:"STARRED_LOAD_FAILURE"},t.IdTypes={ENCODED_FILE_OBJ_ID:"ENCODED_FILE_OBJ_ID",EXTERNAL_RESOURCE_ID:"EXTERNAL_RESOURCE_ID",PAPER_ID_PATH:"PAPER_ID_PATH",FQ_PATH:"FQ_PATH"},(function(e){e.HOME_STARRED="HOME_STARRED",e.HOME_RECENTS="HOME_RECENTS",e.BROWSE="BROWSE",e.FILE_VIEWER="FILE_VIEWER",e.SUGGESTED_STARS="SUGGESTED_STARS",e.HOME_TASKS="HOME_TASKS"})(t.StarredSource||(t.StarredSource={}))})),define("modules/clean/react/starred/id_type_pair",["require","exports","modules/clean/react/home/resource_id_types"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.idTypePairToString=function(e){return e.type+":"+e.id},t.idTypePairFromStarrableItem=function(e){return(function(e){return!!e.file_id})(e)?{id:e.file_id,type:n.HOME_RESOURCE_ID_TYPE.ENCODED_FILE_OBJ_ID}:(function(e){return!!e.pad_id})(e)?{id:e.pad_id,type:n.HOME_RESOURCE_ID_TYPE.PAPER_DOCUMENT_ID}:(function(e){return!!e.folder_id})(e)?{id:e.folder_id,type:n.HOME_RESOURCE_ID_TYPE.PAPER_FOLDER_ID}:(function(e){return!!e.fq_path})(e)?{id:e.fq_path,type:n.HOME_RESOURCE_ID_TYPE.FQ_PATH}:e}}));
//# sourceMappingURL=pkg-home.min.js-vfl_Ln6xu.map