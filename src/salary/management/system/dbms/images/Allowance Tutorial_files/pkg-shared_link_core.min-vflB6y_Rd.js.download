define("modules/clean/react/file_viewer/ml_experiment",["require","exports","modules/clean/api_v2/user_client"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ML_EXPERIMENT_TYPES={contract:"CONTRACT",esign:"ESIGN",control:"CONTROL",file:"FILE"},t.ML_ENDPOINT_FETCH_TYPES=["CONTRACT","ESIGN"],t.ML_EXPERIMENT_EXTENSIONS=["pdf","docx"],t.fetchDocClassification=function(e,t){var r={file_id:t};return(new n.UserApiV2Client).ns("hellosign").rpc("get_classification",r,{subjectUserId:e})}})),define("modules/clean/react/comments2/data/store",["require","exports","tslib","external/lodash","modules/clean/redux/namespaces","modules/clean/react/comments2/data/reducer","modules/clean/redux/store"],(function(e,t,n,r,a,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importStar(r),t.getStoreForComments2=r.once((function(){var e;return s.getStoreAndRegisterReducers(((e={})[a.COMMENTS2_NAMESPACE_KEY]=i.reducer,e))}))})),define("modules/clean/react/file_sidebar/store/instance",["require","exports","tslib","redux","modules/clean/react/file_sidebar/store/app/reducer","modules/clean/react/file_sidebar/store/file_activity/reducer","modules/clean/react/file_sidebar/store/sidebar/reducer","modules/clean/react/file_sidebar/store/middleware/thunk","modules/clean/react/file_sidebar/store/middleware/reactor","modules/clean/react/file_sidebar/store/sidebar/reactors","modules/clean/redux/unsupported","modules/clean/redux/devtools"],(function(e,t,n,r,a,i,s,o,c,u,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=(r=n.__importStar(r)).combineReducers({app:a.reducer,fileActivity:i.reducer,sidebar:s.reducer});function m(e,t){return"::RESET"===t.type&&(e=void 0),_(e,t)}t.store=l.createStore(m,d.composeEnhancersWithDevTools(r.applyMiddleware(o.thunk(),c.reactor(u.reactors))))})),define("modules/clean/react/file_sidebar/store/sidebar/actions",["require","exports","tslib","modules/clean/react/file_sidebar/store/file_activity/selectors","modules/clean/react/file_sidebar/store/sidebar/helpers","modules/clean/react/file_sidebar/store/sidebar/selectors","modules/clean/react/file_sidebar/file_sidebar_logger","modules/clean/react/file_sidebar/store/sidebar/types","file-viewer/core"],(function(e,t,n,r,a,i,s,o,c){"use strict";function u(e){return function(t,n){t({type:o.ActionType.SidebarOpen,payload:{reason:e}})}}function l(){return function(e,t){var n=t(),a=i.getSidebarContext(n).user;i.getSidebarState(n).open&&(e({type:o.ActionType.SidebarClose}),s.logSidebarClosed({num_comments:i.getTabState(n,"comments").extra.commentCount,num_events:r.getVisibleActivityCount(n),viewing_user_id:a?a.id:null}))}}function d(){return{type:o.ActionType.SidebarIndicateNewFileNav}}Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importStar(r),a=n.__importStar(a),i=n.__importStar(i),t.reset=function(){return{type:o.ActionType.SidebarReset}},t.open=u,t.close=l,t.toggle=function(){return function(e,t){var n=t();i.getSidebarState(n).open?e(l()):e(u("toggle_button"))}},t.completeToggleOpen=function(){return function(e){e(u("toggle_button_after_transition"))}},t.selectTab=function(e){return{type:o.ActionType.SidebarSelectTab,payload:{tabName:e}}},t.thirdpartyBlueDotOnboard=function(){return{type:o.ActionType.SidebarSetThirdPartyBlueDotOnboardState}},t.openFile=function(e){return function(t,n){var r=n(),s=i.getSidebarContext(r);a.isContextChanged(s,e)&&(t({type:o.ActionType.SidebarOpenFile,payload:e}),t(d()))}},t.setComments2DisabledState=function(){return{type:o.ActionType.SidebarSetComments2DisabledState}},t.setComments2ShownState=function(e){return{type:o.ActionType.SidebarSetComments2ShownState,payload:e}},t.setCommentingOnNewFile=d,t.OverrideInitialState=function(e){var t=e===c.FileViewerMode.Documentation?"metadata":"comments";return{type:o.ActionType.SidebarOverrideInitialState,payload:{open:!0,tab:t}}}})),define("modules/clean/react/comments2/data/reducer",["require","exports","tslib","external/lodash","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/initial_state","modules/clean/react/comments2/data/util","modules/clean/react/comments2/data/reducer_helper","modules/clean/react/comments2/data/types","comments2/transforms","modules/clean/react/file_metadata/data/type_guards","modules/clean/react/comments2/video_annotations/annotation_helper"],(function(e,t,n,r,a,i,s,o,c,u,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importStar(r),u=n.__importStar(u);var _=o.createStatusReducer(a.ActionTypes),m=o.createActionReducer(),p=o.createReducerFrom(m(a.ActionTypes.SetContext,(function(e,t){return t?n.__assign(n.__assign({},t),{status:c.Comments2ContextStatus.Pending}):void 0})),m(a.ActionTypes.SetContextStatus,(function(e,t){return n.__assign(n.__assign({},e),{status:t})})));function g(e,t,n){return e.map((function(e){return e.id===t?n(e):e}))}function f(e,t,a){var i=e.threads[t];return i?(function(e,t){var r;return n.__assign(n.__assign({},e),{threads:n.__assign(n.__assign({},e.threads),(r={},r[t.id]=t,r))})})(e,r.assignIn({},i,a)):e}function v(e,t,r,a){var i,s=t.threads[r];return s?f(t,r,s.pending?n.__assign(n.__assign({},s),((i={})[a]=s.pending.originalValue,i.pending=n.__assign(n.__assign({},s.pending),{error:e}),i)):s):t}function h(e,t,n,r){var a=e.threads[n];return a?f(e,n,{comments:g(a.comments,t,r)}):e}function S(e,t,r,a,i){return h(t,r,a,(function(t){var r;return t.pending?n.__assign(n.__assign({},t),((r={})[i]=t.pending.originalValue,r.pending=n.__assign(n.__assign({},t.pending),{error:e}),r)):t}))}var b=o.createActionReducer(),w=o.createReducerFrom(b(a.ActionTypes.ActivateThread,(function(e,t){var r=t.thread,a=t.pendingAnnotationInfo,i=t.wasPreviewLayerClick;return n.__assign(n.__assign({},e),{activatedThreadId:r.id,documentRectangleToMakeVisible:i?void 0:s.documentRectangleFromThread(r),pendingAnnotationInfo:a||e.pendingAnnotationInfo})})),b(a.ActionTypes.DeactivateAllThreads,(function(e){return r.assignIn({},e,{activatedThreadId:void 0,activatedDocumentAnnotationRectangle:void 0})})),b(a.ActionTypes.ListComments,{Success:function(e,t,r){var a=n.__assign(n.__assign({},e.authors),u.usersToIUserMap(t.authors)),i=n.__assign(n.__assign({},e.threads),u.threadsToIThreadMap(t.threads,a,t.currentRevision));return n.__assign(n.__assign({},e),{threads:i,authors:a,cursor:t.cursor,listCommentsError:void 0})},Error:function(e,t,r){return n.__assign(n.__assign({},e),{listCommentsError:t})}}),b(a.ActionTypes.CreateThread,{Request:function(e,t,r){var i,o=new Date,c=r.annotation,u=r.author,l=r.content,d=r.guid,_={id:d,timestamp:o,read:!0,readonly:!0,isThirdParty:!1,resolved:!1,comments:[{id:d,threadId:d,timestamp:o,author:u,content:l,revisionInfo:{isCurrent:!0},userPermissions:{canDelete:!1,canEdit:!1}}],annotation:c},m=n.__assign(n.__assign({},_),{pending:{action:a.ActionTypes.CreateThread.name,originalValue:void 0,pendingValue:_}}),p=e.pendingAnnotationInfo.annotationMayBeOffscreen?s.documentRectangleFromThread(_):void 0;return n.__assign(n.__assign({},e),{activatedThreadId:d,documentRectangleToMakeVisible:p,threads:n.__assign(n.__assign({},e.threads),(i={},i[d]=m,i))})},Success:function(e,t,r){var a,i=r.guid,s=e.threads,o=i,c=s[o],u=n.__rest(s,["symbol"==typeof o?o:o+""]),l=g(c.comments,i,(function(e){return n.__assign(n.__assign({},e),{id:t.id,userPermissions:{canDelete:!0,canEdit:!(e.content.metadata[0]&&"sticker"===e.content.metadata[0].type)},readonly:!1})}));return n.__assign(n.__assign({},e),{activatedThreadId:e.activatedThreadId===r.guid?t.id:e.activatedThreadId,threads:n.__assign(n.__assign({},u),(a={},a[t.id]=n.__assign(n.__assign({},c),{id:t.id,comments:l,pending:void 0}),a))})},Error:function(e,t,r){var a=e.threads,i=r.guid,s=(a[i],n.__rest(a,["symbol"==typeof i?i:i+""]));return n.__assign(n.__assign({},e),{threads:s})}}),b(a.ActionTypes.ReplyToThread,{Request:function(e,t,r){var i,s=new Date,o=r.author,c=r.content,u=r.guid,l=r.threadId,d={id:u,threadId:l,timestamp:s,author:o,content:c,revisionInfo:{isCurrent:!0},userPermissions:{canDelete:!1,canEdit:!1}},_=e.threads[l],m=n.__assign(n.__assign({},_),{read:!0,comments:n.__spreadArrays(_.comments,[d])}),p=n.__assign(n.__assign({},m),{pending:{action:a.ActionTypes.ReplyToThread.name,originalValue:_,pendingValue:m}});return n.__assign(n.__assign({},e),{activatedThreadId:l,threads:n.__assign(n.__assign({},e.threads),(i={},i[l]=p,i))})},Success:function(e,t,r){var a,i=r.guid,s=r.threadId,o=e.threads[s],c=g(o.comments,i,(function(e){return n.__assign(n.__assign({},e),{id:t.id,userPermissions:{canDelete:!0,canEdit:!(e.content.metadata[0]&&"sticker"===e.content.metadata[0].type)}})}));return n.__assign(n.__assign({},e),{threads:n.__assign(n.__assign({},e.threads),(a={},a[s]=n.__assign(n.__assign({},o),{comments:c,pending:void 0}),a))})},Error:function(e,t,r){var a,i=e.threads[r.threadId],s=i.comments.filter((function(e){return e.id!==r.guid}));return n.__assign(n.__assign({},e),{threads:n.__assign(n.__assign({},e.threads),(a={},a[r.threadId]=n.__assign(n.__assign({},i),{comments:s,pending:void 0}),a))})}}),b(a.ActionTypes.DeleteComment,{Request:function(e,t,r){return h(e,r.commentId,r.threadId,(function(e){return n.__assign(n.__assign({},e),{deleted:!0,pending:{action:a.ActionTypes.DeleteComment.name,originalValue:e.deleted,pendingValue:!0}})}))},Success:function(e,t,r){return h(e,r.commentId,r.threadId,(function(e){return n.__assign(n.__assign({},e),{pending:void 0})}))},Error:function(e,t,n){return S(t,e,n.commentId,n.threadId,"deleted")}}),b(a.ActionTypes.EditComment,{Request:function(e,t,r){return h(e,r.commentId,r.threadId,(function(e){return n.__assign(n.__assign({},e),{content:r.content,pending:{action:a.ActionTypes.EditComment.name,originalValue:e.content,pendingValue:r.content}})}))},Success:function(e,t,r){return h(e,r.commentId,r.threadId,(function(e){return n.__assign(n.__assign({},e),{pending:void 0})}))},Error:function(e,t,n){return S(t,e,n.commentId,n.threadId,"content")}}),b(a.ActionTypes.SetPerfData,(function(e,t){return n.__assign(n.__assign({},e),{perfEvents:n.__assign(n.__assign({},e.perfEvents),t)})})),b(a.ActionTypes.CheckOnboardingStatus,(function(e,t){return n.__assign(n.__assign({},e),{onboardingVariants:{premium_av_comments_pane_surface:!1===t.premium_av_comments_pane_surface,premium_av_preview_surface:!1===t.premium_av_preview_surface,non_premium_av_comments_pane_surface:!1===t.non_premium_av_comments_pane_surface,not_annotatable_file_comments_pane_surface:!1===t.not_annotatable_file_comments_pane_surface,how_to_at_mention_comments_pane_surface:!1===t.how_to_at_mention_comments_pane_surface,image_preview_surface:!1===t.image_preview_surface,document_preview_surface:!1===t.document_preview_surface,share_as_comment:!1===t.share_as_comment}})})),b(a.ActionTypes.MarkOnboarded,(function(e,t,r){var a;return n.__assign(n.__assign({},e),{onboardingVariants:n.__assign(n.__assign({},e.onboardingVariants),(a={},a[r]=!1,a))})})),b(a.ActionTypes.GetMediaFeatures,(function(e,t){return n.__assign(n.__assign({},e),{framePreciseCommentsEnabled:t.frame_precise_comments})})),b(a.ActionTypes.GetFileMetadata,(function(e,t){return n.__assign(n.__assign({},e),{frameRate:l.isVideoSpecificMetadata(t.metadata)?t.metadata.frame_rate_precise?t.metadata.frame_rate_precise:t.metadata.frame_rate:void 0})})),b(a.ActionTypes.MarkModalVariantShown,(function(e,t){var r;return n.__assign(n.__assign({},e),{modalVariantsShown:n.__assign(n.__assign({},e.modalVariantsShown),(r={},r[t]=!0,r))})})),b(a.ActionTypes.DismissOnboarding,(function(e){return n.__assign(n.__assign({},e),{onboardingVariants:r.mapValues(e.onboardingVariants,(function(){return!1}))})})),b(a.ActionTypes.MarkThreadRead,{Request:function(e,t,n){return f(e,n.threadId,{read:!0,pending:{action:a.ActionTypes.MarkThreadRead.name,originalValue:e.threads[n.threadId].read,pendingValue:!0}})},Success:function(e,t,n){return f(e,n.threadId,{pending:void 0})},Error:function(e,t,n){return v(t,e,n.threadId,"read")}}),b(a.ActionTypes.MarkThreadUnread,{Request:function(e,t,n){return f(e,n,{read:!1,pending:{action:a.ActionTypes.MarkThreadUnread.name,originalValue:e.threads[n].read,pendingValue:!1}})},Success:function(e,t,n){return f(e,n,{pending:void 0})},Error:function(e,t,n){return v(t,e,n,"read")}}),b(a.ActionTypes.MarkThreadResolved,{Request:function(e,t,n){var r={type:"with_details",resolver:n.resolver,resolvedTimestamp:new Date};return f(e,n.threadId,{resolvedInfo:r,pending:{action:a.ActionTypes.MarkThreadResolved.name,originalValue:e.threads[n.threadId].resolvedInfo,pendingValue:r}})},Success:function(e,t,n){return f(e,n.threadId,{pending:void 0})},Error:function(e,t,n){return v(t,e,n.threadId,"resolvedInfo")}}),b(a.ActionTypes.MarkThreadUnresolved,{Request:function(e,t,n){return f(e,n,{resolvedInfo:void 0,pending:{action:a.ActionTypes.MarkThreadUnresolved.name,originalValue:e.threads[n].resolvedInfo,pendingValue:void 0}})},Success:function(e,t,n){return f(e,n,{pending:void 0})},Error:function(e,t,n){return v(t,e,n,"resolvedInfo")}}),b(a.ActionTypes.SetContext,(function(e,t){return n.__assign(n.__assign({},e),r.pick(i.INITIAL_STATE.data,"activatedThreadId","authors","cursor","documentMetadata","enabledStatus","pendingAnnotationInfo","playerIntegrationEnabled","requestEditorFocus","canSeeCommentEditor","subscriptionStatus","threads"))})),b(a.ActionTypes.ToggleShowResolved,(function(e){return n.__assign(n.__assign({},e),{showResolved:!e.showResolved})})),b(a.ActionTypes.UpdateEditorIsEmpty,(function(e,t){return n.__assign(n.__assign({},e),{editorIsEmpty:t})})),b(a.ActionTypes.UpdateDocumentCurrentPage,(function(e,t){return n.__assign(n.__assign({},e),{pendingAnnotationInfo:n.__assign(n.__assign({},e.pendingAnnotationInfo),{currentPageNumber:t})})})),b(a.ActionTypes.UpdatePlayerCurrentTime,(function(e,t){return n.__assign(n.__assign({},e),{pendingAnnotationInfo:n.__assign(n.__assign({},e.pendingAnnotationInfo),{playerCurrentTime:d.VideoAnnotationHelper.unitConvertSecondsToDomainObjectTime(t),playerCurrentTimeSec:t})})})),b(a.ActionTypes.HoverThread,(function(e,t){return n.__assign(n.__assign({},e),{hoverThreadId:t})})),b(a.ActionTypes.FocusThread,(function(e,t){return n.__assign(n.__assign({},e),{focusedThreadId:t})})),b(a.ActionTypes.SetPendingNumberedAnnotation,(function(e,t){return n.__assign(n.__assign({},e),{pendingAnnotationInfo:n.__assign(n.__assign({},e.pendingAnnotationInfo),{numberedAnnotation:t,annotationMayBeOffscreen:!1})})})),b(a.ActionTypes.ClearPendingNumberedAnnotation,(function(e,t){return n.__assign(n.__assign({},e),{pendingAnnotationInfo:n.__assign(n.__assign({},e.pendingAnnotationInfo),{numberedAnnotation:void 0,annotationMayBeOffscreen:!1})})})),b(a.ActionTypes.SetPendingNumberedAnnotationMayBeOffscreen,(function(e){return n.__assign(n.__assign({},e),{pendingAnnotationInfo:n.__assign(n.__assign({},e.pendingAnnotationInfo),{annotationMayBeOffscreen:!0})})})),b(a.ActionTypes.TrackSidebarCommentsVisibility,(function(e,t){return n.__assign(n.__assign({},e),{visibleInSidebar:t})})),b(a.ActionTypes.DocMetadataLoad,(function(e,t){return n.__assign(n.__assign({},e),{documentMetadata:t})})),b(a.ActionTypes.RequestEditorFocus,(function(e){return n.__assign(n.__assign({},e),{requestEditorFocus:!0})})),b(a.ActionTypes.FulfillEditorFocusRequest,(function(e){if(!e.requestEditorFocus)throw new Error("Fulfilling request for editor focus, but isnt requested in store");return n.__assign(n.__assign({},e),{requestEditorFocus:!1})})),b(a.ActionTypes.EnablePlayerIntegration,(function(e,t){return n.__assign(n.__assign({},e),{playerIntegrationEnabled:!0})})),b(a.ActionTypes.SetUpsellTooltipVariant,(function(e,t){return n.__assign(n.__assign({},e),{upsellTooltipVariant:t})})),b(a.ActionTypes.SetThirdPartySource,(function(e,t){return n.__assign(n.__assign({},e),{thirdPartySource:t})})),b(a.ActionTypes.SetCanSeeCommentEditor,(function(e,t){return n.__assign(n.__assign({},e),{canSeeCommentEditor:t})})),b(a.ActionTypes.RecordEnabledStatus,(function(e,t){return n.__assign(n.__assign({},e),{enabledStatus:r.merge({},e.enabledStatus,t)})})),b(a.ActionTypes.SetSubscriptionStatus,(function(e,t){return n.__assign(n.__assign({},e),{subscriptionStatus:t})})),b(a.ActionTypes.Subscribe,(function(e){return n.__assign(n.__assign({},e),{subscriptionStatus:r.merge({},e.subscriptionStatus,{isSubscribed:!0})})})),b(a.ActionTypes.Unsubscribe,(function(e){return n.__assign(n.__assign({},e),{subscriptionStatus:r.merge({},e.subscriptionStatus,{isSubscribed:!1})})})),b(a.ActionTypes.ResetStore,(function(e,t){return n.__assign({},i.INITIAL_STATE.data)})),b(a.ActionTypes.GetStickers,(function(e,t){return n.__assign(n.__assign({},e),{stickers:t.sticker_sets})})));t.reducer=function(e,t){void 0===e&&(e=i.INITIAL_STATE);var n=p(e.context,t),r=w(e.data,t),a=_(e.statuses,t);return n!==e.context||r!==e.data||a!==e.statuses?{context:n,data:r,statuses:a}:e}})),define("modules/clean/react/comments2/data/action_helper",["require","exports","tslib","modules/clean/react/comments2/data/selectors","modules/clean/react/comments2/util"],(function(e,t,n,r,a){"use strict";function i(e){return{error:e+".Error",request:e+".Request",success:e+".Success"}}function s(e){return{actionTypes:i(e),name:e,type:"async"}}function o(e){return{actionType:e,name:e,type:"sync",zero:!1}}function c(e){return{actionType:e,name:e,type:"sync",zero:!0}}function u(){var e=this;return function(t,i){return n.__awaiter(e,void 0,void 0,(function(){var e,s,o,c,u,l,d;return n.__generator(this,(function(n){switch(n.label){case 0:return e=i.action,s=i.args,o=i.dispatch,c=i.context,u=i.getState,a.isContextSame(c,r.getContext(u()))?[3,2]:[4,t(i)];case 1:return[2,n.sent()];case 2:o({type:e.actionTypes.request,payload:s,meta:{args:s}}),n.label=3;case 3:return n.trys.push([3,5,,6]),[4,t(i)];case 4:return l=n.sent(),o({type:e.actionTypes.success,payload:l,meta:{args:s}}),[2,l];case 5:throw d=n.sent(),o({type:e.actionTypes.error,error:d,meta:{args:s}}),d;case 6:return[2]}}))}))}}Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importStar(r),t.syncReduxAction=function(e,t){return e.zero?{type:e.actionType}:{type:e.actionType,payload:t}},t.requestReduxAction=function(e,t){return{type:e.actionTypes.request,payload:t,meta:{args:t}}},t.successReduxAction=function(e,t,n){return{type:e.actionTypes.success,payload:n,meta:{args:t}}},t.errorReduxAction=function(e,t,n){return{type:e.actionTypes.error,error:n,meta:{args:t}}},t.asyncActionConstants=i,t.asyncAction=s,t.syncAction=o,t.syncAction0=c,t.namespacedActions=function(e){return{asyncAction:function(t){return s(e+"/"+t)},syncAction:function(t){return o(e+"/"+t)},syncAction0:function(t){return c(e+"/"+t)}}},t.syncHandler=function(e){return e.zero?function(){return{type:e.name}}:function(t){return{payload:t,type:e.name}}},t.createAsyncHandler=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t,a){return function(i){return function(s,o){return n.__awaiter(void 0,void 0,void 0,(function(){var c,u;return n.__generator(this,(function(l){switch(l.label){case 0:c=r.getContext(o()),u=e.reduceRight((function(e,t){return function(r){return n.__awaiter(void 0,void 0,void 0,(function(){return n.__generator(this,(function(n){switch(n.label){case 0:return[4,t(e,r)];case 1:return[2,n.sent()]}}))}))}}),(function(e){return a(i,e)})),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,u({action:t,args:i,dispatch:s,getState:o,context:c})];case 2:return[2,l.sent()];case 3:return l.sent(),[3,4];case 4:return[2]}}))}))}}}},t.dispatchMiddleware=u,t.thunkHandler=t.createAsyncHandler(),t.asyncHandler=t.createAsyncHandler(u())})),define("modules/clean/react/file_activity_stream/tti_logger",["require","exports","modules/clean/react/file_sidebar/file_sidebar_logger"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(){this.hasLogged=!1}return e.prototype.recordStart=function(e){this.startTs=(new Date).getTime(),this.fileId=e,this.hasLogged=!1},e.prototype.recordInteractive=function(e){if(!this.hasLogged&&e===this.fileId&&this.startTs){var t=(new Date).getTime();n.logActivityStreamInteractivity({time_start:this.startTs,time_interactive:t}),this.hasLogged=!0}},e})();t.faStreamTTILogger=new r})),define("modules/clean/react/file_sidebar/store/sidebar/reactors",["require","exports","tslib","modules/clean/react/file_sidebar/file_sidebar_logger","modules/clean/react/file_sidebar/store/sidebar/selectors","modules/clean/react/file_sidebar/store/file_activity/selectors"],(function(e,t,n,r,a,i){"use strict";function s(e){var t=a.getSidebarState(e),n=t.open,r=t.ready;return n&&r}function o(e){return!s(e)}function c(e){var t=a.getSidebarContext(e).user;r.logSidebarOpened({reason:a.getOpenReason(e),num_comments:a.getTabState(e,"comments").extra.commentCount,num_events:i.getVisibleActivityCount(e),viewing_user_id:t?t.id:null})}Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importStar(a),i=n.__importStar(i),t.reactors=function(e){e({changesFrom:o,changesTo:s},(function(e){c(e.nextState)})),e({changes:function(e,t){if(s(e)&&s(t)){var n=t.sidebar.tabs,r=e.sidebar.tabs;return!(r.activity.ready&&r.comments.ready)&&n.activity.ready&&n.comments.ready}return!1}},(function(e){c(e.nextState)}))}})),define("modules/clean/react/workflows/markup/markup_layer",["require","exports","tslib","react","react-redux","external/lodash","modules/clean/react/workflows/markup/fabric_wrapper","modules/clean/react/css","modules/clean/react/workflows/markup/selectors","modules/clean/react/file_viewer/data/actions","modules/clean/react/workflows/markup/types","modules/clean/react/workflows/markup/fabric"],(function(e,t,n,r,a,i,s,o,c,u,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleSelectionChange=function(e){if(e.selected){var n=e.selected,r=n.some((function(e){return["circle","rect"].includes(e.type||"")}))?[l.FormatSubmenuEntry.FILL,l.FormatSubmenuEntry.STROKE]:[l.FormatSubmenuEntry.STROKE];t.props.setMarkupFormatSubmenu(r);var a=n.filter((function(e){return d.getStroke(e)})),i=d.getStroke(a[0]),s=a.every((function(e){return d.getStroke(e)===i})),o=n.filter((function(e){return d.getFill(e)})),c=d.getFill(o[0]),u=o.every((function(e){return d.getFill(e)===c}));i&&s&&t.props.setMarkupStroke(i),c&&u&&t.props.setMarkupFill(c)}},t.handleObjectMoving=function(e){var t=e.target;if(t&&t.canvas&&null!=t.top&&null!=t.left){t.setCoords();var n=t.canvas.getWidth(),r=t.canvas.getHeight(),a=t.getBoundingRect().width,i=t.getBoundingRect().height,s=t.getBoundingRect().top,o=t.getBoundingRect().left;if(!(i>r||a>n)){var c=.9*a,u=.9*i,l=Math.max(t.top,t.top-s-u),d=Math.max(t.left,t.left-o-c);t.top=Math.min(l,r+u-i+t.top-s),t.left=Math.min(d,n+c-a+t.left-o),t.setCoords()}}},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this.createFabricCanvas(),t=this.props.markupState[this.props.page];t&&t.fabric&&e.loadFromJSON(t.fabric.toJSON(),(function(){e.requestRenderAll()})),this.props.setMarkupCanvas(this.props.page,e,this.getCanvasSize().scale)},t.prototype.createFabricCanvas=function(){var e=new s.fabric.Canvas(this.canvasId);return e.on("selection:updated",this.handleSelectionChange),e.on("selection:created",this.handleSelectionChange),e.on("object:moving",this.handleObjectMoving),e.isDrawingMode=this.props.markupState.isDrawingMode,e},t.prototype.componentDidUpdate=function(){var e=this.props,t=e.markupState,n=e.page,r=this.getCanvasSize(),a=r.width,i=r.height,s=r.scale,o=t[n]&&t[n].fabric;if(o)o.setDimensions({width:a,height:i}),this.props.updateMarkupCanvasScale(n,s);else{var c=this.createFabricCanvas();this.props.setMarkupCanvas(n,c,s)}},t.prototype.shouldComponentUpdate=function(e){return this.props.page!==e.page||!i.isEqual(this.props.pageDimensions,e.pageDimensions)||!i.isEqual(this.props.layerSize,e.layerSize)},t.prototype.getCanvasSize=function(){var e=this.props.layerSize.width,t=this.props.pageDimensions||this.props.layerSize,n=t.width,r=t.height,a=e/n;return{width:Math.round(n*a),height:Math.round(r*a),scale:a}},t.prototype.render=function(){var e=this.getCanvasSize(),t=e.width,n=e.height,a={width:t+"px",height:n+"px"};return this.canvasId="markup-canvas"+this.props.page,r.default.createElement("div",{className:"fv-markup-layer",style:a},r.default.createElement("canvas",{id:this.canvasId,width:t,height:n}))},t})((r=n.__importDefault(r)).default.Component);t._MarkupLayer=_;var m=a.connect((function(e){return{markupState:c.getMarkupState(e)}}),{setMarkupCanvas:u.setMarkupCanvas,updateMarkupCanvasScale:u.updateMarkupCanvasScale,setMarkupFormatSubmenu:u.setMarkupFormatSubmenu,setMarkupFill:u.setMarkupFill,setMarkupStroke:u.setMarkupStroke});t.ConnectedMarkupLayer=m(_);var p=o.requireCssWithComponent(t.ConnectedMarkupLayer,["/static/css/file_viewer/markup_layer-vflF_C1Ab.css"]);t.MarkupLayer=p})),define("modules/clean/previews/pending_upload_watcher",["require","exports","tslib","modules/clean/ajax","modules/clean/react/file_viewer/data/actions","modules/core/browser","modules/core/uri"],(function(e,t,n,r,a,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importStar(r),i=n.__importStar(i);var o=(function(){function e(e,t,n){void 0===n&&(n=""),this.pollUrl=new s.URI({path:"/sp/"}).updateQuery({link_type:e,link_key:t,secure_hash:n}).toString()}return e.prototype.startPolling=function(){this.pollPending()},e.prototype.pollSuccess=function(e){var t=JSON.parse(e);t.hasOwnProperty("upload_status")&&"complete"===t.upload_status?a.pendingFileUploaded():setTimeout(this.pollPending.bind(this),2e3)},e.prototype.pollFailure=function(e){e.status<400||e.status>=500?this.retryPoll():i.reload(!0)},e.prototype.retryPoll=function(){setTimeout(this.pollPending.bind(this),2e3)},e.prototype.pollPending=function(){var e=this;r.SilentBackgroundRequest({url:this.pollUrl,success:function(t){e.pollSuccess(t)},error:function(t){e.pollFailure(t)}})},e})();t.PendingUploadWatcher=o})),define("modules/clean/react/open_in_app/button",["require","exports","tslib","react","spectrum/button","modules/clean/open_in_app/actions","modules/core/i18n","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants"],(function(e,t,n,r,a,i,s,o,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(e){function t(t){var n=e.call(this,t)||this;return n.handleClick=function(){o.logUserAction(c.UserAction.OpenInApp,n.props.userActionContext),i.openInApp(n.props.urls,{onAppNeeded:function(){return n.setState({showInstallAppText:!0})},onAppInstalled:function(){return n.setState({showInstallAppText:!1})}})},n.state={showInstallAppText:!1},n}return n.__extends(t,e),t.prototype.componentWillUnmount=function(){i.cleanUp()},t.prototype.render=function(){return r.default.createElement(a.Button,{className:"control__button open-in-app-button",variant:"primary",onClick:this.handleClick},this.state.showInstallAppText?s.intl.formatMessage({id:"RgopQo",defaultMessage:"Install app?"}):s.intl.formatMessage({id:"B9kRrE",defaultMessage:"Open in app"}))},t})((r=n.__importDefault(r)).default.Component);t.OpenInAppButton=u})),define("modules/clean/react/comments2/data/selectors",["require","exports","tslib","external/lodash","reselect","modules/clean/redux/selectors","modules/clean/redux/namespaces","modules/clean/react/comments2/data/types","modules/clean/react/comments2/data/util","modules/clean/react/comments2/util","modules/clean/react/file_viewer/data/selectors","modules/clean/previews/constants","modules/clean/previews/data/preview_type_util","modules/clean/react/file_viewer/data/selectors","comments2/transforms"],(function(e,t,n,r,a,i,s,o,c,u,l,d,_,m,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importStar(r),u=n.__importStar(u),m=n.__importStar(m);t.IMAGE_SENTINEL="IMAGE_SENTINEL",t.getState=function(e){return i.getStateAtNamespace(e,s.COMMENTS2_NAMESPACE_KEY)};t.getContext=function(e){var n=t.getState(e).context;return n?{stream:n.stream,viewer:n.viewer}:void 0},t.getContextStatus=function(e){var n=t.getState(e).context;return n?n.status:void 0};var g=a.createSelector(t.getContextStatus,(function(e){return e===o.Comments2ContextStatus.FullyEnabled})),f=a.createSelector(t.getContextStatus,(function(e){return e===o.Comments2ContextStatus.ReadOnly}));function v(e){return _.getPreviewType(m.getPreviewApiDataForCurrentFile(e))}function h(e){return a.createSelector(t.getData,(function(t){return t[e]}))}t.isEnabled=a.createSelector([g,f],(function(e,t){return e||t})),t.getFQPath=function(e){var n=t.getContext(e);return n?n.stream.fq_path:void 0},t.getViewer=function(e){var n=t.getContext(e);return n?n.viewer:void 0},t.getViewerId=function(e){var n=t.getViewer(e);return n?n.id:void 0},t.canCreateAnnotations=function(e){var n=t.getContext(e);return!(!n||!n.viewer)&&!u.isComments2Mobile()&&t.getVisibleInSidebar(e)},t.getPreviewTypeForCurrentFile=v,t.getIsComments2Ready=function(e){var t=e[s.COMMENTS2_NAMESPACE_KEY];return!(!t||!t.context||t.context.status!==o.Comments2ContextStatus.FullyEnabled&&t.context.status!==o.Comments2ContextStatus.ReadOnly)},t.getData=function(e){return t.getState(e).data},t.getRevision=a.createSelector(t.getContext,(function(e){return e&&p.streamToRevision(e.stream)})),t.getSort=a.createSelector(v,(function(e){switch(e){case d.PreviewType.Audio:case d.PreviewType.Video:return o.SortType.VideoTimeCode;default:return o.SortType.Chronological}})),t.getEditorIsEmpty=h("editorIsEmpty"),t.getThreadMap=h("threads");var S=a.createSelector(t.getThreadMap,(function(e){return r.values(e)})),b=a.createSelector(t.getContext,(function(e){return e&&e.stream.isVersionHistoryMode}));function w(e){return t.isEnabled(e)&&!u.isComments2Mobile()&&(function(e){var n=t.getData(e).onboardingVariants;switch(v(e)){case d.PreviewType.Audio:case d.PreviewType.Video:return t.getIsPlayerIntegrationEnabled(e)?n.premium_av_comments_pane_surface:n.non_premium_av_comments_pane_surface;case d.PreviewType.SsrDoc:return n.document_preview_surface||n.how_to_at_mention_comments_pane_surface;case d.PreviewType.Image:return n.image_preview_surface||n.how_to_at_mention_comments_pane_surface;case void 0:return!1;default:return n.not_annotatable_file_comments_pane_surface}})(e)}t.getThreads=a.createSelector([S,t.getSort,b,t.getRevision],(function(e,t,a,i){var s=(function(e,t){switch(t){case o.SortType.Chronological:return r.sortBy(e,[function(e){return e.timestamp.getTime()}]);case o.SortType.VideoTimeCode:var a=r.partition(e,c.isThreadWithTimecodeAnnotation),i=a[0],s=a[1];return n.__spreadArrays(r.sortBy(i,[function(e){return e.annotation.time},function(e){return e.timestamp.getTime()}]),r.sortBy(s,[function(e){return e.timestamp.getTime()}]))}})(e,t);return a?(function(e,t){return e.filter((function(e){var n=e.comments[0].revisionInfo;return n.isCurrent||!t||n.revision&&n.revision.nsId===t.ns_id&&n.revision.sjId<=t.sjid}))})(s,i):s})),t.getCursor=h("cursor"),t.getUnmarkedOnboardingKeysRelevantToCurrentFile=function(e){var n,r=t.getData(e).onboardingVariants;switch(v(e)){case d.PreviewType.SsrDoc:n=["document_preview_surface","how_to_at_mention_comments_pane_surface"];break;case d.PreviewType.Image:n=["image_preview_surface","how_to_at_mention_comments_pane_surface"];break;case d.PreviewType.Audio:case d.PreviewType.Video:n=t.getIsPlayerIntegrationEnabled(e)?["premium_av_comments_pane_surface","premium_av_preview_surface"]:["non_premium_av_comments_pane_surface"];break;case void 0:return[];default:n=["not_annotatable_file_comments_pane_surface"]}return n.filter((function(e){return r[e]}))},t.getShowOnboardingOnVideo=function(e){var n=t.getData(e).onboardingVariants,r=!l.getIsMediaPlaying(e),a=l.getPauseCount(e);return t.isEnabled(e)&&!u.isComments2Mobile()&&t.getIsPlayerIntegrationEnabled(e)&&r&&!w(e)&&n.premium_av_preview_surface&&a%5==1&&a<15},t.getShowShareAsCommentOnboarding=function(e){return t.getData(e).onboardingVariants.share_as_comment},t.getShowOnboardingOnCommentsPane=w,t.getOnboardingVariants=function(e){return t.getData(e).onboardingVariants},t.getHasShownAnyModalVariant=function(e){var n=t.getData(e).modalVariantsShown;return n[o.ModalVariant.EmailVerifyModal]||n[o.ModalVariant.SignUpModal]},t.getFramePreciseCommentsEnabled=function(e){return t.getData(e).framePreciseCommentsEnabled},t.getFrameRate=function(e){return t.getData(e).frameRate},t.getActivatedThreadId=h("activatedThreadId");var y=a.createSelector(t.getActivatedThreadId,t.getThreadMap,(function(e,t){return e&&t[e]}));t.getActivatedTimecodeThread=function(e){var t=y(e);return t&&c.isThreadWithTimecodeAnnotation(t)?t:void 0};var T=h("documentRectangleToMakeVisible");t.getDocumentRectangleToMakeVisibleIfComments2Ready=function(e){return t.getIsComments2Ready(e)?T(e):void 0},t.getListCommentsError=h("listCommentsError"),t.getHoverThreadId=h("hoverThreadId"),t.getFocusedThreadId=h("focusedThreadId"),t.getUnresolvedTimecodeThreads=function(e){return(function(e){return t.getThreads(e).filter((function(e){return!e.resolvedInfo}))})(e).filter((function(e){var t=e.annotation;return t&&("video"===t.type||"audio"===t.type)}))},t.getShowResolved=h("showResolved"),t.getStatuses=function(e){return t.getState(e).statuses},t.getIsPlayerIntegrationEnabled=h("playerIntegrationEnabled"),t.getStickers=function(e){return t.getData(e).stickers},t.getCanEnable=function(e){return t.getData(e).enabledStatus.canEnable},t.getCanSubscribe=function(e){return t.getData(e).subscriptionStatus.canSubscribe},t.getIsSubscribed=function(e){return t.getData(e).subscriptionStatus.isSubscribed},t.getStream=function(e){var n=t.getContext(e);return n&&n.stream},t.getStreamId=function(e){var n=t.getContext(e);return n&&n.stream.id};var A=h("pendingAnnotationInfo");function M(e){return A(e).numberedAnnotation}t.getPlayerCurrentTime=function(e){return A(e).playerCurrentTime},t.getPlayerCurrentTimeSec=function(e){return A(e).playerCurrentTimeSec},t.getCurrentPageNumber=function(e){return A(e).currentPageNumber},t.getPendingNumberedAnnotation=M,t.getHasPendingNumberedAnnotation=function(e){return t.getIsComments2Ready(e)&&!!M(e)},t.getVisibleInSidebar=h("visibleInSidebar");var E=a.createSelector([t.getVisibleInSidebar,t.isEnabled,t.getShowResolved,S],(function(e,t,n,r){return e&&t?(n?r:r.filter((function(e){return!e.resolvedInfo}))).filter((function(e){return e.comments.some((function(e){return!e.deleted}))})):[]})),C=a.createSelector(E,(function(e){return e.filter(c.isThreadWithDocumentAnnotation)})),I=a.createSelector(C,(function(e){return r.groupBy(e,(function(e){return e.annotation.regions[0].page}))}));function k(e,t){return r.get(I(e),t,[])}function P(e){var t=e.annotation;return!!t&&("document"===t.type||"image"===t.type)}function F(e){return E(e).filter((function(e){return e&&void 0!==e.annotation&&"image"===e.annotation.type}))}t.getDisplayedThreadsForLayer=function(e,t){return void 0===t?F(e):k(e,t)},t.getDisplayedThreadsWithDocumentAnnotationsOnPage=k,t.getDisplayedThreadsWithImageAnnotations=F,t.getDisplayedThreadsWithNumberedAnnotations=function(e){return E(e).filter(P)};var R=h("canSeeCommentEditor");t.getStreamSettings=a.createSelector([g,t.getViewer,R],(function(e,t,n){return{canComment:e,canModifyThreads:n&&!!t,canShowEditor:n}})),t.getDocumentMetadata=function(e){switch(v(e)){case d.PreviewType.SsrDoc:return t.getData(e).documentMetadata;case d.PreviewType.Image:return t.IMAGE_SENTINEL;default:return}},t.getIsEditorFocusRequested=h("requestEditorFocus"),t.getThirdPartySource=h("thirdPartySource")})),define("modules/clean/react/comments2/data/actions",["require","exports","tslib","external/lodash","modules/core/browser","modules/core/i18n","modules/clean/redux/types","modules/clean/react/comments2/data/api","file-viewer/core","modules/clean/react/file_sidebar/store/instance","comments2/transforms","modules/clean/react/comments2/data/types","modules/clean/react/comments2/components/snackbars","modules/clean/react/comments2/util","modules/clean/react/comments2/data/logger","modules/clean/react/comments2/data/perf_util","modules/clean/react/comments2/data/selectors","comments2/components/utils/throttle-debounce","modules/clean/bolt","modules/clean/browse_interface","modules/clean/react/comments2/data/action_helper","modules/clean/react/file_sidebar/store/sidebar/actions","modules/clean/react/file_viewer/data/actions"],(function(e,t,n,r,a,i,s,o,c,u,l,d,_,m,p,g,f,v,h,S,b,w,y){"use strict";function T(e){var t=this,r=e.clientFn,a=e.successCallback,i=e.eventToLog;return function(e,s){return n.__awaiter(t,void 0,void 0,(function(){var t,c,u;return n.__generator(this,(function(n){switch(n.label){case 0:if(!(t=f.getContext(s()))||!t.viewer)throw new Error;c=new o.Comments2Api(t.viewer.id,t.stream),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,r(c)];case 2:return u=n.sent(),p.logEvent(i,{stream:t.stream}),a(e,s,u),[3,4];case 3:return n.sent(),p.logErrorEvent("error trying to execute client event "+i,{stream:t.stream}),[3,4];case 4:return[2]}}))}))}}function A(e){return function(n,r){n(X(e));var a=e.thread,i=r(),s=f.getStream(i);p.logEvent("activate_thread",{stream:s,thread:a}),a.read||a.readonly||n(t.Actions.markThreadRead({threadId:a.id,origin:d.MarkThreadReadOrigin.ThreadActivated}))}}function M(){return T({clientFn:function(e){return e.enableCommenting()},successCallback:E,eventToLog:"enable_comments"})}function E(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(n){switch(n.label){case 0:return f.getStreamId(t())!==r.id?[2]:[4,e(j(d.Comments2ContextStatus.Pending))];case 1:return n.sent(),e(K(!0,!1)),[2]}}))}))}function C(){return T({clientFn:function(e){return e.disableCommenting()},successCallback:I,eventToLog:"disable_comments"})}function I(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){var a;return n.__generator(this,(function(n){return f.getStreamId(t())!==r.id?[2]:(a=f.getContext(t()),k(e,a,!0),[2])}))}))}function k(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(t){switch(t.label){case 0:return[4,e(j(d.Comments2ContextStatus.Disabled))];case 1:return t.sent(),e(y.disableMode(c.FileViewerMode.Commenting)),[4,u.store.dispatch(w.setComments2DisabledState())];case 2:return t.sent(),[2]}}))}))}Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importStar(r),a=n.__importStar(a),m=n.__importStar(m),p=n.__importStar(p),g=n.__importStar(g),f=n.__importStar(f),w=n.__importStar(w),t.HandleErrorArg=_.ShowErrorSnackbarArg,t.enableCommenting=M,t.disableCommenting=C,t.bolt={client:null,subscribe:function(e,n,r){var a=e.app_id,i=e.revision,s=e.token,o=e.unique_id,c=new h.SignedChannelState(a,o,i,s);t.bolt.client?t.bolt.client.update_states([c]):(t.bolt.client=new h.BoltClient([c],n,r),t.bolt.client.start())},unsubscribe:function(){t.bolt.client&&(t.bolt.client.unsubscribe(),t.bolt.client=null)}};var P=m.createBackoff(),F=P.backoff,R=P.resetBackoff;function O(e){var r=this;return function(a,i){return n.__awaiter(r,void 0,void 0,(function(){var r,s,o;return n.__generator(this,(function(n){switch(n.label){case 0:return r=i(),s=f.getContext(r),m.isContextSame(s,e)?[3,2]:(t.bolt.unsubscribe(),a(z(e)),a(ze({setContextTime:+new Date,listCompleteTime:0})),e?(o=s&&s.viewer,e.viewer&&!m.isUserSame(o,e.viewer)&&(a(t.Actions.checkOnboardingStatus(void 0)),a(t.Actions.getMediaFeatures(void 0))),f.getStickers(r)||a(t.Actions.getStickers(void 0)),e.stream&&a(t.Actions.getFileMetadata({fileId:e.stream.id,linkUrl:e.stream.linkUrl})),[4,a(K(!0))]):[3,2]);case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}}t.setFileContext=O;var D=b.namespacedActions("Comments2"),x=D.asyncAction,U=D.syncAction,V=D.syncAction0;function L(e){var t=this,r=e.handleError,a=e.handleSuccess;return function(e,s){return n.__awaiter(t,void 0,void 0,(function(){function t(){return n.__awaiter(this,void 0,void 0,(function(){var c,u,l,d;return n.__generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e(s)];case 1:return c=n.sent(),[3,3];case 2:throw u=n.sent(),(l=(function(e,t){if(t instanceof o.Comments2Error&&(t.code===o.ErrorCode.FILE_NOT_FOUND||t.code===o.ErrorCode.PERMISSION_DENIED)&&e!==ne.name)return{message:i.intl.formatMessage({id:"CKj3RT",defaultMessage:"Either that file was deleted or you no longer have access to it."}),isRetriable:!1};switch(e){case fe.name:case he.name:case ye.name:return{message:i.intl.formatMessage({id:"3hOA04",defaultMessage:"We were unable to post the comment."}),isRetriable:!0};case be.name:return{message:i.intl.formatMessage({id:"CiZnrG",defaultMessage:"We were unable to delete the comment."}),isRetriable:!0};case Ie.name:return{message:i.intl.formatMessage({id:"+YPQ5/",defaultMessage:"We were unable to resolve the thread."}),isRetriable:!0};case Pe.name:return{message:i.intl.formatMessage({id:"QUs54P",defaultMessage:"We were unable to unresolve the thread."}),isRetriable:!0};case Ae.name:return{message:i.intl.formatMessage({id:"Vgd16U",defaultMessage:"We were unable to mark the thread as read."}),isRetriable:!0};case Ee.name:return{message:i.intl.formatMessage({id:"4apXur",defaultMessage:"We were unable to mark the thread as unread."}),isRetriable:!0};case Ge.name:return{message:i.intl.formatMessage({id:"RmXnr0",defaultMessage:"We were unable to subscribe to the file."}),isRetriable:!0};case Ze.name:return{message:i.intl.formatMessage({id:"oz0V3s",defaultMessage:"We were unable to unsubscribe from the file."}),isRetriable:!0};case J.name:case ee.name:case ne.name:case le.name:case Be.name:default:return null}})(s.action.name,u))&&r({message:l.message,retryFn:l.isRetriable?t:void 0}),u;case 3:return(d=(function(e){switch(e){case Ge.name:return{message:i.intl.formatMessage({id:"WQpgoO",defaultMessage:"You have subscribed to the file."})};case Ze.name:return{message:i.intl.formatMessage({id:"8o4LmU",defaultMessage:"You have unsubscribed from the file."})};default:return null}})(s.action.name))&&a(d),[2,c]}}))}))}return n.__generator(this,(function(e){switch(e.label){case 0:return[4,t()];case 1:return[2,e.sent()]}}))}))}}function N(){return+new Date}function W(e){var t=this;return function(r,a){return n.__awaiter(t,void 0,void 0,(function(){function t(t){var n=e(a.action.name,t);if(n){var r=N();a.dispatch(bt(n,a.context,r-i))}}var i,s,c;return n.__generator(this,(function(e){switch(e.label){case 0:i=N(),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,r(a)];case 2:return s=e.sent(),[3,4];case 3:throw c=e.sent(),t(c instanceof o.Comments2Error?c.code:"unknown_error"),c;case 4:return t(),[2,s]}}))}))}}t.statusHandlingMiddleware=L,t.perfLoggingMiddleware=W;var H=b.createAsyncHandler(L({handleError:_.showErrorSnackbar,handleSuccess:_.showSuccessSnackbar}),(function(e,t){var n=t.context;if(!n||!n.viewer)throw new Error("Bad state");var a=new o.Comments2Api(n.viewer.id,n.stream);return e(r.merge({},t,{api:a,context:n}))}),(function(e){var t=this;return function(a,i){return n.__awaiter(t,void 0,void 0,(function(){var t,o;return n.__generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,a(i)];case 1:return t=n.sent(),e(r.merge({},i,{payload:t,status:s.ApiClientStatus.Success})),[2,t];case 2:throw o=n.sent(),e(r.merge({},i,{error:o,status:s.ApiClientStatus.Error})),o;case 3:return[2]}}))}))}})((function(e){var t=e.context.stream,n=f.getThreadMap(e.getState());if(e.status===s.ApiClientStatus.Error)p.logErrorEvent("encountered an error with async api call "+e.action.name,{stream:t});else if(e.status===s.ApiClientStatus.Success){var r=e.args,a=e.payload;switch(e.action.name){case fe.name:var i=n[a.id];p.logEvent("new_comment",{commentId:a.id,stream:t,thread:i});break;case he.name:i=n[r.threadId];p.logEvent("reply_to_comment",{commentId:a.id,stream:t,thread:i});break;case be.name:i=n[r.threadId];p.logEvent("delete_comment",{commentId:r.commentId,stream:t,thread:i});break;case ye.name:i=n[r.threadId];p.logEvent("edit_comment",{commentId:r.commentId,stream:t,thread:i});break;case Ie.name:i=n[r.threadId];p.logEvent("resolve_thread",{stream:t,thread:i});break;case Pe.name:i=n[r];p.logEvent("unresolve_thread",{stream:t,thread:i});break;case Ae.name:var o=r.origin===d.MarkThreadReadOrigin.ThreadActivated?"read_thread":"mark_thread_as_read";i=n[r.threadId];p.logEvent(o,{stream:t,thread:i});break;case Ee.name:i=n[r];p.logEvent("mark_thread_as_unread",{stream:t,thread:i});break;case Ge.name:p.logEvent("subscribe",{stream:t});break;case Ze.name:p.logEvent("unsubscribe",{stream:t})}}})),W((function(e,t){switch(e){case fe.name:case he.name:case Ae.name:case Ee.name:case Ie.name:case Pe.name:return g.threadActionCompleted(e,t);case be.name:case ye.name:return g.commentActionCompleted(e,t)}})),b.dispatchMiddleware()),B=U("SetContext"),z=b.syncHandler(B),q=U("SetContextStatus"),j=b.syncHandler(q),G=x("ListComments"),K=function(e,r){return void 0===e&&(e=!1),void 0===r&&(r=!0),function(s,g){return n.__awaiter(void 0,void 0,void 0,(function(){var h,S,b,T,A,M,E,C,I,P,O,D,x,U,V,L,N,W,H,B,z,q,Y,X,Z,Q,J,$;return n.__generator(this,(function(n){switch(n.label){case 0:if(h=g(),!(S=f.getContext(h)))return[2];s({type:G.actionTypes.request}),b=S.stream,T=S.viewer,A=T?new o.Comments2Api(T.id,b):new o.Comments2LoggedOutApi(b),n.label=1;case 1:return n.trys.push([1,6,,7]),[4,A.listComments(e,f.getCursor(h))];case 2:if(M=n.sent(),E=M.bolt_info,C=M.cursor,I=M.status,P=M.supported_enhancements,O=M.threads,D=M.users,x=M.permissions,U=+new Date,V=f.getContextStatus(h),L=I[".tag"],N="enabled"===L||"readonly"===L,V===d.Comments2ContextStatus.Pending&&N&&(W=f.getData(h),H=W.perfEvents&&W.perfEvents.setContextTime||0,s(t.Actions.logSimplePerfEvent("initial_list_completed_ms",U-H))),B=g(),z=f.getContext(B),!m.isContextSame(z,S))return[2];if(x&&(s(He({canEnable:x.can_enable_commenting})),s(je({canSubscribe:x.can_subscribe,isSubscribed:x.is_subscribed})),s(Ne(x.can_see_comment_editor)),s(N?y.enableMode(c.FileViewerMode.Commenting):y.disableMode(c.FileViewerMode.Commenting))),P&&(q=P.third_party_source,Y=P.time_based_annotations,X=P.time_based_annotations_upsell_tooltip_variant,Z=(void 0===X?{".tag":"other"}:X)[".tag"],Y&&s(Oe()),"other"!==Z&&s(xe(Z)),q&&s(Ve(q[".tag"]))),Q=r?(te=/comment_id=(.*)/.exec(a.get_uri().getFragment()))?te[1]:void 0:void 0,V===d.Comments2ContextStatus.Pending)switch(I[".tag"]){case"disabled":null!=x&&x.can_enable_commenting,k(s),Q&&_.showErrorSnackbar({message:i.intl.formatMessage({id:"cwWK1c",defaultMessage:"Comments are disabled on this file."})});break;case"enabled":s(ze({listCompleteTime:U})),s(j(d.Comments2ContextStatus.FullyEnabled)),u.store.dispatch(w.setComments2ShownState({commentCount:O.filter((function(e){return!e.resolved})).length}));break;case"readonly":s(ze({listCompleteTime:U})),s(j(d.Comments2ContextStatus.ReadOnly)),u.store.dispatch(w.setComments2ShownState({commentCount:O.filter((function(e){return!e.resolved})).length}));break;case"comments1":s(j(d.Comments2ContextStatus.Comments1))}return f.isEnabled(h)||V===d.Comments2ContextStatus.Pending&&("enabled"===I[".tag"]||"readonly"===I[".tag"])?[4,s((ee=E,function(e){if(m.useBolt()){var n=v.debounce((function(){R(),e(K(!1,!1))}),2e3);t.bolt.subscribe(ee,n,(function(){t.bolt.unsubscribe(),F((function(){e(K(!1,!1))}))}))}}))]:[3,5];case 3:return n.sent(),J=l.streamToRevision(b),[4,s({type:G.actionTypes.success,payload:{authors:D,cursor:C,threads:O,currentRevision:J}})];case 4:n.sent(),Q&&s(t.Actions.activateComment(Q)),n.label=5;case 5:return[3,7];case 6:return($=n.sent())instanceof o.Comments2Error&&($.code===o.ErrorCode.FILE_NOT_FOUND?s(j(d.Comments2ContextStatus.Disabled)):T&&A instanceof o.Comments2Api&&p.logErrorEvent(($.message,": "+$.message),{stream:b})),s({type:G.actionTypes.error,error:$}),[3,7];case 7:return[2]}var ee,te}))}))}},Y=U("ActivateThread"),X=b.syncHandler(Y),Z=V("DeactivateAllThreads"),Q=b.syncHandler(Z),J=x("CheckOnboardingStatus"),$=H(J,(function(e,t){return t.api.checkOnboardingStatus()})),ee=x("GetMediaFeatures"),te=H(ee,(function(e,t){return t.api.getMediaFeatures()})),ne=x("GetFileMetadata"),re=H(ne,(function(e,t){var n=e.fileId,r=e.linkUrl;return t.api.getFileMetadata(n,r)})),ae=x("GetStickers"),ie=H(ae,(function(e,t){return t.api.getStickers()})),se=U("HoverAnnotation"),oe=b.syncHandler(se),ce=U("FocusAnnotation"),ue=b.syncHandler(ce),le=x("MarkOnboarded"),de=H(le,(function(e,t){return t.api.markHasOnboarded(e)})),_e=U("DismissOnboarding"),me=b.syncHandler(_e),pe=U("MarkModalVariantShown"),ge=b.syncHandler(pe),fe=x("CreateThread"),ve=H(fe,(function(e,t){var n=e.annotation,r=(e.author,e.content),a=(e.guid,e.source),i=t.api,s=t.context.stream,o=l.iCommentContentToUserSubmittedComment({annotation:n,content:r,stream:s});return i.createThread(o,a)})),he=x("ReplyToThread"),Se=H(he,(function(e,t){e.author;var n=e.content,r=(e.guid,e.threadId),a=t.api,i=t.context.stream,s=l.iCommentContentToUserSubmittedComment({content:n,stream:i});return a.replyToThread(s,r)})),be=x("DeleteComment"),we=H(be,(function(e,t){var n=e.commentId;e.threadId;return t.api.deleteComment(n)})),ye=x("EditComment"),Te=H(ye,(function(e,t){var n=e.commentId,r=e.content,a=(e.threadId,t.api),i=t.context.stream,s=l.iCommentContentToUserSubmittedComment({content:r,stream:i});return a.editComment(n,s)})),Ae=x("MarkThreadRead"),Me=H(Ae,(function(e,t){e.origin;var n=e.threadId;return t.api.markThreadRead(n)})),Ee=x("MarkThreadUnread"),Ce=H(Ee,(function(e,t){return t.api.markThreadUnread(e)})),Ie=x("MarkThreadResolved"),ke=H(Ie,(function(e,t){var n=e.threadId;return t.api.markThreadResolved(n)})),Pe=x("MarkThreadUnresolved"),Fe=H(Pe,(function(e,t){return t.api.markThreadUnresolved(e)})),Re=V("EnablePlayerIntegration"),Oe=b.syncHandler(Re),De=U("SetUpsellTooltipVariant"),xe=b.syncHandler(De),Ue=U("SetThirdPartySource"),Ve=b.syncHandler(Ue),Le=U("SetCanSeeCommentEditor"),Ne=b.syncHandler(Le),We=U("RecordEnabledStatus"),He=b.syncHandler(We),Be=U("SetPerfData"),ze=b.syncHandler(Be),qe=U("SetSubscriptionStatus"),je=b.syncHandler(qe),Ge=x("Subscribe"),Ke=H(Ge,(function(e,t){return t.api.subscribe()})),Ye=V("ToggleShowResolved"),Xe=b.syncHandler(Ye),Ze=x("Unsubscribe"),Qe=H(Ze,(function(e,t){return t.api.unsubscribe()})),Je=U("UpdateDocumentCurrentPage"),$e=b.syncHandler(Je),et=U("UpdateEditorIsEmpty"),tt=b.syncHandler(et),nt=U("UpdatePlayerCurrentTime"),rt=b.syncHandler(nt),at=U("DocMetadataLoad"),it=b.syncHandler(at),st=U("SetPendingNumberedAnnotation"),ot=b.syncHandler(st),ct=V("ClearPendingNumberedAnnotation"),ut=b.syncHandler(ct),lt=V("SetPendingNumberedAnnotationMayBeOffscreen"),dt=b.syncHandler(lt),_t=V("RequestEditorFocus"),mt=b.syncHandler(_t),pt=V("FulfillEditorFocusRequest"),gt=b.syncHandler(pt),ft=U("TrackSidebarCommentsVisibility"),vt=b.syncHandler(ft),ht=U("ResetStore"),St=b.syncHandler(ht);function bt(e,t,r){var a=this;return function(){return n.__awaiter(a,void 0,void 0,(function(){var a,i;return n.__generator(this,(function(n){return t?(a=t.viewer,i=t.stream,(a?new o.Comments2Api(a.id,i):new o.Comments2LoggedOutApi(i)).logPerfEvent(e,r),[2]):[2]}))}))}}t.ActionTypes={SetContext:B,SetContextStatus:q,ActivateThread:Y,CheckOnboardingStatus:J,CreateThread:fe,DeactivateAllThreads:Z,DeleteComment:be,EditComment:ye,EnablePlayerIntegration:Re,ListComments:G,HoverThread:se,FocusThread:ce,MarkOnboarded:le,DismissOnboarding:_e,GetMediaFeatures:ee,GetFileMetadata:ne,GetStickers:ae,MarkModalVariantShown:pe,MarkThreadRead:Ae,MarkThreadResolved:Ie,MarkThreadUnread:Ee,MarkThreadUnresolved:Pe,RecordEnabledStatus:We,ReplyToThread:he,SetCanSeeCommentEditor:Le,SetPerfData:Be,SetSubscriptionStatus:qe,SetThirdPartySource:Ue,SetUpsellTooltipVariant:De,Subscribe:Ge,ToggleShowResolved:Ye,Unsubscribe:Ze,UpdateDocumentCurrentPage:Je,UpdateEditorIsEmpty:et,UpdatePlayerCurrentTime:nt,DocMetadataLoad:at,SetPendingNumberedAnnotation:st,ClearPendingNumberedAnnotation:ct,SetPendingNumberedAnnotationMayBeOffscreen:lt,RequestEditorFocus:_t,FulfillEditorFocusRequest:pt,TrackSidebarCommentsVisibility:ft,ResetStore:ht},t.Actions={setContextStatus:j,setFileContext:O,activateComment:function(e){return function(t,n){var r=f.getThreads(n()),a=m.findCommentThread(r,e);!a||a.comment.deleted?_.showErrorSnackbar({message:i.intl.formatMessage({id:"/83u+2",defaultMessage:"That comment has been deleted."})}):a.thread.resolved&&_.showErrorSnackbar({message:i.intl.formatMessage({id:"Uu2ETy",defaultMessage:"That comment has been resolved."})}),a&&t(A({thread:a.thread,pendingAnnotationInfo:m.getAnnotationInfoForThread(a.thread)}))}},activateThread:X,activateThreadAndMarkAsRead:A,activateThreadByLayerClick:function(e,t){return function(n,r){var a=r();if(f.getIsComments2Ready(a)){var i=f.getDisplayedThreadsForLayer(a,e.page);n(Q());var s=m.getThreadForNumberedAnnotationAtPoint(e,i,t);s&&n(A({thread:s,wasPreviewLayerClick:!0}))}}},activateThreadByMarkerClick:function(e){return function(t){return n.__awaiter(void 0,void 0,void 0,(function(){var r;return n.__generator(this,(function(n){switch(n.label){case 0:return(r=u.store.getState().sidebar).open?[3,2]:[4,u.store.dispatch(w.open("annotation_select"))];case 1:n.sent(),n.label=2;case 2:return"comments"===r.activeTab?[3,4]:[4,u.store.dispatch(w.selectTab("comments"))];case 3:n.sent(),n.label=4;case 4:return t(A(e)),[2]}}))}))}},checkOnboardingStatus:$,createThread:ve,deactivateAllThreads:Q,deleteComment:we,disableCommenting:C,editComment:Te,enableCommenting:M,enablePlayerIntegration:Oe,hoverThread:oe,focusThread:ue,hoverThreadByLayer:function(e,t){return function(n,r){var a=r();if(f.getIsComments2Ready(a)){var i=f.getDisplayedThreadsForLayer(a,e.page),s=m.getThreadForNumberedAnnotationAtPoint(e,i,t);f.getHoverThreadId(a)!==(s&&s.id)&&n(oe(s&&s.id))}}},getMediaFeatures:te,getFileMetadata:re,getStickers:ie,listComments:K,markOnboarded:de,markOnboardedIfUnmarked:function(e){return function(t,n){f.getOnboardingVariants(n())[e]&&t(de(e))}},dismissOnboarding:me,markModalVariantShown:ge,markThreadRead:Me,markThreadResolved:ke,markThreadUnread:Ce,markThreadUnresolved:Fe,recordEnabledStatus:He,replyToThread:Se,setCanSeeCommentEditor:Ne,setPerfData:ze,setSubscriptionStatus:je,setThirdPartySource:Ve,setUpsellTooltipVariant:xe,subscribe:Ke,toggleShowResolved:Xe,unsubscribe:Qe,updateDocumentCurrentPage:$e,updateEditorIsEmpty:tt,updatePlayerCurrentTime:rt,setPendingNumberedAnnotation:ot,clearPendingNumberedAnnotation:ut,setPendingNumberedAnnotationMayBeOffscreen:dt,requestEditorFocus:mt,fulfillEditorFocusRequest:gt,trackSidebarCommentsVisibility:vt,openVersionHistory:function(){return function(e,t){var n=t(),r=f.getViewerId(n),i=f.getFQPath(n);if(i&&r){var s=S.getFileHistoryUrl({fqPath:i,userId:r});a.redirect(s)}}},docMetadataLoad:it,logPerfEvent:function(e,t){var r=this;return function(a,i){return n.__awaiter(r,void 0,void 0,(function(){var r;return n.__generator(this,(function(n){return r=f.getContext(i()),a(bt(e,r,t)),[2]}))}))}},logSimplePerfEvent:function(e,t){var r=this;return function(a,i){return n.__awaiter(r,void 0,void 0,(function(){var r,a;return n.__generator(this,(function(n){return r=i(),(a=f.getContext(r))&&a.viewer&&new o.Comments2Api(a.viewer.id,a.stream).logSimplePerfEvent(e,t),[2]}))}))}},resetStore:St}})),define("modules/clean/react/watermarking/watermarking_layer",["require","exports","tslib","react","react-redux","modules/clean/react/css","modules/clean/react/file_viewer/data/actions","modules/clean/react/watermarking/drawing","modules/clean/react/watermarking/selectors","modules/clean/react/watermarking/utils","modules/clean/react/watermarking/types"],(function(e,t,n,r,a,i,s,o,c,u,l){"use strict";function d(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");if(!n)return 0;n.drawImage(e,0,0);for(var r,a,i,s=n.getImageData(0,0,t.width,t.height).data,o=0,c=0,u=s.length;c<u;c+=4)r=s[c],a=s[c+1],i=s[c+2],o+=Math.floor((r+a+i)/3);return Math.floor(o/(e.width*e.height))}Object.defineProperty(t,"__esModule",{value:!0});var _=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.updateWatermarkColor=function(){var e=t.props,n=e.thumbUrl,r=e.watermark;n?(t.img=new Image,t.img.crossOrigin="use-credentials",t.img.onload=function(){var e=d(t.img)<127?"white":"black";t.setTextWatermark({color:e})},t.img.src=n):t.setTextWatermark({color:r.textWatermarkingOptions.color})},t.updateWatermarkFontSize=function(){var e=t.props,n=e.pageDimensions,r=e.watermark;if(n){var a=r.textWatermarkingOptions.size,i=Math.floor((n.width+n.height)/2),s=Math.floor(i/200),o=Math.floor(i/5),c=a!==u.DEFAULT_WATERMARKING_STATE.textWatermarkingOptions.size&&s<a&&a<o?a:Math.floor(i/40);t.setTextWatermark({size:c,minSize:s,maxSize:o})}},t.canvasRef=function(e){t.canvas=e},t.redraw=function(){var e=t.props,n=e.tilingFunc,r=e.watermark;if(n&&t.canvas&&r){var a=t.canvas.getContext("2d");if(a){var i=l.getWatermarkingOptions(r),s=t.getCanvasSize(),c=s.canvasWidth,d=s.canvasHeight,_=s.scale;if(a.clearRect(0,0,c,d),i.position!==l.WatermarkPosition.REPEAT){var m,p=i.angle/180*Math.PI;if(r.mode===l.WatermarkingMode.TEXT){if(!(g=r.textWatermarkingOptions).text)return;m=o.drawTextTile(g.text,g.size*_,g.fontFamily,g.color,g.opacity/100,p).canvas}else{var g;if(!(g=r.imageWatermarkingOptions).image)return;m=o.drawImageTile(g.image,g.size*_,g.opacity/100,p).canvas}if(m){var f=i.marginX*_,v=i.marginY*_,h=f,S=v;switch(i.position){case l.WatermarkPosition.CENTER:h=(c-m.width)/2,S=(d-m.height)/2;break;case l.WatermarkPosition.NORTHEAST:h=c-m.width-f;break;case l.WatermarkPosition.SOUTHWEST:S=d-m.height-v;break;case l.WatermarkPosition.SOUTHEAST:h=c-m.width-f,S=d-m.height-v}a.drawImage(m,h,S)}}else{var b=void 0;try{b=n(_)}catch(e){if(e.message===u.WatermarkingError.TILE_NO_INPUT)return;throw e}for(var w=0,y=0,T=(b.startY+y)%b.distanceY-b.height;T<d;T+=b.distanceY){for(var A=(b.startX+w)%b.distanceX-b.width;A<c;A+=b.distanceX)a.drawImage(b.canvas,A,T);w+=b.offsetXPerRow,y+=b.offsetYPerCol}}}}},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.updateWatermarkColor(),this.updateWatermarkFontSize(),this.redraw(),this.props.pageDimensions&&this.props.setPageDimensions(this.props.pageDimensions)},t.prototype.componentDidUpdate=function(e){this.props.thumbUrl!==e.thumbUrl&&this.updateWatermarkColor(),this.redraw()},t.prototype.setTextWatermark=function(e){var t=this.props,n=t.updateWatermarkOptions;t.watermark.mode===l.WatermarkingMode.TEXT&&n({textWatermarkingOptions:e})},t.prototype.getCanvasSize=function(){var e=this.props.layerSize.width,t=this.props.pageDimensions||this.props.layerSize,n=t.width,r=t.height,a=e/n;if(this.props.watermark){var i=l.getWatermarkingOptions(this.props.watermark);a=Math.min(a,i.scale)}return{canvasWidth:Math.round(n*a),canvasHeight:Math.round(r*a),scale:a}},t.prototype.render=function(){var e=this.props,t=e.watermark,n=e.tilingFunc;if(!t||!n)return null;var a=this.props.layerSize,i=a.width,s=a.height,o=this.getCanvasSize(),c=o.canvasWidth,u=o.canvasHeight,l={width:i+"px",height:s+"px"};return r.default.createElement("canvas",{ref:this.canvasRef,className:"fv-watermarking-layer",style:l,width:c,height:u})},t})((r=n.__importDefault(r)).default.PureComponent);t._WatermarkingLayer=_;var m=a.connect((function(e){return{watermark:c.getWatermarkState(e),tilingFunc:c.getWatermarkTilingFunc(e)}}),{updateWatermarkOptions:s.updateWatermarkOptions,setPageDimensions:s.setPageDimensions});t.ConnectedWatermarkingLayer=m(_);var p=i.requireCssWithComponent(t.ConnectedWatermarkingLayer,["/static/css/file_viewer/watermarking_layer-vflNek1am.css"]);t.WatermarkingLayer=p})),define("modules/clean/react/file_sidebar/file_sidebar_logger",["require","exports","tslib","modules/clean/ajax","modules/clean/react/file_viewer/models"],(function(e,t,n,r,a){"use strict";function i(e,t){var n=a.FileViewerSession.currentSession,i=a.FilePreviewSession.currentSession;if(i&&n){var s={event_name:e,file_viewer_session_id:n.id,file_preview_session_id:i.id,file_ns_id:i.file.ns_id,file_sjid:i.file.sjid,extra:JSON.stringify(t)};r.SilentBackgroundRequest({url:"/log/file_sidebar",data:s})}}Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importStar(r),t.logSidebarTabSelected=function(e){i("sidebar_tab_selected",e)},t.logSidebarOpened=function(e){i("sidebar_opened",e)},t.logSidebarClosed=function(e){i("sidebar_closed",e)},t.logActivityStreamInteractivity=function(e){i("activity_stream_interactivity",e)},t.logFileViewActivityCardExpanded=function(e){i("file_view_activity_expanded",e)}})),define("modules/clean/react/previews/toolbar_flip_buttons",["require","exports","tslib","react","external/lodash","classnames","file-viewer/toolbar","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants","modules/core/i18n"],(function(e,t,n,r,a,i,s,o,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importDefault(r),a=n.__importStar(a),i=n.__importDefault(i),t.ToolbarFlipButtons=function(e){var t=e.className,n=e.count,l=e.index,d=e.onClickNext,_=void 0===d?a.noop:d,m=e.onClickPrevious,p=void 0===m?a.noop:m;return null==n||null==l||n<1?null:r.default.createElement(s.ToolbarFlipButtons,{buttonClassName:"toolbar-button-entry",className:i.default("flip-buttons","image-toolbar__item",t),count:n,intl:u.intl,index:l,onClickPrevious:o.wrapToolbarActionWithLogging(p,c.UserAction.FlipPrevious),onClickNext:o.wrapToolbarActionWithLogging(_,c.UserAction.FlipNext)})}})),define("modules/clean/open_in_app/actions",["require","exports","tslib","modules/clean/open_in_app/types","modules/clean/open_in_mobile_app"],(function(e,t,n,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importDefault(a),t.openInApp=function(e,t){var n,i=t.onAppNeeded,s=t.onAppInstalled;r.areUrlsIOS(e)?a.default.open_ios(e.iOSAppUrl,e.iOSAppStoreUrl,!(n=(navigator.userAgent||"").match(/OS (\d+)_(\d+)_?(\d+)?/))||parseInt(n[1],10)>=9,i,s):r.areUrlsAndroid(e)&&a.default.open_android_intent(e.androidAppUrl)},t.openImmediately=function(e){var t;if(r.areUrlsIOS(e))t=e.iOSAppUrl;else{if(!r.areUrlsAndroid(e))return;t=e.androidAppUrl}var n=document.createElement("iframe");n.setAttribute("class","open-in-app-transport"),n.setAttribute("src",t),n.setAttribute("style","display: none"),document.body.appendChild(n)},t.cleanUp=function(){a.default.cleanup()}})),define("modules/clean/open_in_mobile_app",["require","exports","tslib","jquery","modules/clean/analytics","modules/core/exception","modules/core/i18n","spectrum-sharing/utils/sharing_constants"],(function(e,t,n,r,a,i,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importDefault(r),a=n.__importStar(a);var c=(function(){function e(){}return e.initClass=function(){var e=this;this.vischange_listener=null,this.open_app_mode=!0,this.try_open_ios_9=function(t,n,r,a){return void 0===r&&(r=function(){}),void 0===a&&(a=function(){}),e.vischange_listener||(e.vischange_listener=function(t){return e.open_app_mode=!0,a()},document.addEventListener("visibilitychange",e.vischange_listener)),e.open_app_mode?(e.open_app_mode=!1,e._onOpenLoggingHandler(),r(),window.location=t):(e._onInstallLoggingHandler(),window.location=n)},this.fallback_will_launch=!1,this.try_open=function(t,n,i){if(e._onOpenLoggingHandler(),!e.fallback_will_launch){var s=r.default("body"),c=!1,u=function(e){return c=!0};document.addEventListener("visibilitychange",u);var l,d=!1,_=function(e){return d=!0};window.addEventListener("pagehide",_),null!=i&&a.ShareTibEventLogger.log_unauth("CLICK_MOBILE_OPEN",o.SHARE_ACTION_ORIGIN_TYPE.WEB_MOBILE,{scl_url:i}),l=r.default("<iframe />",{src:t,style:"display: none;"}),s.append(l);var m=Date.now();return setTimeout((function(){if(e.fallback_will_launch=!1,document.removeEventListener("visibilitychange",u),window.removeEventListener("pagehide",_),!d&&!c&&Date.now()<m+4700)return null!=i&&a.ShareTibEventLogger.log_unauth("CLICK_MOBILE_INSTALL",o.SHARE_ACTION_ORIGIN_TYPE.WEB_MOBILE,{scl_url:i}),window.location.replace(n)}),3200),e.fallback_will_launch=!0}}},e._onOpenLoggingHandler=function(){},e._onInstallLoggingHandler=function(){},e.registerLoggingHandlers=function(e,t){return this._onOpenLoggingHandler=e,this._onInstallLoggingHandler=t},e.open_on_click=function(e,t,n,a,i,o,c){var u=this;void 0===o&&(o=null);return r.default(n).on("click",(function(n){if(n.preventDefault(),c)return u.open_android_intent(c);if(i){a||(a=r.default("<div/>"));var l=a.text();return u.try_open_ios_9(e,t,(function(){return a.text(s.intl.formatMessage({id:"RgopQo",defaultMessage:"Install app?"}))}),(function(){return a.text(l)}))}return u.try_open(e,t,o)}))},e.open_ios=function(e,t,n,r,a){return void 0===r&&(r=function(){}),void 0===a&&(a=function(){}),n?this.try_open_ios_9(e,t,r,a):this.try_open(e,t)},e.open_android_intent=function(e){return i.assert(e&&e.startsWith("intent://www.dropbox.com/sm/launch_intent_or_fallback_page"),"intentUrl must use intent:// protocol"),this._onOpenLoggingHandler&&this._onOpenLoggingHandler(),window.location.href=e},e.redirect_on_load=function(e,t){return this.try_open(e,t)},e.cleanup=function(){if(this.vischange_listener)return document.removeEventListener("visibilitychange",this.vischange_listener)},e})();c.initClass(),t.default=c})),define("modules/clean/react/file_viewer/controller_mode",["require","exports","modules/clean/api_v2/noauth_client","modules/clean/api_v2/user_client"],(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchControllerMode=function(e,t){return null!=t?(function(e,t){return(new r.UserApiV2Client).ns("file_viewer").rpc("get_mode",e,{subjectUserId:t.id})})(e,t):(function(e){return(new n.NoAuthApiV2Client).ns("file_viewer").rpc("logged_out/get_mode",e,{})})(e)}})),define("modules/clean/react/file_viewer/data/actions",["require","exports","tslib","modules/clean/ajax","modules/clean/react/file_viewer/constants","modules/clean/file_store/actions","modules/clean/previews/data/actions","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/data/selectors","modules/clean/file_store/utils","modules/clean/react/file_viewer/data/types","modules/clean/previews/data/util","modules/clean/react/file_viewer/constants","modules/clean/downloads","modules/core/uri","modules/core/browser","modules/clean/react/file_viewer/controller_mode","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/watermarking/utils","file-viewer/core","modules/clean/react/workflows/markup/fabric","modules/clean/react/workflows/markup/selectors","modules/clean/react/file_viewer/prompt/campaign_api","modules/clean/react/size_class/constants","modules/clean/react/watermarking/selectors","modules/clean/react/file_viewer/ml_experiment","modules/clean/react/branding/api"],(function(e,t,n,r,a,i,s,o,c,u,l,d,_,m,p,g,f,v,h,S,b,w,y,T,A,M,E,C){"use strict";function I(e){return{type:l.Actions.OpenFile,payload:{fileId:e}}}function k(e){return function(t,n){var r,a=((r={})[b.FileViewerMode.Default]=H,r[b.FileViewerMode.Documentation]=z,r[b.FileViewerMode.Commenting]=q,r[b.FileViewerMode.Watermarking]=j,r[b.FileViewerMode.Zoom]=G,r[b.FileViewerMode.Slack]=K,r[b.FileViewerMode.Markup]=Y,r[b.FileViewerMode.Plugins]=Z,r[b.FileViewerMode.HelloSign]=Q,r[b.FileViewerMode.ProAnalytics]=X,r);a[e]&&a[e](t,n)}}function P(e){return h.filePreviewEventEmitter.emit(_.EventType.SidebarModeSelected,v.FilePreviewSession.currentSession,{selected_mode:e}),{type:l.Actions.UpdateMode,payload:{mode:e}}}function F(e){return function(t,n){var r=c.getCurrentFileId(n());r&&t((function(e,t){return{type:l.Actions.UpdateRenderStatus,payload:{fileId:e,renderStatus:t}}})(r,e))}}function R(e){return h.filePreviewEventEmitter.emit(_.EventType.SidebarPaneSelected,v.FilePreviewSession.currentSession,{selected_pane:e}),{type:l.Actions.PushSidebarPane,payload:{paneId:e}}}function O(){return{type:l.Actions.ResetSidebarPaneStack}}function D(){return{type:l.Actions.ResetSelectedSidebarControlId}}function x(e){return{type:l.Actions.SetSelectedSidebarControlId,payload:{controlId:e}}}function U(e){var t=e===b.SidebarVisibility.Open?_.EventType.SidebarOpened:_.EventType.SidebarClosed;return h.filePreviewEventEmitter.emit(t,v.FilePreviewSession.currentSession),{type:l.Actions.SetSidebarVisibility,payload:{visibility:e}}}function V(e){return function(t,n){t({type:l.Actions.UpdateWatermarkOptions,payload:{options:e}}),S.setLocalStorageWatermarkingState(c.getCurrentUser(n()),M.getWatermarkState(n()))}}function L(e){return function(t,n){t({type:l.Actions.SwitchWatermarkingMode,payload:{mode:e}}),S.setLocalStorageWatermarkingState(c.getCurrentUser(n()),M.getWatermarkState(n()))}}function N(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){var a,i;return n.__generator(this,(function(s){switch(s.label){case 0:return[4,S.getUserMetadataTextWatermarkingState(e)];case 1:return a=s.sent(),[4,S.getLocalStorageWatermarkingState(e)];case 2:return(i=s.sent())?(V({textWatermarkingOptions:n.__assign(n.__assign({},i.textWatermarkingOptions),a),imageWatermarkingOptions:i.imageWatermarkingOptions})(t,r),L(i.mode)(t,r)):a?V({textWatermarkingOptions:a})(t,r):V({textWatermarkingOptions:{text:S.getDefaultText(e)}})(t,r),[2]}}))}))}function W(e){return{type:l.Actions.SetTrialMode,payload:{isTrialMode:e}}}function H(e,t){var n=t(),r=c.getMode(n);e(W(!1)),e(D()),r!==b.FileViewerMode.Default&&e(P(b.FileViewerMode.Default))}function B(e,t,n,r){return function(a,i){var s=i(),o=c.getSidebar(s).visibility,u=c.getMode(s);o===b.SidebarVisibility.Closed&&a(U(b.SidebarVisibility.Open)),u!==e&&(a(W(!!r&&r(s))),a(x(t)),a(O()),a(R(n)),a(P(e)))}}Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importStar(r),m=n.__importStar(m),g=n.__importStar(g),t.openFullScreen=function(){return{type:l.Actions.OpenFullScreen}},t.closeFullScreen=function(){return{type:l.Actions.CloseFullScreen}},t.openSidebar=function(e,t){return void 0===e&&(e=a.DocType.default),function(n){n({type:l.Actions.OpenSidebar,payload:{type:e}}),o.logUserAction(a.UserAction.ToggleSidebarOn,t)}},t.closeSidebar=function(e,t){return void 0===e&&(e=a.DocType.default),function(n){n({type:l.Actions.CloseSidebar,payload:{type:e}}),o.logUserAction(a.UserAction.ToggleSidebarOff,t)}},t.dismissAppDownloadInterstitial=function(){return{type:l.Actions.DismissAppDownloadInterstitial}},t.openFileById=I,t.closeFile=function(){return{type:l.Actions.CloseFile}},t.changeMode=k,t.disableMode=function(e){return{type:l.Actions.DisableMode,payload:{mode:e}}},t.enableMode=function(e){return{type:l.Actions.EnableMode,payload:{mode:e}}},t.updateMode=P,t.openFile=function(e){var t=this;return function(r,a){return n.__awaiter(t,void 0,void 0,(function(){var t,o;return n.__generator(this,(function(n){return t=u.getFileStoreId(e),o=i.putFile(e),r(o),!d.previewDataPresentForFile(a(),e)&&!d.previewDataInFlight(a(),e)&&(o.payload.file.preview?r(s.populateFilesPreviewData([o.payload.file])):r(s.fetchPreviewData([o.payload.file]))),r(I(t)),[2]}))}))}},t.setRenderStatusForCurrentFile=F,t.setRenderStatusSuccessForCurrentFile=function(){return F(_.PreviewRenderStatus.Succeeded)},t.fetchShowOverQuotaUpsell=function(e){return function(t,n){e&&void 0===c.getShowOverQuotaUpsell(n())&&r.SilentBackgroundRequest({url:"/should_show_file_preview_upsell",data:{_subject_uid:e.id},success:function(e){try{var n=JSON.parse(e);n&&t((r=n.shouldShowFilePreviewUpsell,{type:l.Actions.SetShowOverQuotaUpsell,payload:r}))}catch(e){}var r}})}},t.pushSidebarPane=R,t.popSidebarPane=function(){return{type:l.Actions.PopSidebarPane}},t.resetSidebarPaneStack=O,t.resetSelectedSidebarControlId=D,t.setSelectedSidebarControlId=x,t.setSidebarVisibility=U,t.setPageDimensions=function(e){return{type:l.Actions.SetPageDimensions,payload:{pageDimensions:e}}},t.updateWatermarkOptions=V,t.switchWatermarkingMode=L,t.setMarkupCanvas=function(e,t,n){return{type:l.Actions.SetMarkupCanvas,payload:{page:e,fabric:t,scale:n}}},t.updateMarkupCanvasScale=function(e,t){return{type:l.Actions.UpdateMarkupCanvasScale,payload:{page:e,scale:t}}},t.setMarkupDrawingMode=function(e){return function(t,n){t({type:l.Actions.SetMarkupDrawingMode,payload:{isDrawingMode:e}}),w.setDrawingMode(y.getMarkupState(n()),e)}},t.setMarkupStroke=function(e){return function(t){t({type:l.Actions.SetMarkupStroke,payload:{color:e}}),w.setBaseBrushColor(e)}},t.setMarkupFill=function(e){return{type:l.Actions.SetMarkupFill,payload:{color:e}}},t.setMarkupFormatSubmenu=function(e){return{type:l.Actions.SetMarkupSubmenuType,payload:{formatSubmenu:e}}},t.resetMarkupState=function(){return function(e,t){w.disposeCanvas(y.getMarkupState(t())),e({type:l.Actions.ResetMarkupState})}},t.switchRevisionAction=function(e){return function(t){e.preview&&t(s.overridePreviewForComments(e,e.preview)),t({type:l.Actions.SwitchRevision,payload:{file:e}})}},t.restoreRevisionAction=function(){return function(e,t){var n=c.getActiveFile(t());n&&e(s.clearCommentsPreviewOverride(n)),e({type:l.Actions.RestoreRevision})}},t.saveForwardRevision=function(e){return function(t){t(i.putFile(e,e.revision_id)),e.preview&&t(s.overridePreviewForComments(e,e.preview)),t({type:l.Actions.SaveForwardRevision,payload:{revisionKey:e.revision_id}})}},t.download=function(e){var t=p.URI.parse(e.href);t.updateQuery({dl:"1"}),m.get({url:t.toString()})},t.pendingFileUploaded=function(){g.reload(!0)},t.setMediaPlaying=function(){return function(e){e({type:l.Actions.PlayMedia})}},t.setMediaPaused=function(){return function(e){e({type:l.Actions.PauseMedia})}},t.resetFileViewerStore=function(){return function(e){e({type:l.Actions.ResetStore})}},t.forceHideToolbar=function(){return{type:l.Actions.ForceHideToolbar}},t.disableForceHideToolbar=function(){return{type:l.Actions.DisableForceHideToolbar}},t.fetchControllerModeAction=function(e,t,r){var a=this;return function(i,s){return n.__awaiter(a,void 0,void 0,(function(){var a,o,u,d;return n.__generator(this,(function(n){switch(n.label){case 0:i({type:l.Actions.FetchControllerModeRequest}),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,f.fetchControllerMode(e,t)];case 2:return a=n.sent().mode,h.filePreviewEventEmitter.emit(_.EventType.FilePreviewModeDetermined,v.FilePreviewSession.currentSession,{mode:a}),r===A.SizeClass.Small||r===A.SizeClass.Medium?(i(x(b.SidebarControlId.Documentation)),i(R(b.SidebarPaneId.Documentation)),i(P(b.FileViewerMode.Documentation)),[2]):(o=(function(e){var t=b.FileViewerMode.Default;if(e)switch(e[".tag"]){case"commenting_mode":t=b.FileViewerMode.Commenting;break;case"documentation_mode":t=b.FileViewerMode.Documentation;break;case"other":t=b.FileViewerMode.Default}return t})(a),(u=c.getMode(s()))&&u!==b.FileViewerMode.Default||i(k(o)),[3,4]);case 3:return d=n.sent(),i({type:l.Actions.FetchControllerModeError,payload:d}),[3,4];case 4:return[2]}}))}))}},t.fetchActiveUserBrandingInfoAction=function(e){var t=this;return function(r,a){return n.__awaiter(t,void 0,void 0,(function(){var t,a,i,s,o,c;return n.__generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,Promise.all([C.getLogo(e.id),C.getName(e.id)])];case 1:return t=n.sent(),a=t[0],i=t[1],s=null,"image"===(null==(o=null===(c=null==a?void 0:a.graphic)||void 0===c?void 0:c.value)?void 0:o[".tag"])&&o.original_url&&(s=o.original_url),r({type:l.Actions.SetActiveUserBrandingInfo,payload:{activeUserBrandingInfo:{logoUrl:s,organizationName:i}}}),[3,3];case 2:return n.sent(),[3,3];case 3:return[2]}}))}))}},t.fetchBestCampaignsAction=function(e,t){var r=this;return function(a,i){return n.__awaiter(r,void 0,void 0,(function(){var r;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,T.fetchBestCampaigns(e.id,t)];case 1:return r=n.sent().campaigns,a({type:l.Actions.SetBestCampaign,payload:{campaign:r[0]}}),[2]}}))}))}},t.fetchDocClassificationAction=function(e,t){var r=this;return function(a,i){return n.__awaiter(r,void 0,void 0,(function(){var r;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,E.fetchDocClassification(e,t)];case 1:return r=n.sent().predicted_types,a({type:l.Actions.SetDocClassification,payload:{docClassification:{predicted_types:r},fileId:t}}),[2]}}))}))}},t.updateCurrentPageIndex=function(e){return{type:l.Actions.UpdateCurrentPageIndex,payload:{currentPageIndex:e}}},t.pageDown=function(){return{type:l.Actions.PageDown}},t.pageUp=function(){return{type:l.Actions.PageUp}},t.registerUser=function(e){return function(t,n){t({type:l.Actions.RegisterUser,payload:{user:e}}),N(e,t,n)}},t.loadWatermarkingStateFromStorage=N;var z=B(b.FileViewerMode.Documentation,b.SidebarControlId.Documentation,b.SidebarPaneId.Documentation),q=B(b.FileViewerMode.Commenting,b.SidebarControlId.Comments,b.SidebarPaneId.Comments),j=B(b.FileViewerMode.Watermarking,b.SidebarControlId.Watermarking,b.SidebarPaneId.Watermarking,(function(e){return S.allowWatermarkTrial(c.getCurrentUser(e))})),G=B(b.FileViewerMode.Zoom,b.SidebarControlId.Zoom,b.SidebarPaneId.Zoom),K=B(b.FileViewerMode.Slack,b.SidebarControlId.Slack,b.SidebarPaneId.SlackHome),Y=B(b.FileViewerMode.Markup,b.SidebarControlId.Markup,b.SidebarPaneId.Markup),X=B(b.FileViewerMode.ProAnalytics,b.SidebarControlId.ProAnalytics,b.SidebarPaneId.ProAnalytics),Z=function(){},Q=function(){};t.overflowZoomOn=function(){return{type:l.Actions.OverflowZoomOn}},t.overflowZoomOff=function(){return{type:l.Actions.OverflowZoomOff}}})),define("modules/clean/react/file_viewer/data/reducer",["require","exports","tslib","modules/clean/react/file_viewer/data/types","modules/clean/react/watermarking/utils","modules/clean/react/file_viewer/constants","file-viewer/core","modules/clean/react/workflows/markup/utils"],(function(e,t,n,r,a,i,s,o){"use strict";var c;Object.defineProperty(t,"__esModule",{value:!0}),t.defaultState={currentFileId:void 0,currentPageIndex:0,fileRevision:void 0,latestFileId:void 0,forceHideToolbar:!1,isFullScreen:!1,isSidebarOpen:(c={},c[i.DocType.ppt]=!0,c[i.DocType.pdf]=!1,c),mode:s.FileViewerMode.Default,disabledModes:{},renderStatuses:{},showOverQuotaUpsell:void 0,sidebar:{visibility:s.SidebarVisibility.Closed,paneStack:[],selectedControlId:void 0},watermark:a.DEFAULT_WATERMARKING_STATE,markup:o.DEFAULT_MARKUP_STATE,campaign:void 0,activeUserBrandingInfo:void 0,overflowZoom:!1,docClassifications:{},docClassificationVariant:null},t.fileViewerReducer=function(e,a){var i,c,u,l,d,_,m,p;switch(void 0===e&&(e=t.defaultState),a.type){case r.Actions.CloseFile:return n.__assign(n.__assign({},e),{currentFileId:void 0,fileRevision:void 0,latestFileId:void 0});case r.Actions.OpenFile:var g=a.payload;return n.__assign(n.__assign({},e),{currentFileId:g.fileId,fileRevision:void 0,latestFileId:void 0});case r.Actions.SwitchRevision:g=a.payload;return n.__assign(n.__assign({},e),{fileRevision:g.file});case r.Actions.RestoreRevision:return n.__assign(n.__assign({},e),{fileRevision:void 0,currentFileId:e.latestFileId||e.currentFileId,latestFileId:void 0});case r.Actions.SetPageDimensions:var f=a.payload.pageDimensions;return n.__assign(n.__assign({},e),{pageDimensions:f});case r.Actions.UpdateWatermarkOptions:var v=a.payload.options;return n.__assign(n.__assign({},e),{watermark:n.__assign(n.__assign({},e.watermark),{textWatermarkingOptions:n.__assign(n.__assign({},e.watermark.textWatermarkingOptions),v.textWatermarkingOptions),imageWatermarkingOptions:n.__assign(n.__assign({},e.watermark.imageWatermarkingOptions),v.imageWatermarkingOptions)})});case r.Actions.SwitchWatermarkingMode:var h=a.payload.mode;return n.__assign(n.__assign({},e),{watermark:n.__assign(n.__assign({},e.watermark),{mode:h})});case r.Actions.SetMarkupCanvas:var S=a.payload,b=S.page,w=S.fabric,y=S.scale;return n.__assign(n.__assign({},e),{markup:n.__assign(n.__assign({},e.markup),(i={},i[b]={scale:y,fabric:w},i))});case r.Actions.UpdateMarkupCanvasScale:var T=a.payload;b=T.page,y=T.scale;return n.__assign(n.__assign({},e),{markup:n.__assign(n.__assign({},e.markup),(c={},c[b]=n.__assign(n.__assign({},e.markup[b]),{scale:y}),c))});case r.Actions.ResetMarkupState:return n.__assign(n.__assign({},e),{markup:o.DEFAULT_MARKUP_STATE});case r.Actions.SetMarkupDrawingMode:var A=a.payload.isDrawingMode;return n.__assign(n.__assign({},e),{markup:n.__assign(n.__assign({},e.markup),{isDrawingMode:A})});case r.Actions.SetMarkupFill:var M=a.payload.color;return n.__assign(n.__assign({},e),{markup:n.__assign(n.__assign({},e.markup),{fillColor:M})});case r.Actions.SetMarkupStroke:M=a.payload.color;return n.__assign(n.__assign({},e),{markup:n.__assign(n.__assign({},e.markup),{strokeColor:M})});case r.Actions.SetMarkupSubmenuType:var E=a.payload.formatSubmenu;return n.__assign(n.__assign({},e),{markup:n.__assign(n.__assign({},e.markup),{formatSubmenu:E})});case r.Actions.SaveForwardRevision:g=a.payload;return n.__assign(n.__assign({},e),{latestFileId:g.revisionKey});case r.Actions.UpdateMode:g=a.payload;return n.__assign(n.__assign({},e),{mode:g.mode});case r.Actions.DisableMode:g=a.payload;return n.__assign(n.__assign({},e),{disabledModes:n.__assign(n.__assign({},e.disabledModes),(u={},u[g.mode]=!0,u))});case r.Actions.EnableMode:g=a.payload;return n.__assign(n.__assign({},e),{disabledModes:n.__assign(n.__assign({},e.disabledModes),(l={},l[g.mode]=!1,l))});case r.Actions.OpenFullScreen:return n.__assign(n.__assign({},e),{isFullScreen:!0});case r.Actions.CloseFullScreen:return n.__assign(n.__assign({},e),{isFullScreen:!1});case r.Actions.OpenSidebar:g=a.payload;return n.__assign(n.__assign({},e),{isSidebarOpen:n.__assign(n.__assign({},e.isSidebarOpen),(d={},d[g.type]=!0,d))});case r.Actions.CloseSidebar:g=a.payload;return n.__assign(n.__assign({},e),{isSidebarOpen:n.__assign(n.__assign({},e.isSidebarOpen),(_={},_[g.type]=!1,_))});case r.Actions.DismissAppDownloadInterstitial:return n.__assign(n.__assign({},e),{appDownloadInterstitialDismissed:!0});case r.Actions.SetShowOverQuotaUpsell:g=a.payload;return n.__assign(n.__assign({},e),{showOverQuotaUpsell:g});case r.Actions.UpdateRenderStatus:g=a.payload;return n.__assign(n.__assign({},e),{renderStatuses:n.__assign(n.__assign({},e.renderStatuses),(m={},m[g.fileId]=g.renderStatus,m))});case r.Actions.PlayMedia:return n.__assign(n.__assign({},e),{isMediaPlaying:!0});case r.Actions.PauseMedia:return n.__assign(n.__assign({},e),{isMediaPlaying:!1,pauseCount:e.pauseCount?e.pauseCount+1:1});case r.Actions.ResetStore:return t.defaultState;case r.Actions.UpdateCurrentPageIndex:g=a.payload;return n.__assign(n.__assign({},e),{currentPageIndex:g.currentPageIndex});case r.Actions.ForceHideToolbar:return n.__assign(n.__assign({},e),{forceHideToolbar:!0});case r.Actions.DisableForceHideToolbar:return n.__assign(n.__assign({},e),{forceHideToolbar:!1});case r.Actions.PopSidebarPane:return e.sidebar.paneStack.length<1?e:n.__assign(n.__assign({},e),{sidebar:n.__assign(n.__assign({},e.sidebar),{paneStack:e.sidebar.paneStack.slice(0,-1)})});case r.Actions.PushSidebarPane:g=a.payload;return e.sidebar.paneStack.includes(g.paneId)?e:n.__assign(n.__assign({},e),{sidebar:n.__assign(n.__assign({},e.sidebar),{paneStack:n.__spreadArrays(e.sidebar.paneStack,[g.paneId])})});case r.Actions.SetSelectedSidebarControlId:g=a.payload;return n.__assign(n.__assign({},e),{sidebar:n.__assign(n.__assign({},e.sidebar),{selectedControlId:g.controlId})});case r.Actions.ResetSidebarPaneStack:return n.__assign(n.__assign({},e),{sidebar:n.__assign(n.__assign({},e.sidebar),{paneStack:[]})});case r.Actions.ResetSelectedSidebarControlId:return n.__assign(n.__assign({},e),{sidebar:n.__assign(n.__assign({},e.sidebar),{selectedControlId:void 0})});case r.Actions.SetSidebarVisibility:g=a.payload;return n.__assign(n.__assign({},e),{sidebar:n.__assign(n.__assign({},e.sidebar),{visibility:g.visibility})});case r.Actions.FetchControllerModeError:return n.__assign(n.__assign({},e),{mode:s.FileViewerMode.Commenting});case r.Actions.SetActiveUserBrandingInfo:g=a.payload;return n.__assign(n.__assign({},e),{activeUserBrandingInfo:g.activeUserBrandingInfo});case r.Actions.SetBestCampaign:g=a.payload;return n.__assign(n.__assign({},e),{campaign:g.campaign});case r.Actions.SetDocClassification:g=a.payload;return n.__assign(n.__assign({},e),{docClassifications:n.__assign(n.__assign({},e.docClassifications),(p={},p[g.fileId]=g.docClassification,p))});case r.Actions.PageDown:return void 0===(C=e.currentPageIndex)?e:n.__assign(n.__assign({},e),{currentPageIndex:C+1});case r.Actions.PageUp:var C;return void 0===(C=e.currentPageIndex)?e:n.__assign(n.__assign({},e),{currentPageIndex:C-1});case r.Actions.RegisterUser:g=a.payload;return n.__assign(n.__assign({},e),{currentUser:g.user});case r.Actions.SetTrialMode:g=a.payload;return n.__assign(n.__assign({},e),{isTrialMode:g.isTrialMode});case r.Actions.OverflowZoomOn:return n.__assign(n.__assign({},e),{overflowZoom:!0});case r.Actions.OverflowZoomOff:return n.__assign(n.__assign({},e),{overflowZoom:!1});default:return e}}})),define("modules/clean/react/file_viewer/data/selectors",["require","exports","tslib","modules/clean/redux/namespaces","modules/clean/redux/selectors","modules/clean/file_store/selectors","modules/clean/previews/data/selectors","modules/clean/react/file_viewer/constants","modules/clean/previews/data/preview_type_util","reselect","external/lodash","modules/clean/react/extensions/data/selectors","modules/clean/react/extensions/client","file-viewer/core"],(function(e,t,n,r,a,i,s,o,c,u,l,d,_,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),l=n.__importStar(l),t.getFileViewerState=function(e){return a.getStateAtNamespace(e,r.FILE_VIEWER_NAMESPACE_KEY)},t.getIsFullScreen=function(e){return t.getFileViewerState(e).isFullScreen},t.getIsSidebarOpen=function(e){return t.getFileViewerState(e).isSidebarOpen},t.getCurrentPageIndex=function(e){return t.getFileViewerState(e).currentPageIndex},t.getAppDownloadInterstitial=function(e){return t.getFileViewerState(e).appDownloadInterstitialDismissed},t.getCurrentFileId=function(e){return t.getFileViewerState(e).currentFileId},t.getCurrentFile=u.createSelector(l.nthArg(0),t.getCurrentFileId,i.getFile),t.getPastFile=function(e){return t.getFileViewerState(e).fileRevision},t.getCurrentUser=function(e){return t.getFileViewerState(e).currentUser},t.getMode=function(e){return t.getFileViewerState(e).mode},t.getDisabledModes=function(e){return t.getFileViewerState(e).disabledModes},t.getSidebar=function(e){return t.getFileViewerState(e).sidebar},t.getAnnotationAllowed=u.createSelector(t.getMode,(function(e){return e===m.FileViewerMode.Commenting})),t.getIsTrialMode=function(e){return t.getFileViewerState(e).isTrialMode},t.getIsEditMode=function(e){return t.getIsMarkupMode(e)||t.getIsWatermarkingMode(e)},t.getIsWatermarkingMode=function(e){return t.getMode(e)===m.FileViewerMode.Watermarking},t.getIsMarkupMode=function(e){return t.getMode(e)===m.FileViewerMode.Markup},t.getPageDimensions=function(e){return t.getFileViewerState(e).pageDimensions},t.getActiveFile=function(e){return t.getPastFile(e)||t.getCurrentFile(e)},t.getShowOverQuotaUpsell=function(e){return t.getFileViewerState(e).showOverQuotaUpsell};t.getSelectedPromptCampaign=function(e){return t.getFileViewerState(e).campaign},t.getActiveUserBrandingInfo=function(e){return t.getFileViewerState(e).activeUserBrandingInfo},t.getRenderStatusForCurrentFile=function(e){var n=t.getCurrentFileId(e);if(n)return(function(e,n){return t.getFileViewerState(e).renderStatuses[n]})(e,n)},t.getIsMediaPlaying=function(e){return t.getFileViewerState(e).isMediaPlaying},t.getPauseCount=function(e){var n=t.getFileViewerState(e).pauseCount;return n||0},t.getPreviewApiDataForCurrentFile=function(e){var n=t.getCurrentFile(e);return s.getApiDataForFile(e,n).data},t.getIsFlippingEnabled=function(e){var n=t.getPreviewApiDataForCurrentFile(e);return!(t.getIsEditMode(e)||t.getIsMediaPlaying(e)||t.getIsFullScreen(e)&&c.isSsrDoc(n))},t.shouldForceHideToolbar=function(e){return t.getFileViewerState(e).forceHideToolbar},t.getExtensionsEnabled=function(e){var n=t.getActiveFile(e);return!n||!d.fileExtensionsConfigs(e)[n.file_id]||d.fileExtensionsConfigs(e)[n.file_id].displayState!==_.DisplayState.DISABLED},t.isOverflowZoomMode=function(e){return!0===t.getFileViewerState(e).overflowZoom},t.getHelloSignAppActionForFile=function(e,t){return d.getShareActionsForFile(e,t).filter((function(e){return e.app_id===o.HELLOSIGN_PROD_APP_ID}))[0]},t.getDocClassificationForFile=function(e,n){var r=t.getFileViewerState(e);if(r&&r.docClassifications&&r.docClassifications[n])return r.docClassifications[n]}})),define("modules/clean/react/file_viewer/data/store",["require","exports","modules/clean/redux/store","modules/clean/redux/namespaces","modules/clean/file_store/reducer","modules/clean/react/file_viewer/data/reducer","modules/clean/previews/data/reducer","modules/clean/previews/data/actions","modules/clean/file_store/actions","modules/clean/react/file_viewer/data/actions","modules/clean/react/extensions/data/store"],(function(e,t,n,r,a,i,s,o,c,u,l){"use strict";var d;Object.defineProperty(t,"__esModule",{value:!0}),t.fileViewerReducerMap=((d={})[r.FILE_NAMESPACE_KEY]=a.fileNamespaceReducer,d[r.FILE_VIEWER_NAMESPACE_KEY]=i.fileViewerReducer,d[r.PREVIEW_NAMESPACE_KEY]=s.reducer,d),t.getStoreForFileViewer=function(){return l.getStore(),n.getStoreAndRegisterReducers(t.fileViewerReducerMap)},t.hydrateFileViewerNamespace=function(e,t,n){var r=t.file;r&&e.dispatch(u.openFile(r)),n&&e.dispatch(u.registerUser(n))},t.hydrateFileStore=function(e,t){e.dispatch(o.populateFilesPreviewData(t)),e.dispatch(c.putFiles(t))},t.updateFileStore=function(e,t){e.dispatch(c.putFiles(t))}})),define("modules/clean/react/file_viewer/data/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e.CloseFile="FileViewer/CloseFile",e.CloseFullScreen="FileViewer/CloseFullScreen",e.CloseSidebar="FileViewer/CloseSidebar",e.DismissAppDownloadInterstitial="FileViewer/DismissAppDownloadInterstitial",e.DisableForceHideToolbar="FileViewer/DisableForceHideToolbar",e.ForceHideToolbar="FileViewer/ForceHideToolbar",e.UpdateMode="FileViewer/UpdateMode",e.DisableMode="FileViewer/DisableMode",e.EnableMode="FileViewer/EnableMode",e.OpenFile="FileViewer/OpenFile",e.OpenFullScreen="FileViewer/OpenFullScreen",e.OpenSidebar="FileViewer/OpenSidebar",e.PageDown="FileViewer/PageDown",e.PageUp="FileViewer/PageUp",e.PauseMedia="FileViewer/PauseMedia",e.PlayMedia="FileViewer/PlayMedia",e.PopSidebarPane="FileViewer/PopSidebarPane",e.PushSidebarPane="FileViewer/PushSidebarPane",e.SetSelectedSidebarControlId="FileViewer/SetSelectedSidebarControlId",e.ResetSidebarPaneStack="FileViewer/ResetSidebarPaneStack",e.ResetSelectedSidebarControlId="FileViewer/ResetSelectedSidebarControlId",e.ResetStore="FileViewer/ResetStore",e.UpdateCurrentPageIndex="FileViewer/UpdateCurrentPageIndex",e.RestoreRevision="FileViewer/RestoreRevision",e.SaveForwardRevision="FileViewer/SaveForwardRevision",e.SetCurrentCalloutType="FileViewer/SetCurrentCalloutType",e.SetShowOverQuotaUpsell="FileViewer/SetShowOverQuotaUpsell",e.SetSidebarVisibility="FileViewer/SetSidebarVisibility",e.SetPageDimensions="FileViewer/SetPageDimensions",e.UpdateWatermarkOptions="FileViewer/UpdateWatermarkOptions",e.SwitchWatermarkingMode="FileViewer/SwitchWatermarkingMode",e.SetMarkupCanvas="FileViewer/SetMarkupCanvas",e.UpdateMarkupCanvasScale="FileViewer/UpdateMarkupCanvasScale",e.ResetMarkupState="FileViewer/ResetMarkupState",e.SetMarkupDrawingMode="FileViewer/SetMarkupDrawingMode",e.SetMarkupFill="FileViewer/SetMarkupFill",e.SetMarkupStroke="FileViewer/SetMarkupStroke",e.SetMarkupSubmenuType="FileViewer/SetMarkupSubmenuType",e.SwitchRevision="FileViewer/SwitchRevision",e.UpdateRenderStatus="FileViewer/UpdateRenderStatus",e.RegisterUser="FileViewer/RegisterUser",e.SetTrialMode="FileViewer/SetTrialMode",e.FetchControllerModeRequest="FileViewer/FetchControllerModeRequest",e.FetchControllerModeSuccess="FileViewer/FetchControllerModeSuccess",e.FetchControllerModeError="FileViewer/FetchControllerModeError",e.FetchBestCampaign="FileViewer/FetchBestCampaign",e.SetBestCampaign="FileViewer/SetBestCampaign",e.SetActiveUserBrandingInfo="FileViewer/SetActiveUserBrandingInfo",e.SetDocClassification="FileViewer/SetDocClassification",e.OverflowZoomOn="FileViewer/OverflowZoomOn",e.OverflowZoomOff="FileViewer/OverflowZoomOff"})(t.Actions||(t.Actions={}))})),define("modules/clean/react/file_viewer/data/utils",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isUserOwnerOfFile=function(e,t){return e&&t&&e.home_ns_id===t.ns_id}})),define("modules/clean/react/file_viewer/file_preview_event_emitter",["require","exports","tslib","eventemitter3"],(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importDefault(r),t.filePreviewEventEmitter=new r.default})),define("modules/clean/react/file_viewer/logging",["require","exports","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/constants"],(function(e,t,n,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logUserAction=function(e,t,i){void 0===i&&(i={}),null!=n.FilePreviewSession.currentSession&&r.filePreviewEventEmitter.emit(a.EventType.FilePreviewUserAction,n.FilePreviewSession.currentSession,e,t,i)},t.wrapToolbarActionWithLogging=function(e,n){return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var s=e.apply(void 0,r);return t.logUserAction(n,a.UserActionContext.Toolbar),s}},t.wrapKeyboardActionWithLogging=function(e,n){return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var s=e.apply(void 0,r);return t.logUserAction(n,a.UserActionContext.Keyboard),s}}})),define("modules/clean/react/file_viewer/models",["require","exports","tslib","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/previews/constants","modules/clean/uuid","modules/clean/web_timing_logger","modules/core/browser","modules/core/browser_detection","modules/core/exception"],(function(e,t,n,r,a,i,s,o,c,u,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),c=n.__importStar(c),l=n.__importStar(l);var d={};d[r.EventType.FilePreviewAttemptStarted]=null,d[r.EventType.FilePreviewSupportConfirmed]=r.EventType.FilePreviewAttemptStarted,d[r.EventType.FilePreviewSupportDenied]=r.EventType.FilePreviewAttemptStarted,d[r.EventType.FilePreviewDownloadAttempted]=r.EventType.FilePreviewSupportConfirmed,d[r.EventType.FilePreviewDownloadSucceeded]=r.EventType.FilePreviewDownloadAttempted,d[r.EventType.FilePreviewDownloadFailed]=r.EventType.FilePreviewDownloadAttempted,d[r.EventType.FilePreviewRenderSucceeded]=r.EventType.FilePreviewDownloadSucceeded,d[r.EventType.FilePreviewRenderFailed]=r.EventType.FilePreviewDownloadSucceeded;var _=(function(){function e(e){this.id=e||s.UUID.v4({allowInsecure:!0}),this.deviceType=this._deviceTypeString()}return e.prototype._deviceTypeString=function(){return u.is_supported_mobile_browser()?"mobile":u.is_tablet()?"tablet":"desktop"},e.currentSession=null,e})();t.FileViewerSession=_;var m=(function(){function e(e){var t=e.id,n=e.fileViewerSession,r=e.file,a=e.previewType,i=e.sourceContext,o=e.sourceAction,c=e.extra;this.passwordNeeded=!1,l.assert(!!n,"FileViewerSession required"),l.assert(!!r,"File required"),this.id=t||s.UUID.v4({allowInsecure:!0}),this.fileViewerSession=n,this.file=r,this.previewType=a,this.sourceContext=i,this.sourceAction=o,this.previewTimeline={},this.lastEvent=null,this.extra=c||{}}return e.prototype.recordEvent=function(e,t){if(void 0===t&&(t={}),!(t instanceof Object))throw new Error("extra param of recordEvent should be an object.");this.isEventInTimeline(e)||d.hasOwnProperty(e)&&this.lastEvent!==d[e]||(this.addToTimeline(e),a.filePreviewEventEmitter.emit(e,this,n.__assign(n.__assign({},this.extra),t)),this.lastEvent=e)},e.prototype.markPrimaryEvent=function(){var e;e=window._timingData&&window._timingData.tti?window._timingData.tti.getTime():c.now(),this.primaryMarkTs||(this.primaryMarkTs=e)},e.prototype.timeToPrimaryMark=function(){return this.timeToMark(this.primaryMarkTs)},e.prototype.timeToMark=function(e){if(void 0!==e)switch(this.sourceAction){default:return;case i.PreviewSourceAction.Visit:var t=o.start_time();return void 0!==t?e-t:void 0;case i.PreviewSourceAction.Click:var n=this.previewTimeline[r.EventType.FilePreviewAttemptStarted];if(!n)return;var a=n.timestamp;if(void 0===a)return;return e-a}},e.prototype.isEventInTimeline=function(e){return e in this.previewTimeline},e.prototype.addToTimeline=function(e){this.previewTimeline[e]={timestamp:c.now()}},e.currentSession=null,e})();t.FilePreviewSession=m})),define("modules/clean/react/file_viewer/open_button/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e[e.DOWNLOAD=0]="DOWNLOAD",e[e.UNITY_FILE=1]="UNITY_FILE",e[e.UNITY_FOLDER=2]="UNITY_FOLDER",e[e.OPEN_WITH=3]="OPEN_WITH",e[e.OPEN_IN_PAPER=4]="OPEN_IN_PAPER",e[e.APP_ACTION=5]="APP_ACTION",e[e.PREPARE_FOR_SIGNATURE=6]="PREPARE_FOR_SIGNATURE",e[e.SHARE_TO_SLACK=7]="SHARE_TO_SLACK",e[e.PRESENT_IN_ZOOM=8]="PRESENT_IN_ZOOM",e[e.SHARE_TO_TRELLO=9]="SHARE_TO_TRELLO",e[e.INVITE_VIA_EMAIL=10]="INVITE_VIA_EMAIL",e[e.OPEN_WITH_CLOUD_DOC=11]="OPEN_WITH_CLOUD_DOC",e[e.OPEN_MORE_APPS=12]="OPEN_MORE_APPS",e[e.OPEN_ADD_APPS=13]="OPEN_ADD_APPS",e[e.DECOMPRESS_FILE=14]="DECOMPRESS_FILE",e[e.PREVIEW_FILE=15]="PREVIEW_FILE"})(t.OpenButtonAction||(t.OpenButtonAction={}))})),define("modules/clean/react/file_viewer/prompt/campaign_api",["require","exports","modules/clean/api_v2/user_client"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchBestCampaigns=function(e,t){var r={client_context:{platform:"web",locations:["targeted_bubble"],ref_page:["preview","file_viewer"],display_context:"fv_preview_type="+t}};return(new n.UserApiV2Client).ns("prompt").rpc("get_best_campaigns",r,{subjectUserId:e})}})),define("modules/clean/react/location/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e,t){void 0===t&&(t={}),this.path=e,this.query=t}return e.fromURI=function(t){return new e(t.getPath(),t.getQuery())},e})();t.Location=n})),define("modules/clean/react/size_class/size_class",["require","exports","tslib","react","classnames","hoist-non-react-statics","spectrum/match","modules/clean/react/size_class/constants","modules/clean/react/helpers"],(function(e,t,n,r,a,i,s,o,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importDefault(r),a=n.__importDefault(a),i=n.__importDefault(i),t.SizeClass=o.SizeClass,t.withSizeClass=function(e,t){void 0===t&&(t={});var u=(function(i){function u(t){var n=i.call(this,t)||this;return n.displayName="WithSizeClass("+c.getDisplayName(e),n.onMatchSmall=function(){return n.setState({sizeClass:o.SizeClass.Small})},n.onMatchMedium=function(){return n.setState({sizeClass:o.SizeClass.Medium})},n.onMatchLarge=function(){return n.setState({sizeClass:o.SizeClass.Large})},n.onMatchExtraLarge=function(){return n.setState({sizeClass:o.SizeClass.ExtraLarge})},window.matchMedia(o.MEDIA_SIZE_CLASS_EXTRA_LARGE).matches?n.state={sizeClass:o.SizeClass.ExtraLarge}:window.matchMedia(o.MEDIA_SIZE_CLASS_LARGE).matches?n.state={sizeClass:o.SizeClass.Large}:window.matchMedia(o.MEDIA_SIZE_CLASS_MEDIUM).matches?n.state={sizeClass:o.SizeClass.Medium}:n.state={sizeClass:o.SizeClass.Small},n}return n.__extends(u,i),u.prototype.render=function(){var i,c=t.isResponsiveEnabled,u=t.responsiveClassName,l=void 0===u?"":u,d=!c||c();return r.default.createElement("div",{className:a.default((i={},i[l]=d,i))},r.default.createElement(s.Match,{media:o.MEDIA_SIZE_CLASS_SMALL,onMatch:this.onMatchSmall}),r.default.createElement(s.Match,{media:o.MEDIA_SIZE_CLASS_MEDIUM,onMatch:this.onMatchMedium}),r.default.createElement(s.Match,{media:o.MEDIA_SIZE_CLASS_LARGE,onMatch:this.onMatchLarge}),r.default.createElement(s.Match,{media:o.MEDIA_SIZE_CLASS_EXTRA_LARGE,onMatch:this.onMatchExtraLarge}),r.default.createElement(e,n.__assign({},this.props,{sizeClass:d?this.state.sizeClass:o.SizeClass.Large})))},u})(r.default.Component);return i.default(u,e)}})),define("modules/clean/react/size_class/utils",["require","exports","modules/clean/react/size_class/constants"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSmallerThanLarge=function(e){return e!==n.SizeClass.Large&&e!==n.SizeClass.ExtraLarge}})),define("modules/clean/react/watermarking/drawing",["require","exports"],(function(e,t){"use strict";function n(e,t,n,r,a){void 0===a&&(a=!1),e.save(),e.font=n+"px "+r;var i=e.measureText(t);return e.restore(),a?{width:i.width,height:i.actualBoundingBoxAscent+i.actualBoundingBoxDescent||n}:{width:i.width,height:i.fontBoundingBoxAscent+i.fontBoundingBoxDescent||n}}Object.defineProperty(t,"__esModule",{value:!0}),t.drawTextTile=function(e,t,r,a,i,s){var o=document.createElement("canvas"),c=o.getContext("2d");if(!c)throw new Error("Cannot draw on canvas");var u=n(c,e,t,r),l=u.width,d=u.height;o.width=Math.abs(l*Math.cos(s))+Math.abs(d*Math.sin(s)),o.height=Math.abs(l*Math.sin(s))+Math.abs(d*Math.cos(s)),c.font=t+"px "+r,c.globalAlpha=i,c.fillStyle=a,c.textBaseline="bottom";var _=0,m=o.height;s<.5*Math.PI?_=d*Math.sin(s):s<Math.PI?(_=d*Math.sin(s)-l*Math.cos(s),m+=d*Math.cos(s)):s<1.5*Math.PI?(_=-l*Math.cos(s),m=0):m+=l*Math.sin(s),c.translate(_,m),c.rotate(-s),c.fillText(e,0,0);var p=n(c,e,t,r,!0),g=p.width;return{canvas:o,actualUnrotatedHeight:p.height,actualUnrotatedWidth:g}},t.drawImageTile=function(e,t,n,r){var a=document.createElement("canvas"),i=a.getContext("2d");if(!i)throw new Error("Cannot draw on canvas");var s=r||0,o=e.width*t,c=e.height*t;a.width=Math.round(Math.abs(o*Math.cos(s))+Math.abs(c*Math.sin(s))),a.height=Math.round(Math.abs(o*Math.sin(s))+Math.abs(c*Math.cos(s)));var u=0,l=0;return s<.5*Math.PI?l=o*Math.sin(s):s<Math.PI?(u=-o*Math.cos(s),l=o*Math.sin(s)-c*Math.cos(s)):s<1.5*Math.PI?(u=-o*Math.cos(s)-c*Math.sin(s),l=-c*Math.cos(s)):u=-c*Math.sin(s),i.globalAlpha=n,i.translate(u,l),i.rotate(-s),i.drawImage(e,0,0,o,c),{canvas:a,actualUnrotatedHeight:c,actualUnrotatedWidth:o}}})),define("modules/clean/react/watermarking/selectors",["require","exports","tslib","reselect","external/lodash","modules/clean/react/watermarking/types","modules/clean/react/watermarking/utils","modules/clean/react/watermarking/drawing","modules/clean/react/file_viewer/data/selectors"],(function(e,t,n,r,a,i,s,o,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importStar(a),t.getWatermarkState=function(e){return c.getFileViewerState(e).watermark},t.getWatermarkTilingFunc=r.createSelector(t.getWatermarkState,(function(e){return a.memoize((function(t){var n=i.getWatermarkingOptions(e),r=n.angle,a=n.opacity,c=n.size,u=r%360,l=r/180*Math.PI,d=l%(Math.PI/2),_=(function(n){if(e.mode===i.WatermarkingMode.TEXT){var r=e.textWatermarkingOptions,u=r.color,l=r.fontFamily,d=r.text;return o.drawTextTile(d,c*t,l,u,a/100,n)}var _=e.imageWatermarkingOptions.image;if(!_)throw new s.WatermarkingError(s.WatermarkingError.TILE_NO_INPUT);return o.drawImageTile(_,c*t,a/100,n)})(l),m=_.canvas,p=_.actualUnrotatedHeight,g=_.actualUnrotatedWidth,f=Math.max(p,g),v=f/2,h=f/2;e.mode===i.WatermarkingMode.TEXT&&(v=2*p,h=e.textWatermarkingOptions.lineHeight*p);var S=g+v,b=p+h,w=0,y=0,T=0;return u%180==0?(w=S,y=b,T=v/-1.2):u%180==90?(w=b,y=S):u>0&&u<90||u>180&&u<270?(w=b/Math.sin(d),y=S*Math.sin(d),T=-S*Math.cos(d)):(u>90&&u<180||u>270&&u<360)&&(w=b/Math.cos(d),y=S*Math.cos(d),T=S*Math.sin(d)),{canvas:m,width:m.width,height:m.height,distanceX:w,distanceY:y,startX:-m.width/2,startY:-m.height/2,offsetXPerRow:T,offsetYPerCol:0}}))}))})),define("modules/clean/react/watermarking/types",["require","exports"],(function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e.TEXT="text",e.IMAGE="image"})(n=t.WatermarkingMode||(t.WatermarkingMode={})),(function(e){e.REPEAT="REPEAT",e.CENTER="CENTER",e.NORTHWEST="NORTHWEST",e.NORTHEAST="NORTHEAST",e.SOUTHEAST="SOUTHEAST",e.SOUTHWEST="SOUTHWEST"})(t.WatermarkPosition||(t.WatermarkPosition={})),t.getWatermarkingOptions=function(e){return e.mode===n.TEXT?e.textWatermarkingOptions:e.imageWatermarkingOptions}})),define("modules/clean/react/watermarking/utils",["require","exports","tslib","sjcl","external/lodash","modules/constants/file_viewer","modules/clean/i18n/formatters","modules/constants/page_load","modules/clean/file_store/utils","modules/core/i18n","modules/clean/previews/constants","modules/clean/react/watermarking/drawing","modules/clean/react/watermarking/types","modules/clean/storage","modules/core/cookies","modules/core/exception","modules/clean/react/user_metadata/api"],(function(e,t,n,r,a,i,s,o,c,u,l,d,_,m,p,g,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importStar(r),a=n.__importStar(a),g=n.__importStar(g);var v=[".pdf",".jpg",".jpeg",".png",".bmp"];t.DEFAULT_SIZES={size:1,minSize:.2,maxSize:5},t.WATERMARKING_LOCAL_STORAGE_KEY="fileviewer_watermarking_data";var h=(function(e){function t(t){var n=e.call(this,t)||this;return n.message=t,n.name="WatermarkingError",n}return n.__extends(t,e),t.TILE_NO_INPUT="Unable to tile: missing text or image",t})(Error);function S(e){return e&&i.WATERMARK_TRIAL_VARIANT_BY_USER_ID?i.WATERMARK_TRIAL_VARIANT_BY_USER_ID[e.id]:""}function b(e){return!t.isWatermarkingEnabled(e)&&["DEACTIVATED_MENU","POPOVER_WM_VALUE_PROPS","POPOVER_PRO_VALUE_PROPS","TOOLTIP_ON_HOVER"].includes(S(e))}function w(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){t(r)},r.onerror=function(e){n(e)},r.crossOrigin="anonymous",r.src=e}))}function y(e,n){var a=(function(e){try{var t=r.codec.utf8String.toBits(p.Cookies.read("__Host-js_csrf"));return r.encrypt(t,JSON.stringify(e))}catch(e){return void g.reportException({err:e,severity:g.SEVERITY.NONCRITICAL,tags:["watermarking"]})}})(n);a&&m.UserLocalStorage.set(e.id,t.WATERMARKING_LOCAL_STORAGE_KEY,a)}t.WatermarkingError=h,t.fileIsWatermarkable=function(e){return!!e&&(c.isBrowseFile(e)&&!e.read_only&&!!e.ext&&v.includes(e.ext.toLowerCase()))},t.isWatermarkingEnabled=function(e){return!!(e&&i.WATERMARKING_BY_USER_ID&&i.WATERMARKING_BY_USER_ID[e.id])},t.allowWatermark=function(e,n){return t.isWatermarkingEnabled(n)&&t.fileIsWatermarkable(e)},t.getWatermarkTrialVariant=S,t.allowWatermarkTrial=b,t.allowWatermarkOrTrial=function(e,n){return t.allowWatermark(e,n)||b(n)},t.getDefaultText=function(e){if(!e)return"DRAFT";var t=(0,s.createFormatters(o.USER_LOCALE,{}).formatDate)(new Date,{});return e.display_name+" | "+t},t.getImageDefaultSizes=function(e,n){if(!e||!n)return t.DEFAULT_SIZES;var r=e.width/n.width,a=e.height/n.height,i=Math.max(r,a);if(i*t.DEFAULT_SIZES.maxSize<=.9)return t.DEFAULT_SIZES;var s=.9/i;return{size:s/5,minSize:s/25,maxSize:s}},t.DEFAULT_WATERMARKING_STATE={mode:_.WatermarkingMode.TEXT,textWatermarkingOptions:{angle:45,color:"black",opacity:30,fontFamily:"Helvetica, sans-serif",size:20,minSize:5,maxSize:200,lineHeight:3,text:"DRAFT",position:_.WatermarkPosition.REPEAT,marginX:40,marginY:40,scale:1},imageWatermarkingOptions:n.__assign({angle:45,opacity:30,position:_.WatermarkPosition.REPEAT,marginX:40,marginY:40,scale:1},t.DEFAULT_SIZES)},t.getWatermarkScale=function(e){return e===l.PreviewType.SsrDoc?300/72:1},t.getWatermarkingLabelText=function(e,t){if(e)return t===l.PreviewType.Image?u.intl.formatMessage({id:"35NidE",defaultMessage:"Watermarking is available on PDFs, PNGs, JPEGs, and BMPs."}):u.intl.formatMessage({id:"HcLjiD",defaultMessage:"Watermarking is available on PDFs and images."})},t.getImageFromURL=w,t.getWatermarkMilestone=function(e){return"M2"},t.setLocalStorageWatermarkingState=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){var r;return n.__generator(this,(function(a){if(!e||!t)return[2];r=(function(e){var t=n.__assign(n.__assign({},e),{imageWatermarkingOptions:n.__assign({},e.imageWatermarkingOptions)});t.imageWatermarkingOptions.image&&!t.imageWatermarkingOptions.imageAsDataURL&&(t.imageWatermarkingOptions.imageAsDataURL=d.drawImageTile(t.imageWatermarkingOptions.image,1,1).canvas.toDataURL());return delete t.imageWatermarkingOptions.image,t})(t);try{y(e,r)}catch(t){if(r.imageWatermarkingOptions.imageAsDataURL){delete r.imageWatermarkingOptions.imageAsDataURL;try{y(e,r)}catch(e){g.reportException({err:t,severity:g.SEVERITY.NONCRITICAL,tags:["watermarking"]})}}}return[2]}))}))},t.getLocalStorageWatermarkingState=function(e){return n.__awaiter(this,void 0,void 0,(function(){var a,i,s,o,c;return n.__generator(this,(function(n){switch(n.label){case 0:if(!(a=m.UserLocalStorage.get(e.id,t.WATERMARKING_LOCAL_STORAGE_KEY)))return[3,5];n.label=1;case 1:return n.trys.push([1,4,,5]),i=r.codec.utf8String.toBits(p.Cookies.read("__Host-js_csrf")),(s=JSON.parse(r.decrypt(i,a))).imageWatermarkingOptions.imageAsDataURL?(o=s.imageWatermarkingOptions,[4,w(s.imageWatermarkingOptions.imageAsDataURL)]):[3,3];case 2:o.image=n.sent(),n.label=3;case 3:return[2,s];case 4:return c=n.sent(),g.reportException({err:c,severity:g.SEVERITY.NONCRITICAL,tags:["watermarking"]}),[3,5];case 5:return[2]}}))}))},t.getUserMetadataTextWatermarkingState=function(e){return n.__awaiter(this,void 0,Promise,(function(){var t,r,i;return n.__generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,f.getUserMetadata(["TEXT_WATERMARKING_COLOR","TEXT_WATERMARKING_TEXT","TEXT_WATERMARKING_OPACITY","TEXT_WATERMARKING_ANGLE","TEXT_WATERMARKING_POSITION","TEXT_WATERMARKING_SIZE"],e.id)];case 1:return t=n.sent(),r={color:t.TEXT_WATERMARKING_COLOR?t.TEXT_WATERMARKING_COLOR:void 0,text:t.TEXT_WATERMARKING_TEXT,opacity:t.TEXT_WATERMARKING_OPACITY,angle:t.TEXT_WATERMARKING_ANGLE,position:t.TEXT_WATERMARKING_POSITION?t.TEXT_WATERMARKING_POSITION:void 0,size:t.TEXT_WATERMARKING_SIZE},[2,a.omitBy(r,a.isUndefined)];case 2:return i=n.sent(),g.reportException({err:i,severity:g.SEVERITY.NONCRITICAL,tags:["watermarking"]}),[2];case 3:return[2]}}))}))},t.setUserMetadataTextWatermarkingState=function(e,t){var n=t.textWatermarkingOptions;f.setUserMetadata({TEXT_WATERMARKING_COLOR:n.color,TEXT_WATERMARKING_TEXT:n.text,TEXT_WATERMARKING_OPACITY:n.opacity,TEXT_WATERMARKING_ANGLE:n.angle,TEXT_WATERMARKING_POSITION:n.position,TEXT_WATERMARKING_SIZE:n.size},e.id)},t.isOverQuotaError=function(e){return!(!e||"over_quota_error"!==e[".tag"])},t.isFilesystemError=function(e){return!(!e||"filesystem_error"!==e[".tag"])},t.isUnsupportedFileError=function(e){return!(!e||"unsupported_file_error"!==e[".tag"])},t.isUnauthorizedAccessError=function(e){return!(!e||"unauthorized_access"!==e[".tag"])}})),define("modules/clean/react/workflows/markup/fabric_wrapper",["require","exports","tslib","fabric"],(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(r=n.__importDefault(r)).default.fabric||r.default;t.fabric=a})),define("modules/clean/react/workflows/markup/fabric",["require","exports","tslib","modules/clean/react/workflows/markup/fabric_wrapper","modules/clean/previews/constants","modules/clean/react/workflows/markup/types","modules/clean/api_v2/user_client"],(function(e,t,n,r,a,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r.fabric.Object&&(r.fabric.util.object.extend(r.fabric.Object.prototype,{cornerStyle:"circle",cornerColor:"#0052D9",cornerSize:10,cornerStrokeColor:"white",transparentCorners:!1,drawControls:function(e,t){t=t||{};var n=this._calculateCurrentDimensions(),r=n.x,a=n.y,i=t.cornerSize||this.cornerSize,s=-(r+i)/2,o=-(a+i)/2,c=void 0!==t.transparentCorners?t.transparentCorners:this.transparentCorners,u=void 0!==t.hasRotatingPoint?t.hasRotatingPoint:this.hasRotatingPoint,l=c?"stroke":"fill";return e.save(),e.strokeStyle=e.fillStyle=t.cornerColor||this.cornerColor,this.transparentCorners||(e.strokeStyle=t.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(e,t.cornerDashArray||this.cornerDashArray,null),this._drawControl("tl",e,l,s,o,t),this._drawControl("tr",e,l,s+r,o,t),this._drawControl("bl",e,l,s,o+a,t),this._drawControl("br",e,l,s+r,o+a,t),u&&this._drawControl("mtr",e,l,s+r/2,o-this.rotatingPointOffset,t),e.restore(),this},_findTargetCorner:function(e){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var t=e.x,n=e.y;for(var r in this.__corner=0,this.oCoords)if(this.isControlVisible(r)&&("mtr"!==r||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==r&&"mr"!==r&&"mb"!==r&&"ml"!==r)){var a=void 0;switch(r){case"mt":a=this._getHorizontalImageLines(this.oCoords.tl.corner,this.oCoords.tr.corner);break;case"mr":a=this._getVerticalImageLines(this.oCoords.tr.corner,this.oCoords.br.corner);break;case"mb":a=this._getHorizontalImageLines(this.oCoords.bl.corner,this.oCoords.br.corner);break;case"ml":a=this._getVerticalImageLines(this.oCoords.tl.corner,this.oCoords.bl.corner);break;default:a=this._getImageLines(this.oCoords[r].corner)}var i=this._findCrossPoints({x:t,y:n},a);if(0!==i&&i%2==1)return this.__corner=r,r}return!1},_getHorizontalImageLines:function(e,t){return{topline:{o:e.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:e.bl},leftline:{o:e.bl,d:e.tl}}},_getVerticalImageLines:function(e,t){return{topline:{o:e.tl,d:e.tr},rightline:{o:e.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:e.tl}}}}),r.fabric.util.object.extend(r.fabric.Canvas.prototype,{uniScaleKey:null,_getActionFromCorner:function(e,t,n){if(!t||!e)return"drag";switch(t){case"mtr":return"rotate";case"ml":case"mr":return n.shiftKey?"scale":"scaleX";case"mt":case"mb":return n.shiftKey?"scale":"scaleY";default:return"scale"}}})),r.fabric.BaseBrush&&(c(i.MarkupColor.RED_CHERRY),r.fabric.BaseBrush.prototype.width=3);var o={strokeUniform:!0,strokeWidth:3,stroke:"red"};function c(e){r.fabric.BaseBrush&&(r.fabric.BaseBrush.prototype.color=e)}function u(e){return e&&"group"===e.type}function l(e){return e&&"i-text"===e.type}t.addMarkupObject=function(e,t,a){var s;switch(t){case i.MarkupType.TEXT:s=new r.fabric.IText("Text",n.__assign(n.__assign(n.__assign(n.__assign({},o),{fontSize:22}),a),{fill:a.stroke,stroke:void 0}));break;case i.MarkupType.CIRCLE:s=new r.fabric.Circle(n.__assign(n.__assign(n.__assign({},o),{radius:50,fill:void 0}),a));break;case i.MarkupType.RECT:s=new r.fabric.Rect(n.__assign(n.__assign(n.__assign({},o),{width:100,height:100,fill:void 0}),a));break;case i.MarkupType.ARROW:var c=a.left,u=a.top,l=a.stroke,d=[c,u+100,c+100,u],_=180*Math.atan2(100,100)/Math.PI,m=new r.fabric.Triangle(n.__assign(n.__assign({},o),{angle:_,top:d[3],left:d[2]+3,height:15,width:15,originX:"center",originY:"center",stroke:l,fill:l})),p=new r.fabric.Line(d,n.__assign(n.__assign({},o),a));s=new r.fabric.Group([p,m],n.__assign(n.__assign(n.__assign({},o),{lockUniScaling:!0,centeredScaling:!0}),a))}s&&(e.add(s),e.setActiveObject(s))},t.setDrawingMode=function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&"object"==typeof e[n]){var r=e[n].fabric;r&&(r.isDrawingMode=t)}},t.setBaseBrushColor=c,t.disposeCanvas=function(e){for(var t in e)e[t].fabric&&e[t].fabric.dispose()},t.saveMarkup=function(e,t,r,i,o){return n.__awaiter(this,void 0,void 0,(function(){var c,u,l,d,_,m,p,g,f,v,h,S;return n.__generator(this,(function(n){for(d in c=new s.UserApiV2Client,u=[],l=o===a.PreviewType.SsrDoc?300/72:1,i)if(i.hasOwnProperty(d)&&"object"==typeof i[d]&&(_=i[d].scale,m=l/_,p=i[d].fabric))for(g=0,f=p.getObjects();g<f.length;g++)v=f[g],h=v.getBoundingRect(),u.push({".tag":"burn_image",image:v.toDataURL({multiplier:m}).split(",",2).pop(),x:Math.round(h.left/_),y:Math.round(h.top/_),page:Number(d)});return S={path:t,should_overwrite:r,burn_objects:u},[2,c.ns("workflows").rpc("markup_file",S,{subjectUserId:e})]}))}))},t.setOptionsForActiveObjects=function(e,t){e&&(e.getActiveObjects().forEach((function(e){l(e)?e.set(n.__assign(n.__assign({},t),{stroke:void 0,fill:t.stroke||e.fill})):u(e)?e.forEachObject((function(e){return e.set(n.__assign(n.__assign({},t),{fill:t.stroke||e.stroke}))})):!(function(e){return e&&"path"===e.type})(e)?e.set(t):e.set(n.__assign(n.__assign({},t),{fill:void 0}))})),e.renderAll())},t.getStroke=function(e){return l(e)?e.fill:u(e)?e.getObjects().filter((function(e){return"line"===e.type}))[0].stroke:"stroke"in e?e.stroke:void 0},t.getFill=function(e){if((function(e){return e&&"circle"===e.type})(e)||(function(e){return e&&"rect"===e.type})(e))return e.fill}})),define("modules/clean/react/workflows/markup/selectors",["require","exports","modules/clean/react/file_viewer/data/selectors"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMarkupState=function(e){return n.getFileViewerState(e).markup}})),define("modules/clean/react/workflows/markup/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e[e.TEXT=0]="TEXT",e[e.CIRCLE=1]="CIRCLE",e[e.RECT=2]="RECT",e[e.ARROW=3]="ARROW",e[e.FREEFORM=4]="FREEFORM"})(t.MarkupType||(t.MarkupType={})),(function(e){e.STROKE="stroke",e.FILL="fill"})(t.FormatSubmenuEntry||(t.FormatSubmenuEntry={})),(function(e){e.TRANSPARENT="transparent",e.RED_CHERRY="#D62C0B",e.ORANGE_TANGERINE="#FF8E21",e.GREEN="#00864C",e.DARK_BLUE="#005DD6",e.ULTRAVIOLET="#813BF6",e.WHITE="white",e.BLACK="black"})(t.MarkupColor||(t.MarkupColor={}))})),define("modules/clean/react/workflows/markup/utils",["require","exports","modules/constants/file_viewer","modules/clean/file_store/utils","modules/clean/previews/constants","modules/core/i18n","modules/clean/react/workflows/markup/types"],(function(e,t,n,r,a,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=[".pdf",".jpg",".jpeg",".png",".bmp"];t.OFFSET=10,t.DEFAULT_LEFT=100,t.DEFAULT_TOP=100,t.MOVE_DISTANCE_X=1,t.MOVE_DISTANCE_Y=1,t.fileIsMarkupable=function(e){return!!e&&(r.isBrowseFile(e)&&!e.read_only&&!!e.ext&&o.includes(e.ext.toLowerCase()))};t.userCanMarkup=function(){return["M0"].includes(n.FILE_MARKUP)},t.allowMarkup=function(e){return t.userCanMarkup()&&t.fileIsMarkupable(e)},t.getMarkupLabelText=function(e,t){if(e)return t===a.PreviewType.Image?i.intl.formatMessage({id:"4hf7s2",defaultMessage:"Markup is available on PDFs, PNGs, JPEGs, and BMPs."}):i.intl.formatMessage({id:"PSKrse",defaultMessage:"Markup is available on PDFs and images."})},t.getMarkupErrorMessage=function(e){switch(e[".tag"]){case"over_quota_error":return i.intl.formatMessage({id:"ebkvMX",defaultMessage:"Can’t save because your account is full. Upgrade to get more space."});case"filesystem_error":return i.intl.formatMessage({id:"rV+Py+",defaultMessage:"Couldn’t save markup. Refresh the page to try again."});case"unsupported_file_error":return i.intl.formatMessage({id:"9ZczZk",defaultMessage:"Can’t save. Markup isn’t available for this file type."});case"unauthorized_access":return i.intl.formatMessage({id:"+/+p5G",defaultMessage:"You don’t have permission to save to this folder."});default:return i.intl.formatMessage({id:"rV+Py+",defaultMessage:"Couldn’t save markup. Refresh the page to try again."})}},t.DEFAULT_MARKUP_STATE={isDrawingMode:!1,formatSubmenu:[],strokeColor:s.MarkupColor.RED_CHERRY,fillColor:s.MarkupColor.TRANSPARENT}})),define("modules/clean/react/user_metadata/api",["require","exports","modules/clean/api_v2/user_client","modules/clean/react/user_metadata/util"],(function(e,t,n,r){"use strict";function a(e){var t=r.removeEmptyFields(e),n=r.getUserMetadataKeys(t),a={};return n.forEach((function(e){a[e]=JSON.stringify(t[e])})),a}function i(e){var t=r.getUserMetadataKeys(e.metadata),n={};return t.forEach((function(t){var r=JSON.parse(e.metadata[t]);null!=r&&(n[t]=r)})),n}function s(e,t){return(new n.UserApiV2Client).ns("user_metadata").rpc("user_metadata/get",e,{subjectUserId:t})}function o(e,t){return(new n.UserApiV2Client).ns("user_metadata").rpc("user_metadata/set",e,{subjectUserId:t})}Object.defineProperty(t,"__esModule",{value:!0}),t.getUserMetadata=function(e,t){return s({metadata:e},t).then(i)},t.setUserMetadata=function(e,t){return o({metadata:a(e)},t).then(i)},t.prepareUserMetadataSetArg=a,t.processUserMetadataResult=i,t.fetchUserMetadata=s,t.mutateUserMetadata=o})),define("modules/clean/react/user_metadata/util",["require","exports"],(function(e,t){"use strict";function n(e){return Object.keys(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.pickMetadata=function(e,t){var n={};return e.forEach((function(e){n[e]=t[e]})),n},t.removeEmptyFields=function(e){var t=n(e),r={};return t.forEach((function(t){null!=e[t]&&(r[t]=e[t])})),r},t.getUserMetadataKeys=n})),define("modules/clean/react/branding/api",["require","exports","tslib","modules/clean/react/premium_kit/api","modules/clean/react/premium_kit/types","modules/clean/react/user_metadata/api","modules/core/uri"],(function(e,t,n,r,a,i,s){"use strict";function o(e,t){var n=new s.URI({scheme:"https",authority:"www.dropbox.com",path:"/team/"+t+"/"+e,query:{suppress_default_logo:"1"}}).toString();return new Promise((function(e,r){var a=new XMLHttpRequest;a.open("HEAD",n),a.onload=function(){switch(a.status){case 200:return e(n);case 404:return e(void 0);default:throw new Error("Failed to get "+t)}},a.onerror=function(){return r(new Error("Failed to get "+t))},a.send()}))}Object.defineProperty(t,"__esModule",{value:!0}),t.USER_METADATA_ORG_NAME_KEY="PREMIUM_KIT_ORGANIZATION_NAME",t.USER_METADATA_BACKGROUND_KEY="PREMIUM_KIT_BACKGROUND_ASSET_ID",t.USER_METADATA_BRANDING_LOGO_SET_KEY="PREMIUM_KIT_BRANDING_LOGO_SET",t.getBackgroundAssets=function(e){var t,i;return n.__awaiter(this,void 0,Promise,(function(){var s;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,r.getAssetLibraries(e,[a.AssetLibraryId.BrandingBackground])];case 1:return s=n.sent(),[2,(null===(i=null===(t=s.asset_libraries)||void 0===t?void 0:t[0])||void 0===i?void 0:i.assets)||[]]}}))}))},t.getSelectedBackgroundAssetId=function(e){return n.__awaiter(this,void 0,Promise,(function(){return n.__generator(this,(function(n){switch(n.label){case 0:return[4,i.getUserMetadata([t.USER_METADATA_BACKGROUND_KEY],e)];case 1:return[2,n.sent()[t.USER_METADATA_BACKGROUND_KEY]||""]}}))}))},t.saveSelectedBackgroundAssetId=function(e,r){return n.__awaiter(this,void 0,Promise,(function(){var a;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,i.setUserMetadata((a={},a[t.USER_METADATA_BACKGROUND_KEY]=r||"",a),e)];case 1:return n.sent(),[2]}}))}))},t.getLogo=function(e){var t,i,s;return n.__awaiter(this,void 0,Promise,(function(){var o;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,r.getAssetLibraries(e,[a.AssetLibraryId.BrandingLogo])];case 1:return o=n.sent(),[2,null===(s=null===(i=null===(t=o.asset_libraries)||void 0===t?void 0:t[0])||void 0===i?void 0:i.assets)||void 0===s?void 0:s[0]]}}))}))},t.removeLogo=function(e){return n.__awaiter(this,void 0,Promise,(function(){return n.__generator(this,(function(t){switch(t.label){case 0:return[4,r.removeAssetLibrary(e,a.AssetLibraryId.BrandingLogo)];case 1:return t.sent(),[2]}}))}))},t.saveLogoFlag=function(e,r){return n.__awaiter(this,void 0,Promise,(function(){var a;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,i.setUserMetadata((a={},a[t.USER_METADATA_BRANDING_LOGO_SET_KEY]=r,a),e)];case 1:return n.sent(),[2]}}))}))},t.getName=function(e){return n.__awaiter(this,void 0,Promise,(function(){return n.__generator(this,(function(n){switch(n.label){case 0:return[4,i.getUserMetadata([t.USER_METADATA_ORG_NAME_KEY],e)];case 1:return[2,n.sent()[t.USER_METADATA_ORG_NAME_KEY]||""]}}))}))},t.saveName=function(e,r){return n.__awaiter(this,void 0,Promise,(function(){var a;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,i.setUserMetadata((a={},a[t.USER_METADATA_ORG_NAME_KEY]=r,a),e)];case 1:return n.sent(),[2]}}))}))},t.DISALLOWED={disallowed:!0},t.getTeamLogoUrl=function(e){return n.__awaiter(this,void 0,Promise,(function(){return n.__generator(this,(function(t){return[2,o(e,"team_logo")]}))}))},t.getTeamBackgroundUrl=function(e){return n.__awaiter(this,void 0,Promise,(function(){return n.__generator(this,(function(t){return[2,o(e,"team_background")]}))}))}})),define("modules/clean/react/premium_kit/api",["require","exports","tslib","modules/clean/api_v2/user_client"],(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addAssetByBlock=function(e,t,a,i){return n.__awaiter(this,void 0,Promise,(function(){var s;return n.__generator(this,(function(n){switch(n.label){case 0:if(0===a.length)throw new Error("blockTokens list must not be empty");return s={library_assets_to_add:[{asset_library_id:i,assets_to_add:[{asset_id:t,file_args:{".tag":"add_by_blocks",tokens:a}}]}]},[4,(new r.UserApiV2Client).ns("premium_kit").rpc("asset_libraries/add_assets",s,{subjectUserId:e}).then((function(e){var t,n=e.added_library_assets[0].added_assets[0].result;switch(n[".tag"]){case"asset":return(null===(t=null==n?void 0:n.graphic)||void 0===t?void 0:t.fallback_image_url)?n:void 0;case"asset_error":throw new Error(n.message);default:throw new Error("unexpected .tag value "+n[".tag"])}}))];case 1:return[2,n.sent()]}}))}))},t.getAssetLibraries=function(e,t){var n={asset_library_ids:t};return(new r.UserApiV2Client).ns("premium_kit").rpc("asset_libraries/get",n,{subjectUserId:e})},t.removeAssetLibrary=function(e,t){return n.__awaiter(this,void 0,Promise,(function(){var a;return n.__generator(this,(function(n){switch(n.label){case 0:return a={asset_library_id:t},[4,(new r.UserApiV2Client).ns("premium_kit").rpc("asset_libraries/remove",a,{subjectUserId:e})];case 1:return[2,n.sent()]}}))}))}})),define("modules/clean/react/premium_kit/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e.BrandingBackground="branding_background",e.BrandingLogo="branding_logo",e.CustomLogo="custom_logo"})(t.AssetLibraryId||(t.AssetLibraryId={})),(function(e){e.BrandingCustomBackground="branding_custom_background",e.BrandingLogo="branding_logo",e.CustomLogo="custom_logo",e.Sapphire="sapphire",e.PinkLibrary="pink_library",e.Wheat="wheat",e.BlackCherry="black_cherry",e.Canopy="canopy",e.Turquoise="turquoise",e.Topaz="topaz",e.Pollen="pollen",e.Azalea="azalea",e.Shark="shark",e.AbstractHands="abstract_hands",e.RedMan="red_man",e.TransferAnimals="transfer_animals",e.BlueStairs="blue_stairs",e.WAVE="wave"})(t.AssetId||(t.AssetId={})),(function(e){e.Image="image",e.Video="video",e.Color="color",e.Other="other"})(t.AssetType||(t.AssetType={}))})),define("modules/clean/react/previews/preview_toolbar_button",["require","exports","tslib","classnames","react","modules/clean/react/sprite","modules/clean/static_urls","spectrum/icon_document","spectrum/tooltip"],(function(e,t,n,r,a,i,s,o,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importDefault(r),a=n.__importDefault(a),t.PreviewToolbarButton=function(e){var t=e.className,n=e["data-test"],u=e.disabled,l=e.iconName,d=e.onClick,_=e.spriteGroup,m=e.spriteName,p=e.spectrumIconName,g=e.tooltip;return a.default.createElement("div",{className:r.default(t,"toolbar-button-entry"),"data-test":n},a.default.createElement(c.Tooltip,{positioning:"above",positionOffset:24,tooltipContent:g},a.default.createElement("button",{className:t+"-button","aria-label":g,onClick:d},void 0!==l?a.default.createElement("img",{src:s.static_url("/static/images/previews/toolbar/"+l+".svg"),alt:g,className:r.default({disabled:u})}):void 0!==m?a.default.createElement(i.Sprite,{group:_,name:m,alt:g,className:r.default({disabled:u})}):a.default.createElement(o.IconDocument,{name:p}))))}})),define("spectrum/icon_document",["require","exports","tslib","react","spectrum/icon_templates/stateless","spectrum/svg_icon_bundle","spectrum/icon_document/bundle"],(function(e,t,n,r,a,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importStar(r),t.ICONS=s.ICONS,t.IconDocument=function(e){var t=e.name,n=r.createElement(i.SvgIconBundle,{focusable:"false",icon:s.ICONS[t]});return r.createElement(a.Component,Object.assign({icon:n},e))},t.IconDocument.displayName="IconDocument"})),define("spectrum/icon_document/bundle",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ICONS=JSON.parse('\n    {"date-small":{"attrs":{"width":"24","height":"24","viewBox":"0 0 24 24"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><g fill=\\"#000\\" fill-rule=\\"nonzero\\"><path d=\\"M4 4h16v16H4V4zm2 2v12h12V6H6z\\"></path><path d=\\"M5 8h14v2H5zM7 2h2v4H7zM15 2h2v4h-2z\\"></path></g></g>"},"date":{"attrs":{"width":"32","height":"32","viewBox":"0 0 32 32"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><g fill=\\"#000\\" fill-rule=\\"nonzero\\"><path d=\\"M6 6h20v20H6V6zm2 2v16h16V8H8z\\"></path><path d=\\"M7 11h18v2H7zM11 4h2v4h-2zM19 4h2v4h-2z\\"></path></g></g>"},"signature-small":{"attrs":{"width":"24","height":"24","viewBox":"0 0 24 24"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><g fill=\\"#000\\" fill-rule=\\"nonzero\\"><path d=\\"M1 18h22v1H1z\\"></path><path d=\\"M10.874 17.262c-1.33 1.046-1.25 2.246-.297 2.723 1.076.537 2.438-.321 3.206-2.953.226-.774.42-1.509.583-2.205-1.06.632-2.251 1.46-3.492 2.435zm4.589.26c-1.044 3.578-3.487 5.118-5.668 4.028-2.131-1.065-2.317-3.844-.003-5.664 1.857-1.46 3.565-2.6 5.014-3.317.634-4.207-.218-6.501-2.436-6.681-1.374-.111-1.993.459-2.027 1.713-.041 1.48.799 3.57 2.34 5.61l-1.397 1.054c-1.76-2.33-2.746-4.782-2.693-6.713.062-2.246 1.534-3.602 3.918-3.408 3.355.272 4.634 3.065 4.144 7.711 1.236-.31 2.137-.102 2.578.742.211.404.28.842.24 1.308a3.4 3.4 0 0 1-.025.205c1.118-.989 1.885-1.388 2.896-1.103.22.063.432.163.632.299l-.986 1.446a.42.42 0 0 0-.121-.06c-.223-.063-.618.152-1.332.792l-.42.379c-.17.151-.308.267-.442.37-.42.32-.786.5-1.217.5-.758 0-1.248-.545-1.188-1.264a2.4 2.4 0 0 1 .12-.543c.034-.105.181-.524.157-.454.11-.32.166-.532.182-.719a.652.652 0 0 0-.037-.325c.02.04.003.044-.143.053-.287.018-.69.127-1.183.324a38.652 38.652 0 0 1-.903 3.717zM1.381 11.619L2.62 10.38l4.95 4.95-1.238 1.237z\\"></path><path d=\\"M6.377 10.382l1.238 1.236-4.948 4.952-1.238-1.237z\\"></path></g></g>"},"signature":{"attrs":{"width":"32","height":"32","viewBox":"0 0 32 32"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><g fill=\\"#000\\" fill-rule=\\"nonzero\\"><path d=\\"M3 24h26v1H3z\\"></path><path d=\\"M12.5 23.31c-1.983 1.56-1.857 3.437-.376 4.177 1.643.821 3.682-.464 4.79-4.26.37-1.271.68-2.47.931-3.594-1.6.917-3.43 2.172-5.345 3.678zm6.334.476c-1.423 4.878-4.698 6.942-7.604 5.49-2.828-1.413-3.075-5.094.034-7.538 2.627-2.065 5.04-3.666 7.065-4.65.94-6.089-.293-9.445-3.584-9.712-2.047-.166-3.02.73-3.072 2.607-.058 2.126 1.133 5.09 3.313 7.976l-1.595 1.206c-2.431-3.218-3.79-6.597-3.717-9.237.082-3.012 2.03-4.805 5.233-4.546 4.596.373 6.315 4.295 5.547 10.86 1.785-.52 3.073-.3 3.663.83.273.523.363 1.094.31 1.705a4.971 4.971 0 0 1-.175.925c.12-.105.252-.223.4-.356 1.565-1.402 2.605-1.969 3.947-1.59.285.08.558.21.818.387l-1.126 1.652a.807.807 0 0 0-.235-.114c-.414-.117-1.015.21-2.07 1.155-.07.063-.47.426-.586.529a10.64 10.64 0 0 1-.604.506c-.55.42-1.024.653-1.565.653-.928 0-1.51-.649-1.437-1.524.018-.219.07-.436.158-.71.046-.143.25-.725.217-.63.16-.462.24-.774.265-1.057.023-.255-.008-.449-.09-.605-.063-.122-.828-.083-2.231.498-.3 1.634-.728 3.4-1.279 5.29z\\"></path><path d=\\"M8.293 14.294l1.415 1.414-4.997 5-1.414-1.414z\\"></path><path d=\\"M3.297 15.708l1.414-1.414 5 5-1.414 1.414z\\"></path></g></g>"},"text-small":{"attrs":{"width":"24","height":"24","viewBox":"0 0 24 24"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><g fill=\\"#000\\" fill-rule=\\"nonzero\\"><path d=\\"M4 4h16v16H4V4zm2 2v12h12V6H6z\\"></path><path d=\\"M8 8h8v2H8z\\"></path><path d=\\"M11 9h2v7h-2z\\"></path></g></g>"},"text":{"attrs":{"width":"32","height":"32","viewBox":"0 0 32 32"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><g fill=\\"#000\\" fill-rule=\\"nonzero\\"><path d=\\"M6 6h20v20H6V6zm2 2v16h16V8H8z\\"></path><path d=\\"M11 11h10v2H11zM15 13h2v8h-2z\\"></path></g></g>"}}\n  ')}));
//# sourceMappingURL=pkg-shared_link_core.min.js-vflaA1oZS.map