define(["require","exports","tslib","rondo/v1/index","rondo-saga/v1"],(function(e,t,r,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationsManagerBehavior=function(e){var t=e.listeners,i=e.allowStacking,a=void 0!==i&&i,o=e.successMessage,c=e.errorMessage,u=e.timeout;return(function(){function e(){this.removeTasks={},this.timerTasks={},this.initialState=function(){return{notifications:[]}},this.actionAddNotification=n.createAction().handle((function(e,t){var r=e.notifications;return a?{notifications:r.concat([t])}:{notifications:[t]}})),this.actionUpdateNotification=n.createAction().handle((function(e,t){return{notifications:e.notifications.map((function(e){return e.id!==t.id?e:r.__assign(r.__assign({},e),t)}))}})),this.actionRemoveNotification=n.createAction().handle((function(e,t){return{notifications:e.notifications.filter((function(e){return e.id!==t}))}})).takeEvery((function(e){return r.__generator(this,(function(t){switch(t.label){case 0:return this.removeTasks.hasOwnProperty(e)?[4,s.cancel(this.removeTasks[e])]:[3,2];case 1:t.sent(),delete this.removeTasks[e],t.label=2;case 2:return this.timerTasks.hasOwnProperty(e)?[4,s.cancel(this.timerTasks[e])]:[3,4];case 3:t.sent(),delete this.timerTasks[e],t.label=4;case 4:return[2]}}))})),this.actionClearNotifications=n.createAction().handle((function(){return{notifications:[]}})).takeEvery((function(e){var t,n,i,a,o,c,u,l,f,h,d,m;return r.__generator(this,(function(e){switch(e.label){case 0:e.trys.push([0,5,6,7]),t=r.__values(this.removeTasks),n=t.next(),e.label=1;case 1:return n.done?[3,4]:(i=n.value,[4,s.cancel(this.removeTasks[i])]);case 2:e.sent(),delete this.removeTasks[i],e.label=3;case 3:return n=t.next(),[3,1];case 4:return[3,7];case 5:return a=e.sent(),f={error:a},[3,7];case 6:try{n&&!n.done&&(h=t.return)&&h.call(t)}finally{if(f)throw f.error}return[7];case 7:e.trys.push([7,12,13,14]),o=r.__values(this.timerTasks),c=o.next(),e.label=8;case 8:return c.done?[3,11]:(u=c.value,[4,s.cancel(this.timerTasks[u])]);case 9:e.sent(),delete this.timerTasks[u],e.label=10;case 10:return c=o.next(),[3,8];case 11:return[3,14];case 12:return l=e.sent(),d={error:l},[3,14];case 13:try{c&&!c.done&&(m=o.return)&&m.call(o)}finally{if(d)throw d.error}return[7];case 14:return[2]}}))})),this.listenerMessage=function(e,t){if(t instanceof Error&&(e.errorMessage||c)){var r=e.errorMessage||c;return"function"==typeof r?r(t):r}var n=e.successMessage||o;return"function"==typeof n?n(t):n},this.listenerId=function(e,t){return e.idGenerator?e.idGenerator(t):Math.random().toString(36).substr(2,9)},this.saga=n.createSaga((function(){var e,n;return r.__generator(this,(function(i){switch(i.label){case 0:e=function(){var e,i,a,o,c,l,f,h,d,m;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,s.raceListeners(t,"action")];case 1:return(e=r.sent())?(i=e.action.payload,a=e.listener,o=n.listenerMessage(a,i),c=a.timeout||u,l=n.listenerId(a,i),n.getState().notifications.filter((function(e){return e.id===l})).length>0?[4,s.put(n.actionUpdateNotification)({id:l,payload:o,error:i instanceof Error,type:a.type})]:[3,3]):[2,"continue"];case 2:return r.sent(),[3,5];case 3:return[4,s.put(n.actionAddNotification)({id:l,payload:o,error:i instanceof Error,type:a.type})];case 4:r.sent(),r.label=5;case 5:return a.actionRemove?(f=n.removeTasks,h=l,[4,s.fork(n.removeNotification,l,a.actionRemove)]):[3,7];case 6:f[h]=r.sent(),r.label=7;case 7:return void 0===c?[3,9]:(d=n.timerTasks,m=l,[4,s.fork(n.timeout,l,c)]);case 8:d[m]=r.sent(),r.label=9;case 9:return[2]}}))},n=this,i.label=1;case 1:return[5,e()];case 2:return i.sent(),[3,1];case 3:return[2]}}))}))}return e.prototype.timeout=function(e,t){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,s.delay(t)];case 1:return r.sent(),[4,s.put(this.actionRemoveNotification)(e)];case 2:return r.sent(),this.removeTasks.hasOwnProperty(e)?[4,s.cancel(this.removeTasks[e])]:[3,4];case 3:r.sent(),delete this.removeTasks[e],r.label=4;case 4:return this.timerTasks.hasOwnProperty(e)&&delete this.timerTasks[e],[2]}}))},e.prototype.removeNotification=function(e,t){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,s.take([t])];case 1:return r.sent(),[4,s.put(this.actionRemoveNotification)(e)];case 2:return r.sent(),this.timerTasks.hasOwnProperty(e)?[4,s.cancel(this.timerTasks[e])]:[3,4];case 3:r.sent(),delete this.timerTasks[e],r.label=4;case 4:return this.removeTasks.hasOwnProperty(e)&&delete this.removeTasks[e],[2]}}))},e})()}}));
//# sourceMappingURL=notification_manager.min.js-vflEYPhZL.map