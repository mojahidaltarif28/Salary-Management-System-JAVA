define(["require","exports","tslib","react","comments2/components/rich_facepile/context","spectrum/avatar","spectrum/facepile","comments2/components/rich_facepile/spectrum_fork/facepile_members_avatar","spectrum/util/uuid_generator","comments2/components/rich_facepile/leave_active_mode_wrapper"],(function(e,o,t,n,i,r,a,s,c,l){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),n=t.__importStar(n),o.OVERFLOW="overflow",o.MAX_FACES=5;var d;(d=o.DisplayMode||(o.DisplayMode={}))[d.Auto=1]="Auto",d[d.ForceShow=2]="ForceShow",d[d.ForceHide=3]="ForceHide",d[d.Hover=4]="Hover";var v=(function(e){function i(){var t=e.apply(this,arguments)||this;return t.state={},t.tooltipContentWrapperClassName=c.generateUUID("sc-rich-facepile-tooltip-content"),t.documentClickListener=function(e){var o=e.target;void 0===t.state.activeTooltipIndex||t.closest(o,t.tooltipContentWrapperClassName)||t.closest(o,"mc-facepile-container")||t.setActiveTooltipIndex(void 0)},t.leaveActiveMode=function(){t.setActiveTooltipIndex(void 0)},t.bindN=function(e){for(var t=[],n=function(o){t.push((function(){return e(o)}))},i=0;i<o.MAX_FACES;i++)n(i);return t},t.onTooltipShownForIndex=function(e){if(!t.activeMode){var o=t.props.onTooltipChange,n=t.infoFromIndex(e);if(o&&null!==n){var i=t.avatarRectForIndex(e,n);o({activeMode:t.activeMode,displayInfo:null},{activeMode:t.activeMode,displayInfo:n,avatarRect:i})}}},t.onTooltipHiddenForIndex=function(e){if(!t.activeMode){var o=t.props.onTooltipChange,n=t.infoFromIndex(e);o&&null!==n&&o({activeMode:t.activeMode,displayInfo:n},{activeMode:t.activeMode,displayInfo:null})}},t.onAvatarClickForIndex=function(e){var n=t.props,i=n.becomePassiveOnOverflowAvatarClick,r=n.onAvatarClick,a=t.infoFromIndex(e),s=i&&a===o.OVERFLOW;s||t.activeMode||t.setActiveTooltipIndex(e),s&&t.activeMode&&t.setActiveTooltipIndex(void 0),a&&r&&r(a)},t.onAvatarMouseOverForIndex=function(e){t.activeMode&&t.setActiveTooltipIndex(e)},t.onAvatarMouseEnterForIndex=function(e){if(t.props.onAvatarMouseEnter){var o=t.infoFromIndex(e),n=t.avatarRectForIndex(e,o);t.props.onAvatarMouseEnter({activeMode:t.activeMode,displayInfo:o,avatarRect:n})}},t.onAvatarFocusForIndex=function(e){t.onAvatarMouseEnterForIndex(e),t.onAvatarMouseOverForIndex(e)},t.onTooltipShown=t.bindN(t.onTooltipShownForIndex),t.onTooltipHidden=t.bindN(t.onTooltipHiddenForIndex),t.onAvatarClick=t.bindN(t.onAvatarClickForIndex),t.onAvatarMouseOver=t.bindN(t.onAvatarMouseOverForIndex),t.onAvatarMouseEnter=t.bindN(t.onAvatarMouseEnterForIndex),t.onAvatarFocus=t.bindN(t.onAvatarFocusForIndex),t.avatarDivRefs=Array(o.MAX_FACES).fill(0).map((function(e){return n.createRef()})),t}return t.__extends(i,e),i.prototype.componentDidMount=function(){document.addEventListener("click",this.documentClickListener,!0),window.addEventListener("resize",this.leaveActiveMode,!0)},i.prototype.componentWillUnmount=function(){document.removeEventListener("click",this.documentClickListener,!0),window.removeEventListener("resize",this.leaveActiveMode,!0)},i.prototype.closest=function(e,o){for(;e;e=e.parentElement)if(e.classList.contains(o))return e;return null},Object.defineProperty(i.prototype,"activeMode",{get:function(){return void 0!==this.state.activeTooltipIndex},enumerable:!0,configurable:!0}),i.prototype.setActiveTooltipIndex=function(e){var o=this.state.activeTooltipIndex,t=this.props.onTooltipChange;if(t&&o!==e){var n=this.activeMode,i=void 0!==e,r=i?this.infoFromIndex(e):null;t({activeMode:n,displayInfo:n?this.infoFromIndex(o):r},{activeMode:i,displayInfo:r,avatarRect:i?this.avatarRectForIndex(e,r):void 0})}this.setState({activeTooltipIndex:e})},i.prototype.displayModeForIndex=function(e){var t=this.state.activeTooltipIndex,n=this.props.passiveShowOnHover?o.DisplayMode.Hover:o.DisplayMode.Auto;return void 0===t?n:t===e?o.DisplayMode.ForceShow:o.DisplayMode.ForceHide},i.prototype.infoFromIndex=function(e){var t=this.props,n=t.avatarInfoList,i=t.avatarInfoList.length;return t.overflowRemainderCount&&e===i?o.OVERFLOW:e>=i?null:n[e]},i.prototype.getBoundingClientRectForRef=function(e){var o=e.current;return o?o.getBoundingClientRect():{left:-1,top:-1,width:0,height:0,right:-1,bottom:-1}},i.prototype.avatarRectForIndex=function(e,o){if(void 0===o&&(o=this.infoFromIndex(e)),o){var t=this.getBoundingClientRectForRef(this.avatarDivRefs[e]);return{origin:{x:t.left,y:t.top},size:{width:t.width,height:t.height}}}},Object.defineProperty(i.prototype,"intl",{get:function(){return this.context.intl},enumerable:!0,configurable:!0}),i.prototype.render=function(){var e=this,t=this.props,i=t.avatarSize,c=t.avatarInfoList,d=t.overflowRemainderCount,v=t.tooltipComponent,p=t.renderFacepile,u=c.map((function(o,t){var a,c=o.present,d=o.activeTooltipContent,p=o.avatarColorSeed,u=o.displayName,f=o.initials,h=o.memberKey,m=o.passiveTooltipContent,M=o.photoUrl,C=p||u,F=n.createElement("div",{onFocusCapture:e.onAvatarFocus[t],ref:e.avatarDivRefs[t]},n.createElement(s.FacepileMembersAvatar,{active:c,"aria-label":u,avatarColorSeed:C,avatarSize:i,initials:f,onClick:e.onAvatarClick[t],onMouseEnter:e.onAvatarMouseEnter[t],onMouseOver:e.onAvatarMouseOver[t],photoUrl:M}));return e.activeMode?null!==(a=void 0!==d?d:m)&&(a=n.createElement(l.LeaveActiveModeWrapperContext.Provider,{value:{signalClick:e.leaveActiveMode}},a)):a=m,n.createElement(v,{avatar:F,displayMode:e.displayModeForIndex(t),tooltipContent:a,avatarColor:r.avatarColorForUserIdentifier(C),onTooltipShown:e.onTooltipShown[t],onTooltipHidden:e.onTooltipHidden[t],tooltipContentWrapperClassName:e.tooltipContentWrapperClassName,key:h})})),f=this.intl;if(d){var h=f.formatMessage({id:"tkBGME",defaultMessage:"99+"}),m=d>=99?h:""+d,M=c.length,C=n.createElement("div",{onFocusCapture:this.onAvatarMouseOver[M],ref:this.avatarDivRefs[M]},n.createElement(a.FacepileMembersOverflowCircle,{avatarSize:i,backgroundColor:"#627283",textColor:"white",onClick:this.onAvatarClick[M],onMouseOver:this.onAvatarMouseOver[M],remainderCount:m})),F=f.formatMessage({id:"U34Aor",defaultMessage:"{count, plural, one {# other} other {# others}}"},{count:d});u.push(n.createElement(v,{avatar:C,displayMode:this.displayModeForIndex(M),tooltipContent:n.createElement("div",{className:"sc-rich-facepile-overflow-tooltip-content"},F),avatarColor:"#627283",onTooltipShown:this.onTooltipShown[M],onTooltipHidden:this.onTooltipHidden[M],tooltipContentWrapperClassName:this.tooltipContentWrapperClassName,key:o.OVERFLOW}))}return p(u)},i})(n.Component);o.Avatars=v,v.contextType=i.RichFacepileContext}));
//# sourceMappingURL=avatars.min.js-vflTyI6my.map